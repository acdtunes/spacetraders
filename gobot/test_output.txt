[1;37mFeature:[0m Contract Entity

  [1;37mScenario:[0m Create a valid contract with single delivery                 [1;30m# features/domain/contract/contract_entity.feature:3[0m
    [32mGiven[0m [32ma contract with ID "contract-1" for player 1[0m                   [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "COSMIC"[0m                                [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "PROCUREMENT"[0m                               [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 1000 credits on acceptance and 5000 on fulfillment[0m    [1;30m# contract_steps.go:412 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 100 units of "IRON_ORE" to "X1-GZ7-A1" is required[0m [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mWhen[0m [32mI create the contract[0m                                           [1;30m# contract_steps.go:422 -> *contractContext[0m
    [32mThen[0m [32mthe contract should be created successfully[0m                     [1;30m# contract_steps.go:432 -> *contractContext[0m
    [32mAnd[0m [32mthe contract ID should be "contract-1"[0m                           [1;30m# contract_steps.go:433 -> *contractContext[0m
    [32mAnd[0m [32mthe contract should not be accepted[0m                              [1;30m# contract_steps.go:434 -> *contractContext[0m
    [32mAnd[0m [32mthe contract should not be fulfilled[0m                             [1;30m# contract_steps.go:435 -> *contractContext[0m

  [1;37mScenario:[0m Accept a pending contract    [1;30m# features/domain/contract/contract_entity.feature:15[0m
    [32mGiven[0m [32ma valid unaccepted contract[0m    [1;30m# contract_steps.go:414 -> *contractContext[0m
    [32mWhen[0m [32mI accept the contract[0m           [1;30m# contract_steps.go:423 -> *contractContext[0m
    [32mThen[0m [32mthe contract should be accepted[0m [1;30m# contract_steps.go:436 -> *contractContext[0m

  [1;37mScenario:[0m Cannot accept an already accepted contract             [1;30m# features/domain/contract/contract_entity.feature:20[0m
    [32mGiven[0m [32ma valid accepted contract[0m                                [1;30m# contract_steps.go:415 -> *contractContext[0m
    [32mWhen[0m [32mI try to accept the contract[0m                              [1;30m# contract_steps.go:424 -> *contractContext[0m
    [32mThen[0m [32mI should get a contract error "contract already accepted"[0m [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Deliver cargo for valid delivery                                       [1;30m# features/domain/contract/contract_entity.feature:25[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [32mWhen[0m [32mI deliver 50 units of "IRON_ORE"[0m                                          [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mThen[0m [32mthe delivery should show 50 units fulfilled[0m                               [1;30m# contract_steps.go:438 -> *contractContext[0m
    [32mAnd[0m [32mthe contract should not be fulfilled[0m                                       [1;30m# contract_steps.go:435 -> *contractContext[0m

  [1;37mScenario:[0m Deliver remaining cargo completes delivery                 [1;30m# features/domain/contract/contract_entity.feature:31[0m
    [32mGiven[0m [32ma contract with 50 of 100 "IRON_ORE" units already delivered[0m [1;30m# contract_steps.go:417 -> *contractContext[0m
    [32mWhen[0m [32mI deliver 50 units of "IRON_ORE"[0m                              [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mThen[0m [32mthe delivery should show 100 units fulfilled[0m                  [1;30m# contract_steps.go:438 -> *contractContext[0m

  [1;37mScenario:[0m Cannot deliver more than required                                      [1;30m# features/domain/contract/contract_entity.feature:36[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [32mWhen[0m [32mI try to deliver 150 units of "IRON_ORE"[0m                                  [1;30m# contract_steps.go:426 -> *contractContext[0m
    [32mThen[0m [32mI should get a contract error "units exceed required"[0m                     [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Cannot deliver invalid trade symbol                                    [1;30m# features/domain/contract/contract_entity.feature:41[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [32mWhen[0m [32mI try to deliver 50 units of "COPPER_ORE"[0m                                 [1;30m# contract_steps.go:426 -> *contractContext[0m
    [32mThen[0m [32mI should get a contract error "trade symbol not in contract"[0m              [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Check if contract can be fulfilled (all complete) [1;30m# features/domain/contract/contract_entity.feature:46[0m
    [32mGiven[0m [32ma contract with all deliveries fulfilled[0m            [1;30m# contract_steps.go:418 -> *contractContext[0m
    [32mWhen[0m [32mI check if contract can be fulfilled[0m                 [1;30m# contract_steps.go:427 -> *contractContext[0m
    [32mThen[0m [32mthe contract can be fulfilled[0m                        [1;30m# contract_steps.go:439 -> *contractContext[0m

  [1;37mScenario:[0m Check if contract cannot be fulfilled (incomplete) [1;30m# features/domain/contract/contract_entity.feature:51[0m
    [32mGiven[0m [32ma contract with incomplete deliveries[0m                [1;30m# contract_steps.go:419 -> *contractContext[0m
    [32mWhen[0m [32mI check if contract can be fulfilled[0m                  [1;30m# contract_steps.go:427 -> *contractContext[0m
    [32mThen[0m [32mthe contract cannot be fulfilled[0m                      [1;30m# contract_steps.go:440 -> *contractContext[0m

  [1;37mScenario:[0m Fulfill a complete contract            [1;30m# features/domain/contract/contract_entity.feature:56[0m
    [32mGiven[0m [32ma contract with all deliveries fulfilled[0m [1;30m# contract_steps.go:418 -> *contractContext[0m
    [32mWhen[0m [32mI fulfill the contract[0m                    [1;30m# contract_steps.go:428 -> *contractContext[0m
    [32mThen[0m [32mthe contract should be fulfilled[0m          [1;30m# contract_steps.go:441 -> *contractContext[0m

  [1;37mScenario:[0m Cannot fulfill incomplete contract                   [1;30m# features/domain/contract/contract_entity.feature:61[0m
    [32mGiven[0m [32ma contract with incomplete deliveries[0m                  [1;30m# contract_steps.go:419 -> *contractContext[0m
    [32mWhen[0m [32mI try to fulfill the contract[0m                           [1;30m# contract_steps.go:429 -> *contractContext[0m
    [32mThen[0m [32mI should get a contract error "deliveries not complete"[0m [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Cannot create contract with empty ID                                [1;30m# features/domain/contract/contract_entity.feature:70[0m
    [33mWhen[0m [33mI attempt to create a contract with empty contract_id[0m
    [33mThen[0m [33mcontract creation should fail with error "contract_id cannot be empty"[0m

  [1;37mScenario:[0m Cannot create contract with zero player ID                         [1;30m# features/domain/contract/contract_entity.feature:74[0m
    [33mWhen[0m [33mI attempt to create a contract with player_id 0[0m
    [33mThen[0m [33mcontract creation should fail with error "player_id must be positive"[0m

  [1;37mScenario:[0m Cannot create contract with negative player ID                     [1;30m# features/domain/contract/contract_entity.feature:78[0m
    [33mWhen[0m [33mI attempt to create a contract with player_id -1[0m
    [33mThen[0m [33mcontract creation should fail with error "player_id must be positive"[0m

  [1;37mScenario:[0m Cannot create contract with empty faction                              [1;30m# features/domain/contract/contract_entity.feature:82[0m
    [33mWhen[0m [33mI attempt to create a contract with empty faction_symbol[0m
    [33mThen[0m [33mcontract creation should fail with error "faction_symbol cannot be empty"[0m

  [1;37mScenario:[0m Cannot create contract with no deliveries                               [1;30m# features/domain/contract/contract_entity.feature:86[0m
    [32mGiven[0m [32ma contract with ID "contract-1" for player 1[0m                              [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "COSMIC"[0m                                           [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "PROCUREMENT"[0m                                          [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 1000 credits on acceptance and 5000 on fulfillment[0m               [1;30m# contract_steps.go:412 -> *contractContext[0m
    [33mWhen[0m [33mI attempt to create the contract with no deliveries[0m
    [33mThen[0m [33mcontract creation should fail with error "must have at least one delivery"[0m

  [1;37mScenario:[0m Create contract with multiple deliveries                      [1;30m# features/domain/contract/contract_entity.feature:98[0m
    [32mGiven[0m [32ma contract with ID "contract-2" for player 1[0m                    [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "COSMIC"[0m                                 [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "PROCUREMENT"[0m                                [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 2000 credits on acceptance and 10000 on fulfillment[0m    [1;30m# contract_steps.go:412 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 100 units of "IRON_ORE" to "X1-GZ7-A1" is required[0m  [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 50 units of "COPPER_ORE" to "X1-GZ7-A1" is required[0m [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mWhen[0m [32mI create the contract[0m                                            [1;30m# contract_steps.go:422 -> *contractContext[0m
    [32mThen[0m [32mthe contract should be created successfully[0m                      [1;30m# contract_steps.go:432 -> *contractContext[0m
    [33mAnd[0m [33mthe contract should have 2 deliveries[0m

  [1;37mScenario:[0m Partially fulfill multi-delivery contract              [1;30m# features/domain/contract/contract_entity.feature:109[0m
    [33mGiven[0m [33ma valid accepted contract with multiple deliveries:[0m
      | [36mtrade_symbol[0m | [36munits_required[0m | [36mdestination[0m |
      | [36mIRON_ORE[0m     | [36m100[0m            | [36mX1-GZ7-A1[0m   |
      | [36mCOPPER_ORE[0m   | [36m50[0m             | [36mX1-GZ7-A1[0m   |
    [36mWhen[0m [36mI deliver 100 units of "IRON_ORE"[0m                         [1;30m# contract_steps.go:425 -> *contractContext[0m
    [36mAnd[0m [36mI deliver 25 units of "COPPER_ORE"[0m                         [1;30m# contract_steps.go:425 -> *contractContext[0m
    [36mThen[0m [36mthe contract should not be fulfilled[0m                      [1;30m# contract_steps.go:435 -> *contractContext[0m
    [33mAnd[0m [33m"IRON_ORE" delivery should be complete[0m
    [33mAnd[0m [33m"COPPER_ORE" delivery should have 25 of 50 units fulfilled[0m

  [1;37mScenario:[0m Fulfill all deliveries in multi-delivery contract [1;30m# features/domain/contract/contract_entity.feature:120[0m
    [33mGiven[0m [33ma valid accepted contract with multiple deliveries:[0m
      | [36mtrade_symbol[0m | [36munits_required[0m | [36mdestination[0m |
      | [36mIRON_ORE[0m     | [36m100[0m            | [36mX1-GZ7-A1[0m   |
      | [36mCOPPER_ORE[0m   | [36m50[0m             | [36mX1-GZ7-A1[0m   |
    [36mWhen[0m [36mI deliver 100 units of "IRON_ORE"[0m                    [1;30m# contract_steps.go:425 -> *contractContext[0m
    [36mAnd[0m [36mI deliver 50 units of "COPPER_ORE"[0m                    [1;30m# contract_steps.go:425 -> *contractContext[0m
    [33mThen[0m [33mthe contract should be fulfillable[0m
    [33mAnd[0m [33mI can fulfill the contract successfully[0m

  [1;37mScenario:[0m Deliver zero units does nothing                                        [1;30m# features/domain/contract/contract_entity.feature:134[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [32mWhen[0m [32mI deliver 0 units of "IRON_ORE"[0m                                           [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mThen[0m [32mthe delivery should show 0 units fulfilled[0m                                [1;30m# contract_steps.go:438 -> *contractContext[0m

  [1;37mScenario:[0m Deliver negative units raises error                                    [1;30m# features/domain/contract/contract_entity.feature:139[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [33mWhen[0m [33mI try to deliver -10 units of "IRON_ORE"[0m
    [36mThen[0m [36mI should get a contract error "units must be positive"[0m                    [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Deliver to contract before accepting raises error  [1;30m# features/domain/contract/contract_entity.feature:144[0m
    [32mGiven[0m [32ma valid unaccepted contract[0m                          [1;30m# contract_steps.go:414 -> *contractContext[0m
    [32mWhen[0m [32mI try to deliver 50 units of "IRON_ORE"[0m               [1;30m# contract_steps.go:426 -> *contractContext[0m
    [31mThen[0m [31mI should get a contract error "contract not accepted"[0m [1;30m# contract_steps.go:437 -> *contractContext[0m
    [1;31mexpected error 'contract not accepted', got nil[0m

  [1;37mScenario:[0m Deliver exact remaining amount completes delivery          [1;30m# features/domain/contract/contract_entity.feature:149[0m
    [32mGiven[0m [32ma contract with 99 of 100 "IRON_ORE" units already delivered[0m [1;30m# contract_steps.go:417 -> *contractContext[0m
    [33mWhen[0m [33mI deliver 1 unit of "IRON_ORE"[0m
    [36mThen[0m [36mthe delivery should show 100 units fulfilled[0m                  [1;30m# contract_steps.go:438 -> *contractContext[0m
    [33mAnd[0m [33mthe contract should be fulfillable[0m

  [1;37mScenario:[0m Multiple deliveries to same contract accumulate                        [1;30m# features/domain/contract/contract_entity.feature:155[0m
    [32mGiven[0m [32ma valid accepted contract with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m [1;30m# contract_steps.go:416 -> *contractContext[0m
    [32mWhen[0m [32mI deliver 25 units of "IRON_ORE"[0m                                          [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mAnd[0m [32mI deliver 25 units of "IRON_ORE"[0m                                           [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mAnd[0m [32mI deliver 25 units of "IRON_ORE"[0m                                           [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mAnd[0m [32mI deliver 25 units of "IRON_ORE"[0m                                           [1;30m# contract_steps.go:425 -> *contractContext[0m
    [32mThen[0m [32mthe delivery should show 100 units fulfilled[0m                              [1;30m# contract_steps.go:438 -> *contractContext[0m

  [1;37mScenario:[0m Check if contract is expired                  [1;30m# features/domain/contract/contract_entity.feature:167[0m
    [33mGiven[0m [33ma contract with deadline "2020-01-01T00:00:00Z"[0m
    [33mWhen[0m [33mI check if contract is expired[0m
    [33mThen[0m [33mthe contract should be expired[0m

  [1;37mScenario:[0m Check if contract is not expired              [1;30m# features/domain/contract/contract_entity.feature:172[0m
    [33mGiven[0m [33ma contract with deadline "2030-01-01T00:00:00Z"[0m
    [33mWhen[0m [33mI check if contract is expired[0m
    [33mThen[0m [33mthe contract should not be expired[0m

  [1;37mScenario:[0m Check if contract with no deadline is not expired [1;30m# features/domain/contract/contract_entity.feature:177[0m
    [33mGiven[0m [33ma contract with no deadline[0m
    [33mWhen[0m [33mI check if contract is expired[0m
    [33mThen[0m [33mthe contract should not be expired[0m

  [1;37mScenario:[0m Cannot accept a fulfilled contract                      [1;30m# features/domain/contract/contract_entity.feature:186[0m
    [33mGiven[0m [33ma fully fulfilled contract[0m
    [36mWhen[0m [36mI try to accept the contract[0m                               [1;30m# contract_steps.go:424 -> *contractContext[0m
    [36mThen[0m [36mI should get a contract error "contract already fulfilled"[0m [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Cannot fulfill an unaccepted contract                  [1;30m# features/domain/contract/contract_entity.feature:191[0m
    [33mGiven[0m [33ma valid unaccepted contract with all deliveries complete[0m
    [36mWhen[0m [36mI try to fulfill the contract[0m                             [1;30m# contract_steps.go:429 -> *contractContext[0m
    [36mThen[0m [36mI should get a contract error "contract not accepted"[0m     [1;30m# contract_steps.go:437 -> *contractContext[0m

  [1;37mScenario:[0m Fulfilling a contract marks it as fulfilled [1;30m# features/domain/contract/contract_entity.feature:196[0m
    [32mGiven[0m [32ma contract with all deliveries fulfilled[0m      [1;30m# contract_steps.go:418 -> *contractContext[0m
    [32mWhen[0m [32mI fulfill the contract[0m                         [1;30m# contract_steps.go:428 -> *contractContext[0m
    [32mThen[0m [32mthe contract should be fulfilled[0m               [1;30m# contract_steps.go:441 -> *contractContext[0m
    [32mAnd[0m [32mthe contract should be accepted[0m                 [1;30m# contract_steps.go:436 -> *contractContext[0m

  [1;37mScenario:[0m Contract has correct acceptance payment                      [1;30m# features/domain/contract/contract_entity.feature:206[0m
    [32mGiven[0m [32ma contract with ID "contract-1" for player 1[0m                   [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "COSMIC"[0m                                [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "PROCUREMENT"[0m                               [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 1000 credits on acceptance and 5000 on fulfillment[0m    [1;30m# contract_steps.go:412 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 100 units of "IRON_ORE" to "X1-GZ7-A1" is required[0m [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mWhen[0m [32mI create the contract[0m                                           [1;30m# contract_steps.go:422 -> *contractContext[0m
    [33mThen[0m [33mthe contract acceptance payment should be 1000 credits[0m
    [33mAnd[0m [33mthe contract fulfillment payment should be 5000 credits[0m

  [1;37mScenario:[0m Contract type is correctly set                               [1;30m# features/domain/contract/contract_entity.feature:216[0m
    [32mGiven[0m [32ma contract with ID "contract-1" for player 1[0m                   [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "COSMIC"[0m                                [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "TRANSPORT"[0m                                 [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 1000 credits on acceptance and 5000 on fulfillment[0m    [1;30m# contract_steps.go:412 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 100 units of "IRON_ORE" to "X1-GZ7-A1" is required[0m [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mWhen[0m [32mI create the contract[0m                                           [1;30m# contract_steps.go:422 -> *contractContext[0m
    [33mThen[0m [33mthe contract type should be "TRANSPORT"[0m

  [1;37mScenario:[0m Contract faction is correctly set                            [1;30m# features/domain/contract/contract_entity.feature:225[0m
    [32mGiven[0m [32ma contract with ID "contract-1" for player 1[0m                   [1;30m# contract_steps.go:409 -> *contractContext[0m
    [32mAnd[0m [32mthe contract has faction "UNITED"[0m                                [1;30m# contract_steps.go:410 -> *contractContext[0m
    [32mAnd[0m [32mthe contract type is "PROCUREMENT"[0m                               [1;30m# contract_steps.go:411 -> *contractContext[0m
    [32mAnd[0m [32mpayment is 1000 credits on acceptance and 5000 on fulfillment[0m    [1;30m# contract_steps.go:412 -> *contractContext[0m
    [32mAnd[0m [32ma delivery of 100 units of "IRON_ORE" to "X1-GZ7-A1" is required[0m [1;30m# contract_steps.go:413 -> *contractContext[0m
    [32mWhen[0m [32mI create the contract[0m                                           [1;30m# contract_steps.go:422 -> *contractContext[0m
    [33mThen[0m [33mthe contract faction should be "UNITED"[0m

[1;37mFeature:[0m Market Value Object
  As a market scouting system
  I need to aggregate trade goods data for a market
  So that I can query and track market state over time

  [1;37mBackground:[0m
    [32mGiven[0m [32mI have a market at waypoint "X1-TEST-A1"[0m                                                         [1;30m# scouting_market_steps.go:44 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Create market with multiple trade goods                                                        [1;30m# features/domain/market/market.feature:9[0m
    [32mGiven[0m [32mI have the following trade goods:[0m                                                                [1;30m# scouting_market_steps.go:47 -> *scoutingMarketContext[0m
      | [36msymbol[0m   | [36msupply[0m   | [36mactivity[0m | [36mpurchase_price[0m | [36msell_price[0m | [36mtrade_volume[0m |
      | [36mIRON_ORE[0m | [36mMODERATE[0m | [36mSTRONG[0m   | [36m50[0m             | [36m100[0m        | [36m500[0m          |
      | [36mFUEL[0m     | [36mHIGH[0m     | [36mWEAK[0m     | [36m10[0m             | [36m20[0m         | [36m1000[0m         |
      | [36mFOOD[0m     | [36mLIMITED[0m  | [36mGROWING[0m  | [36m30[0m             | [36m60[0m         | [36m200[0m          |
    [32mWhen[0m [32mI create a market with waypoint "X1-TEST-A1" at timestamp "2025-11-13T12:00:00Z" with these goods[0m [1;30m# scouting_market_steps.go:51 -> *scoutingMarketContext[0m
    [32mThen[0m [32mthe market should have waypoint symbol "X1-TEST-A1"[0m                                               [1;30m# scouting_market_steps.go:66 -> *scoutingMarketContext[0m
    [32mAnd[0m [32mthe market should have 3 trade goods[0m                                                               [1;30m# market_steps.go:293 -> *marketContext[0m
    [32mAnd[0m [32mthe market should have last updated "2025-11-13T12:00:00Z"[0m                                         [1;30m# scouting_market_steps.go:68 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Create market with no trade goods                                                           [1;30m# features/domain/market/market.feature:20[0m
    [32mWhen[0m [32mI create a market with waypoint "X1-TEST-A1" at timestamp "2025-11-13T12:00:00Z" with no goods[0m [1;30m# scouting_market_steps.go:53 -> *scoutingMarketContext[0m
    [32mThen[0m [32mthe market should have waypoint symbol "X1-TEST-A1"[0m                                            [1;30m# scouting_market_steps.go:66 -> *scoutingMarketContext[0m
    [32mAnd[0m [32mthe market should have 0 trade goods[0m                                                            [1;30m# market_steps.go:293 -> *marketContext[0m
    [32mAnd[0m [32mthe market should have last updated "2025-11-13T12:00:00Z"[0m                                      [1;30m# scouting_market_steps.go:68 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Find specific trade good in market                            [1;30m# features/domain/market/market.feature:26[0m
    [32mGiven[0m [32mI have the following trade goods:[0m                               [1;30m# scouting_market_steps.go:47 -> *scoutingMarketContext[0m
      | [36msymbol[0m   | [36msupply[0m   | [36mactivity[0m | [36mpurchase_price[0m | [36msell_price[0m | [36mtrade_volume[0m |
      | [36mIRON_ORE[0m | [36mMODERATE[0m | [36mSTRONG[0m   | [36m50[0m             | [36m100[0m        | [36m500[0m          |
      | [36mFUEL[0m     | [36mHIGH[0m     | [36mWEAK[0m     | [36m10[0m             | [36m20[0m         | [36m1000[0m         |
    [32mAnd[0m [32mI have created a market with these goods at "X1-TEST-A1"[0m          [1;30m# scouting_market_steps.go:48 -> *scoutingMarketContext[0m
    [32mWhen[0m [32mI search for good "IRON_ORE" in the market[0m                       [1;30m# scouting_market_steps.go:61 -> *scoutingMarketContext[0m
    [32mThen[0m [32mI should find the good with purchase price 50 and sell price 100[0m [1;30m# scouting_market_steps.go:69 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Check if market has specific good                    [1;30m# features/domain/market/market.feature:35[0m
    [32mGiven[0m [32mI have the following trade goods:[0m                      [1;30m# scouting_market_steps.go:47 -> *scoutingMarketContext[0m
      | [36msymbol[0m   | [36msupply[0m   | [36mactivity[0m | [36mpurchase_price[0m | [36msell_price[0m | [36mtrade_volume[0m |
      | [36mIRON_ORE[0m | [36mMODERATE[0m | [36mSTRONG[0m   | [36m50[0m             | [36m100[0m        | [36m500[0m          |
      | [36mFUEL[0m     | [36mHIGH[0m     | [36mWEAK[0m     | [36m10[0m             | [36m20[0m         | [36m1000[0m         |
    [32mAnd[0m [32mI have created a market with these goods at "X1-TEST-A1"[0m [1;30m# scouting_market_steps.go:48 -> *scoutingMarketContext[0m
    [32mWhen[0m [32mI check if the market has good "IRON_ORE"[0m               [1;30m# scouting_market_steps.go:62 -> *scoutingMarketContext[0m
    [32mThen[0m [32mthe has good result should be true[0m                      [1;30m# scouting_market_steps.go:72 -> *scoutingMarketContext[0m
    [32mWhen[0m [32mI check if the market has good "FOOD"[0m                   [1;30m# scouting_market_steps.go:62 -> *scoutingMarketContext[0m
    [32mThen[0m [32mthe has good result should be false[0m                     [1;30m# scouting_market_steps.go:72 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Count goods in market                                [1;30m# features/domain/market/market.feature:46[0m
    [32mGiven[0m [32mI have the following trade goods:[0m                      [1;30m# scouting_market_steps.go:47 -> *scoutingMarketContext[0m
      | [36msymbol[0m   | [36msupply[0m   | [36mactivity[0m | [36mpurchase_price[0m | [36msell_price[0m | [36mtrade_volume[0m |
      | [36mIRON_ORE[0m | [36mMODERATE[0m | [36mSTRONG[0m   | [36m50[0m             | [36m100[0m        | [36m500[0m          |
      | [36mFUEL[0m     | [36mHIGH[0m     | [36mWEAK[0m     | [36m10[0m             | [36m20[0m         | [36m1000[0m         |
      | [36mFOOD[0m     | [36mLIMITED[0m  | [36mGROWING[0m  | [36m30[0m             | [36m60[0m         | [36m200[0m          |
    [32mAnd[0m [32mI have created a market with these goods at "X1-TEST-A1"[0m [1;30m# scouting_market_steps.go:48 -> *scoutingMarketContext[0m
    [32mWhen[0m [32mI count the goods in the market[0m                         [1;30m# scouting_market_steps.go:63 -> *scoutingMarketContext[0m
    [32mThen[0m [32mthe goods count should be 3[0m                             [1;30m# scouting_market_steps.go:73 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Reject market with empty waypoint symbol                                          [1;30m# features/domain/market/market.feature:56[0m
    [32mWhen[0m [32mI attempt to create a market with empty waypoint at timestamp "2025-11-13T12:00:00Z"[0m [1;30m# scouting_market_steps.go:55 -> *scoutingMarketContext[0m
    [32mThen[0m [32mI should get a market error "waypoint symbol cannot be empty"[0m                        [1;30m# scouting_market_steps.go:74 -> *scoutingMarketContext[0m

  [1;37mScenario:[0m Reject market with invalid timestamp                                    [1;30m# features/domain/market/market.feature:60[0m
    [32mWhen[0m [32mI attempt to create a market with waypoint "X1-TEST-A1" at empty timestamp[0m [1;30m# scouting_market_steps.go:57 -> *scoutingMarketContext[0m
    [32mThen[0m [32mI should get a market error "timestamp cannot be empty"[0m                    [1;30m# scouting_market_steps.go:74 -> *scoutingMarketContext[0m

[1;37mFeature:[0m TradeGood Value Object
  As a market scouting system
  I need to represent trade goods with prices and supply information
  So that I can track commodity data across markets

  [1;37mBackground:[0m
    [32mGiven[0m [32mI have market trade good data[0m                                                                                                              [1;30m# trade_good_steps.go:33 -> *tradeGoodContext[0m

  [1;37mScenario:[0m Create valid trade good with all fields                                                                                                  [1;30m# features/domain/market/trade_good.feature:9[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON_ORE", supply "MODERATE", activity "STRONG", purchase price 50, sell price 100, and trade volume 500[0m [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have symbol "IRON_ORE"[0m                                                                                                [1;30m# trade_good_steps.go:46 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have supply "MODERATE"[0m                                                                                                 [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have activity "STRONG"[0m                                                                                                 [1;30m# trade_good_steps.go:48 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have purchase price 50[0m                                                                                                 [1;30m# trade_good_steps.go:49 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have sell price 100[0m                                                                                                    [1;30m# trade_good_steps.go:50 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have trade volume 500[0m                                                                                                  [1;30m# trade_good_steps.go:51 -> *tradeGoodContext[0m

  [1;37mScenario:[0m Create trade good with optional nil fields                                                                            [1;30m# features/domain/market/trade_good.feature:18[0m
    [32mWhen[0m [32mI create a trade good with symbol "FUEL", no supply, no activity, purchase price 10, sell price 20, and trade volume 100[0m [1;30m# trade_good_steps.go:38 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have symbol "FUEL"[0m                                                                                 [1;30m# trade_good_steps.go:46 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have nil supply[0m                                                                                     [1;30m# trade_good_steps.go:52 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have nil activity[0m                                                                                   [1;30m# trade_good_steps.go:53 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have purchase price 10[0m                                                                              [1;30m# trade_good_steps.go:49 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have sell price 20[0m                                                                                  [1;30m# trade_good_steps.go:50 -> *tradeGoodContext[0m
    [32mAnd[0m [32mthe trade good should have trade volume 100[0m                                                                               [1;30m# trade_good_steps.go:51 -> *tradeGoodContext[0m

  [1;37mScenario:[0m Reject trade good with negative purchase price                                                                                            [1;30m# features/domain/market/trade_good.feature:27[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "IRON", supply "HIGH", activity "WEAK", purchase price -10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "purchase price must be non-negative"[0m                                                                                  [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Reject trade good with negative sell price                                                                                                [1;30m# features/domain/market/trade_good.feature:31[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "IRON", supply "HIGH", activity "WEAK", purchase price 10, sell price -50, and trade volume 100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "sell price must be non-negative"[0m                                                                                      [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Reject trade good with negative trade volume                                                                                              [1;30m# features/domain/market/trade_good.feature:35[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "IRON", supply "HIGH", activity "WEAK", purchase price 10, sell price 50, and trade volume -100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "trade volume must be non-negative"[0m                                                                                    [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Reject trade good with empty symbol                                                                                                  [1;30m# features/domain/market/trade_good.feature:39[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "", supply "HIGH", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "symbol cannot be empty"[0m                                                                                          [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Accept valid supply values                                                                                                        [1;30m# features/domain/market/trade_good.feature:43[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "SCARCE", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m   [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have supply "SCARCE"[0m                                                                                           [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "LIMITED", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m  [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have supply "LIMITED"[0m                                                                                          [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "MODERATE", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have supply "MODERATE"[0m                                                                                         [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "HIGH", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m     [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have supply "HIGH"[0m                                                                                             [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "ABUNDANT", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have supply "ABUNDANT"[0m                                                                                         [1;30m# trade_good_steps.go:47 -> *tradeGoodContext[0m

  [1;37mScenario:[0m Accept valid activity values                                                                                                        [1;30m# features/domain/market/trade_good.feature:55[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "HIGH", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m       [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have activity "WEAK"[0m                                                                                             [1;30m# trade_good_steps.go:48 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "HIGH", activity "GROWING", purchase price 10, sell price 50, and trade volume 100[0m    [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have activity "GROWING"[0m                                                                                          [1;30m# trade_good_steps.go:48 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "HIGH", activity "STRONG", purchase price 10, sell price 50, and trade volume 100[0m     [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have activity "STRONG"[0m                                                                                           [1;30m# trade_good_steps.go:48 -> *tradeGoodContext[0m
    [32mWhen[0m [32mI create a trade good with symbol "IRON", supply "HIGH", activity "RESTRICTED", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:36 -> *tradeGoodContext[0m
    [32mThen[0m [32mthe trade good should have activity "RESTRICTED"[0m                                                                                       [1;30m# trade_good_steps.go:48 -> *tradeGoodContext[0m

  [1;37mScenario:[0m Reject invalid supply value                                                                                                                 [1;30m# features/domain/market/trade_good.feature:65[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "IRON", supply "INVALID", activity "WEAK", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "invalid supply value"[0m                                                                                                   [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Reject invalid activity value                                                                                                               [1;30m# features/domain/market/trade_good.feature:69[0m
    [32mWhen[0m [32mI attempt to create a trade good with symbol "IRON", supply "HIGH", activity "INVALID", purchase price 10, sell price 50, and trade volume 100[0m [1;30m# trade_good_steps.go:42 -> *tradeGoodContext[0m
    [32mThen[0m [32mI should get an error "invalid activity value"[0m                                                                                                 [1;30m# market_steps.go:294 -> *marketContext[0m

[1;37mFeature:[0m Route Entity
  As a navigation system
  I want to manage routes and route segments
  So that ships can navigate between waypoints

  [1;37mBackground:[0m
    [32mGiven[0m [32mtest waypoints are available:[0m                         [1;30m# route_steps.go:736 -> *routeContext[0m
      | [36msymbol[0m | [36mx[0m     | [36my[0m   |
      | [36mX1-A1[0m  | [36m0.0[0m   | [36m0.0[0m |
      | [36mX1-B2[0m  | [36m100.0[0m | [36m0.0[0m |
      | [36mX1-C3[0m  | [36m200.0[0m | [36m0.0[0m |

  [1;37mScenario:[0m Create route segment with required fields           [1;30m# features/domain/navigation/route_entity.feature:17[0m
    [32mWhen[0m [32mI create a route segment from "X1-A1" to "X1-B2" with:[0m [1;30m# route_steps.go:737 -> *routeContext[0m
      | [36mdistance[0m      | [36m100.0[0m  |
      | [36mfuel_required[0m | [36m50[0m     |
      | [36mtravel_time[0m   | [36m100[0m    |
      | [36mflight_mode[0m   | [36mCRUISE[0m |
    [32mThen[0m [32mthe segment should have from_waypoint "X1-A1"[0m          [1;30m# route_steps.go:738 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have to_waypoint "X1-B2"[0m             [1;30m# route_steps.go:739 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have distance 100.0[0m                  [1;30m# route_steps.go:740 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have fuel_required 50[0m                [1;30m# route_steps.go:741 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have travel_time 100[0m                 [1;30m# route_steps.go:742 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have flight_mode "CRUISE"[0m            [1;30m# route_steps.go:743 -> *routeContext[0m
    [32mAnd[0m [32mthe segment should have requires_refuel false[0m           [1;30m# route_steps.go:744 -> *routeContext[0m

  [1;37mScenario:[0m Create route segment with refuel flag               [1;30m# features/domain/navigation/route_entity.feature:31[0m
    [32mWhen[0m [32mI create a route segment from "X1-A1" to "X1-B2" with:[0m [1;30m# route_steps.go:737 -> *routeContext[0m
      | [36mdistance[0m        | [36m100.0[0m  |
      | [36mfuel_required[0m   | [36m50[0m     |
      | [36mtravel_time[0m     | [36m100[0m    |
      | [36mflight_mode[0m     | [36mCRUISE[0m |
      | [36mrequires_refuel[0m | [36mtrue[0m   |
    [32mThen[0m [32mthe segment should have requires_refuel true[0m           [1;30m# route_steps.go:744 -> *routeContext[0m

  [1;37mScenario:[0m Create route with valid data                              [1;30m# features/domain/navigation/route_entity.feature:44[0m
    [32mGiven[0m [32ma route segment from "X1-A1" to "X1-B2" with distance 100.0[0m [1;30m# route_steps.go:747 -> *routeContext[0m
    [32mAnd[0m [32ma route segment from "X1-B2" to "X1-C3" with distance 100.0[0m   [1;30m# route_steps.go:747 -> *routeContext[0m
    [32mWhen[0m [32mI create a route with:[0m                                       [1;30m# route_steps.go:748 -> *routeContext[0m
      | [36mroute_id[0m           | [36mroute-1[0m |
      | [36mship_symbol[0m        | [36mSHIP-1[0m  |
      | [36mplayer_id[0m          | [36m1[0m       |
      | [36mship_fuel_capacity[0m | [36m100[0m     |
    [32mThen[0m [32mthe route should have route_id "route-1"[0m                     [1;30m# route_steps.go:749 -> *routeContext[0m
    [32mAnd[0m [32mthe route should have ship_symbol "SHIP-1"[0m                    [1;30m# route_steps.go:750 -> *routeContext[0m
    [32mAnd[0m [32mthe route should have player_id 1[0m                             [1;30m# route_steps.go:751 -> *routeContext[0m
    [32mAnd[0m [32mthe route should have 2 segments[0m                              [1;30m# route_steps.go:752 -> *routeContext[0m
    [32mAnd[0m [32mthe route should have status "PLANNED"[0m                        [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Can create route with empty segments for already-at-destination case [1;30m# features/domain/navigation/route_entity.feature:58[0m
    [32mWhen[0m [32mI create a route with empty segments[0m                                    [1;30m# route_steps.go:754 -> *routeContext[0m
    [32mThen[0m [32mthe route should have 0 segments[0m                                        [1;30m# route_steps.go:752 -> *routeContext[0m
    [32mAnd[0m [32mthe route should have status "PLANNED"[0m                                   [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Cannot create route with disconnected segments                  [1;30m# features/domain/navigation/route_entity.feature:63[0m
    [32mGiven[0m [32ma route segment from "X1-A1" to "X1-B2" with distance 100.0[0m       [1;30m# route_steps.go:747 -> *routeContext[0m
    [32mAnd[0m [32ma route segment from "X1-A1" to "X1-C3" with distance 100.0[0m         [1;30m# route_steps.go:747 -> *routeContext[0m
    [32mWhen[0m [32mI attempt to create a route with disconnected segments[0m             [1;30m# route_steps.go:755 -> *routeContext[0m
    [32mThen[0m [32mthe route creation should fail with error "segments not connected"[0m [1;30m# route_steps.go:756 -> *routeContext[0m

  [1;37mScenario:[0m Cannot create route when segment exceeds fuel capacity                              [1;30m# features/domain/navigation/route_entity.feature:69[0m
    [32mGiven[0m [32ma route segment from "X1-A1" to "X1-B2" requiring 150 fuel[0m                            [1;30m# route_steps.go:757 -> *routeContext[0m
    [32mWhen[0m [32mI attempt to create a route with fuel capacity 100[0m                                     [1;30m# route_steps.go:758 -> *routeContext[0m
    [32mThen[0m [32mthe route creation should fail with error "requires 150 fuel but ship capacity is 100"[0m [1;30m# route_steps.go:756 -> *routeContext[0m

  [1;37mScenario:[0m Allow segment at capacity limit                          [1;30m# features/domain/navigation/route_entity.feature:74[0m
    [32mGiven[0m [32ma route segment from "X1-A1" to "X1-B2" requiring 100 fuel[0m [1;30m# route_steps.go:757 -> *routeContext[0m
    [32mWhen[0m [32mI create a route with fuel capacity 100[0m                     [1;30m# route_steps.go:759 -> *routeContext[0m
    [32mThen[0m [32mthe route should be created successfully[0m                    [1;30m# route_steps.go:760 -> *routeContext[0m

  [1;37mScenario:[0m Route starts in planned status      [1;30m# features/domain/navigation/route_entity.feature:83[0m
    [32mGiven[0m [32ma newly created route[0m                 [1;30m# route_steps.go:763 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "PLANNED"[0m [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Start execution transitions to executing [1;30m# features/domain/navigation/route_entity.feature:87[0m
    [32mGiven[0m [32ma route in "PLANNED" status[0m                [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI start route execution[0m                     [1;30m# route_steps.go:767 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "EXECUTING"[0m    [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Cannot start execution when already executing                              [1;30m# features/domain/navigation/route_entity.feature:92[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m                                                [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI attempt to start route execution[0m                                            [1;30m# route_steps.go:768 -> *routeContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot start route in status EXECUTING"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Cannot start execution when completed                                      [1;30m# features/domain/navigation/route_entity.feature:97[0m
    [32mGiven[0m [32ma route in "COMPLETED" status[0m                                                [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI attempt to start route execution[0m                                            [1;30m# route_steps.go:768 -> *routeContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot start route in status COMPLETED"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Complete segment advances index    [1;30m# features/domain/navigation/route_entity.feature:102[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m        [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mAnd[0m [32mthe current_segment_index is 0[0m         [1;30m# route_steps.go:766 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m        [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mThen[0m [32mthe current_segment_index should be 1[0m [1;30m# route_steps.go:771 -> *routeContext[0m

  [1;37mScenario:[0m Complete segment multiple times             [1;30m# features/domain/navigation/route_entity.feature:108[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI complete the current segment[0m                  [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mThen[0m [32mthe current_segment_index should be 2[0m          [1;30m# route_steps.go:771 -> *routeContext[0m

  [1;37mScenario:[0m Complete segment transitions to completed when done [1;30m# features/domain/navigation/route_entity.feature:114[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m         [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                         [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "EXECUTING"[0m               [1;30m# route_steps.go:753 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                         [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "COMPLETED"[0m               [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Cannot complete segment when not executing                                               [1;30m# features/domain/navigation/route_entity.feature:121[0m
    [32mGiven[0m [32ma route in "PLANNED" status[0m                                                                [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI attempt to complete the current segment[0m                                                   [1;30m# route_steps.go:770 -> *routeContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot complete segment when route status is PLANNED"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Fail route transitions to failed             [1;30m# features/domain/navigation/route_entity.feature:126[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m                  [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI fail the route with reason "Navigation error"[0m [1;30m# route_steps.go:773 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "FAILED"[0m           [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Abort route transitions to aborted          [1;30m# features/domain/navigation/route_entity.feature:131[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m                 [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI abort the route with reason "User cancelled"[0m [1;30m# route_steps.go:774 -> *routeContext[0m
    [32mThen[0m [32mthe route should have status "ABORTED"[0m         [1;30m# route_steps.go:753 -> *routeContext[0m

  [1;37mScenario:[0m Calculate total distance              [1;30m# features/domain/navigation/route_entity.feature:140[0m
    [32mGiven[0m [32ma route with segments having distances:[0m [1;30m# route_steps.go:777 -> *routeContext[0m
      | [36m100.0[0m |
      | [36m100.0[0m |
    [32mWhen[0m [32mI calculate the total distance[0m           [1;30m# route_steps.go:781 -> *routeContext[0m
    [32mThen[0m [32mthe total distance should be 200.0[0m       [1;30m# route_steps.go:785 -> *routeContext[0m

  [1;37mScenario:[0m Calculate total fuel required       [1;30m# features/domain/navigation/route_entity.feature:147[0m
    [32mGiven[0m [32ma route with segments requiring fuel:[0m [1;30m# route_steps.go:778 -> *routeContext[0m
      | [36m50[0m |
      | [36m50[0m |
    [32mWhen[0m [32mI calculate the total fuel required[0m    [1;30m# route_steps.go:782 -> *routeContext[0m
    [32mThen[0m [32mthe total fuel required should be 100[0m  [1;30m# route_steps.go:786 -> *routeContext[0m

  [1;37mScenario:[0m Calculate total travel time              [1;30m# features/domain/navigation/route_entity.feature:154[0m
    [32mGiven[0m [32ma route with segments having travel times:[0m [1;30m# route_steps.go:779 -> *routeContext[0m
      | [36m100[0m |
      | [36m100[0m |
    [32mWhen[0m [32mI calculate the total travel time[0m           [1;30m# route_steps.go:783 -> *routeContext[0m
    [32mThen[0m [32mthe total travel time should be 200[0m         [1;30m# route_steps.go:787 -> *routeContext[0m

  [1;37mScenario:[0m Calculations with single segment [1;30m# features/domain/navigation/route_entity.feature:161[0m
    [32mGiven[0m [32ma route with a single segment:[0m     [1;30m# route_steps.go:780 -> *routeContext[0m
      | [36mdistance[0m      | [36m100.0[0m |
      | [36mfuel_required[0m | [36m50[0m    |
      | [36mtravel_time[0m   | [36m100[0m   |
    [32mWhen[0m [32mI calculate route totals[0m            [1;30m# route_steps.go:784 -> *routeContext[0m
    [32mThen[0m [32mthe total distance should be 100.0[0m  [1;30m# route_steps.go:785 -> *routeContext[0m
    [32mAnd[0m [32mthe total fuel required should be 50[0m [1;30m# route_steps.go:786 -> *routeContext[0m
    [32mAnd[0m [32mthe total travel time should be 100[0m  [1;30m# route_steps.go:787 -> *routeContext[0m

  [1;37mScenario:[0m Get first segment initially [1;30m# features/domain/navigation/route_entity.feature:175[0m
    [32mGiven[0m [32ma route with 2 segments[0m       [1;30m# route_steps.go:790 -> *routeContext[0m
    [32mWhen[0m [32mI get the current segment[0m      [1;30m# route_steps.go:791 -> *routeContext[0m
    [32mThen[0m [32mit should be the first segment[0m [1;30m# route_steps.go:792 -> *routeContext[0m

  [1;37mScenario:[0m Get next segment after completion           [1;30m# features/domain/navigation/route_entity.feature:180[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the current segment[0m                       [1;30m# route_steps.go:791 -> *routeContext[0m
    [32mThen[0m [32mit should be the second segment[0m                [1;30m# route_steps.go:793 -> *routeContext[0m

  [1;37mScenario:[0m Returns nil when route completed            [1;30m# features/domain/navigation/route_entity.feature:186[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI complete the current segment[0m                  [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the current segment[0m                       [1;30m# route_steps.go:791 -> *routeContext[0m
    [32mThen[0m [32mthe current segment should be nil[0m              [1;30m# route_steps.go:794 -> *routeContext[0m

  [1;37mScenario:[0m Returns all segments initially    [1;30m# features/domain/navigation/route_entity.feature:197[0m
    [32mGiven[0m [32ma route with 2 segments[0m             [1;30m# route_steps.go:790 -> *routeContext[0m
    [32mWhen[0m [32mI get the remaining segments[0m         [1;30m# route_steps.go:797 -> *routeContext[0m
    [32mThen[0m [32mthere should be 2 remaining segments[0m [1;30m# route_steps.go:798 -> *routeContext[0m

  [1;37mScenario:[0m Returns remaining after completion             [1;30m# features/domain/navigation/route_entity.feature:202[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m    [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                    [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the remaining segments[0m                       [1;30m# route_steps.go:797 -> *routeContext[0m
    [32mThen[0m [32mthere should be 1 remaining segment[0m               [1;30m# route_steps.go:798 -> *routeContext[0m
    [32mAnd[0m [32mthe remaining segment should be the second segment[0m [1;30m# route_steps.go:799 -> *routeContext[0m

  [1;37mScenario:[0m Returns empty list when completed           [1;30m# features/domain/navigation/route_entity.feature:209[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI complete the current segment[0m                  [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the remaining segments[0m                    [1;30m# route_steps.go:797 -> *routeContext[0m
    [32mThen[0m [32mthere should be 0 remaining segments[0m           [1;30m# route_steps.go:798 -> *routeContext[0m

  [1;37mScenario:[0m Returns zero initially       [1;30m# features/domain/navigation/route_entity.feature:220[0m
    [32mGiven[0m [32ma newly created route[0m          [1;30m# route_steps.go:763 -> *routeContext[0m
    [32mWhen[0m [32mI get the current segment index[0m [1;30m# route_steps.go:802 -> *routeContext[0m
    [32mThen[0m [32mthe index should be 0[0m           [1;30m# route_steps.go:803 -> *routeContext[0m

  [1;37mScenario:[0m Returns updated index after completion      [1;30m# features/domain/navigation/route_entity.feature:225[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the current segment index[0m                 [1;30m# route_steps.go:802 -> *routeContext[0m
    [32mThen[0m [32mthe index should be 1[0m                          [1;30m# route_steps.go:803 -> *routeContext[0m

  [1;37mScenario:[0m Returns segment count when completed        [1;30m# features/domain/navigation/route_entity.feature:231[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI complete the current segment[0m                 [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI complete the current segment[0m                  [1;30m# route_steps.go:769 -> *routeContext[0m
    [32mAnd[0m [32mI get the current segment index[0m                 [1;30m# route_steps.go:802 -> *routeContext[0m
    [32mThen[0m [32mthe index should be 2[0m                          [1;30m# route_steps.go:803 -> *routeContext[0m

  [1;37mScenario:[0m Has refuel at start when route requires refuel before departure [1;30m# features/domain/navigation/route_entity.feature:242[0m
    [32mGiven[0m [32ma route with refuel_before_departure true[0m                         [1;30m# route_steps.go:806 -> *routeContext[0m
    [32mThen[0m [32mHasRefuelAtStart should return true[0m                                [1;30m# route_steps.go:807 -> *routeContext[0m

  [1;37mScenario:[0m Does not have refuel at start when route does not require refuel before departure [1;30m# features/domain/navigation/route_entity.feature:246[0m
    [32mGiven[0m [32ma route with refuel_before_departure false[0m                                          [1;30m# route_steps.go:806 -> *routeContext[0m
    [32mThen[0m [32mHasRefuelAtStart should return false[0m                                                 [1;30m# route_steps.go:807 -> *routeContext[0m

  [1;37mScenario:[0m NextSegment returns first segment initially [1;30m# features/domain/navigation/route_entity.feature:250[0m
    [32mGiven[0m [32ma route with 2 segments[0m                       [1;30m# route_steps.go:790 -> *routeContext[0m
    [32mWhen[0m [32mI call NextSegment[0m                             [1;30m# route_steps.go:808 -> *routeContext[0m
    [32mThen[0m [32mit should return the first segment[0m             [1;30m# route_steps.go:809 -> *routeContext[0m

  [1;37mScenario:[0m NextSegment returns current segment when executing [1;30m# features/domain/navigation/route_entity.feature:255[0m
    [32mGiven[0m [32ma route in "EXECUTING" status with 2 segments[0m        [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mAnd[0m [32mthe current_segment_index is 1[0m                         [1;30m# route_steps.go:766 -> *routeContext[0m
    [32mWhen[0m [32mI call NextSegment[0m                                    [1;30m# route_steps.go:808 -> *routeContext[0m
    [32mThen[0m [32mit should return the second segment[0m                   [1;30m# route_steps.go:810 -> *routeContext[0m

  [1;37mScenario:[0m NextSegment returns nil when route completed [1;30m# features/domain/navigation/route_entity.feature:261[0m
    [32mGiven[0m [32ma route in "COMPLETED" status with 2 segments[0m  [1;30m# route_steps.go:765 -> *routeContext[0m
    [32mWhen[0m [32mI call NextSegment[0m                              [1;30m# route_steps.go:808 -> *routeContext[0m
    [32mThen[0m [32mit should return nil[0m                            [1;30m# route_steps.go:811 -> *routeContext[0m

  [1;37mScenario:[0m IsComplete returns false when route is planned [1;30m# features/domain/navigation/route_entity.feature:266[0m
    [32mGiven[0m [32ma route in "PLANNED" status[0m                      [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsComplete[0m                                 [1;30m# route_steps.go:812 -> *routeContext[0m
    [32mThen[0m [32mit should return false[0m                            [1;30m# route_steps.go:813 -> *routeContext[0m

  [1;37mScenario:[0m IsComplete returns false when route is executing [1;30m# features/domain/navigation/route_entity.feature:271[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m                      [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsComplete[0m                                   [1;30m# route_steps.go:812 -> *routeContext[0m
    [32mThen[0m [32mit should return false[0m                              [1;30m# route_steps.go:813 -> *routeContext[0m

  [1;37mScenario:[0m IsComplete returns true when route is completed [1;30m# features/domain/navigation/route_entity.feature:276[0m
    [32mGiven[0m [32ma route in "COMPLETED" status[0m                     [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsComplete[0m                                  [1;30m# route_steps.go:812 -> *routeContext[0m
    [32mThen[0m [32mit should return true[0m                              [1;30m# route_steps.go:813 -> *routeContext[0m

  [1;37mScenario:[0m IsFailed returns false when route is planned [1;30m# features/domain/navigation/route_entity.feature:281[0m
    [32mGiven[0m [32ma route in "PLANNED" status[0m                    [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsFailed[0m                                 [1;30m# route_steps.go:814 -> *routeContext[0m
    [32mThen[0m [32mit should return false[0m                          [1;30m# route_steps.go:813 -> *routeContext[0m

  [1;37mScenario:[0m IsFailed returns false when route is executing [1;30m# features/domain/navigation/route_entity.feature:286[0m
    [32mGiven[0m [32ma route in "EXECUTING" status[0m                    [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsFailed[0m                                   [1;30m# route_steps.go:814 -> *routeContext[0m
    [32mThen[0m [32mit should return false[0m                            [1;30m# route_steps.go:813 -> *routeContext[0m

  [1;37mScenario:[0m IsFailed returns true when route is failed [1;30m# features/domain/navigation/route_entity.feature:291[0m
    [32mGiven[0m [32ma route in "FAILED" status[0m                   [1;30m# route_steps.go:764 -> *routeContext[0m
    [32mWhen[0m [32mI call IsFailed[0m                               [1;30m# route_steps.go:814 -> *routeContext[0m
    [32mThen[0m [32mit should return true[0m                         [1;30m# route_steps.go:813 -> *routeContext[0m

[1;37mFeature:[0m Ship Entity
  As a SpaceTraders bot
  I want to manage ship entities with proper state transitions
  So that I can navigate, refuel, and manage cargo safely

  [1;37mScenario:[0m Create ship with valid data                                                                                    [1;30m# features/domain/navigation/ship_entity.feature:10[0m
    [32mWhen[0m [32mI create a ship with symbol "SHIP-1", player 1, at "X1-A1", fuel 100/100, cargo 0/40, speed 30, status "IN_ORBIT"[0m [1;30m# ship_steps.go:761 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have symbol "SHIP-1"[0m                                                                              [1;30m# ship_steps.go:778 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should have player_id 1[0m                                                                                   [1;30m# ship_steps.go:779 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be at location "X1-A1"[0m                                                                             [1;30m# ship_steps.go:780 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should have 100 units of fuel[0m                                                                             [1;30m# ship_steps.go:781 -> *shipContext[0m
    [32mAnd[0m [32mthe ship fuel capacity should be 100[0m                                                                               [1;30m# ship_steps.go:782 -> *shipContext[0m
    [32mAnd[0m [32mthe ship cargo capacity should be 40[0m                                                                               [1;30m# ship_steps.go:783 -> *shipContext[0m
    [32mAnd[0m [32mthe ship cargo units should be 0[0m                                                                                   [1;30m# ship_steps.go:784 -> *shipContext[0m
    [32mAnd[0m [32mthe ship engine speed should be 30[0m                                                                                 [1;30m# ship_steps.go:785 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be in orbit[0m                                                                                        [1;30m# ship_steps.go:786 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with invalid empty symbol                           [1;30m# features/domain/navigation/ship_entity.feature:22[0m
    [32mWhen[0m [32mI attempt to create a ship with empty ship_symbol[0m                  [1;30m# ship_steps.go:763 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "ship_symbol cannot be empty"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with zero player_id                                [1;30m# features/domain/navigation/ship_entity.feature:26[0m
    [32mWhen[0m [32mI attempt to create a ship with player_id 0[0m                       [1;30m# ship_steps.go:764 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "player_id must be positive"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with negative player_id                            [1;30m# features/domain/navigation/ship_entity.feature:30[0m
    [32mWhen[0m [32mI attempt to create a ship with player_id -1[0m                      [1;30m# ship_steps.go:765 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "player_id must be positive"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with negative fuel capacity                              [1;30m# features/domain/navigation/ship_entity.feature:34[0m
    [32mWhen[0m [32mI attempt to create a ship with fuel_capacity -10[0m                       [1;30m# ship_steps.go:766 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "fuel_capacity cannot be negative"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with mismatched fuel capacity                                            [1;30m# features/domain/navigation/ship_entity.feature:38[0m
    [32mWhen[0m [32mI attempt to create a ship with fuel object capacity 80 but fuel_capacity parameter 100[0m [1;30m# ship_steps.go:767 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "fuel capacity must match fuel_capacity"[0m           [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with negative cargo capacity                              [1;30m# features/domain/navigation/ship_entity.feature:42[0m
    [32mWhen[0m [32mI attempt to create a ship with cargo_capacity -10[0m                       [1;30m# ship_steps.go:769 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "cargo_capacity cannot be negative"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with negative cargo units                              [1;30m# features/domain/navigation/ship_entity.feature:46[0m
    [32mWhen[0m [32mI attempt to create a ship with cargo_units -5[0m                        [1;30m# ship_steps.go:770 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "cargo_units cannot be negative"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with cargo units exceeding capacity                              [1;30m# features/domain/navigation/ship_entity.feature:50[0m
    [32mWhen[0m [32mI attempt to create a ship with cargo_capacity 40 and cargo_units 50[0m            [1;30m# ship_steps.go:771 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "cargo_units cannot exceed cargo_capacity"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with zero engine speed                                [1;30m# features/domain/navigation/ship_entity.feature:54[0m
    [32mWhen[0m [32mI attempt to create a ship with engine_speed 0[0m                       [1;30m# ship_steps.go:773 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "engine_speed must be positive"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with negative engine speed                            [1;30m# features/domain/navigation/ship_entity.feature:58[0m
    [32mWhen[0m [32mI attempt to create a ship with engine_speed -10[0m                     [1;30m# ship_steps.go:773 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "engine_speed must be positive"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Create ship with invalid nav status                    [1;30m# features/domain/navigation/ship_entity.feature:62[0m
    [32mWhen[0m [32mI attempt to create a ship with nav_status "FLYING"[0m       [1;30m# ship_steps.go:774 -> *shipContext[0m
    [32mThen[0m [32mship creation should fail with error "invalid nav_status"[0m [1;30m# ship_steps.go:775 -> *shipContext[0m

  [1;37mScenario:[0m Depart from docked to in orbit [1;30m# features/domain/navigation/ship_entity.feature:70[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m         [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mthe ship departs[0m                  [1;30m# ship_steps.go:792 -> *shipContext[0m
    [32mThen[0m [32mthe ship should be in orbit[0m       [1;30m# ship_steps.go:786 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should not be docked[0m      [1;30m# ship_steps.go:794 -> *shipContext[0m

  [1;37mScenario:[0m Depart when in transit raises error                               [1;30m# features/domain/navigation/ship_entity.feature:76[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m                                        [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to depart the ship[0m                                         [1;30m# ship_steps.go:793 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot orbit while in transit"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Dock from in orbit to docked [1;30m# features/domain/navigation/ship_entity.feature:81[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m     [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mthe ship docks[0m                  [1;30m# ship_steps.go:795 -> *shipContext[0m
    [32mThen[0m [32mthe ship should be docked[0m       [1;30m# ship_steps.go:797 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should not be in orbit[0m  [1;30m# ship_steps.go:798 -> *shipContext[0m

  [1;37mScenario:[0m Dock when in transit raises error                                [1;30m# features/domain/navigation/ship_entity.feature:87[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m                                       [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to dock the ship[0m                                          [1;30m# ship_steps.go:796 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot dock while in transit"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Start transit from in orbit        [1;30m# features/domain/navigation/ship_entity.feature:92[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m           [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mthe ship starts transit to "X1-B2"[0m    [1;30m# ship_steps.go:799 -> *shipContext[0m
    [32mThen[0m [32mthe ship should be in transit[0m         [1;30m# ship_steps.go:801 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should not be in orbit[0m        [1;30m# ship_steps.go:798 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be at location "X1-B2"[0m [1;30m# ship_steps.go:780 -> *shipContext[0m

  [1;37mScenario:[0m Start transit when not in orbit raises error                               [1;30m# features/domain/navigation/ship_entity.feature:99[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m                                                     [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to start transit to "X1-B2"[0m                                         [1;30m# ship_steps.go:800 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "ship must be in orbit to start transit"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Arrive from in transit to in orbit [1;30m# features/domain/navigation/ship_entity.feature:104[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m         [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mthe ship arrives[0m                      [1;30m# ship_steps.go:803 -> *shipContext[0m
    [32mThen[0m [32mthe ship should be in orbit[0m           [1;30m# ship_steps.go:786 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should not be in transit[0m      [1;30m# ship_steps.go:802 -> *shipContext[0m

  [1;37mScenario:[0m Arrive when not in transit raises error                               [1;30m# features/domain/navigation/ship_entity.feature:110[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m                                                [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to arrive the ship[0m                                             [1;30m# ship_steps.go:804 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "ship must be in transit to arrive"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Ensure in orbit from docked transitions to orbit [1;30m# features/domain/navigation/ship_entity.feature:115[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m                           [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI ensure the ship is in orbit[0m                       [1;30m# ship_steps.go:805 -> *shipContext[0m
    [32mThen[0m [32mthe state change result should be true[0m              [1;30m# ship_steps.go:807 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be in orbit[0m                          [1;30m# ship_steps.go:786 -> *shipContext[0m

  [1;37mScenario:[0m Ensure in orbit when already in orbit returns false [1;30m# features/domain/navigation/ship_entity.feature:121[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m                            [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mI ensure the ship is in orbit[0m                          [1;30m# ship_steps.go:805 -> *shipContext[0m
    [32mThen[0m [32mthe state change result should be false[0m                [1;30m# ship_steps.go:807 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be in orbit[0m                             [1;30m# ship_steps.go:786 -> *shipContext[0m

  [1;37mScenario:[0m Ensure in orbit when in transit raises error                      [1;30m# features/domain/navigation/ship_entity.feature:127[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m                                        [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to ensure the ship is in orbit[0m                             [1;30m# ship_steps.go:806 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot orbit while in transit"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Ensure docked from in orbit transitions to docked [1;30m# features/domain/navigation/ship_entity.feature:132[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m                          [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mI ensure the ship is docked[0m                          [1;30m# ship_steps.go:808 -> *shipContext[0m
    [32mThen[0m [32mthe state change result should be true[0m               [1;30m# ship_steps.go:807 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be docked[0m                             [1;30m# ship_steps.go:797 -> *shipContext[0m

  [1;37mScenario:[0m Ensure docked when already docked returns false [1;30m# features/domain/navigation/ship_entity.feature:138[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m                          [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI ensure the ship is docked[0m                        [1;30m# ship_steps.go:808 -> *shipContext[0m
    [32mThen[0m [32mthe state change result should be false[0m            [1;30m# ship_steps.go:807 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be docked[0m                           [1;30m# ship_steps.go:797 -> *shipContext[0m

  [1;37mScenario:[0m Ensure docked when in transit raises error                       [1;30m# features/domain/navigation/ship_entity.feature:144[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m                                       [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to ensure the ship is docked[0m                              [1;30m# ship_steps.go:809 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "cannot dock while in transit"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Consume fuel reduces fuel amount   [1;30m# features/domain/navigation/ship_entity.feature:153[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m        [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mthe ship consumes 30 units of fuel[0m    [1;30m# ship_steps.go:815 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 70 units of fuel[0m [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Consume fuel with zero amount       [1;30m# features/domain/navigation/ship_entity.feature:158[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m         [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mthe ship consumes 0 units of fuel[0m      [1;30m# ship_steps.go:815 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 100 units of fuel[0m [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Consume fuel with negative amount raises error                     [1;30m# features/domain/navigation/ship_entity.feature:163[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m                                        [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to consume -10 units of fuel[0m                                [1;30m# value_object_steps.go:546 -> *valueObjectContext[0m
    [32mThen[0m [32mthe operation should fail with error "fuel amount cannot be negative"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Consume fuel more than available raises error         [1;30m# features/domain/navigation/ship_entity.feature:168[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m                           [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to consume 150 units of fuel[0m                   [1;30m# value_object_steps.go:546 -> *valueObjectContext[0m
    [32mThen[0m [32mthe operation should fail with error "insufficient fuel"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Consume all fuel                  [1;30m# features/domain/navigation/ship_entity.feature:173[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m       [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mthe ship consumes 100 units of fuel[0m  [1;30m# ship_steps.go:815 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 0 units of fuel[0m [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Refuel increases fuel amount                [1;30m# features/domain/navigation/ship_entity.feature:178[0m
    [32mGiven[0m [32ma ship with 50 units of fuel and capacity 100[0m [1;30m# ship_steps.go:814 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels 30 units[0m                      [1;30m# ship_steps.go:817 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 80 units of fuel[0m          [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Refuel with zero amount             [1;30m# features/domain/navigation/ship_entity.feature:183[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m         [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels 0 units[0m               [1;30m# ship_steps.go:817 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 100 units of fuel[0m [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Refuel with negative amount raises error                           [1;30m# features/domain/navigation/ship_entity.feature:188[0m
    [32mGiven[0m [32ma ship with 100 units of fuel[0m                                        [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to refuel -10 units[0m                                         [1;30m# ship_steps.go:818 -> *shipContext[0m
    [32mThen[0m [32mthe operation should fail with error "fuel amount cannot be negative"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Refuel caps at capacity                     [1;30m# features/domain/navigation/ship_entity.feature:193[0m
    [32mGiven[0m [32ma ship with 50 units of fuel and capacity 100[0m [1;30m# ship_steps.go:814 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels 80 units[0m                      [1;30m# ship_steps.go:817 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 100 units of fuel[0m         [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Refuel to full when partially filled        [1;30m# features/domain/navigation/ship_entity.feature:198[0m
    [32mGiven[0m [32ma ship with 50 units of fuel and capacity 100[0m [1;30m# ship_steps.go:814 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels to full[0m                       [1;30m# ship_steps.go:819 -> *shipContext[0m
    [32mThen[0m [32mthe fuel added should be 50 units[0m              [1;30m# ship_steps.go:820 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should have 100 units of fuel[0m          [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Refuel to full when already full             [1;30m# features/domain/navigation/ship_entity.feature:204[0m
    [32mGiven[0m [32ma ship with 100 units of fuel and capacity 100[0m [1;30m# ship_steps.go:814 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels to full[0m                        [1;30m# ship_steps.go:819 -> *shipContext[0m
    [32mThen[0m [32mthe fuel added should be 0 units[0m                [1;30m# ship_steps.go:820 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should have 100 units of fuel[0m           [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Can navigate to nearby destination with enough fuel           [1;30m# features/domain/navigation/ship_entity.feature:214[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 100 units of fuel[0m [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                        [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship can navigate to "X1-B2"[0m                      [1;30m# ship_steps.go:826 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Cannot navigate to destination without enough fuel          [1;30m# features/domain/navigation/ship_entity.feature:220[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 0 units of fuel[0m [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-C3" at coordinates (200, 0)[0m                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship can navigate to "X1-C3"[0m                    [1;30m# ship_steps.go:826 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Can navigate to same location                                 [1;30m# features/domain/navigation/ship_entity.feature:226[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 100 units of fuel[0m [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship can navigate to "X1-A1"[0m                      [1;30m# ship_steps.go:826 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel for trip with cruise mode           [1;30m# features/domain/navigation/ship_entity.feature:231[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0)[0m            [1;30m# ship_steps.go:828 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m             [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate fuel required to "X1-B2" with CRUISE mode[0m [1;30m# ship_steps.go:829 -> *shipContext[0m
    [32mThen[0m [32mthe fuel required should be 100 units[0m                 [1;30m# ship_steps.go:830 -> *shipContext[0m

  [1;37mScenario:[0m Calculate fuel for trip with drift mode           [1;30m# features/domain/navigation/ship_entity.feature:237[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0)[0m           [1;30m# ship_steps.go:828 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m            [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate fuel required to "X1-B2" with DRIFT mode[0m [1;30m# ship_steps.go:829 -> *shipContext[0m
    [32mThen[0m [32mthe fuel required should be 1 units[0m                  [1;30m# ship_steps.go:830 -> *shipContext[0m

  [1;37mScenario:[0m Calculate fuel for trip with burn mode           [1;30m# features/domain/navigation/ship_entity.feature:243[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0)[0m          [1;30m# ship_steps.go:828 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m           [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate fuel required to "X1-B2" with BURN mode[0m [1;30m# ship_steps.go:829 -> *shipContext[0m
    [32mThen[0m [32mthe fuel required should be 200 units[0m               [1;30m# ship_steps.go:830 -> *shipContext[0m

  [1;37mScenario:[0m Needs refuel for journey with low fuel                       [1;30m# features/domain/navigation/ship_entity.feature:249[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 10 units of fuel[0m [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-C3" at coordinates (200, 0)[0m                       [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship needs refuel for journey to "X1-C3"[0m         [1;30m# ship_steps.go:831 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                                       [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Does not need refuel with enough fuel and zero safety margin                [1;30m# features/domain/navigation/ship_entity.feature:255[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 100 units of fuel[0m               [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship needs refuel for journey to "X1-B2" with safety margin 0.0[0m [1;30m# ship_steps.go:832 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate travel time with cruise mode                      [1;30m# features/domain/navigation/ship_entity.feature:261[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and engine speed 30[0m [1;30m# ship_steps.go:834 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate travel time to "X1-B2" with CRUISE mode[0m            [1;30m# ship_steps.go:836 -> *shipContext[0m
    [32mThen[0m [32mthe travel time should be 103 seconds[0m                          [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate travel time with drift mode                       [1;30m# features/domain/navigation/ship_entity.feature:267[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and engine speed 30[0m [1;30m# ship_steps.go:834 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate travel time to "X1-B2" with DRIFT mode[0m             [1;30m# ship_steps.go:836 -> *shipContext[0m
    [32mThen[0m [32mthe travel time should be 86 seconds[0m                           [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate travel time with burn mode                        [1;30m# features/domain/navigation/ship_entity.feature:273[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and engine speed 30[0m [1;30m# ship_steps.go:834 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate travel time to "X1-B2" with BURN mode[0m              [1;30m# ship_steps.go:836 -> *shipContext[0m
    [32mThen[0m [32mthe travel time should be 50 seconds[0m                           [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select optimal flight mode with high fuel   [1;30m# features/domain/navigation/ship_entity.feature:279[0m
    [32mGiven[0m [32ma ship with 250 units of fuel at distance 100[0m [1;30m# ship_steps.go:838 -> *shipContext[0m
    [32mWhen[0m [32mI select optimal flight mode for distance 100[0m  [1;30m# ship_steps.go:839 -> *shipContext[0m
    [32mThen[0m [32mthe ship's selected mode should be BURN[0m        [1;30m# ship_steps.go:840 -> *shipContext[0m

  [1;37mScenario:[0m Select optimal flight mode with low fuel   [1;30m# features/domain/navigation/ship_entity.feature:284[0m
    [32mGiven[0m [32ma ship with 50 units of fuel at distance 100[0m [1;30m# ship_steps.go:838 -> *shipContext[0m
    [32mWhen[0m [32mI select optimal flight mode for distance 100[0m [1;30m# ship_steps.go:839 -> *shipContext[0m
    [32mThen[0m [32mthe ship's selected mode should be DRIFT[0m      [1;30m# ship_steps.go:840 -> *shipContext[0m

  [1;37mScenario:[0m Select optimal flight mode with medium fuel [1;30m# features/domain/navigation/ship_entity.feature:289[0m
    [32mGiven[0m [32ma ship with 110 units of fuel at distance 100[0m [1;30m# ship_steps.go:838 -> *shipContext[0m
    [32mWhen[0m [32mI select optimal flight mode for distance 100[0m  [1;30m# ship_steps.go:839 -> *shipContext[0m
    [32mThen[0m [32mthe ship's selected mode should be CRUISE[0m      [1;30m# ship_steps.go:840 -> *shipContext[0m

  [1;37mScenario:[0m Has cargo space with empty cargo              [1;30m# features/domain/navigation/ship_entity.feature:298[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 0[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 1 units[0m  [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has cargo space with partial cargo             [1;30m# features/domain/navigation/ship_entity.feature:303[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 20[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 1 units[0m   [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                         [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has cargo space with full cargo                [1;30m# features/domain/navigation/ship_entity.feature:308[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 40[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 1 units[0m   [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has cargo space with specific units            [1;30m# features/domain/navigation/ship_entity.feature:313[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 35[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 5 units[0m   [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                         [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has cargo space with specific units exceeding available [1;30m# features/domain/navigation/ship_entity.feature:318[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 35[0m          [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 6 units[0m            [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                                 [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Available cargo space with empty cargo        [1;30m# features/domain/navigation/ship_entity.feature:323[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 0[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check available cargo space[0m                    [1;30m# ship_steps.go:845 -> *shipContext[0m
    [32mThen[0m [32mthe available space should be 40 units[0m           [1;30m# ship_steps.go:846 -> *shipContext[0m

  [1;37mScenario:[0m Available cargo space with partial cargo       [1;30m# features/domain/navigation/ship_entity.feature:328[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 25[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check available cargo space[0m                     [1;30m# ship_steps.go:845 -> *shipContext[0m
    [32mThen[0m [32mthe available space should be 15 units[0m            [1;30m# ship_steps.go:846 -> *shipContext[0m

  [1;37mScenario:[0m Available cargo space with full cargo          [1;30m# features/domain/navigation/ship_entity.feature:333[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 40[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check available cargo space[0m                     [1;30m# ship_steps.go:845 -> *shipContext[0m
    [32mThen[0m [32mthe available space should be 0 units[0m             [1;30m# ship_steps.go:846 -> *shipContext[0m

  [1;37mScenario:[0m Is cargo empty when empty                     [1;30m# features/domain/navigation/ship_entity.feature:338[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 0[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if cargo is empty[0m                        [1;30m# value_object_steps.go:596 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is cargo empty when not empty                 [1;30m# features/domain/navigation/ship_entity.feature:343[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 1[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if cargo is empty[0m                        [1;30m# value_object_steps.go:596 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                       [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is cargo full when full                        [1;30m# features/domain/navigation/ship_entity.feature:348[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 40[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if cargo is full[0m                          [1;30m# value_object_steps.go:597 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m                         [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is cargo full when not full                   [1;30m# features/domain/navigation/ship_entity.feature:353[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 0[0m [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if cargo is full[0m                         [1;30m# value_object_steps.go:597 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                       [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is docked when docked      [1;30m# features/domain/navigation/ship_entity.feature:362[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m     [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is docked[0m [1;30m# ship_steps.go:852 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is docked when in orbit    [1;30m# features/domain/navigation/ship_entity.feature:367[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m   [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is docked[0m [1;30m# ship_steps.go:852 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m    [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is in orbit when in orbit    [1;30m# features/domain/navigation/ship_entity.feature:372[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m     [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is in orbit[0m [1;30m# ship_steps.go:853 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m       [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is in orbit when docked      [1;30m# features/domain/navigation/ship_entity.feature:377[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m       [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is in orbit[0m [1;30m# ship_steps.go:853 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m      [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is in transit when in transit  [1;30m# features/domain/navigation/ship_entity.feature:382[0m
    [32mGiven[0m [32ma ship in transit to "X1-B2"[0m     [1;30m# ship_steps.go:791 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is in transit[0m [1;30m# ship_steps.go:854 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m         [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is in transit when docked      [1;30m# features/domain/navigation/ship_entity.feature:387[0m
    [32mGiven[0m [32ma docked ship at "X1-A1"[0m         [1;30m# ship_steps.go:789 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is in transit[0m [1;30m# ship_steps.go:854 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is at location when at location         [1;30m# features/domain/navigation/ship_entity.feature:392[0m
    [32mGiven[0m [32ma ship at "X1-A1"[0m                         [1;30m# ship_steps.go:851 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is at location "X1-A1"[0m [1;30m# ship_steps.go:855 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                  [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is at location when not at location     [1;30m# features/domain/navigation/ship_entity.feature:397[0m
    [32mGiven[0m [32ma ship at "X1-A1"[0m                         [1;30m# ship_steps.go:851 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship is at location "X1-B2"[0m [1;30m# ship_steps.go:855 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                 [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should refuel opportunistically when at fuel station with low fuel         [1;30m# features/domain/navigation/ship_entity.feature:406[0m
    [33mGiven[0m [33ma ship at "X1-A1" with 30 units of fuel and capacity 100[0m
    [33mAnd[0m [33mwaypoint "X1-A1" has trait "MARKETPLACE" and fuel available[0m
    [33mWhen[0m [33mI check if ship should refuel opportunistically at "X1-A1" with threshold 0.5[0m
    [36mThen[0m [36mthe result should be true[0m                                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should not refuel opportunistically when fuel above threshold              [1;30m# features/domain/navigation/ship_entity.feature:412[0m
    [33mGiven[0m [33ma ship at "X1-A1" with 60 units of fuel and capacity 100[0m
    [33mAnd[0m [33mwaypoint "X1-A1" has trait "MARKETPLACE" and fuel available[0m
    [33mWhen[0m [33mI check if ship should refuel opportunistically at "X1-A1" with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                                    [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should not refuel opportunistically when no fuel available at waypoint     [1;30m# features/domain/navigation/ship_entity.feature:418[0m
    [33mGiven[0m [33ma ship at "X1-A1" with 30 units of fuel and capacity 100[0m
    [33mAnd[0m [33mwaypoint "X1-A1" has no fuel available[0m
    [33mWhen[0m [33mI check if ship should refuel opportunistically at "X1-A1" with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                                    [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should prevent drift mode when fuel below threshold       [1;30m# features/domain/navigation/ship_entity.feature:424[0m
    [32mGiven[0m [32ma ship with 40 units of fuel and capacity 100[0m               [1;30m# ship_steps.go:814 -> *shipContext[0m
    [33mAnd[0m [33ma route segment requiring 50 units of fuel in DRIFT mode[0m
    [33mWhen[0m [33mI check if ship should prevent drift mode with threshold 0.5[0m
    [36mThen[0m [36mthe result should be true[0m                                    [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should not prevent drift mode when fuel above threshold   [1;30m# features/domain/navigation/ship_entity.feature:430[0m
    [32mGiven[0m [32ma ship with 60 units of fuel and capacity 100[0m               [1;30m# ship_steps.go:814 -> *shipContext[0m
    [33mAnd[0m [33ma route segment requiring 50 units of fuel in DRIFT mode[0m
    [33mWhen[0m [33mI check if ship should prevent drift mode with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                   [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Should not prevent drift mode when not using drift flight mode [1;30m# features/domain/navigation/ship_entity.feature:436[0m
    [32mGiven[0m [32ma ship with 40 units of fuel and capacity 100[0m                    [1;30m# ship_steps.go:814 -> *shipContext[0m
    [33mAnd[0m [33ma route segment requiring 50 units of fuel in CRUISE mode[0m
    [33mWhen[0m [33mI check if ship should prevent drift mode with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Refuel ship with zero fuel capacity (probe) [1;30m# features/domain/navigation/ship_entity.feature:446[0m
    [32mGiven[0m [32ma ship with 0 units of fuel and capacity 0[0m    [1;30m# ship_steps.go:814 -> *shipContext[0m
    [32mWhen[0m [32mthe ship refuels to full[0m                       [1;30m# ship_steps.go:819 -> *shipContext[0m
    [32mThen[0m [32mthe fuel added should be 0 units[0m               [1;30m# ship_steps.go:820 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should have 0 units of fuel[0m            [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Ship with zero cargo capacity cannot load cargo [1;30m# features/domain/navigation/ship_entity.feature:452[0m
    [32mGiven[0m [32ma ship with cargo capacity 0 and cargo units 0[0m    [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 1 units[0m    [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                         [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Consume exactly all remaining fuel [1;30m# features/domain/navigation/ship_entity.feature:457[0m
    [32mGiven[0m [32ma ship with 50 units of fuel[0m         [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mthe ship consumes 50 units of fuel[0m    [1;30m# ship_steps.go:815 -> *shipContext[0m
    [32mThen[0m [32mthe ship should have 0 units of fuel[0m  [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Cannot consume more fuel than available by 1 unit     [1;30m# features/domain/navigation/ship_entity.feature:462[0m
    [32mGiven[0m [32ma ship with 10 units of fuel[0m                            [1;30m# ship_steps.go:813 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to consume 11 units of fuel[0m                    [1;30m# value_object_steps.go:546 -> *valueObjectContext[0m
    [32mThen[0m [32mthe operation should fail with error "insufficient fuel"[0m [1;30m# route_steps.go:772 -> *routeContext[0m
    [32mAnd[0m [32mthe ship should have 10 units of fuel[0m                     [1;30m# ship_steps.go:781 -> *shipContext[0m

  [1;37mScenario:[0m Ship at exact refuel threshold boundary (low side)                         [1;30m# features/domain/navigation/ship_entity.feature:468[0m
    [33mGiven[0m [33ma ship at "X1-A1" with 49 units of fuel and capacity 100[0m
    [33mAnd[0m [33mwaypoint "X1-A1" has trait "MARKETPLACE" and fuel available[0m
    [33mWhen[0m [33mI check if ship should refuel opportunistically at "X1-A1" with threshold 0.5[0m
    [36mThen[0m [36mthe result should be true[0m                                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Ship at exact refuel threshold boundary (high side)                        [1;30m# features/domain/navigation/ship_entity.feature:474[0m
    [33mGiven[0m [33ma ship at "X1-A1" with 50 units of fuel and capacity 100[0m
    [33mAnd[0m [33mwaypoint "X1-A1" has trait "MARKETPLACE" and fuel available[0m
    [33mWhen[0m [33mI check if ship should refuel opportunistically at "X1-A1" with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                                    [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Check cargo space for zero units always returns true [1;30m# features/domain/navigation/ship_entity.feature:480[0m
    [32mGiven[0m [32ma ship with cargo capacity 40 and cargo units 40[0m       [1;30m# ship_steps.go:843 -> *shipContext[0m
    [32mWhen[0m [32mI check if the ship has cargo space for 0 units[0m         [1;30m# ship_steps.go:844 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                               [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel for zero distance travel            [1;30m# features/domain/navigation/ship_entity.feature:485[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0)[0m            [1;30m# ship_steps.go:828 -> *shipContext[0m
    [32mWhen[0m [32mI calculate fuel required to "X1-A1" with CRUISE mode[0m [1;30m# ship_steps.go:829 -> *shipContext[0m
    [32mThen[0m [32mthe fuel required should be 0 units[0m                   [1;30m# ship_steps.go:830 -> *shipContext[0m

  [1;37mScenario:[0m Ship needs refuel when fuel exactly equals required amount                  [1;30m# features/domain/navigation/ship_entity.feature:490[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 100 units of fuel[0m               [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship needs refuel for journey to "X1-B2" with safety margin 0.0[0m [1;30m# ship_steps.go:832 -> *shipContext[0m
    [32mThen[0m [32mthe result should be false[0m                                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Ship needs refuel with small safety margin                                  [1;30m# features/domain/navigation/ship_entity.feature:496[0m
    [32mGiven[0m [32ma ship at "X1-A1" with coordinates (0, 0) and 100 units of fuel[0m               [1;30m# ship_steps.go:823 -> *shipContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100, 0)[0m                                      [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if the ship needs refuel for journey to "X1-B2" with safety margin 0.1[0m [1;30m# ship_steps.go:832 -> *shipContext[0m
    [32mThen[0m [32mthe result should be true[0m                                                      [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Prevent drift mode at exact threshold boundary            [1;30m# features/domain/navigation/ship_entity.feature:502[0m
    [32mGiven[0m [32ma ship with 50 units of fuel and capacity 100[0m               [1;30m# ship_steps.go:814 -> *shipContext[0m
    [33mAnd[0m [33ma route segment requiring 40 units of fuel in DRIFT mode[0m
    [33mWhen[0m [33mI check if ship should prevent drift mode with threshold 0.5[0m
    [36mThen[0m [36mthe result should be false[0m                                   [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Update ship location during transit [1;30m# features/domain/navigation/ship_entity.feature:508[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m            [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mthe ship starts transit to "X1-B2"[0m     [1;30m# ship_steps.go:799 -> *shipContext[0m
    [32mThen[0m [32mthe ship should be at location "X1-B2"[0m [1;30m# ship_steps.go:780 -> *shipContext[0m
    [32mAnd[0m [32mthe ship should be in transit[0m           [1;30m# ship_steps.go:801 -> *shipContext[0m

  [1;37mScenario:[0m Cannot start transit to same location                               [1;30m# features/domain/navigation/ship_entity.feature:514[0m
    [32mGiven[0m [32ma ship in orbit at "X1-A1"[0m                                            [1;30m# ship_steps.go:790 -> *shipContext[0m
    [32mWhen[0m [32mI attempt to start transit to "X1-A1"[0m                                  [1;30m# ship_steps.go:800 -> *shipContext[0m
    [31mThen[0m [31mthe operation should fail with error "cannot transit to same location"[0m [1;30m# route_steps.go:772 -> *routeContext[0m
    [1;31mexpected error containing 'cannot transit to same location' but got no error[0m

[1;37mFeature:[0m Cargo Value Object
  As a cargo management system
  I want to work with immutable cargo value objects
  So that cargo operations are safe and predictable

  [1;37mScenario:[0m Create cargo item with valid data                                    [1;30m# features/domain/shared/cargo_value_object.feature:10[0m
    [32mWhen[0m [32mI create a cargo item with symbol "IRON_ORE", name "Iron Ore", units 10[0m [1;30m# value_object_steps.go:560 -> *valueObjectContext[0m
    [32mThen[0m [32mthe cargo item should have symbol "IRON_ORE"[0m                            [1;30m# value_object_steps.go:565 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo item should have name "Iron Ore"[0m                               [1;30m# value_object_steps.go:566 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo item should have units 10[0m                                      [1;30m# value_object_steps.go:567 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo item with empty symbol fails                              [1;30m# features/domain/shared/cargo_value_object.feature:16[0m
    [32mWhen[0m [32mI attempt to create a cargo item with empty symbol[0m                        [1;30m# value_object_steps.go:562 -> *valueObjectContext[0m
    [32mThen[0m [32mcargo item creation should fail with error "cargo symbol cannot be empty"[0m [1;30m# value_object_steps.go:564 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo item with negative units fails                              [1;30m# features/domain/shared/cargo_value_object.feature:20[0m
    [32mWhen[0m [32mI attempt to create a cargo item with units -5[0m                              [1;30m# value_object_steps.go:563 -> *valueObjectContext[0m
    [32mThen[0m [32mcargo item creation should fail with error "cargo units cannot be negative"[0m [1;30m# value_object_steps.go:564 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo item with zero units succeeds                          [1;30m# features/domain/shared/cargo_value_object.feature:24[0m
    [32mWhen[0m [32mI create a cargo item with symbol "IRON_ORE", name "Iron Ore", units 0[0m [1;30m# value_object_steps.go:560 -> *valueObjectContext[0m
    [32mThen[0m [32mthe cargo item should have units 0[0m                                     [1;30m# value_object_steps.go:567 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo with valid data                          [1;30m# features/domain/shared/cargo_value_object.feature:32[0m
    [32mGiven[0m [32ma cargo item with symbol "IRON_ORE" and units 10[0m        [1;30m# value_object_steps.go:570 -> *valueObjectContext[0m
    [32mWhen[0m [32mI create cargo with capacity 40, units 10, and inventory[0m [1;30m# value_object_steps.go:571 -> *valueObjectContext[0m
    [32mThen[0m [32mthe cargo should have capacity 40[0m                        [1;30m# value_object_steps.go:577 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo should have units 10[0m                            [1;30m# value_object_steps.go:578 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo inventory should contain 1 items[0m                [1;30m# value_object_steps.go:579 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create empty cargo succeeds                                [1;30m# features/domain/shared/cargo_value_object.feature:39[0m
    [32mWhen[0m [32mI create cargo with capacity 40, units 0, and empty inventory[0m [1;30m# value_object_steps.go:572 -> *valueObjectContext[0m
    [32mThen[0m [32mthe cargo should have capacity 40[0m                             [1;30m# value_object_steps.go:577 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo should have units 0[0m                                  [1;30m# value_object_steps.go:578 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe cargo should be empty[0m                                      [1;30m# value_object_steps.go:580 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo with negative units fails                              [1;30m# features/domain/shared/cargo_value_object.feature:45[0m
    [32mWhen[0m [32mI attempt to create cargo with units -5[0m                                [1;30m# value_object_steps.go:573 -> *valueObjectContext[0m
    [32mThen[0m [32mcargo creation should fail with error "cargo units cannot be negative"[0m [1;30m# value_object_steps.go:576 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo with negative capacity fails                              [1;30m# features/domain/shared/cargo_value_object.feature:49[0m
    [32mWhen[0m [32mI attempt to create cargo with capacity -10[0m                               [1;30m# value_object_steps.go:574 -> *valueObjectContext[0m
    [32mThen[0m [32mcargo creation should fail with error "cargo capacity cannot be negative"[0m [1;30m# value_object_steps.go:576 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo with units exceeding capacity fails                       [1;30m# features/domain/shared/cargo_value_object.feature:53[0m
    [32mWhen[0m [32mI attempt to create cargo with capacity 40 and units 50[0m                   [1;30m# value_object_steps.go:575 -> *valueObjectContext[0m
    [32mThen[0m [32mcargo creation should fail with error "cargo units 50 exceed capacity 40"[0m [1;30m# value_object_steps.go:576 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create cargo with mismatched inventory sum fails                        [1;30m# features/domain/shared/cargo_value_object.feature:57[0m
    [32mGiven[0m [32ma cargo item with symbol "IRON_ORE" and units 10[0m                          [1;30m# value_object_steps.go:570 -> *valueObjectContext[0m
    [33mWhen[0m [33mI attempt to create cargo with capacity 40, units 20, and inventory[0m
    [36mThen[0m [36mcargo creation should fail with error "inventory sum 10 != total units 20"[0m [1;30m# value_object_steps.go:576 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has item returns true when item exists             [1;30m# features/domain/shared/cargo_value_object.feature:66[0m
    [32mGiven[0m [32mcargo with items:[0m                                    [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
      | [36mCOPPER[0m   | [36m5[0m     |
    [32mWhen[0m [32mI check if cargo has item "IRON_ORE" with min units 5[0m [1;30m# value_object_steps.go:584 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m                             [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has item returns false when insufficient units      [1;30m# features/domain/shared/cargo_value_object.feature:74[0m
    [32mGiven[0m [32mcargo with items:[0m                                     [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
    [32mWhen[0m [32mI check if cargo has item "IRON_ORE" with min units 15[0m [1;30m# value_object_steps.go:584 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                             [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has item returns false when item not present     [1;30m# features/domain/shared/cargo_value_object.feature:81[0m
    [32mGiven[0m [32mcargo with items:[0m                                  [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
    [32mWhen[0m [32mI check if cargo has item "COPPER" with min units 1[0m [1;30m# value_object_steps.go:584 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                          [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get item units returns correct amount [1;30m# features/domain/shared/cargo_value_object.feature:88[0m
    [32mGiven[0m [32mcargo with items:[0m                       [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
      | [36mCOPPER[0m   | [36m5[0m     |
    [32mWhen[0m [32mI get units of item "IRON_ORE"[0m           [1;30m# value_object_steps.go:585 -> *valueObjectContext[0m
    [32mThen[0m [32mthe item units should be 10[0m              [1;30m# value_object_steps.go:586 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get item units returns zero for non-existent item [1;30m# features/domain/shared/cargo_value_object.feature:96[0m
    [32mGiven[0m [32mcargo with items:[0m                                   [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
    [32mWhen[0m [32mI get units of item "GOLD"[0m                           [1;30m# value_object_steps.go:585 -> *valueObjectContext[0m
    [32mThen[0m [32mthe item units should be 0[0m                           [1;30m# value_object_steps.go:586 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has items other than specific symbol          [1;30m# features/domain/shared/cargo_value_object.feature:103[0m
    [32mGiven[0m [32mcargo with items:[0m                               [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
      | [36mCOPPER[0m   | [36m5[0m     |
    [32mWhen[0m [32mI check if cargo has items other than "IRON_ORE"[0m [1;30m# value_object_steps.go:587 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m                        [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Has no items other than specific symbol       [1;30m# features/domain/shared/cargo_value_object.feature:111[0m
    [32mGiven[0m [32mcargo with items:[0m                               [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m10[0m    |
    [32mWhen[0m [32mI check if cargo has items other than "IRON_ORE"[0m [1;30m# value_object_steps.go:587 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                       [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate available capacity with empty cargo [1;30m# features/domain/shared/cargo_value_object.feature:122[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 0[0m              [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate available capacity[0m                   [1;30m# value_object_steps.go:592 -> *valueObjectContext[0m
    [32mThen[0m [32mthe available capacity should be 40[0m              [1;30m# value_object_steps.go:593 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate available capacity with partial cargo [1;30m# features/domain/shared/cargo_value_object.feature:127[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 25[0m               [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate available capacity[0m                     [1;30m# value_object_steps.go:592 -> *valueObjectContext[0m
    [32mThen[0m [32mthe available capacity should be 15[0m                [1;30m# value_object_steps.go:593 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate available capacity with full cargo [1;30m# features/domain/shared/cargo_value_object.feature:132[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 40[0m            [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate available capacity[0m                  [1;30m# value_object_steps.go:592 -> *valueObjectContext[0m
    [32mThen[0m [32mthe available capacity should be 0[0m              [1;30m# value_object_steps.go:593 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is empty returns true when no cargo [1;30m# features/domain/shared/cargo_value_object.feature:141[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 0[0m    [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if cargo is empty[0m              [1;30m# value_object_steps.go:596 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m              [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is empty returns false when cargo present [1;30m# features/domain/shared/cargo_value_object.feature:146[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 1[0m          [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if cargo is empty[0m                    [1;30m# value_object_steps.go:596 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                   [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is full returns true when at capacity [1;30m# features/domain/shared/cargo_value_object.feature:151[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 40[0m     [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if cargo is full[0m                 [1;30m# value_object_steps.go:597 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be true[0m                [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is full returns false when below capacity [1;30m# features/domain/shared/cargo_value_object.feature:156[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 39[0m         [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if cargo is full[0m                     [1;30m# value_object_steps.go:597 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m                   [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is full returns false when empty [1;30m# features/domain/shared/cargo_value_object.feature:161[0m
    [32mGiven[0m [32mcargo with capacity 40 and units 0[0m [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI check if cargo is full[0m            [1;30m# value_object_steps.go:597 -> *valueObjectContext[0m
    [32mThen[0m [32mthe result should be false[0m          [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get other items from cargo with multiple types      [1;30m# features/domain/shared/cargo_value_object.feature:170[0m
    [32mGiven[0m [32mcargo with items:[0m                                     [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m       | [36munits[0m |
      | [36mIRON_ORE[0m     | [36m50[0m    |
      | [36mCOPPER_ORE[0m   | [36m25[0m    |
      | [36mALUMINUM_ORE[0m | [36m10[0m    |
    [32mWhen[0m [32mI get other items excluding "IRON_ORE"[0m                 [1;30m# value_object_steps.go:600 -> *valueObjectContext[0m
    [32mThen[0m [32mI should have 2 other cargo items[0m                      [1;30m# value_object_steps.go:601 -> *valueObjectContext[0m
    [32mAnd[0m [32mother items should contain "COPPER_ORE" with 25 units[0m   [1;30m# value_object_steps.go:602 -> *valueObjectContext[0m
    [32mAnd[0m [32mother items should contain "ALUMINUM_ORE" with 10 units[0m [1;30m# value_object_steps.go:602 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get other items returns empty when only specified item exists [1;30m# features/domain/shared/cargo_value_object.feature:181[0m
    [32mGiven[0m [32mcargo with items:[0m                                               [1;30m# value_object_steps.go:583 -> *valueObjectContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m50[0m    |
    [32mWhen[0m [32mI get other items excluding "IRON_ORE"[0m                           [1;30m# value_object_steps.go:600 -> *valueObjectContext[0m
    [32mThen[0m [32mI should have 0 other cargo items[0m                                [1;30m# value_object_steps.go:601 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get other items from empty cargo    [1;30m# features/domain/shared/cargo_value_object.feature:188[0m
    [32mGiven[0m [32mcargo with capacity 100 and units 0[0m   [1;30m# value_object_steps.go:591 -> *valueObjectContext[0m
    [32mWhen[0m [32mI get other items excluding "IRON_ORE"[0m [1;30m# value_object_steps.go:600 -> *valueObjectContext[0m
    [32mThen[0m [32mI should have 0 other cargo items[0m      [1;30m# value_object_steps.go:601 -> *valueObjectContext[0m

[1;37mFeature:[0m Flight Mode Value Object
  As a navigation system
  I want to calculate fuel costs and travel times for different flight modes
  So that I can optimize ship navigation

  [1;37mScenario:[0m Calculate cruise mode fuel cost                        [1;30m# features/domain/shared/flight_mode_value_object.feature:10[0m
    [32mWhen[0m [32mI calculate fuel cost for CRUISE mode with distance 100.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 100[0m                               [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate drift mode fuel cost                        [1;30m# features/domain/shared/flight_mode_value_object.feature:14[0m
    [32mWhen[0m [32mI calculate fuel cost for DRIFT mode with distance 100.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 1[0m                                [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate burn mode fuel cost                        [1;30m# features/domain/shared/flight_mode_value_object.feature:18[0m
    [32mWhen[0m [32mI calculate fuel cost for BURN mode with distance 100.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 200[0m                             [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate stealth mode fuel cost                        [1;30m# features/domain/shared/flight_mode_value_object.feature:22[0m
    [32mWhen[0m [32mI calculate fuel cost for STEALTH mode with distance 100.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 100[0m                                [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Fuel cost for zero distance is zero                  [1;30m# features/domain/shared/flight_mode_value_object.feature:26[0m
    [32mWhen[0m [32mI calculate fuel cost for CRUISE mode with distance 0.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 0[0m                               [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Minimum fuel cost is 1 for very small distances      [1;30m# features/domain/shared/flight_mode_value_object.feature:30[0m
    [32mWhen[0m [32mI calculate fuel cost for CRUISE mode with distance 0.1[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 1[0m                               [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Drift mode has minimal fuel consumption                [1;30m# features/domain/shared/flight_mode_value_object.feature:34[0m
    [32mWhen[0m [32mI calculate fuel cost for DRIFT mode with distance 1000.0[0m [1;30m# value_object_steps.go:550 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel cost should be 3[0m                                 [1;30m# value_object_steps.go:551 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate cruise mode travel time                                     [1;30m# features/domain/shared/flight_mode_value_object.feature:42[0m
    [32mWhen[0m [32mI calculate travel time for CRUISE mode with distance 100.0 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 103 seconds[0m                                    [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate drift mode travel time                                     [1;30m# features/domain/shared/flight_mode_value_object.feature:46[0m
    [32mWhen[0m [32mI calculate travel time for DRIFT mode with distance 100.0 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 86 seconds[0m                                    [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate burn mode travel time                                     [1;30m# features/domain/shared/flight_mode_value_object.feature:50[0m
    [32mWhen[0m [32mI calculate travel time for BURN mode with distance 100.0 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 50 seconds[0m                                   [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate stealth mode travel time                                     [1;30m# features/domain/shared/flight_mode_value_object.feature:54[0m
    [32mWhen[0m [32mI calculate travel time for STEALTH mode with distance 100.0 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 166 seconds[0m                                     [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Travel time for zero distance is zero                               [1;30m# features/domain/shared/flight_mode_value_object.feature:58[0m
    [32mWhen[0m [32mI calculate travel time for CRUISE mode with distance 0.0 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 0 seconds[0m                                    [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Minimum travel time is 1 for very small distances                   [1;30m# features/domain/shared/flight_mode_value_object.feature:62[0m
    [32mWhen[0m [32mI calculate travel time for CRUISE mode with distance 0.1 and speed 30[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 1 seconds[0m                                    [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Higher speed reduces travel time                                      [1;30m# features/domain/shared/flight_mode_value_object.feature:66[0m
    [32mWhen[0m [32mI calculate travel time for CRUISE mode with distance 100.0 and speed 60[0m [1;30m# value_object_steps.go:552 -> *valueObjectContext[0m
    [32mThen[0m [32mthe travel time should be 51 seconds[0m                                     [1;30m# value_object_steps.go:554 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select burn mode with high fuel and safety margin                         [1;30m# features/domain/shared/flight_mode_value_object.feature:74[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 100, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be BURN[0m                                             [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select cruise mode with medium fuel                                      [1;30m# features/domain/shared/flight_mode_value_object.feature:78[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 54, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be CRUISE[0m                                          [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select drift mode with low fuel                                          [1;30m# features/domain/shared/flight_mode_value_object.feature:82[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 53, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be DRIFT[0m                                           [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select burn with exact fuel for burn plus safety                          [1;30m# features/domain/shared/flight_mode_value_object.feature:86[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 104, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be BURN[0m                                             [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select cruise when burn would exceed safety                               [1;30m# features/domain/shared/flight_mode_value_object.feature:90[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 103, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be CRUISE[0m                                           [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Select drift when cruise would exceed safety                             [1;30m# features/domain/shared/flight_mode_value_object.feature:94[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 53, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be DRIFT[0m                                           [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Always select fastest mode that maintains safety margin                   [1;30m# features/domain/shared/flight_mode_value_object.feature:98[0m
    [32mWhen[0m [32mI select optimal flight mode with current fuel 200, cost 50, safety margin 4[0m [1;30m# value_object_steps.go:555 -> *valueObjectContext[0m
    [32mThen[0m [32mthe selected mode should be BURN[0m                                             [1;30m# value_object_steps.go:557 -> *valueObjectContext[0m

  [1;37mScenario:[0m Get cruise mode name          [1;30m# features/domain/shared/flight_mode_value_object.feature:106[0m
    [33mWhen[0m [33mI get the name of CRUISE mode[0m
    [33mThen[0m [33mthe mode name should be "CRUISE"[0m

  [1;37mScenario:[0m Get drift mode name          [1;30m# features/domain/shared/flight_mode_value_object.feature:110[0m
    [33mWhen[0m [33mI get the name of DRIFT mode[0m
    [33mThen[0m [33mthe mode name should be "DRIFT"[0m

  [1;37mScenario:[0m Get burn mode name          [1;30m# features/domain/shared/flight_mode_value_object.feature:114[0m
    [33mWhen[0m [33mI get the name of BURN mode[0m
    [33mThen[0m [33mthe mode name should be "BURN"[0m

  [1;37mScenario:[0m Get stealth mode name          [1;30m# features/domain/shared/flight_mode_value_object.feature:118[0m
    [33mWhen[0m [33mI get the name of STEALTH mode[0m
    [33mThen[0m [33mthe mode name should be "STEALTH"[0m

[1;37mFeature:[0m Fuel Value Object
  As a navigation system
  I want to work with immutable fuel value objects
  So that fuel operations are safe and predictable

  [1;37mScenario:[0m Create fuel with valid data                 [1;30m# features/domain/shared/fuel_value_object.feature:10[0m
    [32mWhen[0m [32mI create fuel with current 50 and capacity 100[0m [1;30m# value_object_steps.go:537 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel should have current 50[0m                [1;30m# value_object_steps.go:540 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe fuel should have capacity 100[0m               [1;30m# value_object_steps.go:541 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create fuel with negative current fails                             [1;30m# features/domain/shared/fuel_value_object.feature:15[0m
    [32mWhen[0m [32mI attempt to create fuel with current -10 and capacity 100[0m             [1;30m# value_object_steps.go:538 -> *valueObjectContext[0m
    [32mThen[0m [32mfuel creation should fail with error "current fuel cannot be negative"[0m [1;30m# value_object_steps.go:539 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create fuel with negative capacity fails                             [1;30m# features/domain/shared/fuel_value_object.feature:19[0m
    [32mWhen[0m [32mI attempt to create fuel with current 50 and capacity -100[0m              [1;30m# value_object_steps.go:538 -> *valueObjectContext[0m
    [32mThen[0m [32mfuel creation should fail with error "fuel capacity cannot be negative"[0m [1;30m# value_object_steps.go:539 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create fuel with current exceeding capacity fails                       [1;30m# features/domain/shared/fuel_value_object.feature:23[0m
    [32mWhen[0m [32mI attempt to create fuel with current 150 and capacity 100[0m                 [1;30m# value_object_steps.go:538 -> *valueObjectContext[0m
    [32mThen[0m [32mfuel creation should fail with error "current fuel cannot exceed capacity"[0m [1;30m# value_object_steps.go:539 -> *valueObjectContext[0m

  [1;37mScenario:[0m Create fuel at full capacity succeeds        [1;30m# features/domain/shared/fuel_value_object.feature:27[0m
    [32mWhen[0m [32mI create fuel with current 100 and capacity 100[0m [1;30m# value_object_steps.go:537 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel should have current 100[0m                [1;30m# value_object_steps.go:540 -> *valueObjectContext[0m
    [33mAnd[0m [33mthe fuel should be full[0m

  [1;37mScenario:[0m Create fuel at zero capacity succeeds    [1;30m# features/domain/shared/fuel_value_object.feature:32[0m
    [32mWhen[0m [32mI create fuel with current 0 and capacity 0[0m [1;30m# value_object_steps.go:537 -> *valueObjectContext[0m
    [32mThen[0m [32mthe fuel should have current 0[0m              [1;30m# value_object_steps.go:540 -> *valueObjectContext[0m
    [32mAnd[0m [32mthe fuel should have capacity 0[0m              [1;30m# value_object_steps.go:541 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel percentage           [1;30m# features/domain/shared/fuel_value_object.feature:41[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate the fuel percentage[0m        [1;30m# value_object_steps.go:543 -> *valueObjectContext[0m
    [32mThen[0m [32mthe percentage should be 50.0[0m          [1;30m# value_object_steps.go:544 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel percentage when full  [1;30m# features/domain/shared/fuel_value_object.feature:46[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate the fuel percentage[0m         [1;30m# value_object_steps.go:543 -> *valueObjectContext[0m
    [32mThen[0m [32mthe percentage should be 100.0[0m          [1;30m# value_object_steps.go:544 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel percentage when empty [1;30m# features/domain/shared/fuel_value_object.feature:51[0m
    [32mGiven[0m [32mfuel with current 0 and capacity 100[0m   [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate the fuel percentage[0m         [1;30m# value_object_steps.go:543 -> *valueObjectContext[0m
    [32mThen[0m [32mthe percentage should be 0.0[0m            [1;30m# value_object_steps.go:544 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate fuel percentage with zero capacity returns zero [1;30m# features/domain/shared/fuel_value_object.feature:56[0m
    [32mGiven[0m [32mfuel with current 0 and capacity 0[0m                          [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate the fuel percentage[0m                              [1;30m# value_object_steps.go:543 -> *valueObjectContext[0m
    [32mThen[0m [32mthe percentage should be 0.0[0m                                 [1;30m# value_object_steps.go:544 -> *valueObjectContext[0m

  [1;37mScenario:[0m Consume fuel returns new fuel object [1;30m# features/domain/shared/fuel_value_object.feature:65[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI consume 30 units of fuel[0m              [1;30m# value_object_steps.go:545 -> *valueObjectContext[0m
    [32mThen[0m [32mthe new fuel should have current 70[0m     [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m
    [33mAnd[0m [33mthe new fuel should have capacity 100[0m

  [1;37mScenario:[0m Consume negative fuel fails                                        [1;30m# features/domain/shared/fuel_value_object.feature:71[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m                               [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI attempt to consume -10 units of fuel[0m                                [1;30m# value_object_steps.go:546 -> *valueObjectContext[0m
    [32mThen[0m [32mthe operation should fail with error "fuel amount cannot be negative"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Consume more fuel than available sets to zero [1;30m# features/domain/shared/fuel_value_object.feature:76[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m           [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI consume 80 units of fuel[0m                       [1;30m# value_object_steps.go:545 -> *valueObjectContext[0m
    [32mThen[0m [32mthe new fuel should have current 0[0m               [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Consume all fuel                     [1;30m# features/domain/shared/fuel_value_object.feature:81[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI consume 100 units of fuel[0m             [1;30m# value_object_steps.go:545 -> *valueObjectContext[0m
    [32mThen[0m [32mthe new fuel should have current 0[0m      [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Consume zero fuel returns same values [1;30m# features/domain/shared/fuel_value_object.feature:86[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m   [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI consume 0 units of fuel[0m                [1;30m# value_object_steps.go:545 -> *valueObjectContext[0m
    [32mThen[0m [32mthe new fuel should have current 50[0m      [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Original fuel object is unchanged after consume [1;30m# features/domain/shared/fuel_value_object.feature:91[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m            [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [32mWhen[0m [32mI consume 30 units of fuel[0m                         [1;30m# value_object_steps.go:545 -> *valueObjectContext[0m
    [33mThen[0m [33mthe original fuel should still have current 100[0m

  [1;37mScenario:[0m Add fuel returns new fuel object    [1;30m# features/domain/shared/fuel_value_object.feature:100[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI add 30 units of fuel[0m
    [36mThen[0m [36mthe new fuel should have current 80[0m    [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m
    [33mAnd[0m [33mthe new fuel should have capacity 100[0m

  [1;37mScenario:[0m Add negative fuel fails                                           [1;30m# features/domain/shared/fuel_value_object.feature:106[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m                               [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI attempt to add -10 units of fuel[0m
    [36mThen[0m [36mthe operation should fail with error "add amount cannot be negative"[0m [1;30m# route_steps.go:772 -> *routeContext[0m

  [1;37mScenario:[0m Add fuel caps at capacity           [1;30m# features/domain/shared/fuel_value_object.feature:111[0m
    [32mGiven[0m [32mfuel with current 80 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI add 50 units of fuel[0m
    [36mThen[0m [36mthe new fuel should have current 100[0m   [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Add fuel to empty tank             [1;30m# features/domain/shared/fuel_value_object.feature:116[0m
    [32mGiven[0m [32mfuel with current 0 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI add 100 units of fuel[0m
    [36mThen[0m [36mthe new fuel should have current 100[0m  [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Add zero fuel returns same values   [1;30m# features/domain/shared/fuel_value_object.feature:121[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI add 0 units of fuel[0m
    [36mThen[0m [36mthe new fuel should have current 50[0m    [1;30m# value_object_steps.go:547 -> *valueObjectContext[0m

  [1;37mScenario:[0m Original fuel object is unchanged after add [1;30m# features/domain/shared/fuel_value_object.feature:126[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m         [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI add 30 units of fuel[0m
    [33mThen[0m [33mthe original fuel should still have current 50[0m

  [1;37mScenario:[0m Can travel with sufficient fuel                             [1;30m# features/domain/shared/fuel_value_object.feature:135[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m                        [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel can travel requiring 50 with safety margin 0.1[0m
    [36mThen[0m [36mthe result should be true[0m                                      [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Cannot travel with insufficient fuel                        [1;30m# features/domain/shared/fuel_value_object.feature:140[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m                         [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel can travel requiring 50 with safety margin 0.1[0m
    [36mThen[0m [36mthe result should be false[0m                                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Can travel with exact fuel and no safety margin             [1;30m# features/domain/shared/fuel_value_object.feature:145[0m
    [32mGiven[0m [32mfuel with current 50 and capacity 100[0m                         [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel can travel requiring 50 with safety margin 0.0[0m
    [36mThen[0m [36mthe result should be true[0m                                      [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Cannot travel with exact fuel but with safety margin        [1;30m# features/domain/shared/fuel_value_object.feature:150[0m
    [32mGiven[0m [32mfuel with current 55 and capacity 100[0m                         [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel can travel requiring 50 with safety margin 0.1[0m
    [36mThen[0m [36mthe result should be true[0m                                      [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is full when at capacity             [1;30m# features/domain/shared/fuel_value_object.feature:159[0m
    [32mGiven[0m [32mfuel with current 100 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel is full[0m
    [36mThen[0m [36mthe result should be true[0m               [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is not full when below capacity     [1;30m# features/domain/shared/fuel_value_object.feature:164[0m
    [32mGiven[0m [32mfuel with current 99 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel is full[0m
    [36mThen[0m [36mthe result should be false[0m             [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Is not full when empty             [1;30m# features/domain/shared/fuel_value_object.feature:169[0m
    [32mGiven[0m [32mfuel with current 0 and capacity 100[0m [1;30m# value_object_steps.go:542 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if fuel is full[0m
    [36mThen[0m [36mthe result should be false[0m            [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

[1;37mFeature:[0m Waypoint Value Object
  As a navigation system
  I want to work with immutable waypoint value objects
  So that I can safely share location data across the system

  [1;37mScenario:[0m Create waypoint with valid data                    [1;30m# features/domain/shared/waypoint_value_object.feature:10[0m
    [32mWhen[0m [32mI create a waypoint with symbol "X1-A1", x 0.0, y 0.0[0m [1;30m# value_object_steps.go:527 -> *valueObjectContext[0m
    [32mThen[0m [32mthe waypoint should have symbol "X1-A1"[0m               [1;30m# value_object_steps.go:530 -> *valueObjectContext[0m
    [33mAnd[0m [33mthe waypoint should have x coordinate 0.0[0m
    [33mAnd[0m [33mthe waypoint should have y coordinate 0.0[0m

  [1;37mScenario:[0m Create waypoint with empty symbol fails                 [1;30m# features/domain/shared/waypoint_value_object.feature:16[0m
    [32mWhen[0m [32mI attempt to create a waypoint with empty symbol[0m           [1;30m# value_object_steps.go:528 -> *valueObjectContext[0m
    [32mThen[0m [32mwaypoint creation should fail with error "cannot be empty"[0m [1;30m# value_object_steps.go:529 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate distance between two waypoints   [1;30m# features/domain/shared/waypoint_value_object.feature:24[0m
    [32mGiven[0m [32ma waypoint "X1-A1" at coordinates (0.0, 0.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (3.0, 4.0)[0m   [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate distance from "X1-A1" to "X1-B2"[0m  [1;30m# value_object_steps.go:532 -> *valueObjectContext[0m
    [32mThen[0m [32mthe distance should be 5.0[0m                    [1;30m# value_object_steps.go:533 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate distance to same waypoint is zero [1;30m# features/domain/shared/waypoint_value_object.feature:30[0m
    [32mGiven[0m [32ma waypoint "X1-A1" at coordinates (0.0, 0.0)[0m  [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate distance from "X1-A1" to "X1-A1"[0m   [1;30m# value_object_steps.go:532 -> *valueObjectContext[0m
    [32mThen[0m [32mthe distance should be 0.0[0m                     [1;30m# value_object_steps.go:533 -> *valueObjectContext[0m

  [1;37mScenario:[0m Calculate distance with negative coordinates   [1;30m# features/domain/shared/waypoint_value_object.feature:35[0m
    [32mGiven[0m [32ma waypoint "X1-A1" at coordinates (-10.0, -20.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (10.0, 20.0)[0m     [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate distance from "X1-A1" to "X1-B2"[0m      [1;30m# value_object_steps.go:532 -> *valueObjectContext[0m
    [32mThen[0m [32mthe distance should be approximately 44.72[0m        [1;30m# value_object_steps.go:534 -> *valueObjectContext[0m

  [1;37mScenario:[0m Distance calculation is symmetric          [1;30m# features/domain/shared/waypoint_value_object.feature:41[0m
    [32mGiven[0m [32ma waypoint "X1-A1" at coordinates (0.0, 0.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mAnd[0m [32ma waypoint "X1-B2" at coordinates (100.0, 0.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [32mWhen[0m [32mI calculate distance from "X1-A1" to "X1-B2"[0m  [1;30m# value_object_steps.go:532 -> *valueObjectContext[0m
    [32mAnd[0m [32mI calculate distance from "X1-B2" to "X1-A1"[0m   [1;30m# value_object_steps.go:532 -> *valueObjectContext[0m
    [33mThen[0m [33mboth distances should be equal[0m

  [1;37mScenario:[0m Check if waypoint is orbital of another    [1;30m# features/domain/shared/waypoint_value_object.feature:52[0m
    [33mGiven[0m [33ma waypoint "X1-A1" with orbitals ["X1-A1-B"][0m
    [36mAnd[0m [36ma waypoint "X1-A1-B" at coordinates (0.0, 0.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if "X1-A1-B" is orbital of "X1-A1"[0m
    [36mThen[0m [36mthe result should be true[0m                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Check waypoint is not orbital of unrelated waypoint [1;30m# features/domain/shared/waypoint_value_object.feature:58[0m
    [33mGiven[0m [33ma waypoint "X1-A1" with orbitals ["X1-A1-B"][0m
    [36mAnd[0m [36ma waypoint "X1-C3" at coordinates (0.0, 0.0)[0m            [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if "X1-C3" is orbital of "X1-A1"[0m
    [36mThen[0m [36mthe result should be false[0m                             [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

  [1;37mScenario:[0m Orbital relationship is bidirectional      [1;30m# features/domain/shared/waypoint_value_object.feature:64[0m
    [33mGiven[0m [33ma waypoint "X1-A1" with orbitals ["X1-A1-B"][0m
    [36mAnd[0m [36ma waypoint "X1-A1-B" at coordinates (0.0, 0.0)[0m [1;30m# value_object_steps.go:531 -> *valueObjectContext[0m
    [33mWhen[0m [33mI check if "X1-A1" is orbital of "X1-A1-B"[0m
    [36mThen[0m [36mthe result should be true[0m                     [1;30m# value_object_steps.go:588 -> *valueObjectContext[0m

[1;37mFeature:[0m Market Entity

  [1;37mScenario:[0m Create valid market with trade goods                          [1;30m# features/domain/trading/market_entity.feature:3[0m
    [32mGiven[0m [32ma market at waypoint "X1-GZ7-A1"[0m                                [1;30m# market_steps.go:277 -> *marketContext[0m
    [32mAnd[0m [32mthe market sells "IRON_ORE" at 50 credits with trade volume 100[0m   [1;30m# market_steps.go:278 -> *marketContext[0m
    [32mAnd[0m [32mthe market sells "COPPER_ORE" at 75 credits with trade volume 200[0m [1;30m# market_steps.go:278 -> *marketContext[0m
    [32mWhen[0m [32mI create the market[0m                                              [1;30m# market_steps.go:283 -> *marketContext[0m
    [32mThen[0m [32mthe market should be created successfully[0m                        [1;30m# market_steps.go:291 -> *marketContext[0m
    [32mAnd[0m [32mthe waypoint should be "X1-GZ7-A1"[0m                                [1;30m# market_steps.go:292 -> *marketContext[0m
    [32mAnd[0m [32mthe market should have 2 trade goods[0m                              [1;30m# market_steps.go:293 -> *marketContext[0m

  [1;37mScenario:[0m Create valid market with no trade goods [1;30m# features/domain/trading/market_entity.feature:12[0m
    [32mGiven[0m [32ma market at waypoint "X1-GZ7-A1"[0m          [1;30m# market_steps.go:277 -> *marketContext[0m
    [32mWhen[0m [32mI create the market with no trade goods[0m    [1;30m# market_steps.go:284 -> *marketContext[0m
    [32mThen[0m [32mthe market should be created successfully[0m  [1;30m# market_steps.go:291 -> *marketContext[0m
    [32mAnd[0m [32mthe market should have 0 trade goods[0m        [1;30m# market_steps.go:293 -> *marketContext[0m

  [1;37mScenario:[0m Cannot create market with empty waypoint symbol      [1;30m# features/domain/trading/market_entity.feature:18[0m
    [32mGiven[0m [32ma market at waypoint ""[0m                                [1;30m# market_steps.go:277 -> *marketContext[0m
    [32mWhen[0m [32mI try to create the market[0m                              [1;30m# market_steps.go:285 -> *marketContext[0m
    [32mThen[0m [32mI should get an error "waypoint symbol cannot be empty"[0m [1;30m# market_steps.go:294 -> *marketContext[0m

  [1;37mScenario:[0m Get existing trade good              [1;30m# features/domain/trading/market_entity.feature:23[0m
    [32mGiven[0m [32ma market with "IRON_ORE" at 50 credits[0m [1;30m# market_steps.go:279 -> *marketContext[0m
    [32mWhen[0m [32mI get trade good "IRON_ORE"[0m             [1;30m# market_steps.go:286 -> *marketContext[0m
    [32mThen[0m [32mI should find the trade good[0m            [1;30m# market_steps.go:295 -> *marketContext[0m
    [32mAnd[0m [32mthe sell price should be 50 credits[0m      [1;30m# market_steps.go:296 -> *marketContext[0m

  [1;37mScenario:[0m Get non-existent trade good          [1;30m# features/domain/trading/market_entity.feature:29[0m
    [32mGiven[0m [32ma market with "IRON_ORE" at 50 credits[0m [1;30m# market_steps.go:279 -> *marketContext[0m
    [32mWhen[0m [32mI get trade good "COPPER_ORE"[0m           [1;30m# market_steps.go:286 -> *marketContext[0m
    [32mThen[0m [32mI should not find the trade good[0m        [1;30m# market_steps.go:297 -> *marketContext[0m

  [1;37mScenario:[0m Get transaction limit for existing good      [1;30m# features/domain/trading/market_entity.feature:34[0m
    [32mGiven[0m [32ma market with "IRON_ORE" with trade volume 150[0m [1;30m# market_steps.go:280 -> *marketContext[0m
    [32mWhen[0m [32mI get transaction limit for "IRON_ORE"[0m          [1;30m# market_steps.go:287 -> *marketContext[0m
    [32mThen[0m [32mthe transaction limit should be 150[0m             [1;30m# market_steps.go:298 -> *marketContext[0m

  [1;37mScenario:[0m Get transaction limit for non-existent good returns unlimited [1;30m# features/domain/trading/market_entity.feature:39[0m
    [32mGiven[0m [32ma market with "IRON_ORE" with trade volume 150[0m                  [1;30m# market_steps.go:280 -> *marketContext[0m
    [32mWhen[0m [32mI get transaction limit for "COPPER_ORE"[0m                         [1;30m# market_steps.go:287 -> *marketContext[0m
    [32mThen[0m [32mthe transaction limit should be 999999[0m                           [1;30m# market_steps.go:298 -> *marketContext[0m

  [1;37mScenario:[0m Check market has good (true)         [1;30m# features/domain/trading/market_entity.feature:44[0m
    [32mGiven[0m [32ma market with "IRON_ORE" at 50 credits[0m [1;30m# market_steps.go:279 -> *marketContext[0m
    [32mWhen[0m [32mI check if market has "IRON_ORE"[0m        [1;30m# market_steps.go:288 -> *marketContext[0m
    [32mThen[0m [32mthe market should have the good[0m         [1;30m# market_steps.go:299 -> *marketContext[0m

  [1;37mScenario:[0m Check market has good (false)        [1;30m# features/domain/trading/market_entity.feature:49[0m
    [32mGiven[0m [32ma market with "IRON_ORE" at 50 credits[0m [1;30m# market_steps.go:279 -> *marketContext[0m
    [32mWhen[0m [32mI check if market has "COPPER_ORE"[0m      [1;30m# market_steps.go:288 -> *marketContext[0m
    [32mThen[0m [32mthe market should not have the good[0m     [1;30m# market_steps.go:300 -> *marketContext[0m

[1;37mFeature:[0m Accept Contract Command

  [1;37mScenario:[0m Accept unaccepted contract                                     [1;30m# features/application/accept_contract.feature:3[0m
    [32mGiven[0m [32man unaccepted contract "CONTRACT-1" for player 1 in the database[0m [1;30m# accept_contract_steps.go:274 -> *acceptContractContext[0m
    [32mWhen[0m [32mI execute accept contract command for "CONTRACT-1" with player 1[0m  [1;30m# accept_contract_steps.go:278 -> *acceptContractContext[0m
    [32mThen[0m [32mthe command should succeed[0m                                        [1;30m# accept_contract_steps.go:280 -> *acceptContractContext[0m
    [32mAnd[0m [32mthe contract should be marked as accepted[0m                          [1;30m# accept_contract_steps.go:281 -> *acceptContractContext[0m
    [32mAnd[0m [32mthe contract should still not be fulfilled[0m                         [1;30m# accept_contract_steps.go:282 -> *acceptContractContext[0m

  [1;37mScenario:[0m Accept already accepted contract                                       [1;30m# features/application/accept_contract.feature:10[0m
    [32mGiven[0m [32man accepted contract "CONTRACT-2" for player 1 in the database[0m           [1;30m# accept_contract_steps.go:275 -> *acceptContractContext[0m
    [32mWhen[0m [32mI try to execute accept contract command for "CONTRACT-2" with player 1[0m   [1;30m# accept_contract_steps.go:279 -> *acceptContractContext[0m
    [32mThen[0m [32mthe command should return an error containing "contract already accepted"[0m [1;30m# accept_contract_steps.go:283 -> *acceptContractContext[0m

  [1;37mScenario:[0m Accept non-existent contract                                           [1;30m# features/application/accept_contract.feature:15[0m
    [32mGiven[0m [32ma player with ID 1 exists in the database[0m                                [1;30m# accept_contract_steps.go:276 -> *acceptContractContext[0m

2025/11/15 16:02:48 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/contract_repository.go:26 [35;1mrecord not found
[0m[33m[0.057ms] [34;1m[rows:0][0m SELECT * FROM `contracts` WHERE contract_id = "NON-EXISTENT" AND player_id = 1 ORDER BY `contracts`.`contract_id` LIMIT 1
    [32mWhen[0m [32mI try to execute accept contract command for "NON-EXISTENT" with player 1[0m [1;30m# accept_contract_steps.go:279 -> *acceptContractContext[0m
    [32mThen[0m [32mthe command should return an error containing "contract not found"[0m        [1;30m# accept_contract_steps.go:283 -> *acceptContractContext[0m

  [1;37mScenario:[0m Accept contract with API integration                           [1;30m# features/application/accept_contract.feature:20[0m
    [32mGiven[0m [32man unaccepted contract "CONTRACT-3" for player 1 in the database[0m [1;30m# accept_contract_steps.go:274 -> *acceptContractContext[0m
    [32mAnd[0m [32mthe API will successfully accept the contract[0m                      [1;30m# accept_contract_steps.go:277 -> *acceptContractContext[0m
    [32mWhen[0m [32mI execute accept contract command for "CONTRACT-3" with player 1[0m  [1;30m# accept_contract_steps.go:278 -> *acceptContractContext[0m
    [32mThen[0m [32mthe command should succeed[0m                                        [1;30m# accept_contract_steps.go:280 -> *acceptContractContext[0m
    [32mAnd[0m [32mthe contract should be persisted with accepted status[0m              [1;30m# accept_contract_steps.go:284 -> *acceptContractContext[0m

[1;37mFeature:[0m Assign Scouting Fleet
  As a space trader
  I want to automatically assign all probe and satellite ships to market scouting operations
  So that I can efficiently gather market data across all non-fuel-station marketplaces

  [1;37mBackground:[0m
    [33mGiven[0m [33ma mediator is configured with scouting handlers[0m
    [36mAnd[0m [36ma player with ID 1 exists with agent "TEST-AGENT"[0m                   [1;30m# batch_contract_workflow_steps.go:616 -> *batchContractWorkflowContext[0m
    [36mAnd[0m [36ma system "X1-TEST" exists with multiple waypoints[0m                   [1;30m# batch_contract_workflow_steps.go:617 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Assign all probe ships to scout markets excluding fuel stations [1;30m# features/application/assign_scouting_fleet.feature:11[0m
    [33mGiven[0m [33mthe following ships owned by player 1 in system "X1-TEST":[0m
      | [36msymbol[0m   | [36mframe_type[0m  | [36mlocation[0m   |
      | [36mPROBE-1[0m  | [36mFRAME_PROBE[0m | [36mX1-TEST-A1[0m |
      | [36mPROBE-2[0m  | [36mFRAME_PROBE[0m | [36mX1-TEST-B1[0m |
      | [36mHAULER-1[0m | [36mFRAME_HEAVY[0m | [36mX1-TEST-C1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m      | [36mtraits[0m       |
      | [36mX1-TEST-A1[0m | [36mPLANET[0m    | [36mMARKETPLACE[0m  |
      | [36mX1-TEST-B1[0m | [36mMOON[0m      | [36mMARKETPLACE[0m  |
      | [36mX1-TEST-C1[0m | [36mGAS_GIANT[0m | [36mFUEL_STATION[0m |
      | [36mX1-TEST-D1[0m | [36mASTEROID[0m  | [36mMARKETPLACE[0m  |
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [33mThen[0m [33mthe command should assign 2 ships to scouting[0m
    [33mAnd[0m [33mship "PROBE-1" should be assigned to scout markets[0m
    [33mAnd[0m [33mship "PROBE-2" should be assigned to scout markets[0m
    [33mAnd[0m [33mship "HAULER-1" should not be assigned[0m
    [33mAnd[0m [33mthe markets assigned should exclude "X1-TEST-C1"[0m
    [33mAnd[0m [33mthe markets assigned should include "X1-TEST-A1"[0m
    [33mAnd[0m [33mthe markets assigned should include "X1-TEST-B1"[0m
    [33mAnd[0m [33mthe markets assigned should include "X1-TEST-D1"[0m

  [1;37mScenario:[0m Assign probe and drone ships together                      [1;30m# features/application/assign_scouting_fleet.feature:35[0m
    [33mGiven[0m [33mthe following ships owned by player 1 in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mframe_type[0m     | [36mlocation[0m   |
      | [36mPROBE-1[0m    | [36mFRAME_PROBE[0m    | [36mX1-TEST-A1[0m |
      | [36mDRONE-1[0m    | [36mFRAME_DRONE[0m    | [36mX1-TEST-B1[0m |
      | [36mEXPLORER-1[0m | [36mFRAME_EXPLORER[0m | [36mX1-TEST-C1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m   | [36mtraits[0m      |
      | [36mX1-TEST-A1[0m | [36mPLANET[0m | [36mMARKETPLACE[0m |
      | [36mX1-TEST-B1[0m | [36mMOON[0m   | [36mMARKETPLACE[0m |
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [33mThen[0m [33mthe command should assign 2 ships to scouting[0m
    [33mAnd[0m [33mship "PROBE-1" should be assigned to scout markets[0m
    [33mAnd[0m [33mship "DRONE-1" should be assigned to scout markets[0m
    [33mAnd[0m [33mship "EXPLORER-1" should not be assigned[0m

  [1;37mScenario:[0m No probe or satellite ships available                               [1;30m# features/application/assign_scouting_fleet.feature:53[0m
    [33mGiven[0m [33mthe following ships owned by player 1 in system "X1-TEST":[0m
      | [36msymbol[0m   | [36mframe_type[0m  | [36mlocation[0m   |
      | [36mHAULER-1[0m | [36mFRAME_HEAVY[0m | [36mX1-TEST-A1[0m |
      | [36mMINER-1[0m  | [36mFRAME_MINER[0m | [36mX1-TEST-B1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m   | [36mtraits[0m      |
      | [36mX1-TEST-A1[0m | [36mPLANET[0m | [36mMARKETPLACE[0m |
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [36mThen[0m [36mthe command should fail with error "no probe or satellite ships found"[0m [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m
    [33mAnd[0m [33mno ships should be assigned to scouting[0m

  [1;37mScenario:[0m Only fuel stations available (no markets to scout)                       [1;30m# features/application/assign_scouting_fleet.feature:67[0m
    [33mGiven[0m [33mthe following ships owned by player 1 in system "X1-TEST":[0m
      | [36msymbol[0m  | [36mframe_type[0m  | [36mlocation[0m   |
      | [36mPROBE-1[0m | [36mFRAME_PROBE[0m | [36mX1-TEST-A1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m      | [36mtraits[0m       |
      | [36mX1-TEST-A1[0m | [36mGAS_GIANT[0m | [36mFUEL_STATION[0m |
      | [36mX1-TEST-B1[0m | [36mGAS_GIANT[0m | [36mFUEL_STATION[0m |
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [36mThen[0m [36mthe command should fail with error "no non-fuel-station marketplaces found"[0m [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m
    [33mAnd[0m [33mno ships should be assigned to scouting[0m

  [1;37mScenario:[0m Reuse existing scout containers (idempotency)              [1;30m# features/application/assign_scouting_fleet.feature:81[0m
    [33mGiven[0m [33mthe following ships owned by player 1 in system "X1-TEST":[0m
      | [36msymbol[0m  | [36mframe_type[0m  | [36mlocation[0m   |
      | [36mPROBE-1[0m | [36mFRAME_PROBE[0m | [36mX1-TEST-A1[0m |
      | [36mPROBE-2[0m | [36mFRAME_PROBE[0m | [36mX1-TEST-B1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m   | [36mtraits[0m      |
      | [36mX1-TEST-A1[0m | [36mPLANET[0m | [36mMARKETPLACE[0m |
      | [36mX1-TEST-B1[0m | [36mMOON[0m   | [36mMARKETPLACE[0m |
    [33mAnd[0m [33mship "PROBE-1" already has a running scout-tour container[0m
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [33mThen[0m [33mthe command should assign 2 ships to scouting[0m
    [33mAnd[0m [33mship "PROBE-1" container should be reused[0m
    [33mAnd[0m [33mship "PROBE-2" should get a new scout-tour container[0m
    [33mAnd[0m [33m1 container should be marked as reused[0m

  [1;37mScenario:[0m Filter ships to only those in the specified system         [1;30m# features/application/assign_scouting_fleet.feature:99[0m
    [33mGiven[0m [33mthe following ships owned by player 1:[0m
      | [36msymbol[0m  | [36mframe_type[0m  | [36msystem[0m   | [36mlocation[0m    |
      | [36mPROBE-1[0m | [36mFRAME_PROBE[0m | [36mX1-TEST[0m  | [36mX1-TEST-A1[0m  |
      | [36mPROBE-2[0m | [36mFRAME_PROBE[0m | [36mX1-OTHER[0m | [36mX1-OTHER-Z1[0m |
    [33mAnd[0m [33mthe following waypoints with marketplaces in system "X1-TEST":[0m
      | [36msymbol[0m     | [36mtype[0m   | [36mtraits[0m      |
      | [36mX1-TEST-A1[0m | [36mPLANET[0m | [36mMARKETPLACE[0m |
    [33mWhen[0m [33mI execute the assign scouting fleet command with:[0m
      | [36mplayer_id[0m     | [36m1[0m       |
      | [36msystem_symbol[0m | [36mX1-TEST[0m |
    [33mThen[0m [33mthe command should assign 1 ship to scouting[0m
    [33mAnd[0m [33mship "PROBE-1" should be assigned to scout markets[0m
    [33mAnd[0m [33mship "PROBE-2" should not be assigned[0m

[1;37mFeature:[0m Batch Contract Workflow
  As a space trader
  I want to execute automated contract workflows in batches
  So that I can efficiently complete multiple contracts with minimal manual intervention

  [1;37mBackground:[0m
    [32mGiven[0m [32ma mediator is configured with all contract handlers[0m             [1;30m# batch_contract_workflow_steps.go:615 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma player with ID 1 exists with agent "TEST-AGENT"[0m                 [1;30m# batch_contract_workflow_steps.go:616 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma system "X1-TEST" exists with multiple waypoints[0m                 [1;30m# batch_contract_workflow_steps.go:617 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Single contract workflow end-to-end                           [1;30m# features/application/batch_contract_workflow.feature:11[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m      [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                          [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                            [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit[0m [1;30m# batch_contract_workflow_steps.go:621 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mwaypoint "X1-TEST-C1" exists as a delivery destination[0m            [1;30m# batch_contract_workflow_steps.go:622 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                          [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                 [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32mno errors should be recorded[0m                                      [1;30m# batch_contract_workflow_steps.go:637 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Resume existing active contract (idempotency)                 [1;30m# features/application/batch_contract_workflow.feature:28[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m      [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                          [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32man existing active contract "CONTRACT-1" for player 1 requiring:[0m  [1;30m# batch_contract_workflow_steps.go:623 -> *batchContractWorkflowContext[0m
      | [36mtrade_symbol[0m       | [36mIRON_ORE[0m   |
      | [36munits_required[0m     | [36m100[0m        |
      | [36munits_fulfilled[0m    | [36m0[0m          |
      | [36mdestination_symbol[0m | [36mX1-TEST-C1[0m |
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit[0m [1;30m# batch_contract_workflow_steps.go:621 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                          [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                 [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m0[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32mthe existing contract "CONTRACT-1" should be fulfilled[0m            [1;30m# batch_contract_workflow_steps.go:638 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Multi-trip delivery when cargo capacity is less than required units      [1;30m# features/application/batch_contract_workflow.feature:48[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m                 [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                                     [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                                       [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma contract requiring 200 units of "IRON_ORE" to be delivered to "X1-TEST-C1"[0m [1;30m# batch_contract_workflow_steps.go:624 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit[0m            [1;30m# batch_contract_workflow_steps.go:621 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                                     [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                            [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32mthe workflow should have executed 2 trips[0m                                    [1;30m# batch_contract_workflow_steps.go:639 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mall 200 units should be delivered[0m                                            [1;30m# batch_contract_workflow_steps.go:640 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Jettison wrong cargo before purchase when cargo is full                  [1;30m# features/application/batch_contract_workflow.feature:66[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m                 [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                                     [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has cargo:[0m                                                 [1;30m# batch_contract_workflow_steps.go:625 -> *batchContractWorkflowContext[0m
      | [36msymbol[0m     | [36munits[0m |
      | [36mCOPPER_ORE[0m | [36m50[0m    |
    [32mAnd[0m [32mno active contracts exist for player 1[0m                                       [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma contract requiring 100 units of "IRON_ORE" to be delivered to "X1-TEST-C1"[0m [1;30m# batch_contract_workflow_steps.go:624 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit[0m            [1;30m# batch_contract_workflow_steps.go:621 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                                     [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                            [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32m"COPPER_ORE" should have been jettisoned[0m                                     [1;30m# batch_contract_workflow_steps.go:641 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32m"IRON_ORE" should have been purchased[0m                                        [1;30m# batch_contract_workflow_steps.go:642 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Jettison wrong cargo when ship has mixed cargo and needs more space      [1;30m# features/application/batch_contract_workflow.feature:87[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m                 [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                                     [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has cargo:[0m                                                 [1;30m# batch_contract_workflow_steps.go:625 -> *batchContractWorkflowContext[0m
      | [36msymbol[0m     | [36munits[0m |
      | [36mIRON_ORE[0m   | [36m30[0m    |
      | [36mCOPPER_ORE[0m | [36m40[0m    |
    [32mAnd[0m [32mno active contracts exist for player 1[0m                                       [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma contract requiring 100 units of "IRON_ORE" to be delivered to "X1-TEST-C1"[0m [1;30m# batch_contract_workflow_steps.go:624 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit[0m            [1;30m# batch_contract_workflow_steps.go:621 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                                     [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                            [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32m"COPPER_ORE" should have been jettisoned[0m                                     [1;30m# batch_contract_workflow_steps.go:641 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32m70 units of "IRON_ORE" should have been purchased[0m                            [1;30m# batch_contract_workflow_steps.go:643 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Transaction splitting when market has transaction limits                                [1;30m# features/application/batch_contract_workflow.feature:109[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m                                [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                                                    [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                                                      [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma contract requiring 100 units of "IRON_ORE" to be delivered to "X1-TEST-C1"[0m                [1;30m# batch_contract_workflow_steps.go:624 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market at "X1-TEST-B1" sells "IRON_ORE" for 50 credits per unit with transaction limit 30[0m [1;30m# batch_contract_workflow_steps.go:626 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                                                    [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                                           [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32mpurchases should have been split into 4 transactions[0m                                        [1;30m# batch_contract_workflow_steps.go:644 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Multiple iterations with profit tracking                 [1;30m# features/application/batch_contract_workflow.feature:126[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                     [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                       [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mmarkets sell "IRON_ORE" at various prices[0m                    [1;30m# batch_contract_workflow_steps.go:627 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                     [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m3[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                            [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m3[0m |
      | [36maccepted[0m   | [36m3[0m |
      | [36mfulfilled[0m  | [36m3[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32mtotal profit should be calculated across all contracts[0m       [1;30m# batch_contract_workflow_steps.go:645 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Graceful error handling - continue to next iteration on failure [1;30m# features/application/batch_contract_workflow.feature:142[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m        [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                            [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                              [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe second contract negotiation will fail[0m                           [1;30m# batch_contract_workflow_steps.go:628 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                            [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m3[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                   [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m2[0m |
      | [36maccepted[0m   | [36m2[0m |
      | [36mfulfilled[0m  | [36m2[0m |
      | [36mfailed[0m     | [36m1[0m |
    [32mAnd[0m [32m1 error should be recorded[0m                                          [1;30m# batch_contract_workflow_steps.go:646 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe workflow should complete all 3 iterations[0m                       [1;30m# batch_contract_workflow_steps.go:647 -> *batchContractWorkflowContext[0m

  [1;37mScenario:[0m Unprofitable contract still accepted (matches Python behavior) [1;30m# features/application/batch_contract_workflow.feature:159[0m
    [32mGiven[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-TEST-A1"[0m       [1;30m# batch_contract_workflow_steps.go:618 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mthe ship "SHIP-1" has 100 cargo capacity[0m                           [1;30m# batch_contract_workflow_steps.go:619 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32mno active contracts exist for player 1[0m                             [1;30m# batch_contract_workflow_steps.go:620 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma contract with net profit of -3000 credits[0m                        [1;30m# batch_contract_workflow_steps.go:629 -> *batchContractWorkflowContext[0m
    [32mAnd[0m [32ma market sells the required goods[0m                                  [1;30m# batch_contract_workflow_steps.go:630 -> *batchContractWorkflowContext[0m
    [32mWhen[0m [32mI execute batch contract workflow with:[0m                           [1;30m# batch_contract_workflow_steps.go:633 -> *batchContractWorkflowContext[0m
      | [36mship_symbol[0m | [36mSHIP-1[0m |
      | [36miterations[0m  | [36m1[0m      |
      | [36mplayer_id[0m   | [36m1[0m      |
    [32mThen[0m [32mthe workflow result should show:[0m                                  [1;30m# batch_contract_workflow_steps.go:636 -> *batchContractWorkflowContext[0m
      | [36mnegotiated[0m | [36m1[0m |
      | [36maccepted[0m   | [36m1[0m |
      | [36mfulfilled[0m  | [36m1[0m |
      | [36mfailed[0m     | [36m0[0m |
    [32mAnd[0m [32ma warning should be logged about unprofitability[0m                   [1;30m# batch_contract_workflow_steps.go:648 -> *batchContractWorkflowContext[0m

[1;37mFeature:[0m Deliver Contract Command
  As a SpaceTraders player
  I want to deliver cargo for contracts
  So that I can fulfill contract requirements and earn rewards

  [1;37mScenario:[0m Deliver cargo for valid delivery                                                                           [1;30m# features/application/deliver_contract.feature:7[0m
    [32mGiven[0m [32ma player with ID 1 and token "test-token-1"[0m                                                                  [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [32mAnd[0m [32man accepted contract "CONTRACT-1" for player 1 with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                  [1;30m# deliver_contract_steps.go:377 -> *deliverContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-GZ7-A1" with 50 "IRON_ORE" in cargo[0m                          [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mAnd[0m [32mthe API will return successful delivery with 50 units delivered[0m                                                [1;30m# deliver_contract_steps.go:380 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "CONTRACT-1", ship "SHIP-1", trade "IRON_ORE", 50 units, player 1[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should succeed[0m                                                                            [1;30m# deliver_contract_steps.go:382 -> *deliverContractContext[0m
    [32mAnd[0m [32m50 units should be delivered[0m                                                                                   [1;30m# deliver_contract_steps.go:383 -> *deliverContractContext[0m
    [32mAnd[0m [32mthe contract should show 50 units fulfilled for "IRON_ORE"[0m                                                     [1;30m# deliver_contract_steps.go:384 -> *deliverContractContext[0m

  [1;37mScenario:[0m Deliver remaining cargo completes delivery                                                                 [1;30m# features/application/deliver_contract.feature:17[0m
    [32mGiven[0m [32ma player with ID 1 and token "test-token-1"[0m                                                                  [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [32mAnd[0m [32man accepted contract "CONTRACT-1" for player 1 with 50 of 100 "IRON_ORE" already delivered to "X1-GZ7-A1"[0m      [1;30m# deliver_contract_steps.go:378 -> *deliverContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-GZ7-A1" with 50 "IRON_ORE" in cargo[0m                          [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mAnd[0m [32mthe API will return successful delivery with 50 units delivered[0m                                                [1;30m# deliver_contract_steps.go:380 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "CONTRACT-1", ship "SHIP-1", trade "IRON_ORE", 50 units, player 1[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should succeed[0m                                                                            [1;30m# deliver_contract_steps.go:382 -> *deliverContractContext[0m
    [32mAnd[0m [32m50 units should be delivered[0m                                                                                   [1;30m# deliver_contract_steps.go:383 -> *deliverContractContext[0m
    [32mAnd[0m [32mthe contract should show 100 units fulfilled for "IRON_ORE"[0m                                                    [1;30m# deliver_contract_steps.go:384 -> *deliverContractContext[0m

  [1;37mScenario:[0m Cannot deliver more than required                                                                           [1;30m# features/application/deliver_contract.feature:27[0m
    [32mGiven[0m [32ma player with ID 1 and token "test-token-1"[0m                                                                   [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [32mAnd[0m [32man accepted contract "CONTRACT-1" for player 1 with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                   [1;30m# deliver_contract_steps.go:377 -> *deliverContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-GZ7-A1" with 150 "IRON_ORE" in cargo[0m                          [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "CONTRACT-1", ship "SHIP-1", trade "IRON_ORE", 150 units, player 1[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should fail with error "units exceed required"[0m                                             [1;30m# deliver_contract_steps.go:385 -> *deliverContractContext[0m

  [1;37mScenario:[0m Cannot deliver invalid trade symbol                                                                          [1;30m# features/application/deliver_contract.feature:34[0m
    [32mGiven[0m [32ma player with ID 1 and token "test-token-1"[0m                                                                    [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [32mAnd[0m [32man accepted contract "CONTRACT-1" for player 1 with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                    [1;30m# deliver_contract_steps.go:377 -> *deliverContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-GZ7-A1" with 50 "COPPER_ORE" in cargo[0m                          [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "CONTRACT-1", ship "SHIP-1", trade "COPPER_ORE", 50 units, player 1[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should fail with error "trade symbol not in contract"[0m                                       [1;30m# deliver_contract_steps.go:385 -> *deliverContractContext[0m

  [1;37mScenario:[0m Cannot deliver when contract not found                                                                      [1;30m# features/application/deliver_contract.feature:41[0m
    [32mGiven[0m [32ma player with ID 1 and token "test-token-1"[0m                                                                   [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 1 at waypoint "X1-GZ7-A1" with 50 "IRON_ORE" in cargo[0m                           [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "NONEXISTENT", ship "SHIP-1", trade "IRON_ORE", 50 units, player 1[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should fail with error "contract not found"[0m                                                [1;30m# deliver_contract_steps.go:385 -> *deliverContractContext[0m

  [1;37mScenario:[0m Cannot deliver when player not found                                                                         [1;30m# features/application/deliver_contract.feature:47[0m
    [32mGiven[0m [32man accepted contract "CONTRACT-1" for player 999 with delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                [1;30m# deliver_contract_steps.go:377 -> *deliverContractContext[0m
    [32mAnd[0m [32ma ship "SHIP-1" owned by player 999 at waypoint "X1-GZ7-A1" with 50 "IRON_ORE" in cargo[0m                          [1;30m# deliver_contract_steps.go:379 -> *deliverContractContext[0m
    [32mWhen[0m [32mI send DeliverContractCommand with contract "CONTRACT-1", ship "SHIP-1", trade "IRON_ORE", 50 units, player 999[0m [1;30m# deliver_contract_steps.go:381 -> *deliverContractContext[0m
    [32mThen[0m [32mthe deliver command should fail with error "player not found"[0m                                                   [1;30m# deliver_contract_steps.go:385 -> *deliverContractContext[0m

[1;37mFeature:[0m Dock Ship Command
  As a SpaceTraders bot
  I want to dock ships at waypoints
  So that I can refuel and access station services

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                           [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.062ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.047ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Dock ship when already docked                                    [1;30m# features/application/dock_ship.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute DockShipCommand for ship "SHIP-1" and player 1[0m            [1;30m# ship_operations_context.go:528 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe dock command should succeed with status "already_docked"[0m        [1;30m# ship_operations_context.go:529 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe ship should still be docked[0m                                      [1;30m# ship_operations_context.go:530 -> *shipOperationsContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.075ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.058ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Dock ship when in orbit                                          [1;30m# features/application/dock_ship.feature:16[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m     [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute DockShipCommand for ship "SHIP-1" and player 1[0m            [1;30m# ship_operations_context.go:528 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe dock command should succeed with status "docked"[0m                [1;30m# ship_operations_context.go:529 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe ship should be docked at "X1-A1"[0m                                 [1;30m# ship_operations_context.go:531 -> *shipOperationsContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.081ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.049ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-START" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.043ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot dock ship when in transit                                    [1;30m# features/application/dock_ship.feature:22[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in transit to "X1-B2"[0m                    [1;30m# ship_operations_context.go:525 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute DockShipCommand for ship "SHIP-1" and player 1[0m               [1;30m# ship_operations_context.go:528 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe dock command should fail with error "cannot dock while in transit"[0m [1;30m# ship_operations_context.go:532 -> *shipOperationsContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.073ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mScenario:[0m Cannot dock ship that does not exist                             [1;30m# features/application/dock_ship.feature:27[0m
    [32mWhen[0m [32mI execute DockShipCommand for ship "NONEXISTENT" and player 1[0m       [1;30m# ship_operations_context.go:528 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe dock command should fail with error "ship not found"[0m            [1;30m# ship_operations_context.go:532 -> *shipOperationsContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.067ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 2 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.071ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot dock ship belonging to different player                   [1;30m# features/application/dock_ship.feature:31[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 2 at "X1-A1" with status "IN_ORBIT"[0m     [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:49 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.054ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1
    [32mWhen[0m [32mI execute DockShipCommand for ship "SHIP-1" and player 1[0m            [1;30m# ship_operations_context.go:528 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe dock command should fail with error "ship not found"[0m            [1;30m# ship_operations_context.go:532 -> *shipOperationsContext[0m

[1;37mFeature:[0m Evaluate Contract Profitability Query

  [1;37mBackground:[0m
    [32mGiven[0m [32ma system "X1-GZ7"[0m                                                             [1;30m# evaluate_contract_profitability_steps.go:458 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Profitable contract with single delivery                                    [1;30m# features/application/evaluate_contract_profitability.feature:6[0m
    [32mGiven[0m [32ma contract paying 10000 credits on acceptance and 50000 on fulfillment[0m        [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                 [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 200 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 100 cargo capacity[0m                                                  [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 1000 credits per trip[0m                                              [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                          [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe net profit should be 39000 credits[0m                                         [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should be profitable[0m                                               [1;30m# evaluate_contract_profitability_steps.go:476 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 1[0m                                                      [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe purchase cost should be 20000 credits[0m                                       [1;30m# evaluate_contract_profitability_steps.go:479 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Acceptable small loss within threshold                                      [1;30m# features/application/evaluate_contract_profitability.feature:18[0m
    [32mGiven[0m [32ma contract paying 10000 credits on acceptance and 20000 on fulfillment[0m        [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                 [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 300 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 100 cargo capacity[0m                                                  [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 4000 credits per trip[0m                                              [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                          [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe net profit should be -4000 credits[0m                                         [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should be profitable[0m                                               [1;30m# evaluate_contract_profitability_steps.go:476 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe reason should contain "Acceptable small loss"[0m                               [1;30m# evaluate_contract_profitability_steps.go:480 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 1[0m                                                      [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Unacceptable loss exceeding threshold                                       [1;30m# features/application/evaluate_contract_profitability.feature:30[0m
    [32mGiven[0m [32ma contract paying 5000 credits on acceptance and 10000 on fulfillment[0m         [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 200 "IRON_ORE" to "X1-GZ7-A1"[0m                 [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 300 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 50 cargo capacity[0m                                                   [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 2000 credits per trip[0m                                              [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                          [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe net profit should be -53000 credits[0m                                        [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should not be profitable[0m                                           [1;30m# evaluate_contract_profitability_steps.go:477 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe reason should contain "Loss exceeds acceptable threshold"[0m                   [1;30m# evaluate_contract_profitability_steps.go:480 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 4[0m                                                      [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Multi-delivery contract                                                       [1;30m# features/application/evaluate_contract_profitability.feature:42[0m
    [32mGiven[0m [32ma contract paying 20000 credits on acceptance and 80000 on fulfillment[0m          [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                   [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 50 "COPPER_ORE" to "X1-GZ7-B2"[0m                  [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 200 credits per unit in system "X1-GZ7"[0m   [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "COPPER_ORE" at 300 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 100 cargo capacity[0m                                                    [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 1500 credits per trip[0m                                                [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                            [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe purchase cost should be 35000 credits[0m                                        [1;30m# evaluate_contract_profitability_steps.go:479 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 2[0m                                                        [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe net profit should be 62000 credits[0m                                            [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should be profitable[0m                                                 [1;30m# evaluate_contract_profitability_steps.go:476 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m No cheapest market found                                             [1;30m# features/application/evaluate_contract_profitability.feature:56[0m
    [32mGiven[0m [32ma contract paying 10000 credits on acceptance and 50000 on fulfillment[0m [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "RARE_ORE" to "X1-GZ7-A1"[0m          [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mno market sells "RARE_ORE" in system "X1-GZ7"[0m                            [1;30m# evaluate_contract_profitability_steps.go:465 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 100 cargo capacity[0m                                           [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI try to evaluate the contract profitability[0m                            [1;30m# evaluate_contract_profitability_steps.go:471 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mI should get an error containing "no market found selling RARE_ORE"[0m     [1;30m# evaluate_contract_profitability_steps.go:481 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Ship not found                                                              [1;30m# features/application/evaluate_contract_profitability.feature:64[0m
    [32mGiven[0m [32ma contract paying 10000 credits on acceptance and 50000 on fulfillment[0m        [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "IRON_ORE" to "X1-GZ7-A1"[0m                 [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 200 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI try to evaluate the contract profitability with an invalid ship[0m              [1;30m# evaluate_contract_profitability_steps.go:472 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mI should get an error containing "ship not found"[0m                              [1;30m# evaluate_contract_profitability_steps.go:481 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Contract with partially fulfilled deliveries                                                [1;30m# features/application/evaluate_contract_profitability.feature:71[0m
    [32mGiven[0m [32ma contract paying 10000 credits on acceptance and 50000 on fulfillment[0m                        [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 100 "IRON_ORE" to "X1-GZ7-A1" with 40 units already fulfilled[0m [1;30m# evaluate_contract_profitability_steps.go:463 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 200 credits per unit in system "X1-GZ7"[0m                 [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 60 cargo capacity[0m                                                                   [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 1000 credits per trip[0m                                                              [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                                          [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe purchase cost should be 12000 credits[0m                                                      [1;30m# evaluate_contract_profitability_steps.go:479 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 1[0m                                                                      [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe net profit should be 47000 credits[0m                                                          [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should be profitable[0m                                                               [1;30m# evaluate_contract_profitability_steps.go:476 -> *evaluateContractProfitabilityContext[0m

  [1;37mScenario:[0m Multiple deliveries with same trade symbol                                  [1;30m# features/application/evaluate_contract_profitability.feature:83[0m
    [32mGiven[0m [32ma contract paying 30000 credits on acceptance and 70000 on fulfillment[0m        [1;30m# evaluate_contract_profitability_steps.go:461 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 50 "IRON_ORE" to "X1-GZ7-A1"[0m                  [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract requires delivery of 75 "IRON_ORE" to "X1-GZ7-B2"[0m                  [1;30m# evaluate_contract_profitability_steps.go:462 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe cheapest market sells "IRON_ORE" at 200 credits per unit in system "X1-GZ7"[0m [1;30m# evaluate_contract_profitability_steps.go:464 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32ma ship with 100 cargo capacity[0m                                                  [1;30m# evaluate_contract_profitability_steps.go:466 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mfuel cost is 1500 credits per trip[0m                                              [1;30m# evaluate_contract_profitability_steps.go:467 -> *evaluateContractProfitabilityContext[0m
    [32mWhen[0m [32mI evaluate the contract profitability[0m                                          [1;30m# evaluate_contract_profitability_steps.go:470 -> *evaluateContractProfitabilityContext[0m
    [32mThen[0m [32mthe purchase cost should be 25000 credits[0m                                      [1;30m# evaluate_contract_profitability_steps.go:479 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mtrips required should be 2[0m                                                      [1;30m# evaluate_contract_profitability_steps.go:478 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe net profit should be 72000 credits[0m                                          [1;30m# evaluate_contract_profitability_steps.go:475 -> *evaluateContractProfitabilityContext[0m
    [32mAnd[0m [32mthe contract should be profitable[0m                                               [1;30m# evaluate_contract_profitability_steps.go:476 -> *evaluateContractProfitabilityContext[0m

[1;37mFeature:[0m Fulfill Contract Command
  As a SpaceTraders player
  I want to fulfill completed contracts
  So that I can receive the fulfillment payment and complete my obligations

  [1;37mBackground:[0m
    [33mGiven[0m [33ma mediator is initialized[0m
    [33mAnd[0m [33ma mock API client[0m
    [33mAnd[0m [33ma contract repository[0m
    [33mAnd[0m [33ma player repository[0m

  [1;37mScenario:[0m Fulfill contract with all deliveries complete                            [1;30m# features/application/fulfill_contract.feature:13[0m
    [36mGiven[0m [36ma player with ID 1 and token "test-token-1"[0m                                [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [36mAnd[0m [36man accepted contract "CONTRACT-1" for player 1 with all deliveries fulfilled[0m [1;30m# fulfill_contract_steps.go:288 -> *fulfillContractContext[0m
    [36mAnd[0m [36mthe API will successfully fulfill the contract[0m                               [1;30m# fulfill_contract_steps.go:290 -> *fulfillContractContext[0m
    [36mWhen[0m [36mI send FulfillContractCommand for "CONTRACT-1" with player 1[0m                [1;30m# fulfill_contract_steps.go:291 -> *fulfillContractContext[0m
    [36mThen[0m [36mthe command should succeed[0m                                                  [1;30m# accept_contract_steps.go:280 -> *acceptContractContext[0m
    [36mAnd[0m [36mthe contract should be marked as fulfilled[0m                                   [1;30m# fulfill_contract_steps.go:293 -> *fulfillContractContext[0m

  [1;37mScenario:[0m Cannot fulfill contract with incomplete deliveries                    [1;30m# features/application/fulfill_contract.feature:21[0m
    [36mGiven[0m [36ma player with ID 1 and token "test-token-1"[0m                             [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [36mAnd[0m [36man accepted contract "CONTRACT-2" for player 1 with incomplete deliveries[0m [1;30m# fulfill_contract_steps.go:289 -> *fulfillContractContext[0m
    [36mWhen[0m [36mI send FulfillContractCommand for "CONTRACT-2" with player 1[0m             [1;30m# fulfill_contract_steps.go:291 -> *fulfillContractContext[0m
    [36mThen[0m [36mthe command should fail with error "deliveries not complete"[0m             [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m

  [1;37mScenario:[0m Fulfill non-existent contract                               [1;30m# features/application/fulfill_contract.feature:27[0m
    [36mGiven[0m [36ma player with ID 1 and token "test-token-1"[0m                   [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [36mWhen[0m [36mI send FulfillContractCommand for "NON-EXISTENT" with player 1[0m [1;30m# fulfill_contract_steps.go:291 -> *fulfillContractContext[0m
    [36mThen[0m [36mthe command should fail with error "contract not found"[0m        [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m

  [1;37mScenario:[0m Fulfill contract without valid player                                        [1;30m# features/application/fulfill_contract.feature:32[0m
    [36mGiven[0m [36man accepted contract "CONTRACT-3" for player 999 with all deliveries fulfilled[0m [1;30m# fulfill_contract_steps.go:288 -> *fulfillContractContext[0m
    [36mWhen[0m [36mI send FulfillContractCommand for "CONTRACT-3" with player 999[0m                  [1;30m# fulfill_contract_steps.go:291 -> *fulfillContractContext[0m
    [36mThen[0m [36mthe command should fail with error "player not found"[0m                           [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m

  [1;37mScenario:[0m Fulfill contract with API integration                                    [1;30m# features/application/fulfill_contract.feature:37[0m
    [36mGiven[0m [36ma player with ID 1 and token "test-token-1"[0m                                [1;30m# fulfill_contract_steps.go:287 -> *fulfillContractContext[0m
    [36mAnd[0m [36man accepted contract "CONTRACT-4" for player 1 with all deliveries fulfilled[0m [1;30m# fulfill_contract_steps.go:288 -> *fulfillContractContext[0m
    [36mAnd[0m [36mthe API will successfully fulfill the contract[0m                               [1;30m# fulfill_contract_steps.go:290 -> *fulfillContractContext[0m
    [36mWhen[0m [36mI send FulfillContractCommand for "CONTRACT-4" with player 1[0m                [1;30m# fulfill_contract_steps.go:291 -> *fulfillContractContext[0m
    [36mThen[0m [36mthe command should succeed[0m                                                  [1;30m# accept_contract_steps.go:280 -> *acceptContractContext[0m
    [36mAnd[0m [36mthe contract should be persisted with fulfilled status[0m                       [1;30m# fulfill_contract_steps.go:295 -> *fulfillContractContext[0m

[1;37mFeature:[0m Jettison Cargo Command
  As a SpaceTraders bot
  I want to jettison cargo from ships
  So that I can free up cargo space when needed

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m                 [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                           [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Jettison cargo successfully from ship in orbit                                   [1;30m# features/application/jettison_cargo.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1" with cargo:[0m                       [1;30m# jettison_cargo_steps.go:322 -> *jettisonCargoContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m50[0m    |
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "SHIP-1" jettisoning 30 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should succeed[0m                                                 [1;30m# jettison_cargo_steps.go:325 -> *jettisonCargoContext[0m
    [32mAnd[0m [32m30 units should have been jettisoned[0m                                                 [1;30m# jettison_cargo_steps.go:326 -> *jettisonCargoContext[0m
    [32mAnd[0m [32mthe ship should have 20 units of "IRON_ORE" remaining[0m                                [1;30m# jettison_cargo_steps.go:327 -> *jettisonCargoContext[0m

  [1;37mScenario:[0m Jettison all cargo of a type                                                     [1;30m# features/application/jettison_cargo.feature:19[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1" with cargo:[0m                       [1;30m# jettison_cargo_steps.go:322 -> *jettisonCargoContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m50[0m    |
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "SHIP-1" jettisoning 50 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should succeed[0m                                                 [1;30m# jettison_cargo_steps.go:325 -> *jettisonCargoContext[0m
    [32mAnd[0m [32m50 units should have been jettisoned[0m                                                 [1;30m# jettison_cargo_steps.go:326 -> *jettisonCargoContext[0m
    [32mAnd[0m [32mthe ship should have 0 units of "IRON_ORE" remaining[0m                                 [1;30m# jettison_cargo_steps.go:327 -> *jettisonCargoContext[0m

  [1;37mScenario:[0m Cannot jettison more cargo than ship has                                         [1;30m# features/application/jettison_cargo.feature:28[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1" with cargo:[0m                       [1;30m# jettison_cargo_steps.go:322 -> *jettisonCargoContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m20[0m    |
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "SHIP-1" jettisoning 30 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should fail with error "insufficient cargo"[0m                    [1;30m# jettison_cargo_steps.go:328 -> *jettisonCargoContext[0m

  [1;37mScenario:[0m Cannot jettison cargo ship doesn't have at all                                   [1;30m# features/application/jettison_cargo.feature:35[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1" with cargo:[0m                       [1;30m# jettison_cargo_steps.go:322 -> *jettisonCargoContext[0m
      | [36msymbol[0m | [36munits[0m |
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "SHIP-1" jettisoning 30 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should fail with error "insufficient cargo"[0m                    [1;30m# jettison_cargo_steps.go:328 -> *jettisonCargoContext[0m

  [1;37mScenario:[0m Ship not found                                                                         [1;30m# features/application/jettison_cargo.feature:41[0m
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "NON-EXISTENT" jettisoning 30 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should fail with error "ship not found"[0m                              [1;30m# jettison_cargo_steps.go:328 -> *jettisonCargoContext[0m

  [1;37mScenario:[0m Auto-orbit ship before jettisoning when docked                                   [1;30m# features/application/jettison_cargo.feature:45[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at "X1-A1" with cargo:[0m                         [1;30m# jettison_cargo_steps.go:323 -> *jettisonCargoContext[0m
      | [36msymbol[0m   | [36munits[0m |
      | [36mIRON_ORE[0m | [36m50[0m    |
    [32mWhen[0m [32mI execute JettisonCargoCommand for ship "SHIP-1" jettisoning 30 units of "IRON_ORE"[0m [1;30m# jettison_cargo_steps.go:324 -> *jettisonCargoContext[0m
    [32mThen[0m [32mthe jettison command should succeed[0m                                                 [1;30m# jettison_cargo_steps.go:325 -> *jettisonCargoContext[0m
    [32mAnd[0m [32m30 units should have been jettisoned[0m                                                 [1;30m# jettison_cargo_steps.go:326 -> *jettisonCargoContext[0m
    [32mAnd[0m [32mthe ship should have 20 units of "IRON_ORE" remaining[0m                                [1;30m# jettison_cargo_steps.go:327 -> *jettisonCargoContext[0m

[1;37mFeature:[0m Navigate Ship Handler - Business Rules Testing
  As a SpaceTraders bot
  I want to execute navigation commands with proper business rules
  So that ships navigate safely with optimal refueling and state management

  [1;37mScenario:[0m Load graph from database cache when available               [1;30m# features/application/navigate_ship_handler.feature:11[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                          [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m           [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has a cached graph with 10 waypoints[0m            [1;30m# navigate_ship_handler_steps.go:650 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" has trait "MARKETPLACE" in waypoints table[0m [1;30m# navigate_ship_handler_steps.go:664 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" has no fuel station trait[0m                  [1;30m# navigate_ship_handler_steps.go:665 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1" with 100 fuel[0m                  [1;30m# navigate_ship_handler_steps.go:675 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:51 Cache hit for X1-GZ7
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database cache
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database
2025/11/15 16:02:51 [NAVIGATE] Ship SCOUT-1 at X1-GZ7-A1, destination X1-GZ7-B1
2025/11/15 16:02:51 [NAVIGATE] Planning route from X1-GZ7-A1 to X1-GZ7-B1
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-GZ7-B1, Mode=CRUISE, Fuel=10, Time=60
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-GZ7-A1 → X1-GZ7-B1 (fuel=10, refuel=false)
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] Executing segment 0: X1-GZ7-A1 → X1-GZ7-B1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=completed, ArrivalTimeStr=''
2025/11/15 16:02:51 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=completed
2025/11/15 16:02:51 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:51 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                            [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [32mThen[0m [32mthe graph should be loaded from database cache[0m                 [1;30m# navigate_ship_handler_steps.go:687 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mwaypoints should be enriched with has_fuel trait data[0m           [1;30m# navigate_ship_handler_steps.go:688 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mnavigation should succeed[0m                                       [1;30m# navigate_ship_handler_steps.go:689 -> *navigateShipHandlerContext[0m

  [1;37mScenario:[0m Build graph from API when cache is empty          [1;30m# features/application/navigate_ship_handler.feature:24[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-NEW" has no cached graph[0m                   [1;30m# navigate_ship_handler_steps.go:651 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mthe API will return 5 waypoints for system "X1-NEW"[0m   [1;30m# navigate_ship_handler_steps.go:652 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.084ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-NEW-A1" AND system_symbol = "X1-NEW" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-NEW-A1"[0m                      [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/system_graph_repository.go:32 [35;1mrecord not found
[0m[33m[0.022ms] [34;1m[rows:0][0m SELECT * FROM `system_graphs` WHERE system_symbol = "X1-NEW" ORDER BY `system_graphs`.`system_symbol` LIMIT 1
2025/11/15 16:02:51 Cache miss for X1-NEW
2025/11/15 16:02:51 Building navigation graph for X1-NEW from API
2025/11/15 16:02:51 Saved graph for X1-NEW to database
2025/11/15 16:02:51 Graph for X1-NEW cached in database
2025/11/15 16:02:51 Loaded graph for X1-NEW from api
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-NEW-B1"[0m                  [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [32mThen[0m [32mthe API should be called to list waypoints[0m           [1;30m# navigate_ship_handler_steps.go:690 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mthe graph should be saved to system_graphs table[0m      [1;30m# navigate_ship_handler_steps.go:691 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mwaypoints should be saved to waypoints table[0m          [1;30m# navigate_ship_handler_steps.go:692 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mthe graph should be enriched with trait data[0m          [1;30m# navigate_ship_handler_steps.go:693 -> *navigateShipHandlerContext[0m
    [31mAnd[0m [31mnavigation should succeed[0m                             [1;30m# navigate_ship_handler_steps.go:689 -> *navigateShipHandlerContext[0m
    [1;31mexpected success but got error: Waypoint X1-NEW-B1 not found in cache for system X1-NEW. Destination waypoint is missing from waypoint cache. Please sync waypoints from API.[0m

  [1;37mScenario:[0m Merge graph structure with waypoint trait data              [1;30m# features/application/navigate_ship_handler.feature:38[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                          [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m           [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has cached graph structure only[0m                 [1;30m# navigate_ship_handler_steps.go:653 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.065ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-GZ7-A1" AND system_symbol = "X1-GZ7" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" has trait "MARKETPLACE" in waypoints table[0m [1;30m# navigate_ship_handler_steps.go:664 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" has no traits in waypoints table[0m           [1;30m# navigate_ship_handler_steps.go:666 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1" with 100 fuel[0m                  [1;30m# navigate_ship_handler_steps.go:675 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:51 Cache hit for X1-GZ7
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database cache
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database
2025/11/15 16:02:51 [NAVIGATE] Ship SCOUT-1 at X1-GZ7-A1, destination X1-GZ7-B1
2025/11/15 16:02:51 [NAVIGATE] Planning route from X1-GZ7-A1 to X1-GZ7-B1
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-GZ7-B1, Mode=CRUISE, Fuel=10, Time=60
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-GZ7-A1 → X1-GZ7-B1 (fuel=10, refuel=false)
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] Executing segment 0: X1-GZ7-A1 → X1-GZ7-B1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=completed, ArrivalTimeStr=''
2025/11/15 16:02:51 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=completed
2025/11/15 16:02:51 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:51 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                            [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [32mThen[0m [32mwaypoint "X1-GZ7-A1" should be enriched with has_fuel true[0m     [1;30m# navigate_ship_handler_steps.go:694 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func4[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" should be enriched with has_fuel false[0m     [1;30m# navigate_ship_handler_steps.go:694 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func4[0m

  [1;37mScenario:[0m Reject navigation with empty waypoint cache                 [1;30m# features/application/navigate_ship_handler.feature:54[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                          [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m           [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has zero waypoints in cache[0m                     [1;30m# navigate_ship_handler_steps.go:654 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.057ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-GZ7-A1" AND system_symbol = "X1-GZ7" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1"[0m                                [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:51 Cache hit for X1-GZ7
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database cache
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                            [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [31mThen[0m [31mthe command should fail with error "waypoint cache is empty"[0m   [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m
    [1;31mexpected error containing 'waypoint cache is empty' but command succeeded[0m
    [36mAnd[0m [36mthe error should mention "Please sync waypoints from API first"[0m [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Reject navigation when ship location missing from cache                        [1;30m# features/application/navigate_ship_handler.feature:64[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                                             [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m                              [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has 5 waypoints cached[0m                                             [1;30m# navigate_ship_handler_steps.go:655 -> *navigateShipHandlerContext[0m
    [32mBut[0m [32mwaypoint "X1-GZ7-A1" is NOT in the cache[0m                                           [1;30m# navigate_ship_handler_steps.go:667 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" reports location "X1-GZ7-A1"[0m                                        [1;30m# navigate_ship_handler_steps.go:677 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:51 Cache hit for X1-GZ7
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database cache
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database
2025/11/15 16:02:51 [NAVIGATE] Ship SCOUT-1 at X1-GZ7-A1, destination X1-GZ7-B1
2025/11/15 16:02:51 [NAVIGATE] Planning route from X1-GZ7-A1 to X1-GZ7-B1
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-GZ7-B1, Mode=CRUISE, Fuel=10, Time=60
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-GZ7-A1 → X1-GZ7-B1 (fuel=10, refuel=false)
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] Executing segment 0: X1-GZ7-A1 → X1-GZ7-B1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=completed, ArrivalTimeStr=''
2025/11/15 16:02:51 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=completed
2025/11/15 16:02:51 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:51 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:51 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:51 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                                               [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [31mThen[0m [31mthe command should fail with error "Ship location is missing from waypoint cache"[0m [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m
    [1;31mexpected error containing 'Ship location is missing from waypoint cache' but command succeeded[0m

  [1;37mScenario:[0m Reject navigation when destination missing from cache                                 [1;30m# features/application/navigate_ship_handler.feature:74[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                                                    [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m                                     [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoint "X1-GZ7-A1" cached[0m                                           [1;30m# navigate_ship_handler_steps.go:656 -> *navigateShipHandlerContext[0m
    [32mBut[0m [32mwaypoint "X1-GZ7-B1" is NOT cached[0m                                                        [1;30m# navigate_ship_handler_steps.go:668 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1"[0m                                                          [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.040ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-GZ7-A1" AND system_symbol = "X1-GZ7" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                                                      [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [31mThen[0m [31mthe command should fail with error "Destination waypoint is missing from waypoint cache"[0m [1;30m# fulfill_contract_steps.go:294 -> *fulfillContractContext[0m
    [1;31mexpected error containing 'Destination waypoint is missing from waypoint cache' but command succeeded[0m

  [1;37mScenario:[0m Route not found - provide detailed statistics                        [1;30m# features/application/navigate_ship_handler.feature:84[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                                   [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m                    [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has 20 waypoints with 3 fuel stations[0m                    [1;30m# navigate_ship_handler_steps.go:657 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1" with 50 fuel out of 100 capacity[0m        [1;30m# navigate_ship_handler_steps.go:678 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mdestination "X1-GZ7-UNREACHABLE" exists but routing engine finds no path[0m [1;30m# navigate_ship_handler_steps.go:681 -> *navigateShipHandlerContext[0m

2025/11/15 16:02:51 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.039ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-GZ7-A1" AND system_symbol = "X1-GZ7" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-UNREACHABLE"[0m                            [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [31mThen[0m [31mthe error should include "No route found"[0m                               [1;30m# navigate_ship_handler_steps.go:702 -> *navigateShipHandlerContext[0m
    [1;31mexpected error to mention 'No route found' but got 'failed to get ship: failed to convert ship data: failed to get location waypoint: waypoint not found: X1-GZ7-A1'[0m
    [36mAnd[0m [36mthe error should mention "20 waypoints cached"[0m                           [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [36mAnd[0m [36mthe error should mention "3 fuel stations"[0m                               [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [36mAnd[0m [36mthe error should mention "Ship fuel: 50/100"[0m                             [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [36mAnd[0m [36mthe error should mention "unreachable or require multi-hop refueling"[0m    [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Ship already at destination - return success immediately [1;30m# features/application/navigate_ship_handler.feature:102[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                       [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m        [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                         [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1"[0m                             [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:51 Cache hit for X1-GZ7
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database cache
2025/11/15 16:02:51 Loaded graph for X1-GZ7 from database
2025/11/15 16:02:51 [NAVIGATE] Ship SCOUT-1 at X1-GZ7-A1, destination X1-GZ7-A1
2025/11/15 16:02:51 [NAVIGATE] Ship already at destination, returning early
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-GZ7-A1"[0m                         [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [32mThen[0m [32mthe response status should be "already_at_destination"[0m      [1;30m# navigate_ship_handler_steps.go:705 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mno navigate API calls should be made[0m                         [1;30m# navigate_ship_handler_steps.go:706 -> *navigateShipHandlerContext[0m
    [31mAnd[0m [31mthe route should have 0 segments[0m                             [1;30m# route_steps.go:752 -> *routeContext[0m
    [1;31mruntime error: invalid memory address or nil pointer dereference
runtime.gopanic
	/usr/local/go1.24.7/src/runtime/panic.go:792
runtime.panicmem
	/usr/local/go1.24.7/src/runtime/panic.go:262
runtime.sigpanic
	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
github.com/andrescamacho/spacetraders-go/internal/domain/navigation.(*Route).Segments
	/home/user/spacetraders/gobot/internal/domain/navigation/route.go:148
github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*routeContext).theRouteShouldHaveSegments
	/home/user/spacetraders/gobot/test/bdd/steps/route_steps.go:195
reflect.Value.call
	/usr/local/go1.24.7/src/reflect/value.go:584
reflect.Value.Call
	/usr/local/go1.24.7/src/reflect/value.go:368
github.com/cucumber/godog/internal/models.(*StepDefinition).Run
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
github.com/cucumber/godog.(*suite).runStep
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
github.com/cucumber/godog.(*suite).runSteps
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
github.com/cucumber/godog.(*suite).runPickle.func1
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
testing.tRunner
	/usr/local/go1.24.7/src/testing/testing.go:1792
runtime.goexit
	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700[0m
    [36mAnd[0m [36mthe route status should be "COMPLETED"[0m                       [1;30m# navigate_ship_handler_steps.go:708 -> *navigateShipHandlerContext[0m
    [36mAnd[0m [36mcurrent location should be "X1-GZ7-A1"[0m                       [1;30m# navigate_ship_handler_steps.go:709 -> *navigateShipHandlerContext[0m

  [1;37mScenario:[0m Wait for previous command completion before starting new navigation [1;30m# features/application/navigate_ship_handler.feature:115[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                                  [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m                   [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                                    [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" is IN_TRANSIT to "X1-GZ7-B1" arriving in 30 seconds[0m
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-C1"[0m                                    [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33mthe handler should detect IN_TRANSIT state[0m
    [33mAnd[0m [33mthe handler should wait for arrival[0m
    [33mAnd[0m [33mship state should be re-synced after arrival[0m
    [33mAnd[0m [33mthen navigation to "X1-GZ7-C1" should begin[0m

  [1;37mScenario:[0m Opportunistically refuel when arriving at fuel station with less than 90% fuel [1;30m# features/application/navigate_ship_handler.feature:131[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                                             [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m                              [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                                               [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" is a fuel station[0m                                             [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" has 100 fuel capacity[0m
    [33mAnd[0m [33mship "SCOUT-1" starts at "X1-GZ7-A1" with 100 fuel[0m
    [33mAnd[0m [33mnavigation to "X1-GZ7-B1" consumes 50 fuel[0m
    [33mAnd[0m [33mthe routing engine plans direct route without planned refuel[0m
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                                               [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33mship should arrive at "X1-GZ7-B1" with 50% fuel[0m
    [33mAnd[0m [33mopportunistic refuel should trigger[0m
    [33mAnd[0m [33mship should dock at "X1-GZ7-B1"[0m
    [33mAnd[0m [33mship should refuel to 100/100[0m
    [33mAnd[0m [33mship should orbit after refuel[0m

  [1;37mScenario:[0m Skip opportunistic refuel when fuel is at or above 90% [1;30m# features/application/navigate_ship_handler.feature:148[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                     [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m      [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                       [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" is a fuel station[0m                     [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" has 100 fuel capacity[0m
    [33mAnd[0m [33mship arrives at fuel station "X1-GZ7-B1" with 95 fuel[0m
    [33mWhen[0m [33mthe navigation segment completes[0m
    [33mThen[0m [33mopportunistic refuel should NOT trigger[0m
    [33mAnd[0m [33mship should remain in orbit[0m

  [1;37mScenario:[0m Skip opportunistic refuel at non-fuel-station     [1;30m# features/application/navigate_ship_handler.feature:160[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                  [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-C1" has no fuel station[0m              [1;30m# navigate_ship_handler_steps.go:672 -> *navigateShipHandlerContext[0m
    [33mAnd[0m [33mship "SCOUT-1" arrives at "X1-GZ7-C1" with 30% fuel[0m
    [33mWhen[0m [33mthe navigation segment completes[0m
    [33mThen[0m [33mopportunistic refuel should NOT trigger[0m

  [1;37mScenario:[0m Skip opportunistic refuel when segment already requires refuel [1;30m# features/application/navigate_ship_handler.feature:170[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                             [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m              [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                               [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" is a fuel station[0m                             [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" arrives at fuel station "X1-GZ7-B1" with 50% fuel[0m
    [33mAnd[0m [33mthe segment has requires_refuel set to true[0m
    [33mWhen[0m [33mthe navigation segment completes[0m
    [33mThen[0m [33mopportunistic refuel should NOT trigger[0m
    [33mAnd[0m [33monly the planned refuel should execute[0m

  [1;37mScenario:[0m Refuel before departure when DRIFT mode planned at fuel station [1;30m# features/application/navigate_ship_handler.feature:186[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                              [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m               [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                                [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" is a fuel station[0m                              [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is at fuel station "X1-GZ7-A1" with 50% fuel[0m
    [33mAnd[0m [33mrouting engine plans DRIFT mode for next segment[0m
    [33mAnd[0m [33mcurrent location has fuel available[0m
    [33mWhen[0m [33mnavigation begins for the segment[0m
    [33mThen[0m [33mpre-departure refuel should trigger[0m
    [33mAnd[0m [33mship should refuel before departing[0m
    [33mAnd[0m [33mlog should mention "Preventing DRIFT mode"[0m

  [1;37mScenario:[0m Skip pre-departure refuel when using CRUISE mode        [1;30m# features/application/navigate_ship_handler.feature:200[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                      [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m       [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                        [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" is a fuel station[0m                      [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is at fuel station "X1-GZ7-A1" with 50% fuel[0m
    [33mAnd[0m [33mrouting engine plans CRUISE mode for next segment[0m
    [33mWhen[0m [33mnavigation begins for the segment[0m
    [33mThen[0m [33mpre-departure refuel should NOT trigger[0m

  [1;37mScenario:[0m Skip pre-departure refuel when fuel is at or above 90%  [1;30m# features/application/navigate_ship_handler.feature:211[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                      [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m       [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                        [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" is a fuel station[0m                      [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is at fuel station "X1-GZ7-A1" with 95% fuel[0m
    [33mAnd[0m [33mrouting engine plans DRIFT mode for next segment[0m
    [33mWhen[0m [33mnavigation begins for the segment[0m
    [33mThen[0m [33mpre-departure refuel should NOT trigger[0m

  [1;37mScenario:[0m Skip pre-departure refuel when not at fuel station [1;30m# features/application/navigate_ship_handler.feature:222[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                 [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m  [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                   [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" has no fuel station[0m               [1;30m# navigate_ship_handler_steps.go:672 -> *navigateShipHandlerContext[0m
    [33mAnd[0m [33mship "SCOUT-1" is at "X1-GZ7-A1" with 50% fuel[0m
    [33mAnd[0m [33mrouting engine plans DRIFT mode for next segment[0m
    [33mWhen[0m [33mnavigation begins for the segment[0m
    [33mThen[0m [33mpre-departure refuel should NOT trigger[0m

  [1;37mScenario:[0m Refuel at start location when route requires it         [1;30m# features/application/navigate_ship_handler.feature:237[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                      [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m       [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                        [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" is a fuel station[0m                      [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is at fuel station "X1-GZ7-A1" with low fuel[0m
    [33mAnd[0m [33mroute has refuel_before_departure set to true[0m
    [33mWhen[0m [33mroute execution begins[0m
    [33mThen[0m [33mship should dock at "X1-GZ7-A1"[0m
    [33mAnd[0m [33mship should refuel to full capacity[0m
    [33mAnd[0m [33mship should orbit after refuel[0m
    [33mAnd[0m [33mthen first segment should execute[0m

  [1;37mScenario:[0m Set flight mode before each navigation segment              [1;30m# features/application/navigate_ship_handler.feature:255[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                          [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m           [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                            [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-GZ7-A1" with 100 fuel[0m                  [1;30m# navigate_ship_handler_steps.go:675 -> *navigateShipHandlerContext[0m
    [33mAnd[0m [33mrouting engine plans BURN mode for segment 1[0m
    [33mAnd[0m [33mrouting engine plans CRUISE mode for segment 2[0m
    [33mWhen[0m [33msegment 1 executes[0m
    [33mThen[0m [33mflight mode should be set to "BURN" before navigate API call[0m
    [33mWhen[0m [33msegment 2 executes[0m
    [33mThen[0m [33mflight mode should be set to "CRUISE" before navigate API call[0m

  [1;37mScenario:[0m Wait for ship to arrive after navigation                [1;30m# features/application/navigate_ship_handler.feature:272[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                      [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m       [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                        [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" navigates from "X1-GZ7-A1" to "X1-GZ7-B1"[0m
    [33mAnd[0m [33mAPI returns segment travel time of 45 seconds[0m
    [33mAnd[0m [33mcurrent time is "2025-11-12T12:00:00Z"[0m
    [33mWhen[0m [33mnavigation API is called[0m
    [33mThen[0m [33mthe handler should calculate 45 seconds wait time[0m
    [33mAnd[0m [33mthe handler should sleep for 48 seconds[0m
    [33mAnd[0m [33mship state should be re-fetched after sleep[0m
    [33mAnd[0m [33mship Arrive method should be called if status is IN_TRANSIT[0m

  [1;37mScenario:[0m Handle arrival time in the past - ship already arrived [1;30m# features/application/navigate_ship_handler.feature:286[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                     [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m      [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                       [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" navigates to destination[0m
    [33mAnd[0m [33mAPI returns travel time in the past[0m
    [33mWhen[0m [33mnavigation executes[0m
    [33mThen[0m [33mwait time should be 0 seconds[0m
    [33mAnd[0m [33mno sleep should occur[0m
    [33mAnd[0m [33mship state should still be re-fetched[0m

  [1;37mScenario:[0m Re-sync ship state after every API call                     [1;30m# features/application/navigate_ship_handler.feature:302[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                          [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m           [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                            [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" executes a route with dock refuel orbit navigate[0m
    [33mWhen[0m [33mdock API is called[0m
    [33mThen[0m [33mship state should be re-fetched immediately[0m
    [33mWhen[0m [33mrefuel API is called[0m
    [33mThen[0m [33mship state should be re-fetched immediately[0m
    [33mWhen[0m [33morbit API is called[0m
    [33mThen[0m [33mship state should be re-fetched immediately[0m
    [33mWhen[0m [33mnavigate API is called[0m
    [33mThen[0m [33mship state should be re-fetched immediately[0m

  [1;37mScenario:[0m Mark route as failed when navigation fails             [1;30m# features/application/navigate_ship_handler.feature:321[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                     [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m      [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                       [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" starts navigation to "X1-GZ7-B1"[0m
    [33mBut[0m [33mnavigate API returns error "Insufficient fuel"[0m
    [33mWhen[0m [33mthe error occurs during execution[0m
    [36mThen[0m [36mroute status should be set to FAILED[0m                      [1;30m# navigate_ship_handler_steps.go:712 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func5[0m
    [33mAnd[0m [33mroute FailRoute method should be called with error message[0m
    [33mAnd[0m [33mthe error should propagate to caller[0m

  [1;37mScenario:[0m Handle dock failure during refuel sequence        [1;30m# features/application/navigate_ship_handler.feature:333[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                  [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" attempts to refuel at "X1-GZ7-B1"[0m
    [33mBut[0m [33mdock API returns error "Ship is already docked"[0m
    [33mWhen[0m [33mthe error occurs[0m
    [33mThen[0m [33mthe error should be returned to handler[0m
    [36mAnd[0m [36mroute should be marked as FAILED[0m                      [1;30m# navigate_ship_handler_steps.go:715 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func6[0m

  [1;37mScenario:[0m Execute multi-segment route with planned refueling [1;30m# features/application/navigate_ship_handler.feature:348[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                 [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m  [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                   [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" has 50 fuel capacity[0m
    [33mAnd[0m [33mship "SCOUT-1" starts at "X1-GZ7-A1" with 50 fuel[0m
    [33mAnd[0m [33mrouting engine plans route with segments:[0m
      | [36mFrom[0m      | [36mTo[0m        | [36mFuel Cost[0m | [36mRequires Refuel[0m |
      | [36mX1-GZ7-A1[0m | [36mX1-GZ7-B1[0m | [36m30[0m        | [36mfalse[0m           |
      | [36mX1-GZ7-B1[0m | [36mX1-GZ7-C1[0m | [36m40[0m        | [36mtrue[0m            |
      | [36mX1-GZ7-C1[0m | [36mX1-GZ7-D1[0m | [36m35[0m        | [36mfalse[0m           |
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-D1"[0m                   [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33msegment 1 should execute from A1 to B1[0m
    [33mAnd[0m [33mship should have 20 fuel remaining at B1[0m
    [33mAnd[0m [33msegment 2 should execute from B1 to C1[0m
    [33mAnd[0m [33mship should refuel at C1 because of planned refuel[0m
    [33mAnd[0m [33mship should have 50 fuel after refuel at C1[0m
    [33mAnd[0m [33msegment 3 should execute from C1 to D1[0m
    [33mAnd[0m [33mship should arrive at D1[0m
    [33mAnd[0m [33mroute status should be COMPLETED[0m

  [1;37mScenario:[0m Execute route with opportunistic and planned refueling [1;30m# features/application/navigate_ship_handler.feature:370[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                     [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m      [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                       [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" has 100 fuel capacity[0m
    [33mAnd[0m [33mship "SCOUT-1" starts at "X1-GZ7-A1" with 100 fuel[0m
    [33mAnd[0m [33mrouting engine plans route with segments:[0m
      | [36mFrom[0m      | [36mTo[0m        | [36mFuel Cost[0m | [36mRequires Refuel[0m | [36mWaypoint Has Fuel[0m |
      | [36mX1-GZ7-A1[0m | [36mX1-GZ7-B1[0m | [36m60[0m        | [36mfalse[0m           | [36mtrue[0m              |
      | [36mX1-GZ7-B1[0m | [36mX1-GZ7-C1[0m | [36m30[0m        | [36mfalse[0m           | [36mfalse[0m             |
      | [36mX1-GZ7-C1[0m | [36mX1-GZ7-D1[0m | [36m45[0m        | [36mtrue[0m            | [36mtrue[0m              |
      | [36mX1-GZ7-D1[0m | [36mX1-GZ7-E1[0m | [36m35[0m        | [36mfalse[0m           | [36mfalse[0m             |
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-E1"[0m                       [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33msegment 1 should execute to B1[0m
    [33mAnd[0m [33mship should have 40% fuel at B1[0m
    [33mAnd[0m [33mopportunistic refuel should trigger at B1[0m
    [33mAnd[0m [33msegment 2 should execute to C1[0m
    [33mAnd[0m [33mno refuel at C1 because no fuel station[0m
    [33mAnd[0m [33msegment 3 should execute to D1[0m
    [33mAnd[0m [33mplanned refuel should execute at D1[0m
    [33mAnd[0m [33msegment 4 should execute to E1[0m
    [33mAnd[0m [33mroute status should be COMPLETED[0m

  [1;37mScenario:[0m Ship transitions through states during navigation [1;30m# features/application/navigate_ship_handler.feature:398[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                  [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" is DOCKED at "X1-GZ7-A1"[0m
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                  [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33mship should be IN_ORBIT before navigation[0m
    [33mAnd[0m [33mship should be IN_TRANSIT after navigate API call[0m
    [33mAnd[0m [33mship should be IN_ORBIT after arrival[0m
    [33mAnd[0m [33mfinal status should be IN_ORBIT at "X1-GZ7-B1"[0m

  [1;37mScenario:[0m Refuel sequence follows dock orbit pattern          [1;30m# features/application/navigate_ship_handler.feature:410[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                  [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m   [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                    [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-B1" is a fuel station[0m                  [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is IN_ORBIT at "X1-GZ7-B1" with low fuel[0m
    [33mAnd[0m [33mroute requires refuel at "X1-GZ7-B1"[0m
    [33mWhen[0m [33mrefuel sequence executes[0m
    [33mThen[0m [33mship should transition to DOCKED[0m
    [33mAnd[0m [33mrefuel API should be called[0m
    [33mAnd[0m [33mship should transition back to IN_ORBIT[0m
    [33mAnd[0m [33mfuel should be at 100%[0m

  [1;37mScenario:[0m Ship with zero fuel capacity navigates without refueling [1;30m# features/application/navigate_ship_handler.feature:428[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                       [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m        [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                         [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "PROBE-1" has 0 fuel capacity[0m
    [36mAnd[0m [36mship "PROBE-1" is at "X1-GZ7-A1"[0m                             [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m
    [36mWhen[0m [36mI navigate "PROBE-1" to "X1-GZ7-B1"[0m                         [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [36mThen[0m [36mnavigation should succeed[0m                                   [1;30m# navigate_ship_handler_steps.go:689 -> *navigateShipHandlerContext[0m
    [33mAnd[0m [33mno refuel checks should execute[0m
    [33mAnd[0m [33mno fuel consumption should occur[0m

  [1;37mScenario:[0m Single waypoint system - already at destination     [1;30m# features/application/navigate_ship_handler.feature:440[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                  [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m   [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-SOLO" has only 1 waypoint cached[0m             [1;30m# navigate_ship_handler_steps.go:661 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32mship "SCOUT-1" is at "X1-SOLO-A1"[0m                       [1;30m# navigate_ship_handler_steps.go:676 -> *navigateShipHandlerContext[0m
2025/11/15 16:02:52 Cache hit for X1-SOLO
2025/11/15 16:02:52 Loaded graph for X1-SOLO from database cache
2025/11/15 16:02:52 Loaded graph for X1-SOLO from database
2025/11/15 16:02:52 [NAVIGATE] Ship SCOUT-1 at X1-SOLO-A1, destination X1-SOLO-A1
2025/11/15 16:02:52 [NAVIGATE] Ship already at destination, returning early
    [32mWhen[0m [32mI navigate "SCOUT-1" to "X1-SOLO-A1"[0m                   [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [32mThen[0m [32mthe response status should be "already_at_destination"[0m [1;30m# navigate_ship_handler_steps.go:705 -> *navigateShipHandlerContext[0m
    [33mAnd[0m [33mroute should have 0 segments[0m
    [33mAnd[0m [33mno API calls should be made[0m

  [1;37mScenario:[0m Route with only refuel before departure                    [1;30m# features/application/navigate_ship_handler.feature:451[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                         [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m          [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                           [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" is a fuel station[0m                         [1;30m# navigate_ship_handler_steps.go:669 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func3[0m
    [33mAnd[0m [33mship "SCOUT-1" is at "X1-GZ7-A1" with 10% fuel[0m
    [33mAnd[0m [33mrouting engine returns route with refuel_before_departure true[0m
    [33mAnd[0m [33mroute has 1 segment from A1 to B1[0m
    [36mWhen[0m [36mI navigate "SCOUT-1" to "X1-GZ7-B1"[0m                           [1;30m# navigate_ship_handler_steps.go:684 -> *navigateShipHandlerContext[0m
    [33mThen[0m [33mship should refuel before starting journey[0m
    [33mAnd[0m [33mship should have 100% fuel before departure[0m
    [33mAnd[0m [33mthen segment to B1 should execute[0m

  [1;37mScenario:[0m Calculate correct wait time with 3 second buffer          [1;30m# features/application/navigate_ship_handler.feature:469[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                        [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m         [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                          [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" navigates with segment travel time 120 seconds[0m
    [33mWhen[0m [33mnavigation API completes[0m
    [33mThen[0m [33mhandler should calculate wait time as 120 seconds[0m
    [33mAnd[0m [33mhandler should add 3 second buffer[0m
    [33mAnd[0m [33mtotal sleep time should be 123 seconds[0m

  [1;37mScenario:[0m Zero wait time for instant arrival                      [1;30m# features/application/navigate_ship_handler.feature:480[0m
    [32mGiven[0m [32man in-memory database is initialized[0m                      [1;30m# navigate_ship_handler_steps.go:646 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32ma player "TEST-PLAYER" exists with token "test-token"[0m       [1;30m# navigate_ship_handler_steps.go:647 -> *navigateShipHandlerContext[0m
    [32mAnd[0m [32msystem "X1-GZ7" has waypoints cached[0m                        [1;30m# navigate_ship_handler_steps.go:658 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeNavigateShipHandlerScenario.func2[0m
    [33mAnd[0m [33mship "SCOUT-1" navigates with segment travel time 0 seconds[0m
    [33mWhen[0m [33mnavigation API completes[0m
    [33mThen[0m [33mhandler should calculate wait time as 0 seconds[0m
    [33mAnd[0m [33mno sleep should occur[0m
    [33mAnd[0m [33mship state should still be re-synced[0m

[1;37mFeature:[0m Navigate to Waypoint Command
  As a SpaceTraders bot
  I want to navigate ships to waypoints
  So that I can move ships around the system

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.071ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mBackground:[0m
    [32mGiven[0m [32ma navigation test player 1 exists with agent "TEST-AGENT" and token "test-token-123"[0m [1;30m# navigate_to_waypoint_steps.go:413 -> *navigateToWaypointContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.065ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.034ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Successfully navigate ship from orbit                                              [1;30m# features/application/navigate_to_waypoint.feature:9[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.080ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32ma waypoint "X1-B2" exists at coordinates (100, 50)[0m                                     [1;30m# navigate_to_waypoint_steps.go:417 -> *navigateToWaypointContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.062ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "X1-B2" for player 1[0m         [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should succeed with status "navigating"[0m                                [1;30m# navigate_to_waypoint_steps.go:425 -> *navigateToWaypointContext[0m
    [32mAnd[0m [32mthe ship should be in transit to "X1-B2"[0m                                               [1;30m# navigate_to_waypoint_steps.go:426 -> *navigateToWaypointContext[0m
    [31mAnd[0m [31mthe response should include arrival time[0m                                               [1;30m# navigate_to_waypoint_steps.go:427 -> *navigateToWaypointContext[0m
    [1;31mexpected arrival time in response[0m
    [36mAnd[0m [36mthe response should include fuel consumed[0m                                              [1;30m# navigate_to_waypoint_steps.go:428 -> *navigateToWaypointContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.072ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.056ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.033ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Navigate ship that is docked (auto-orbits first)                                   [1;30m# features/application/navigate_to_waypoint.feature:18[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m                         [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.044ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32ma waypoint "X1-B2" exists at coordinates (100, 50)[0m                                     [1;30m# navigate_to_waypoint_steps.go:417 -> *navigateToWaypointContext[0m

2025/11/15 16:02:52 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.057ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "X1-B2" for player 1[0m         [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [31mThen[0m [31mthe navigation should succeed with status "navigating"[0m                                [1;30m# navigate_to_waypoint_steps.go:425 -> *navigateToWaypointContext[0m
    [1;31mexpected success but got error: failed to navigate: failed to navigate ship: failed to start transit: ship must be in orbit to start transit, currently: DOCKED[0m
    [36mAnd[0m [36mthe ship should be in transit to "X1-B2"[0m                                               [1;30m# navigate_to_waypoint_steps.go:426 -> *navigateToWaypointContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.051ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.048ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.036ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Ship already at destination (idempotent)                                           [1;30m# features/application/navigate_to_waypoint.feature:25[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.058ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "X1-A1" for player 1[0m         [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should succeed with status "already_at_destination"[0m                    [1;30m# navigate_to_waypoint_steps.go:425 -> *navigateToWaypointContext[0m
    [32mAnd[0m [32mthe ship should remain at "X1-A1"[0m                                                      [1;30m# navigate_to_waypoint_steps.go:429 -> *navigateToWaypointContext[0m
    [32mAnd[0m [32mthe ship should still be in orbit[0m                                                      [1;30m# ship_operations_context.go:537 -> *shipOperationsContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.072ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.062ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.039ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Invalid destination waypoint                                                       [1;30m# features/application/navigate_to_waypoint.feature:32[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.054ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "" for player 1[0m              [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should fail with error "invalid destination waypoint"[0m                  [1;30m# navigate_to_waypoint_steps.go:431 -> *navigateToWaypointContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.067ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.058ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.039ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-START" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.027ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Ship already in transit                                                            [1;30m# features/application/navigate_to_waypoint.feature:37[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in transit to "X1-B2"[0m                                   [1;30m# ship_operations_context.go:525 -> *shipOperationsContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.055ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.018ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-C3" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "X1-C3" for player 1[0m         [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should fail with error "cannot orbit while in transit"[0m                 [1;30m# navigate_to_waypoint_steps.go:431 -> *navigateToWaypointContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.089ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mScenario:[0m Ship not found                                                                     [1;30m# features/application/navigate_to_waypoint.feature:42[0m
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "NONEXISTENT" to "X1-B2" for player 1[0m    [1;30m# navigate_to_waypoint_steps.go:421 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should fail with error "ship not found"[0m                                [1;30m# navigate_to_waypoint_steps.go:431 -> *navigateToWaypointContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.083ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.074ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.052ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Navigate with custom flight mode                                                                   [1;30m# features/application/navigate_to_waypoint.feature:46[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                                       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.073ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32ma waypoint "X1-B2" exists at coordinates (100, 50)[0m                                                     [1;30m# navigate_to_waypoint_steps.go:417 -> *navigateToWaypointContext[0m

2025/11/15 16:02:53 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.051ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mWhen[0m [32mI execute NavigateToWaypointCommand for ship "SHIP-1" to "X1-B2" with flight mode "BURN" for player 1[0m [1;30m# navigate_to_waypoint_steps.go:422 -> *navigateToWaypointContext[0m
    [32mThen[0m [32mthe navigation should succeed with status "navigating"[0m                                                [1;30m# navigate_to_waypoint_steps.go:425 -> *navigateToWaypointContext[0m
    [32mAnd[0m [32mthe ship should be in transit to "X1-B2"[0m                                                               [1;30m# navigate_to_waypoint_steps.go:426 -> *navigateToWaypointContext[0m

[1;37mFeature:[0m Navigation Utilities
  As a navigation system
  I need helper functions to extract system symbols and calculate arrival times
  So that I can process waypoint symbols and time-based navigation

  [1;37mBackground:[0m
    [32mGiven[0m [32mthe navigation utilities are available[0m                    [1;30m# navigation_utils_steps.go:140 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Extract system symbol from valid waypoint symbol        [1;30m# features/application/navigation_utils.feature:9[0m
    [32mWhen[0m [32mI extract the system symbol from waypoint "X1-ABC123-AB12"[0m [1;30m# navigation_utils_steps.go:144 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe extracted system symbol should be "X1-ABC123"[0m          [1;30m# navigation_utils_steps.go:148 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Extract system symbol from waypoint with multiple hyphens [1;30m# features/application/navigation_utils.feature:13[0m
    [32mWhen[0m [32mI extract the system symbol from waypoint "X1-GZ7-F5"[0m        [1;30m# navigation_utils_steps.go:144 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe extracted system symbol should be "X1-GZ7"[0m               [1;30m# navigation_utils_steps.go:148 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Extract system symbol from waypoint without hyphen [1;30m# features/application/navigation_utils.feature:17[0m
    [32mWhen[0m [32mI extract the system symbol from waypoint "NOSYSTEM"[0m  [1;30m# navigation_utils_steps.go:144 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe extracted system symbol should be "NOSYSTEM"[0m      [1;30m# navigation_utils_steps.go:148 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Extract system symbol from single segment waypoint [1;30m# features/application/navigation_utils.feature:21[0m
    [32mWhen[0m [32mI extract the system symbol from waypoint "X1"[0m        [1;30m# navigation_utils_steps.go:144 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe extracted system symbol should be "X1"[0m            [1;30m# navigation_utils_steps.go:148 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Calculate wait time for future arrival                   [1;30m# features/application/navigation_utils.feature:25[0m
    [32mGiven[0m [32mthe current time is "2024-01-01T12:00:00Z"[0m                 [1;30m# navigation_utils_steps.go:141 -> *navigationUtilsContext[0m
    [32mWhen[0m [32mI calculate wait time for arrival at "2024-01-01T12:05:30Z"[0m [1;30m# navigation_utils_steps.go:145 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe wait time should be 330 seconds[0m                         [1;30m# navigation_utils_steps.go:149 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Calculate wait time for past arrival returns zero        [1;30m# features/application/navigation_utils.feature:30[0m
    [32mGiven[0m [32mthe current time is "2024-01-01T12:00:00Z"[0m                 [1;30m# navigation_utils_steps.go:141 -> *navigationUtilsContext[0m
    [32mWhen[0m [32mI calculate wait time for arrival at "2024-01-01T11:50:00Z"[0m [1;30m# navigation_utils_steps.go:145 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe wait time should be 0 seconds[0m                           [1;30m# navigation_utils_steps.go:149 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Calculate wait time handles Z suffix                     [1;30m# features/application/navigation_utils.feature:35[0m
    [32mGiven[0m [32mthe current time is "2024-01-01T12:00:00Z"[0m                 [1;30m# navigation_utils_steps.go:141 -> *navigationUtilsContext[0m
    [32mWhen[0m [32mI calculate wait time for arrival at "2024-01-01T12:03:00Z"[0m [1;30m# navigation_utils_steps.go:145 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe wait time should be 180 seconds[0m                         [1;30m# navigation_utils_steps.go:149 -> *navigationUtilsContext[0m

  [1;37mScenario:[0m Calculate wait time handles +00:00 suffix                     [1;30m# features/application/navigation_utils.feature:40[0m
    [32mGiven[0m [32mthe current time is "2024-01-01T12:00:00Z"[0m                      [1;30m# navigation_utils_steps.go:141 -> *navigationUtilsContext[0m
    [32mWhen[0m [32mI calculate wait time for arrival at "2024-01-01T12:02:00+00:00"[0m [1;30m# navigation_utils_steps.go:145 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe wait time should be 120 seconds[0m                              [1;30m# navigation_utils_steps.go:149 -> *navigationUtilsContext[0m
2025/11/15 16:02:53 Warning: failed to parse arrival time invalid-time-format: parsing time "invalid-time-format" as "2006-01-02T15:04:05Z07:00": cannot parse "invalid-time-format" as "2006"

  [1;37mScenario:[0m Calculate wait time for invalid time string returns zero [1;30m# features/application/navigation_utils.feature:45[0m
    [32mWhen[0m [32mI calculate wait time for arrival at "invalid-time-format"[0m  [1;30m# navigation_utils_steps.go:145 -> *navigationUtilsContext[0m
    [32mThen[0m [32mthe wait time should be 0 seconds[0m                           [1;30m# navigation_utils_steps.go:149 -> *navigationUtilsContext[0m
    [32mAnd[0m [32ma warning should be logged about parsing failure[0m             [1;30m# navigation_utils_steps.go:150 -> *navigationUtilsContext[0m

[1;37mFeature:[0m Negotiate Contract Command
  As a SpaceTraders bot
  I want to negotiate contracts with ships
  So that I can obtain delivery missions and earn credits

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m              [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                        [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Negotiate new contract successfully                                           [1;30m# features/application/negotiate_contract.feature:10[0m
    [32mGiven[0m [32ma negotiate contract ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m [1;30m# negotiate_contract_steps.go:346 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe ship has no active contract[0m                                                   [1;30m# negotiate_contract_steps.go:348 -> *negotiateContractContext[0m
    [32mWhen[0m [32mI execute NegotiateContractCommand for ship "SHIP-1" and player 1[0m                [1;30m# negotiate_contract_steps.go:350 -> *negotiateContractContext[0m
    [32mThen[0m [32mthe negotiate contract command should succeed[0m                                    [1;30m# negotiate_contract_steps.go:351 -> *negotiateContractContext[0m
    [32mAnd[0m [32ma new contract should be negotiated[0m                                               [1;30m# negotiate_contract_steps.go:352 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe contract should belong to player 1[0m                                            [1;30m# negotiate_contract_steps.go:353 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe contract should not be accepted[0m                                               [1;30m# contract_steps.go:434 -> *contractContext[0m
    [32mAnd[0m [32mthe contract should not be fulfilled[0m                                              [1;30m# contract_steps.go:435 -> *contractContext[0m

  [1;37mScenario:[0m Resume existing contract when agent already has one (error 4511)              [1;30m# features/application/negotiate_contract.feature:20[0m
    [32mGiven[0m [32ma negotiate contract ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m [1;30m# negotiate_contract_steps.go:346 -> *negotiateContractContext[0m
    [32mAnd[0m [32magent already has an active contract "CONTRACT-1" for player 1[0m                    [1;30m# negotiate_contract_steps.go:349 -> *negotiateContractContext[0m
    [32mWhen[0m [32mI execute NegotiateContractCommand for ship "SHIP-1" and player 1[0m                [1;30m# negotiate_contract_steps.go:350 -> *negotiateContractContext[0m
    [32mThen[0m [32mthe negotiate contract command should succeed[0m                                    [1;30m# negotiate_contract_steps.go:351 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe existing contract "CONTRACT-1" should be returned[0m                             [1;30m# negotiate_contract_steps.go:356 -> *negotiateContractContext[0m
    [32mAnd[0m [32mno new contract should be negotiated[0m                                              [1;30m# negotiate_contract_steps.go:357 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Dock ship before negotiating                                                    [1;30m# features/application/negotiate_contract.feature:28[0m
    [32mGiven[0m [32ma negotiate contract ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m [1;30m# negotiate_contract_steps.go:346 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe ship has no active contract[0m                                                     [1;30m# negotiate_contract_steps.go:348 -> *negotiateContractContext[0m
    [32mWhen[0m [32mI execute NegotiateContractCommand for ship "SHIP-1" and player 1[0m                  [1;30m# negotiate_contract_steps.go:350 -> *negotiateContractContext[0m
    [32mThen[0m [32mthe negotiate contract command should succeed[0m                                      [1;30m# negotiate_contract_steps.go:351 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe ship should be docked first[0m                                                     [1;30m# negotiate_contract_steps.go:358 -> *negotiateContractContext[0m
    [32mAnd[0m [32ma new contract should be negotiated[0m                                                 [1;30m# negotiate_contract_steps.go:352 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Cannot negotiate contract for ship that does not exist              [1;30m# features/application/negotiate_contract.feature:36[0m
    [32mWhen[0m [32mI execute NegotiateContractCommand for ship "NONEXISTENT" and player 1[0m [1;30m# negotiate_contract_steps.go:350 -> *negotiateContractContext[0m
    [32mThen[0m [32mthe negotiate contract command should fail with error "ship not found"[0m [1;30m# negotiate_contract_steps.go:359 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Cannot negotiate contract with ship in transit                                    [1;30m# features/application/negotiate_contract.feature:40[0m
    [32mGiven[0m [32ma negotiate contract ship "SHIP-1" for player 1 in transit to "X1-B2"[0m               [1;30m# negotiate_contract_steps.go:347 -> *negotiateContractContext[0m
    [32mWhen[0m [32mI execute NegotiateContractCommand for ship "SHIP-1" and player 1[0m                    [1;30m# negotiate_contract_steps.go:350 -> *negotiateContractContext[0m
    [32mThen[0m [32mthe negotiate contract command should fail with error "cannot dock while in transit"[0m [1;30m# negotiate_contract_steps.go:359 -> *negotiateContractContext[0m

[1;37mFeature:[0m Orbit Ship Command
  As a SpaceTraders bot
  I want to put ships into orbit
  So that I can navigate to other waypoints

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                           [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.067ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.052ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Orbit ship when already in orbit                                 [1;30m# features/application/orbit_ship.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m     [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute OrbitShipCommand for ship "SHIP-1" and player 1[0m           [1;30m# ship_operations_context.go:535 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe orbit command should succeed with status "already_in_orbit"[0m     [1;30m# ship_operations_context.go:536 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe ship should still be in orbit[0m                                    [1;30m# ship_operations_context.go:537 -> *shipOperationsContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.083ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.057ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Orbit ship when docked                                           [1;30m# features/application/orbit_ship.feature:16[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute OrbitShipCommand for ship "SHIP-1" and player 1[0m           [1;30m# ship_operations_context.go:535 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe orbit command should succeed with status "in_orbit"[0m             [1;30m# ship_operations_context.go:536 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe ship should be in orbit at "X1-A1"[0m                               [1;30m# ship_operations_context.go:538 -> *shipOperationsContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.065ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.057ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-START" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.034ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot orbit ship when in transit                                     [1;30m# features/application/orbit_ship.feature:22[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in transit to "X1-B2"[0m                      [1;30m# ship_operations_context.go:525 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute OrbitShipCommand for ship "SHIP-1" and player 1[0m                [1;30m# ship_operations_context.go:535 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe orbit command should fail with error "cannot orbit while in transit"[0m [1;30m# ship_operations_context.go:539 -> *shipOperationsContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.099ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mScenario:[0m Cannot orbit ship that does not exist                            [1;30m# features/application/orbit_ship.feature:27[0m
    [32mWhen[0m [32mI execute OrbitShipCommand for ship "NONEXISTENT" and player 1[0m      [1;30m# ship_operations_context.go:535 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe orbit command should fail with error "ship not found"[0m           [1;30m# ship_operations_context.go:539 -> *shipOperationsContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.084ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 2 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.058ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot orbit ship belonging to different player                  [1;30m# features/application/orbit_ship.feature:31[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 2 at "X1-A1" with status "DOCKED"[0m       [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.052ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1
    [32mWhen[0m [32mI execute OrbitShipCommand for ship "SHIP-1" and player 1[0m           [1;30m# ship_operations_context.go:535 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe orbit command should fail with error "ship not found"[0m           [1;30m# ship_operations_context.go:539 -> *shipOperationsContext[0m

[1;37mFeature:[0m Purchase Cargo Command
  As a SpaceTraders bot
  I want to purchase cargo for my ships
  So that I can fulfill contracts and trade goods

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m          [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                    [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Purchase cargo successfully                                               [1;30m# features/application/purchase_cargo.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1"[0m                  [1;30m# purchase_cargo_steps.go:336 -> *purchaseCargoContext[0m
    [32mAnd[0m [32mthe ship has 50 cargo space available[0m                                         [1;30m# purchase_cargo_steps.go:338 -> *purchaseCargoContext[0m
    [32mWhen[0m [32mI execute purchase cargo command for 30 units of "IRON_ORE" on ship "SHIP-1"[0m [1;30m# purchase_cargo_steps.go:339 -> *purchaseCargoContext[0m
    [32mThen[0m [32mthe purchase cargo command should succeed[0m                                    [1;30m# purchase_cargo_steps.go:341 -> *purchaseCargoContext[0m
    [32mAnd[0m [32m30 units should be added to cargo[0m                                             [1;30m# purchase_cargo_steps.go:342 -> *purchaseCargoContext[0m
    [32mAnd[0m [32mthe total cost should be greater than 0[0m                                       [1;30m# purchase_cargo_steps.go:343 -> *purchaseCargoContext[0m

  [1;37mScenario:[0m Cannot purchase when ship not docked                                                   [1;30m# features/application/purchase_cargo.feature:18[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1"[0m                                         [1;30m# purchase_cargo_steps.go:337 -> *purchaseCargoContext[0m
    [32mWhen[0m [32mI attempt to execute purchase cargo command for 30 units of "IRON_ORE" on ship "SHIP-1"[0m   [1;30m# purchase_cargo_steps.go:340 -> *purchaseCargoContext[0m
    [32mThen[0m [32mthe purchase cargo command should fail with error "ship must be docked to purchase cargo"[0m [1;30m# purchase_cargo_steps.go:344 -> *purchaseCargoContext[0m

  [1;37mScenario:[0m Cannot purchase more than cargo space                                                       [1;30m# features/application/purchase_cargo.feature:23[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1"[0m                                    [1;30m# purchase_cargo_steps.go:336 -> *purchaseCargoContext[0m
    [32mAnd[0m [32mthe ship has 20 cargo space available[0m                                                           [1;30m# purchase_cargo_steps.go:338 -> *purchaseCargoContext[0m
    [32mWhen[0m [32mI attempt to execute purchase cargo command for 30 units of "IRON_ORE" on ship "SHIP-1"[0m        [1;30m# purchase_cargo_steps.go:340 -> *purchaseCargoContext[0m
    [32mThen[0m [32mthe purchase cargo command should fail with error "insufficient cargo space: need 30, have 20"[0m [1;30m# purchase_cargo_steps.go:344 -> *purchaseCargoContext[0m

  [1;37mScenario:[0m Ship not found                                                                             [1;30m# features/application/purchase_cargo.feature:29[0m
    [32mWhen[0m [32mI attempt to execute purchase cargo command for 30 units of "IRON_ORE" on ship "NON-EXISTENT"[0m [1;30m# purchase_cargo_steps.go:340 -> *purchaseCargoContext[0m
    [32mThen[0m [32mthe purchase cargo command should fail with error "ship not found"[0m                            [1;30m# purchase_cargo_steps.go:344 -> *purchaseCargoContext[0m

[1;37mFeature:[0m Purchase Cargo with Transaction Limit Splitting

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player with ID 1[0m                                       [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Purchase within single transaction limit               [1;30m# features/application/purchase_cargo_transaction_limits.feature:6[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m               [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 100 units of cargo space[0m                      [1;30m# transaction_limit_steps.go:449 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" sells "IRON_ORE" with transaction limit 100[0m [1;30m# transaction_limit_steps.go:451 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI purchase 50 units of "IRON_ORE" for ship "SHIP-1"[0m       [1;30m# transaction_limit_steps.go:459 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe purchase should succeed[0m                               [1;30m# transaction_limit_steps.go:463 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m                    [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m50 units should have been purchased[0m                        [1;30m# transaction_limit_steps.go:466 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Purchase exceeds market transaction limit - requires splitting [1;30m# features/application/purchase_cargo_transaction_limits.feature:15[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m                       [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 100 units of cargo space[0m                              [1;30m# transaction_limit_steps.go:449 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" sells "IRON_ORE" with transaction limit 20[0m          [1;30m# transaction_limit_steps.go:451 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI purchase 50 units of "IRON_ORE" for ship "SHIP-1"[0m               [1;30m# transaction_limit_steps.go:459 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe purchase should succeed[0m                                       [1;30m# transaction_limit_steps.go:463 -> *transactionLimitContext[0m
    [32mAnd[0m [32m3 transactions should have been executed[0m                           [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m50 units should have been purchased[0m                                [1;30m# transaction_limit_steps.go:466 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Market data unavailable - single transaction fallback [1;30m# features/application/purchase_cargo_transaction_limits.feature:24[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m              [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 100 units of cargo space[0m                     [1;30m# transaction_limit_steps.go:449 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket data is not available for "X1-A1"[0m                  [1;30m# transaction_limit_steps.go:453 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI purchase 30 units of "IRON_ORE" for ship "SHIP-1"[0m      [1;30m# transaction_limit_steps.go:459 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe purchase should succeed[0m                              [1;30m# transaction_limit_steps.go:463 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m                   [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m30 units should have been purchased[0m                       [1;30m# transaction_limit_steps.go:466 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Partial failure during multi-transaction purchase      [1;30m# features/application/purchase_cargo_transaction_limits.feature:33[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m               [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 100 units of cargo space[0m                      [1;30m# transaction_limit_steps.go:449 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" sells "IRON_ORE" with transaction limit 20[0m  [1;30m# transaction_limit_steps.go:451 -> *transactionLimitContext[0m
    [32mAnd[0m [32mAPI will fail on transaction 3 with "insufficient credits"[0m [1;30m# transaction_limit_steps.go:456 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI purchase 50 units of "IRON_ORE" for ship "SHIP-1"[0m       [1;30m# transaction_limit_steps.go:459 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe purchase should return partial success[0m                [1;30m# transaction_limit_steps.go:468 -> *transactionLimitContext[0m
    [32mAnd[0m [32m2 transactions should have been executed[0m                   [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m40 units should have been purchased[0m                        [1;30m# transaction_limit_steps.go:466 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe transaction error should mention "partial failure"[0m     [1;30m# transaction_limit_steps.go:470 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Good not available at market - use fallback limit  [1;30m# features/application/purchase_cargo_transaction_limits.feature:44[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m           [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 100 units of cargo space[0m                  [1;30m# transaction_limit_steps.go:449 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" exists but doesn't sell "RARE_METAL"[0m    [1;30m# transaction_limit_steps.go:454 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI purchase 30 units of "RARE_METAL" for ship "SHIP-1"[0m [1;30m# transaction_limit_steps.go:459 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe purchase should succeed[0m                           [1;30m# transaction_limit_steps.go:463 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m                [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m

[1;37mFeature:[0m Refuel Ship Command
  As a SpaceTraders bot
  I want to refuel ships at fuel stations
  So that I can prepare for journeys and continue operations

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m                        [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                                  [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.056ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.046ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Refuel ship to full capacity at fuel station                                            [1;30m# features/application/refuel_ship.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at fuel station "X1-A1" with status "DOCKED" and fuel 50/100[0m [1;30m# refuel_ship_steps.go:394 -> *refuelShipContext[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "SHIP-1" and player 1 with nil units[0m                  [1;30m# refuel_ship_steps.go:396 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should succeed[0m                                                          [1;30m# refuel_ship_steps.go:398 -> *refuelShipContext[0m
    [32mAnd[0m [32mthe ship should have fuel 100/100[0m                                                           [1;30m# refuel_ship_steps.go:399 -> *refuelShipContext[0m
    [32mAnd[0m [32m50 units of fuel should have been added[0m                                                     [1;30m# refuel_ship_steps.go:400 -> *refuelShipContext[0m

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.083ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:54 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.051ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Refuel ship with specific units at fuel station                                         [1;30m# features/application/refuel_ship.feature:17[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at fuel station "X1-A1" with status "DOCKED" and fuel 30/100[0m [1;30m# refuel_ship_steps.go:394 -> *refuelShipContext[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "SHIP-1" and player 1 with 20 units[0m                   [1;30m# refuel_ship_steps.go:397 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should succeed[0m                                                          [1;30m# refuel_ship_steps.go:398 -> *refuelShipContext[0m
    [32mAnd[0m [32mthe ship should have fuel 50/100[0m                                                            [1;30m# refuel_ship_steps.go:399 -> *refuelShipContext[0m
    [32mAnd[0m [32m20 units of fuel should have been added[0m                                                     [1;30m# refuel_ship_steps.go:400 -> *refuelShipContext[0m

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.069ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.049ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Refuel ship that already has full fuel (idempotent)                                      [1;30m# features/application/refuel_ship.feature:24[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at fuel station "X1-A1" with status "DOCKED" and fuel 100/100[0m [1;30m# refuel_ship_steps.go:394 -> *refuelShipContext[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "SHIP-1" and player 1 with nil units[0m                   [1;30m# refuel_ship_steps.go:396 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should succeed[0m                                                           [1;30m# refuel_ship_steps.go:398 -> *refuelShipContext[0m
    [32mAnd[0m [32mthe ship should have fuel 100/100[0m                                                            [1;30m# refuel_ship_steps.go:399 -> *refuelShipContext[0m
    [32mAnd[0m [32m0 units of fuel should have been added[0m                                                       [1;30m# refuel_ship_steps.go:400 -> *refuelShipContext[0m

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.081ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.046ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Auto-dock ship before refueling when in orbit                                             [1;30m# features/application/refuel_ship.feature:31[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at fuel station "X1-A1" with status "IN_ORBIT" and fuel 50/100[0m [1;30m# refuel_ship_steps.go:394 -> *refuelShipContext[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "SHIP-1" and player 1 with nil units[0m                    [1;30m# refuel_ship_steps.go:396 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should succeed[0m                                                            [1;30m# refuel_ship_steps.go:398 -> *refuelShipContext[0m
    [32mAnd[0m [32mthe ship should have fuel 100/100[0m                                                             [1;30m# refuel_ship_steps.go:399 -> *refuelShipContext[0m
    [32mAnd[0m [32m50 units of fuel should have been added[0m                                                       [1;30m# refuel_ship_steps.go:400 -> *refuelShipContext[0m

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.082ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.046ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-B2" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot refuel ship not at fuel station                                                           [1;30m# features/application/refuel_ship.feature:38[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at waypoint "X1-B2" without fuel with status "DOCKED" and fuel 50/100[0m [1;30m# refuel_ship_steps.go:395 -> *refuelShipContext[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "SHIP-1" and player 1 with nil units[0m                           [1;30m# refuel_ship_steps.go:396 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should fail with error "waypoint does not have fuel station"[0m                     [1;30m# refuel_ship_steps.go:401 -> *refuelShipContext[0m

2025/11/15 16:02:55 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.077ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mScenario:[0m Cannot refuel ship that does not exist                                      [1;30m# features/application/refuel_ship.feature:43[0m
    [32mWhen[0m [32mI execute RefuelShipCommand for ship "NONEXISTENT" and player 1 with nil units[0m [1;30m# refuel_ship_steps.go:396 -> *refuelShipContext[0m
    [32mThen[0m [32mthe refuel command should fail with error "ship not found"[0m                     [1;30m# refuel_ship_steps.go:401 -> *refuelShipContext[0m

[1;37mFeature:[0m Route Executor Service
  As a SpaceTraders bot
  I want to execute routes by orchestrating atomic ship commands
  So that I can navigate efficiently using the routing engine's plan

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m                                       [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                                                 [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Execute single-segment route                                                                           [1;30m# features/application/route_executor.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 100/100[0m                          [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) with fuel station[0m                                            [1;30m# route_executor_steps.go:794 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (10, 0) without fuel station[0m                                        [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with 1 segment from "X1-A1" to "X1-B2" in "CRUISE" mode requiring 25 fuel[0m [1;30m# route_executor_steps.go:796 -> *routeExecutorContext[0m
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                                                        [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                                                        [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-B2"[0m                                                                              [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                                            [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Execute multi-segment route                                                   [1;30m# features/application/route_executor.feature:20[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 100/100[0m [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) without fuel station[0m                [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (10, 0) without fuel station[0m               [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-C3" exists at coordinates (20, 0) without fuel station[0m               [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with segments:[0m                                   [1;30m# route_executor_steps.go:797 -> *routeExecutorContext[0m
      | [36mfrom[0m  | [36mto[0m    | [36mdistance[0m | [36mfuel[0m | [36mmode[0m   | [36mrefuel[0m |
      | [36mX1-A1[0m | [36mX1-B2[0m | [36m10.0[0m     | [36m25[0m   | [36mCRUISE[0m | [36mfalse[0m  |
      | [36mX1-B2[0m | [36mX1-C3[0m | [36m10.0[0m     | [36m25[0m   | [36mCRUISE[0m | [36mfalse[0m  |
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=EXECUTING
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=true, currentIndex=1, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 1: X1-B2 → X1-C3
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 1 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=2, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 2: segment=false, currentIndex=2, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 2 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                               [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                               [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-C3"[0m                                                     [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                   [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Execute route with refuel before departure                                     [1;30m# features/application/route_executor.feature:34[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED" and fuel 20/100[0m     [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) with fuel station[0m                    [1;30m# route_executor_steps.go:794 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (30, 0) without fuel station[0m                [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" requiring refuel before departure[0m                 [1;30m# route_executor_steps.go:798 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe route has 1 segment from "X1-A1" to "X1-B2" in "CRUISE" mode requiring 75 fuel[0m [1;30m# route_executor_steps.go:799 -> *routeExecutorContext[0m
2025/11/15 16:02:55 Refueling before departure at X1-A1
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                                [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                                [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-B2"[0m                                                      [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should have consumed fuel for the journey[0m                                 [1;30m# route_executor_steps.go:809 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                    [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Execute route with mid-route refueling                                        [1;30m# features/application/route_executor.feature:46[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 100/100[0m [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) without fuel station[0m                [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (30, 0) with fuel station[0m                  [1;30m# route_executor_steps.go:794 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-C3" exists at coordinates (60, 0) without fuel station[0m               [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with segments:[0m                                   [1;30m# route_executor_steps.go:797 -> *routeExecutorContext[0m
      | [36mfrom[0m  | [36mto[0m    | [36mdistance[0m | [36mfuel[0m | [36mmode[0m   | [36mrefuel[0m |
      | [36mX1-A1[0m | [36mX1-B2[0m | [36m30.0[0m     | [36m75[0m   | [36mCRUISE[0m | [36mtrue[0m   |
      | [36mX1-B2[0m | [36mX1-C3[0m | [36m30.0[0m     | [36m75[0m   | [36mCRUISE[0m | [36mfalse[0m  |
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 Planned refuel at X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=EXECUTING
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=true, currentIndex=1, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 1: X1-B2 → X1-C3
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 1 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=2, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 2: segment=false, currentIndex=2, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 2 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                               [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                               [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-C3"[0m                                                     [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should have refueled at "X1-B2"[0m                                          [1;30m# route_executor_steps.go:810 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                   [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Execute route with opportunistic refueling                                   [1;30m# features/application/route_executor.feature:61[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 40/100[0m [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) without fuel station[0m               [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (10, 0) with fuel station[0m                 [1;30m# route_executor_steps.go:794 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-C3" exists at coordinates (20, 0) without fuel station[0m              [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with segments:[0m                                  [1;30m# route_executor_steps.go:797 -> *routeExecutorContext[0m
      | [36mfrom[0m  | [36mto[0m    | [36mdistance[0m | [36mfuel[0m | [36mmode[0m   | [36mrefuel[0m |
      | [36mX1-A1[0m | [36mX1-B2[0m | [36m10.0[0m     | [36m25[0m   | [36mCRUISE[0m | [36mfalse[0m  |
      | [36mX1-B2[0m | [36mX1-C3[0m | [36m10.0[0m     | [36m25[0m   | [36mCRUISE[0m | [36mfalse[0m  |
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 Opportunistic refuel at X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=EXECUTING
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=true, currentIndex=1, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 1: X1-B2 → X1-C3
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 1 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=2, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 2: segment=false, currentIndex=2, totalSegments=2
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 2 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                              [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                              [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-C3"[0m                                                    [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should have opportunistically refueled at "X1-B2"[0m                       [1;30m# route_executor_steps.go:811 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                  [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Execute route with pre-departure refuel prevention                                                   [1;30m# features/application/route_executor.feature:76[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 50/100[0m                         [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) with fuel station[0m                                          [1;30m# route_executor_steps.go:794 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (40, 0) without fuel station[0m                                      [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with 1 segment from "X1-A1" to "X1-B2" in "DRIFT" mode requiring 0 fuel[0m [1;30m# route_executor_steps.go:796 -> *routeExecutorContext[0m
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 Pre-departure refuel: preventing DRIFT mode with low fuel at X1-A1
2025/11/15 16:02:55 [ROUTE EXECUTOR] NavigateToWaypoint response: Status=navigating, ArrivalTimeStr=''
2025/11/15 16:02:55 [ROUTE EXECUTOR] WARNING: ArrivalTimeStr is empty for Status=navigating
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment 0 completed successfully
2025/11/15 16:02:55 [ROUTE EXECUTOR] After CompleteSegment: currentIndex=1, status=COMPLETED
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 1: segment=false, currentIndex=1, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] NextSegment() returned nil, breaking loop
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop finished after 1 segments, route status=COMPLETED
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                                                      [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should succeed[0m                                                                      [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should have prevented DRIFT mode by refueling at "X1-A1"[0m                                        [1;30m# route_executor_steps.go:812 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe ship should be at "X1-B2"[0m                                                                            [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "COMPLETED"[0m                                                          [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Handle ship already in transit - wait for arrival first                                                [1;30m# features/application/route_executor.feature:87[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in transit to "X1-B2" arriving in 5 seconds[0m                                 [1;30m# route_executor_steps.go:800 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (10, 0) without fuel station[0m                                        [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-C3" exists at coordinates (20, 0) without fuel station[0m                                        [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with 1 segment from "X1-B2" to "X1-C3" in "CRUISE" mode requiring 25 fuel[0m [1;30m# route_executor_steps.go:796 -> *routeExecutorContext[0m
2025/11/15 16:02:55 Ship SHIP-1 is IN_TRANSIT from previous command, fetching arrival time from API...
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                                                        [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route executor should wait for current transit to complete[0m                                            [1;30m# route_executor_steps.go:813 -> *routeExecutorContext[0m
    [31mAnd[0m [31mthe route execution should succeed[0m                                                                         [1;30m# route_executor_steps.go:806 -> *routeExecutorContext[0m
    [1;31mexpected route execution to succeed but got error: failed to fetch ship data from API: failed to find player: player not found: 1[0m
    [36mAnd[0m [36mthe ship should be at "X1-C3"[0m                                                                              [1;30m# route_executor_steps.go:807 -> *routeExecutorContext[0m
    [36mAnd[0m [36mthe executed route status should be "COMPLETED"[0m                                                            [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m

  [1;37mScenario:[0m Handle route execution failure - segment navigation fails                                              [1;30m# features/application/route_executor.feature:98[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT" and fuel 10/100[0m                           [1;30m# route_executor_steps.go:793 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-A1" exists at coordinates (0, 0) without fuel station[0m                                         [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32mwaypoint "X1-B2" exists at coordinates (50, 0) without fuel station[0m                                        [1;30m# route_executor_steps.go:795 -> *routeExecutorContext[0m
    [32mAnd[0m [32ma route exists for ship "SHIP-1" with 1 segment from "X1-A1" to "X1-B2" in "CRUISE" mode requiring 90 fuel[0m [1;30m# route_executor_steps.go:796 -> *routeExecutorContext[0m
2025/11/15 16:02:55 [ROUTE EXECUTOR] Loop iteration 0: segment=true, currentIndex=0, totalSegments=1
2025/11/15 16:02:55 [ROUTE EXECUTOR] Executing segment 0: X1-A1 → X1-B2
2025/11/15 16:02:55 [ROUTE EXECUTOR] Segment execution failed: failed to navigate: failed to navigate: failed to navigate ship: insufficient fuel: need 125 but only have 10
    [32mWhen[0m [32mI execute the route for ship "SHIP-1" and player 1[0m                                                        [1;30m# route_executor_steps.go:803 -> *routeExecutorContext[0m
    [32mThen[0m [32mthe route execution should fail[0m                                                                           [1;30m# route_executor_steps.go:814 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe executed route status should be "FAILED"[0m                                                               [1;30m# route_executor_steps.go:808 -> *routeExecutorContext[0m
    [32mAnd[0m [32mthe error should indicate "insufficient fuel"[0m                                                              [1;30m# route_executor_steps.go:815 -> *routeExecutorContext[0m

[1;37mFeature:[0m Route Planner Service
  As a SpaceTraders bot
  I want to plan routes using the routing client
  So that ships can navigate efficiently with optimal fuel usage

  [1;37mBackground:[0m
    [32mGiven[0m [32ma ship "TEST-SHIP" exists with current fuel 100 and capacity 100[0m [1;30m# route_planner_steps.go:532 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe ship is at waypoint "X1-A1" with coordinates (0, 0)[0m            [1;30m# route_planner_steps.go:533 -> *routePlannerContext[0m
    [32mAnd[0m [32ma destination waypoint "X1-B2" exists at coordinates (100, 50)[0m     [1;30m# route_planner_steps.go:534 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan simple single-segment direct route                        [1;30m# features/application/route_planner.feature:11[0m
    [32mGiven[0m [32mthe routing client returns a single-step direct route[0m            [1;30m# route_planner_steps.go:537 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-B2, Mode=CRUISE, Fuel=30, Time=120
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=30, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                      [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                  [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 1 segment[0m                            [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should not require refuel before departure[0m       [1;30m# route_planner_steps.go:554 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should travel from "X1-A1" to "X1-B2"[0m            [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should use flight mode "CRUISE"[0m                  [1;30m# route_planner_steps.go:558 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should not require refuel[0m                        [1;30m# route_planner_steps.go:559 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan multi-segment route with mid-route refueling                   [1;30m# features/application/route_planner.feature:21[0m
    [32mGiven[0m [32ma waypoint "X1-FUEL" exists at coordinates (50, 25) with fuel station[0m [1;30m# route_planner_steps.go:535 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe routing client returns a route with refueling stop[0m                  [1;30m# route_planner_steps.go:538 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 3 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-FUEL, Mode=CRUISE, Fuel=20, Time=60
[ROUTE PLANNER]   Step 1: Action=1, Waypoint=X1-FUEL, Mode=, Fuel=0, Time=10
[ROUTE PLANNER]   Step 2: Action=0, Waypoint=X1-B2, Mode=CRUISE, Fuel=25, Time=70
[ROUTE PLANNER] Created 2 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-FUEL (fuel=20, refuel=true)
[ROUTE PLANNER]   Segment 1: X1-FUEL → X1-B2 (fuel=25, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                           [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                       [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 2 segments[0m                                [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should not require refuel before departure[0m            [1;30m# route_planner_steps.go:554 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should travel from "X1-A1" to "X1-FUEL"[0m               [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should require refuel[0m                                 [1;30m# route_planner_steps.go:560 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 2 should travel from "X1-FUEL" to "X1-B2"[0m               [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 2 should not require refuel[0m                             [1;30m# route_planner_steps.go:559 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan route with refuel before departure flag                   [1;30m# features/application/route_planner.feature:33[0m
    [32mGiven[0m [32mthe ship is at a fuel station waypoint "X1-A1"[0m                   [1;30m# route_planner_steps.go:536 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe routing client returns a route with refuel before departure[0m    [1;30m# route_planner_steps.go:539 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 2 steps:
[ROUTE PLANNER]   Step 0: Action=1, Waypoint=X1-A1, Mode=, Fuel=0, Time=10
[ROUTE PLANNER]   Step 1: Action=0, Waypoint=X1-B2, Mode=BURN, Fuel=50, Time=150
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=50, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                      [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                  [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should require refuel before departure[0m           [1;30m# route_planner_steps.go:555 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have at least 1 segment[0m                   [1;30m# route_planner_steps.go:556 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan route with BURN flight mode                               [1;30m# features/application/route_planner.feature:41[0m
    [32mGiven[0m [32mthe routing client returns a route with BURN flight mode[0m         [1;30m# route_planner_steps.go:540 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-B2, Mode=BURN, Fuel=50, Time=80
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=50, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                      [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                  [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 1 segment[0m                            [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should use flight mode "BURN"[0m                    [1;30m# route_planner_steps.go:558 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan route with DRIFT flight mode                              [1;30m# features/application/route_planner.feature:48[0m
    [32mGiven[0m [32mthe routing client returns a route with DRIFT flight mode[0m        [1;30m# route_planner_steps.go:540 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-B2, Mode=DRIFT, Fuel=50, Time=80
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=50, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                      [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                  [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 1 segment[0m                            [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should use flight mode "DRIFT"[0m                   [1;30m# route_planner_steps.go:558 -> *routePlannerContext[0m

  [1;37mScenario:[0m Plan route with STEALTH flight mode                            [1;30m# features/application/route_planner.feature:55[0m
    [32mGiven[0m [32mthe routing client returns a route with STEALTH flight mode[0m      [1;30m# route_planner_steps.go:540 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-B2, Mode=STEALTH, Fuel=50, Time=80
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=50, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                      [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                  [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 1 segment[0m                            [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should use flight mode "STEALTH"[0m                 [1;30m# route_planner_steps.go:558 -> *routePlannerContext[0m

  [1;37mScenario:[0m Handle empty route response from routing client                                         [1;30m# features/application/route_planner.feature:62[0m
    [32mGiven[0m [32mthe routing client returns an empty route[0m                                                 [1;30m# route_planner_steps.go:541 -> *routePlannerContext[0m
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                                               [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mroute planning should fail with error "no route found: routing engine returned empty plan"[0m [1;30m# route_planner_steps.go:561 -> *routePlannerContext[0m

  [1;37mScenario:[0m Handle routing client error                                                   [1;30m# features/application/route_planner.feature:67[0m
    [32mGiven[0m [32mthe routing client returns an error "connection timeout"[0m                        [1;30m# route_planner_steps.go:542 -> *routePlannerContext[0m
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                                     [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mroute planning should fail with error "routing client error: connection timeout"[0m [1;30m# route_planner_steps.go:561 -> *routePlannerContext[0m

  [1;37mScenario:[0m Convert complex multi-step route correctly                            [1;30m# features/application/route_planner.feature:72[0m
    [32mGiven[0m [32ma waypoint "X1-FUEL-1" exists at coordinates (30, 20) with fuel station[0m [1;30m# route_planner_steps.go:535 -> *routePlannerContext[0m
    [32mAnd[0m [32ma waypoint "X1-FUEL-2" exists at coordinates (70, 40) with fuel station[0m   [1;30m# route_planner_steps.go:535 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe routing client returns a complex route with multiple refuel stops[0m     [1;30m# route_planner_steps.go:543 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 5 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-FUEL-1, Mode=CRUISE, Fuel=15, Time=40
[ROUTE PLANNER]   Step 1: Action=1, Waypoint=X1-FUEL-1, Mode=, Fuel=0, Time=10
[ROUTE PLANNER]   Step 2: Action=0, Waypoint=X1-FUEL-2, Mode=CRUISE, Fuel=20, Time=50
[ROUTE PLANNER]   Step 3: Action=1, Waypoint=X1-FUEL-2, Mode=, Fuel=0, Time=10
[ROUTE PLANNER]   Step 4: Action=0, Waypoint=X1-B2, Mode=CRUISE, Fuel=18, Time=45
[ROUTE PLANNER] Created 3 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-FUEL-1 (fuel=15, refuel=true)
[ROUTE PLANNER]   Segment 1: X1-FUEL-1 → X1-FUEL-2 (fuel=20, refuel=true)
[ROUTE PLANNER]   Segment 2: X1-FUEL-2 → X1-B2 (fuel=18, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                             [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                         [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route should have 3 segments[0m                                  [1;30m# route_planner_steps.go:553 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should travel from "X1-A1" to "X1-FUEL-1"[0m               [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 1 should require refuel[0m                                   [1;30m# route_planner_steps.go:560 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 2 should travel from "X1-FUEL-1" to "X1-FUEL-2"[0m           [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 2 should require refuel[0m                                   [1;30m# route_planner_steps.go:560 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 3 should travel from "X1-FUEL-2" to "X1-B2"[0m               [1;30m# route_planner_steps.go:557 -> *routePlannerContext[0m
    [32mAnd[0m [32mplanned segment 3 should not require refuel[0m                               [1;30m# route_planner_steps.go:559 -> *routePlannerContext[0m

  [1;37mScenario:[0m Handle route with only REFUEL steps (edge case)                     [1;30m# features/application/route_planner.feature:86[0m
    [32mGiven[0m [32mthe routing client returns a route with only refuel steps[0m             [1;30m# route_planner_steps.go:544 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=1, Waypoint=X1-A1, Mode=, Fuel=0, Time=10
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                           [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mroute planning should fail with error "route plan has no TRAVEL steps"[0m [1;30m# route_planner_steps.go:561 -> *routePlannerContext[0m

  [1;37mScenario:[0m Generate correct route ID                                                [1;30m# features/application/route_planner.feature:91[0m
    [32mGiven[0m [32mthe routing client returns a single-step route with total time 120 seconds[0m [1;30m# route_planner_steps.go:545 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-B2, Mode=CRUISE, Fuel=30, Time=120
[ROUTE PLANNER] Created 1 route segments:
[ROUTE PLANNER]   Segment 0: X1-A1 → X1-B2 (fuel=30, refuel=false)
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                                [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mthe planned route should be created successfully[0m                            [1;30m# route_planner_steps.go:552 -> *routePlannerContext[0m
    [32mAnd[0m [32mthe planned route ID should be "TEST-SHIP_120"[0m                               [1;30m# route_planner_steps.go:562 -> *routePlannerContext[0m

  [1;37mScenario:[0m Handle missing waypoint in cache during route conversion                    [1;30m# features/application/route_planner.feature:97[0m
    [32mGiven[0m [32mthe routing client returns a route to unknown waypoint "X1-UNKNOWN"[0m           [1;30m# route_planner_steps.go:546 -> *routePlannerContext[0m
[ROUTE PLANNER] Routing service returned 1 steps:
[ROUTE PLANNER]   Step 0: Action=0, Waypoint=X1-UNKNOWN, Mode=CRUISE, Fuel=30, Time=120
    [32mWhen[0m [32mI plan a route from ship location to "X1-B2"[0m                                   [1;30m# route_planner_steps.go:549 -> *routePlannerContext[0m
    [32mThen[0m [32mroute planning should fail with error "waypoint X1-UNKNOWN not found in cache"[0m [1;30m# route_planner_steps.go:561 -> *routePlannerContext[0m

[1;37mFeature:[0m Get Market Data Query
  As a market analysis system
  I need to retrieve market data for a waypoint
  So that I can analyze trade opportunities

  [1;37mScenario:[0m Successfully get market data                                [1;30m# features/application/scouting/get_market_data.feature:6[0m
    [32mGiven[0m [32ma player with ID 1[0m                                            [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-A1" with 2 trade goods[0m [1;30m# get_market_data_steps.go:33 -> *getMarketDataContext[0m
    [32mWhen[0m [32mI query market data for waypoint "X1-TEST-A1"[0m                  [1;30m# get_market_data_steps.go:36 -> *getMarketDataContext[0m
    [32mThen[0m [32mthe market data query should succeed[0m                           [1;30m# get_market_data_steps.go:39 -> *getMarketDataContext[0m
    [32mAnd[0m [32mthe queried market should have 2 trade goods[0m                    [1;30m# get_market_data_steps.go:40 -> *getMarketDataContext[0m

  [1;37mScenario:[0m Query non-existent market returns nil          [1;30m# features/application/scouting/get_market_data.feature:13[0m
    [32mGiven[0m [32ma player with ID 1[0m                               [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI query market data for waypoint "X1-NONEXISTENT"[0m [1;30m# get_market_data_steps.go:36 -> *getMarketDataContext[0m
    [32mThen[0m [32mthe market data query should succeed[0m              [1;30m# get_market_data_steps.go:39 -> *getMarketDataContext[0m
    [32mAnd[0m [32mthe queried market should be nil[0m                   [1;30m# get_market_data_steps.go:41 -> *getMarketDataContext[0m

[1;37mFeature:[0m List Market Data Query
  As a market analysis system
  I need to retrieve all market data in a system
  So that I can analyze trade opportunities across multiple markets

  [1;37mScenario:[0m Successfully list all markets in a system                                       [1;30m# features/application/scouting/list_market_data.feature:6[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                                [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-A1" in system "X1-TEST" with 2 trade goods[0m [1;30m# list_market_data_steps.go:34 -> *listMarketDataContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-B2" in system "X1-TEST" with 3 trade goods[0m [1;30m# list_market_data_steps.go:34 -> *listMarketDataContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-C3" in system "X1-TEST" with 1 trade goods[0m [1;30m# list_market_data_steps.go:34 -> *listMarketDataContext[0m
    [32mWhen[0m [32mI query all markets in system "X1-TEST" with max age 60 minutes[0m                    [1;30m# list_market_data_steps.go:38 -> *listMarketDataContext[0m
    [32mThen[0m [32mthe list query should succeed[0m                                                      [1;30m# list_market_data_steps.go:41 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should contain 3 markets[0m                                            [1;30m# list_market_data_steps.go:42 -> *listMarketDataContext[0m

  [1;37mScenario:[0m Filter markets by max age                                                                               [1;30m# features/application/scouting/list_market_data.feature:15[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                                                        [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-A1" in system "X1-TEST" with 2 trade goods updated 10 minutes ago[0m  [1;30m# list_market_data_steps.go:35 -> *listMarketDataContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-B2" in system "X1-TEST" with 3 trade goods updated 120 minutes ago[0m [1;30m# list_market_data_steps.go:35 -> *listMarketDataContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-C3" in system "X1-TEST" with 1 trade goods updated 5 minutes ago[0m   [1;30m# list_market_data_steps.go:35 -> *listMarketDataContext[0m
    [32mWhen[0m [32mI query all markets in system "X1-TEST" with max age 60 minutes[0m                                            [1;30m# list_market_data_steps.go:38 -> *listMarketDataContext[0m
    [32mThen[0m [32mthe list query should succeed[0m                                                                              [1;30m# list_market_data_steps.go:41 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should contain 2 markets[0m                                                                    [1;30m# list_market_data_steps.go:42 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should include waypoint "X1-TEST-A1"[0m                                                        [1;30m# list_market_data_steps.go:44 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should include waypoint "X1-TEST-C3"[0m                                                        [1;30m# list_market_data_steps.go:44 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should not include waypoint "X1-TEST-B2"[0m                                                    [1;30m# list_market_data_steps.go:45 -> *listMarketDataContext[0m

  [1;37mScenario:[0m Query empty system returns empty list                         [1;30m# features/application/scouting/list_market_data.feature:27[0m
    [32mGiven[0m [32ma player with ID 1[0m                                              [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI query all markets in system "X1-EMPTY" with max age 60 minutes[0m [1;30m# list_market_data_steps.go:38 -> *listMarketDataContext[0m
    [32mThen[0m [32mthe list query should succeed[0m                                    [1;30m# list_market_data_steps.go:41 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should be empty[0m                                   [1;30m# list_market_data_steps.go:43 -> *listMarketDataContext[0m

  [1;37mScenario:[0m Query with zero max age returns all markets                                                              [1;30m# features/application/scouting/list_market_data.feature:33[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                                                         [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-A1" in system "X1-TEST" with 2 trade goods updated 500 minutes ago[0m  [1;30m# list_market_data_steps.go:35 -> *listMarketDataContext[0m
    [32mAnd[0m [32mmarket data exists for waypoint "X1-TEST-B2" in system "X1-TEST" with 3 trade goods updated 1000 minutes ago[0m [1;30m# list_market_data_steps.go:35 -> *listMarketDataContext[0m
    [32mWhen[0m [32mI query all markets in system "X1-TEST" with max age 0 minutes[0m                                              [1;30m# list_market_data_steps.go:38 -> *listMarketDataContext[0m
    [32mThen[0m [32mthe list query should succeed[0m                                                                               [1;30m# list_market_data_steps.go:41 -> *listMarketDataContext[0m
    [32mAnd[0m [32mthe market list should contain 2 markets[0m                                                                     [1;30m# list_market_data_steps.go:42 -> *listMarketDataContext[0m

[1;37mFeature:[0m Scout Markets Command - Fleet Orchestration
  Deploy multiple ships to scout markets using VRP optimization.
  This command orchestrates fleet distribution across markets, reuses existing containers,
  and creates new containers only when needed (idempotent design).

  [1;37mBackground:[0m
    [32mGiven[0m [32ma scout markets test database[0m                                                                             [1;30m# scout_markets_steps.go:411 -> *scoutMarketsContext[0m
    [32mAnd[0m [32ma scout markets player with ID 1 and agent "TESTBOT"[0m                                                        [1;30m# scout_markets_steps.go:412 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe scout markets player has token "test-token-123"[0m                                                         [1;30m# scout_markets_steps.go:413 -> *scoutMarketsContext[0m

2025/11/15 16:02:56 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.063ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Deploy single ship to scout all markets                                                                 [1;30m# features/application/scouting/scout_markets.feature:11[0m
    [32mGiven[0m [32mI have a ship "SCOUT-1" at waypoint "X1-TEST-A1" in system "X1-TEST"[0m                                      [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has markets at "X1-TEST-A1,X1-TEST-B2"[0m                                                 [1;30m# scout_markets_steps.go:417 -> *scoutMarketsContext[0m
    [32mWhen[0m [32mI execute ScoutMarketsCommand with ships "SCOUT-1" and markets "X1-TEST-A1,X1-TEST-B2" in system "X1-TEST"[0m [1;30m# scout_markets_steps.go:422 -> *scoutMarketsContext[0m
    [32mThen[0m [32mthe scout markets command should succeed[0m                                                                   [1;30m# scout_markets_steps.go:425 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m1 scout container should be created[0m                                                                         [1;30m# scout_markets_steps.go:426 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-1" should be assigned 2 markets[0m                                                                 [1;30m# scout_markets_steps.go:429 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.076ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Deploy multiple ships with VRP optimization                                                                                           [1;30m# features/application/scouting/scout_markets.feature:19[0m
    [32mGiven[0m [32mI have a ship "SCOUT-1" at waypoint "X1-TEST-A1" in system "X1-TEST"[0m                                                                    [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.067ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-B2" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mI have a ship "SCOUT-2" at waypoint "X1-TEST-B2" in system "X1-TEST"[0m                                                                      [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has markets at "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3,X1-TEST-D4"[0m                                                         [1;30m# scout_markets_steps.go:417 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe routing client will partition markets using VRP[0m                                                                                       [1;30m# scout_markets_steps.go:419 -> *scoutMarketsContext[0m
    [32mWhen[0m [32mI execute ScoutMarketsCommand with ships "SCOUT-1,SCOUT-2" and markets "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3,X1-TEST-D4" in system "X1-TEST"[0m [1;30m# scout_markets_steps.go:422 -> *scoutMarketsContext[0m
    [32mThen[0m [32mthe scout markets command should succeed[0m                                                                                                 [1;30m# scout_markets_steps.go:425 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m2 scout containers should be created[0m                                                                                                      [1;30m# scout_markets_steps.go:426 -> *scoutMarketsContext[0m
Ship SCOUT-1 assigned 2 markets
Ship SCOUT-2 assigned 2 markets
    [32mAnd[0m [32mmarkets should be distributed across ships[0m                                                                                                [1;30m# scout_markets_steps.go:430 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.056ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Idempotent container reuse - ship already has active container                                          [1;30m# features/application/scouting/scout_markets.feature:29[0m
    [32mGiven[0m [32mI have a ship "SCOUT-1" at waypoint "X1-TEST-A1" in system "X1-TEST"[0m                                      [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-1" has an active container "scout-tour-scout-1-abc12345"[0m                                        [1;30m# scout_markets_steps.go:418 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has markets at "X1-TEST-A1,X1-TEST-B2"[0m                                                 [1;30m# scout_markets_steps.go:417 -> *scoutMarketsContext[0m
    [32mWhen[0m [32mI execute ScoutMarketsCommand with ships "SCOUT-1" and markets "X1-TEST-A1,X1-TEST-B2" in system "X1-TEST"[0m [1;30m# scout_markets_steps.go:422 -> *scoutMarketsContext[0m
    [32mThen[0m [32mthe scout markets command should succeed[0m                                                                   [1;30m# scout_markets_steps.go:425 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m0 new scout containers should be created[0m                                                                    [1;30m# scout_markets_steps.go:427 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m1 scout container should be reused[0m                                                                          [1;30m# scout_markets_steps.go:428 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe reused container is "scout-tour-scout-1-abc12345"[0m                                                       [1;30m# scout_markets_steps.go:431 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.058ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Partial container reuse - some ships have containers                                                                       [1;30m# features/application/scouting/scout_markets.feature:39[0m
    [32mGiven[0m [32mI have a ship "SCOUT-1" at waypoint "X1-TEST-A1" in system "X1-TEST"[0m                                                         [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.046ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-B2" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mI have a ship "SCOUT-2" at waypoint "X1-TEST-B2" in system "X1-TEST"[0m                                                           [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-1" has an active container "scout-tour-scout-1-abc12345"[0m                                                           [1;30m# scout_markets_steps.go:418 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has markets at "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3"[0m                                                         [1;30m# scout_markets_steps.go:417 -> *scoutMarketsContext[0m
    [32mWhen[0m [32mI execute ScoutMarketsCommand with ships "SCOUT-1,SCOUT-2" and markets "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3" in system "X1-TEST"[0m [1;30m# scout_markets_steps.go:422 -> *scoutMarketsContext[0m
    [32mThen[0m [32mthe scout markets command should succeed[0m                                                                                      [1;30m# scout_markets_steps.go:425 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m1 new scout container should be created[0m                                                                                        [1;30m# scout_markets_steps.go:427 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m1 scout container should be reused[0m                                                                                             [1;30m# scout_markets_steps.go:428 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-2" should have a new scout container[0m                                                                               [1;30m# scout_markets_steps.go:432 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.053ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Early return when all ships already have containers                                                             [1;30m# features/application/scouting/scout_markets.feature:50[0m
    [32mGiven[0m [32mI have a ship "SCOUT-1" at waypoint "X1-TEST-A1" in system "X1-TEST"[0m                                              [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.052ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-B2" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mI have a ship "SCOUT-2" at waypoint "X1-TEST-B2" in system "X1-TEST"[0m                                                [1;30m# scout_markets_steps.go:416 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-1" has an active container "scout-tour-scout-1-abc12345"[0m                                                [1;30m# scout_markets_steps.go:418 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mship "SCOUT-2" has an active container "scout-tour-scout-2-def67890"[0m                                                [1;30m# scout_markets_steps.go:418 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has markets at "X1-TEST-A1,X1-TEST-B2"[0m                                                         [1;30m# scout_markets_steps.go:417 -> *scoutMarketsContext[0m
    [32mWhen[0m [32mI execute ScoutMarketsCommand with ships "SCOUT-1,SCOUT-2" and markets "X1-TEST-A1,X1-TEST-B2" in system "X1-TEST"[0m [1;30m# scout_markets_steps.go:422 -> *scoutMarketsContext[0m
    [32mThen[0m [32mthe scout markets command should succeed[0m                                                                           [1;30m# scout_markets_steps.go:425 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m0 new scout containers should be created[0m                                                                            [1;30m# scout_markets_steps.go:427 -> *scoutMarketsContext[0m
    [32mAnd[0m [32m2 scout containers should be reused[0m                                                                                 [1;30m# scout_markets_steps.go:428 -> *scoutMarketsContext[0m
    [32mAnd[0m [32mall requested ships have containers[0m                                                                                 [1;30m# scout_markets_steps.go:433 -> *scoutMarketsContext[0m

[1;37mFeature:[0m Scout Tour Command
  As a market scouting system
  I need to execute market scouting tours with a single ship
  So that I can continuously update market price data

  [1;37mBackground:[0m
    [32mGiven[0m [32ma test database[0m                                                                      [1;30m# scout_tour_steps.go:419 -> *scoutTourContext[0m
    [32mAnd[0m [32ma registered player with ID 1 and agent "TEST-AGENT"[0m                                   [1;30m# scout_tour_steps.go:420 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe player has token "test-token-123"[0m                                                  [1;30m# scout_tour_steps.go:421 -> *scoutTourContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.064ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Scout a single-market tour (stationary scout)                                      [1;30m# features/application/scouting/scout_tour.feature:11[0m
    [32mGiven[0m [32mthe player has a ship "SCOUT-1" at waypoint "X1-TEST-A1" with status "DOCKED"[0m        [1;30m# scout_tour_steps.go:424 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe system "X1-TEST" has waypoint "X1-TEST-A1" with coordinates 0, 0[0m                   [1;30m# scout_tour_steps.go:427 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe API will return market data for "X1-TEST-A1" with 2 trade goods[0m                    [1;30m# scout_tour_steps.go:431 -> *scoutTourContext[0m
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-A1
    [32mWhen[0m [32mI execute ScoutTourCommand with ship "SCOUT-1", markets "X1-TEST-A1", and 1 iteration[0m [1;30m# scout_tour_steps.go:435 -> *scoutTourContext[0m
    [32mThen[0m [32mthe scout tour command should succeed[0m                                                 [1;30m# scout_tour_steps.go:438 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe scout ship should be at "X1-TEST-A1"[0m                                               [1;30m# scout_tour_steps.go:439 -> *scoutTourContext[0m
    [32mAnd[0m [32mmarket data should be persisted for waypoint "X1-TEST-A1"[0m                              [1;30m# scout_tour_steps.go:440 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe persisted market should have 2 trade goods[0m                                         [1;30m# scout_tour_steps.go:441 -> *scoutTourContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.055ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Scout a multi-market tour                                                                                [1;30m# features/application/scouting/scout_tour.feature:21[0m
    [32mGiven[0m [32mthe player has a ship "SCOUT-1" at waypoint "X1-TEST-A1" with status "DOCKED"[0m                              [1;30m# scout_tour_steps.go:424 -> *scoutTourContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.031ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-B2" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.039ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-C3" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mthe system "X1-TEST" has the following waypoints:[0m                                                            [1;30m# scout_tour_steps.go:428 -> *scoutTourContext[0m
      | [36mSymbol[0m     | [36mX[0m  | [36mY[0m |
      | [36mX1-TEST-A1[0m | [36m0[0m  | [36m0[0m |
      | [36mX1-TEST-B2[0m | [36m5[0m  | [36m5[0m |
      | [36mX1-TEST-C3[0m | [36m10[0m | [36m0[0m |
    [32mAnd[0m [32mthe API will return market data for all waypoints[0m                                                            [1;30m# scout_tour_steps.go:432 -> *scoutTourContext[0m
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-C3
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-C3
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-C3
    [32mWhen[0m [32mI execute ScoutTourCommand with ship "SCOUT-1", markets "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3", and 1 iteration[0m [1;30m# scout_tour_steps.go:435 -> *scoutTourContext[0m
    [32mThen[0m [32mthe scout tour command should succeed[0m                                                                       [1;30m# scout_tour_steps.go:438 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe scout ship should have visited 3 markets[0m                                                                 [1;30m# scout_tour_steps.go:442 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe scout ship should be at "X1-TEST-A1"[0m                                                                     [1;30m# scout_tour_steps.go:439 -> *scoutTourContext[0m
    [32mAnd[0m [32mmarket data should be persisted for all 3 waypoints[0m                                                          [1;30m# scout_tour_steps.go:443 -> *scoutTourContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.059ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-B2" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Idempotent tour rotation - resume from current position                                                  [1;30m# features/application/scouting/scout_tour.feature:35[0m
    [32mGiven[0m [32mthe player has a ship "SCOUT-1" at waypoint "X1-TEST-B2" with status "DOCKED"[0m                              [1;30m# scout_tour_steps.go:424 -> *scoutTourContext[0m

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.063ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-A1" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

2025/11/15 16:02:57 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.022ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-TEST-C3" AND system_symbol = "X1-TEST" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1
    [32mAnd[0m [32mthe system "X1-TEST" has the following waypoints:[0m                                                            [1;30m# scout_tour_steps.go:428 -> *scoutTourContext[0m
      | [36mSymbol[0m     | [36mX[0m  | [36mY[0m |
      | [36mX1-TEST-A1[0m | [36m0[0m  | [36m0[0m |
      | [36mX1-TEST-B2[0m | [36m5[0m  | [36m5[0m |
      | [36mX1-TEST-C3[0m | [36m10[0m | [36m0[0m |
    [32mAnd[0m [32mthe API will return market data for all waypoints[0m                                                            [1;30m# scout_tour_steps.go:432 -> *scoutTourContext[0m
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-B2
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-C3
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-C3
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-C3
2025/11/15 16:02:57 [ScoutTour] Navigating SCOUT-1 to X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Navigation complete: status=completed, fuel=100
2025/11/15 16:02:57 [ScoutTour] Docking SCOUT-1 at X1-TEST-A1
2025/11/15 16:02:57 [ScoutTour] Getting market data for SCOUT-1 at X1-TEST-A1
    [32mWhen[0m [32mI execute ScoutTourCommand with ship "SCOUT-1", markets "X1-TEST-A1,X1-TEST-B2,X1-TEST-C3", and 1 iteration[0m [1;30m# scout_tour_steps.go:435 -> *scoutTourContext[0m
    [32mThen[0m [32mthe scout tour command should succeed[0m                                                                       [1;30m# scout_tour_steps.go:438 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe tour should start from "X1-TEST-B2"[0m                                                                      [1;30m# scout_tour_steps.go:444 -> *scoutTourContext[0m
    [32mAnd[0m [32mthe visit order should be "X1-TEST-B2,X1-TEST-C3,X1-TEST-A1"[0m                                                 [1;30m# scout_tour_steps.go:445 -> *scoutTourContext[0m

[1;37mFeature:[0m Sell Cargo Command
  As a SpaceTraders bot
  I want to sell cargo from my ships at marketplaces
  So that I can earn credits and free up cargo space

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with agent "TEST-AGENT" and token "test-token-123"[0m        [1;30m# negotiate_contract_steps.go:344 -> *negotiateContractContext[0m
    [32mAnd[0m [32mthe player has player_id 1[0m                                                  [1;30m# negotiate_contract_steps.go:345 -> *negotiateContractContext[0m

  [1;37mScenario:[0m Sell cargo successfully                                                 [1;30m# features/application/sell_cargo.feature:10[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1" with cargo[0m     [1;30m# sell_cargo_steps.go:335 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe ship contains 30 units of "IRON_ORE"[0m                                    [1;30m# sell_cargo_steps.go:337 -> *sellCargoContext[0m
    [32mWhen[0m [32mI execute sell cargo command for 20 units of "IRON_ORE" from ship "SHIP-1"[0m [1;30m# sell_cargo_steps.go:338 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should succeed[0m                                      [1;30m# sell_cargo_steps.go:340 -> *sellCargoContext[0m
    [32mAnd[0m [32m20 units should be sold from cargo[0m                                          [1;30m# sell_cargo_steps.go:341 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe total revenue should be greater than 0[0m                                  [1;30m# sell_cargo_steps.go:342 -> *sellCargoContext[0m

  [1;37mScenario:[0m Sell all cargo units                                                    [1;30m# features/application/sell_cargo.feature:18[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1" with cargo[0m     [1;30m# sell_cargo_steps.go:335 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe ship contains 50 units of "IRON_ORE"[0m                                    [1;30m# sell_cargo_steps.go:337 -> *sellCargoContext[0m
    [32mWhen[0m [32mI execute sell cargo command for 50 units of "IRON_ORE" from ship "SHIP-1"[0m [1;30m# sell_cargo_steps.go:338 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should succeed[0m                                      [1;30m# sell_cargo_steps.go:340 -> *sellCargoContext[0m
    [32mAnd[0m [32m50 units should be sold from cargo[0m                                          [1;30m# sell_cargo_steps.go:341 -> *sellCargoContext[0m

  [1;37mScenario:[0m Cannot sell when ship not docked                                                   [1;30m# features/application/sell_cargo.feature:25[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 in orbit at "X1-A1" with cargo[0m                          [1;30m# sell_cargo_steps.go:336 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe ship contains 30 units of "IRON_ORE"[0m                                               [1;30m# sell_cargo_steps.go:337 -> *sellCargoContext[0m
    [32mWhen[0m [32mI attempt to execute sell cargo command for 20 units of "IRON_ORE" from ship "SHIP-1"[0m [1;30m# sell_cargo_steps.go:339 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should fail with error "ship must be docked to sell cargo"[0m     [1;30m# sell_cargo_steps.go:343 -> *sellCargoContext[0m

  [1;37mScenario:[0m Cannot sell more than ship has                                                     [1;30m# features/application/sell_cargo.feature:31[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1" with cargo[0m                [1;30m# sell_cargo_steps.go:335 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe ship contains 10 units of "IRON_ORE"[0m                                               [1;30m# sell_cargo_steps.go:337 -> *sellCargoContext[0m
    [32mWhen[0m [32mI attempt to execute sell cargo command for 20 units of "IRON_ORE" from ship "SHIP-1"[0m [1;30m# sell_cargo_steps.go:339 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should fail with error "insufficient cargo: need 20, have 10"[0m  [1;30m# sell_cargo_steps.go:343 -> *sellCargoContext[0m

  [1;37mScenario:[0m Cannot sell cargo ship doesn't have                                                  [1;30m# features/application/sell_cargo.feature:37[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 docked at marketplace "X1-A1" with cargo[0m                  [1;30m# sell_cargo_steps.go:335 -> *sellCargoContext[0m
    [32mAnd[0m [32mthe ship contains 30 units of "IRON_ORE"[0m                                                 [1;30m# sell_cargo_steps.go:337 -> *sellCargoContext[0m
    [32mWhen[0m [32mI attempt to execute sell cargo command for 10 units of "COPPER_ORE" from ship "SHIP-1"[0m [1;30m# sell_cargo_steps.go:339 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should fail with error "insufficient cargo: need 10, have 0"[0m     [1;30m# sell_cargo_steps.go:343 -> *sellCargoContext[0m

  [1;37mScenario:[0m Ship not found                                                                           [1;30m# features/application/sell_cargo.feature:43[0m
    [32mWhen[0m [32mI attempt to execute sell cargo command for 20 units of "IRON_ORE" from ship "NON-EXISTENT"[0m [1;30m# sell_cargo_steps.go:339 -> *sellCargoContext[0m
    [32mThen[0m [32mthe sell cargo command should fail with error "ship not found"[0m                              [1;30m# sell_cargo_steps.go:343 -> *sellCargoContext[0m

[1;37mFeature:[0m Sell Cargo with Transaction Limit Splitting

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player with ID 1[0m                                      [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Sell within single transaction limit                  [1;30m# features/application/sell_cargo_transaction_limits.feature:6[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m              [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 50 units of "IRON_ORE" in cargo[0m              [1;30m# transaction_limit_steps.go:450 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" buys "IRON_ORE" with transaction limit 100[0m [1;30m# transaction_limit_steps.go:452 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI sell 50 units of "IRON_ORE" from ship "SHIP-1"[0m         [1;30m# transaction_limit_steps.go:460 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe sale should succeed[0m                                  [1;30m# transaction_limit_steps.go:464 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m                   [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m50 units should have been sold[0m                            [1;30m# transaction_limit_steps.go:467 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Sell exceeds market transaction limit - requires splitting [1;30m# features/application/sell_cargo_transaction_limits.feature:15[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m                   [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 50 units of "IRON_ORE" in cargo[0m                   [1;30m# transaction_limit_steps.go:450 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" buys "IRON_ORE" with transaction limit 20[0m       [1;30m# transaction_limit_steps.go:452 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI sell 50 units of "IRON_ORE" from ship "SHIP-1"[0m              [1;30m# transaction_limit_steps.go:460 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe sale should succeed[0m                                       [1;30m# transaction_limit_steps.go:464 -> *transactionLimitContext[0m
    [32mAnd[0m [32m3 transactions should have been executed[0m                       [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m50 units should have been sold[0m                                 [1;30m# transaction_limit_steps.go:467 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Market data unavailable - single transaction fallback [1;30m# features/application/sell_cargo_transaction_limits.feature:24[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m              [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 30 units of "IRON_ORE" in cargo[0m              [1;30m# transaction_limit_steps.go:450 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket data is not available for "X1-A1"[0m                  [1;30m# transaction_limit_steps.go:453 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI sell 30 units of "IRON_ORE" from ship "SHIP-1"[0m         [1;30m# transaction_limit_steps.go:460 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe sale should succeed[0m                                  [1;30m# transaction_limit_steps.go:464 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m                   [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m30 units should have been sold[0m                            [1;30m# transaction_limit_steps.go:467 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Partial failure during multi-transaction sale          [1;30m# features/application/sell_cargo_transaction_limits.feature:33[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m               [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 50 units of "IRON_ORE" in cargo[0m               [1;30m# transaction_limit_steps.go:450 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" buys "IRON_ORE" with transaction limit 20[0m   [1;30m# transaction_limit_steps.go:452 -> *transactionLimitContext[0m
    [32mAnd[0m [32mAPI will fail on transaction 3 with "market oversaturated"[0m [1;30m# transaction_limit_steps.go:456 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI sell 50 units of "IRON_ORE" from ship "SHIP-1"[0m          [1;30m# transaction_limit_steps.go:460 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe sale should return partial success[0m                    [1;30m# transaction_limit_steps.go:469 -> *transactionLimitContext[0m
    [32mAnd[0m [32m2 transactions should have been executed[0m                   [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m
    [32mAnd[0m [32m40 units should have been sold[0m                             [1;30m# transaction_limit_steps.go:467 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe transaction error should mention "partial failure"[0m     [1;30m# transaction_limit_steps.go:470 -> *transactionLimitContext[0m

  [1;37mScenario:[0m Good not available at market - use fallback limit [1;30m# features/application/sell_cargo_transaction_limits.feature:44[0m
    [32mGiven[0m [32ma ship "SHIP-1" docked at waypoint "X1-A1"[0m          [1;30m# transaction_limit_steps.go:448 -> *transactionLimitContext[0m
    [32mAnd[0m [32mthe ship has 30 units of "RARE_METAL" in cargo[0m        [1;30m# transaction_limit_steps.go:450 -> *transactionLimitContext[0m
    [32mAnd[0m [32mmarket "X1-A1" exists but doesn't buy "RARE_METAL"[0m    [1;30m# transaction_limit_steps.go:455 -> *transactionLimitContext[0m
    [32mWhen[0m [32mI sell 30 units of "RARE_METAL" from ship "SHIP-1"[0m   [1;30m# transaction_limit_steps.go:460 -> *transactionLimitContext[0m
    [32mThen[0m [32mthe sale should succeed[0m                              [1;30m# transaction_limit_steps.go:464 -> *transactionLimitContext[0m
    [32mAnd[0m [32m1 transaction should have been executed[0m               [1;30m# transaction_limit_steps.go:465 -> *transactionLimitContext[0m

[1;37mFeature:[0m Set Flight Mode Command
  As a SpaceTraders bot
  I want to change ship flight modes
  So that I can optimize travel time and fuel consumption

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.082ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mBackground:[0m
    [32mGiven[0m [32ma ship operations test player 1 exists with agent "TEST-AGENT" and token "test-token-123"[0m [1;30m# ship_operations_context.go:521 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.037ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Successfully set flight mode to CRUISE                                                  [1;30m# features/application/set_flight_mode.feature:9[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                            [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "CRUISE"[0m           [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should succeed with status "success"[0m                               [1;30m# ship_operations_context.go:543 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe current flight mode should be "CRUISE"[0m                                                  [1;30m# ship_operations_context.go:544 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.072ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.045ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Successfully set flight mode to DRIFT                                                   [1;30m# features/application/set_flight_mode.feature:15[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                            [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "DRIFT"[0m            [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should succeed with status "success"[0m                               [1;30m# ship_operations_context.go:543 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe current flight mode should be "DRIFT"[0m                                                   [1;30m# ship_operations_context.go:544 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.074ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.035ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Successfully set flight mode to BURN                                                    [1;30m# features/application/set_flight_mode.feature:21[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "DOCKED"[0m                              [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "BURN"[0m             [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should succeed with status "success"[0m                               [1;30m# ship_operations_context.go:543 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe current flight mode should be "BURN"[0m                                                    [1;30m# ship_operations_context.go:544 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.067ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.037ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Successfully set flight mode to STEALTH                                                 [1;30m# features/application/set_flight_mode.feature:27[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                            [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "STEALTH"[0m          [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should succeed with status "success"[0m                               [1;30m# ship_operations_context.go:543 -> *shipOperationsContext[0m
    [32mAnd[0m [32mthe current flight mode should be "STEALTH"[0m                                                 [1;30m# ship_operations_context.go:544 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.065ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

  [1;37mScenario:[0m Ship not found                                                                          [1;30m# features/application/set_flight_mode.feature:33[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "NONEXISTENT" and player 1 with mode "CRUISE"[0m      [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should fail with error "ship not found"[0m                            [1;30m# ship_operations_context.go:545 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.083ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.044ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Invalid flight mode                                                                     [1;30m# features/application/set_flight_mode.feature:37[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 1 at "X1-A1" with status "IN_ORBIT"[0m                            [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "INVALID"[0m          [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should fail with error "invalid flight mode: UNKNOWN"[0m              [1;30m# ship_operations_context.go:545 -> *shipOperationsContext[0m

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.096ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 1 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/player_repository.go:25 [35;1mrecord not found
[0m[33m[0.054ms] [34;1m[rows:0][0m SELECT * FROM `players` WHERE player_id = 2 ORDER BY `players`.`player_id` LIMIT 1

2025/11/15 16:02:58 [31;1m/home/user/spacetraders/gobot/internal/adapters/persistence/waypoint_repository.go:26 [35;1mrecord not found
[0m[33m[0.061ms] [34;1m[rows:0][0m SELECT * FROM `waypoints` WHERE waypoint_symbol = "X1-A1" AND system_symbol = "X1" ORDER BY `waypoints`.`waypoint_symbol` LIMIT 1

  [1;37mScenario:[0m Cannot set flight mode for ship belonging to different player                           [1;30m# features/application/set_flight_mode.feature:42[0m
    [32mGiven[0m [32ma ship "SHIP-1" for player 2 at "X1-A1" with status "IN_ORBIT"[0m                            [1;30m# ship_operations_context.go:524 -> *shipOperationsContext[0m
    [32mWhen[0m [32mI execute SetFlightModeCommand for ship "SHIP-1" and player 1 with mode "CRUISE"[0m           [1;30m# ship_operations_context.go:542 -> *shipOperationsContext[0m
    [32mThen[0m [32mthe flight mode command should fail with error "ship not found"[0m                            [1;30m# ship_operations_context.go:545 -> *shipOperationsContext[0m

[1;37mFeature:[0m API Client Integration with Circuit Breaker and Retries
  As a SpaceTraders API client
  I want circuit breaker, retry logic, and rate limiting to work together
  So that I have comprehensive error resilience

  [1;37mBackground:[0m
    [31mGiven[0m [31man API client with the following configuration:[0m [1;30m# api_adapter_steps.go:244 -> *apiAdapterContext[0m
      | [36mmax_retries[0m       | [36m3[0m   |
      | [36mbackoff_base[0m      | [36m1s[0m  |
      | [36mcircuit_threshold[0m | [36m5[0m   |
      | [36mcircuit_timeout[0m   | [36m60s[0m |
      | [36mrate_limit[0m        | [36m2/s[0m |
    [1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [1;37mScenario:[0m Circuit breaker wraps entire retry sequence   [1;30m# features/adapters/api/api_client_integration.feature:15[0m
    [33mGiven[0m [33mthe mock API always responds with status 503[0m
    [36mWhen[0m [36mI call GetShip with symbol "SHIP-1"[0m              [1;30m# api_adapter_steps.go:245 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should fail after max retries[0m        [1;30m# api_adapter_steps.go:246 -> *apiAdapterContext[0m
    [33mAnd[0m [33mexactly 4 HTTP attempts should have been made[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 1[0m     [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker state should be "CLOSED"[0m      [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit opens after multiple failed retry sequences [1;30m# features/adapters/api/api_client_integration.feature:23[0m
    [33mGiven[0m [33mthe mock API always responds with status 503[0m
    [33mWhen[0m [33mI make 5 consecutive API calls to GetShip[0m
    [33mThen[0m [33mall 5 requests should fail[0m
    [36mAnd[0m [36mthe circuit breaker state should be "OPEN"[0m              [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [33mAnd[0m [33m20 total HTTP attempts should have been made[0m

  [1;37mScenario:[0m Open circuit prevents retry attempts                            [1;30m# features/adapters/api/api_client_integration.feature:30[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN"[0m
    [36mWhen[0m [36mI call GetShip with symbol "SHIP-1"[0m                                [1;30m# api_adapter_steps.go:245 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail immediately with "circuit breaker is open"[0m
    [33mAnd[0m [33mno HTTP requests should be made[0m
    [33mAnd[0m [33mno retry attempts should occur[0m

  [1;37mScenario:[0m Successful requests reset circuit breaker failure count     [1;30m# features/adapters/api/api_client_integration.feature:37[0m
    [33mGiven[0m [33mthe mock API responds with status 503 for 2 attempts then 200[0m
    [33mWhen[0m [33mI make 10 consecutive API calls to GetShip[0m
    [33mThen[0m [33mall 10 requests should succeed[0m
    [36mAnd[0m [36mthe circuit breaker state should be "CLOSED"[0m                    [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                   [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Rate limiting applies to retry attempts                      [1;30m# features/adapters/api/api_client_integration.feature:45[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m503[0m    |
      | [36m2[0m       | [36m503[0m    |
      | [36m3[0m       | [36m200[0m    |
    [36mWhen[0m [36mI call GetShip with symbol "SHIP-1"[0m                             [1;30m# api_adapter_steps.go:245 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                      [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [33mAnd[0m [33mall retry attempts should respect rate limiting[0m
    [33mAnd[0m [33mthe total time should account for both backoff and rate limiting[0m

  [1;37mScenario:[0m Multiple concurrent requests with retries respect rate limit   [1;30m# features/adapters/api/api_client_integration.feature:56[0m
    [33mGiven[0m [33mthe mock API responds with status 503 for first attempt then 200[0m
    [33mWhen[0m [33mI make 5 concurrent API calls to GetShip[0m
    [33mThen[0m [33mall requests should succeed after 1 retry[0m
    [33mAnd[0m [33mthe requests should be throttled to 2 req/sec[0m
    [33mAnd[0m [33mthe circuit breaker should remain "CLOSED"[0m

  [1;37mScenario:[0m Open circuit prevents rate limiter from being used [1;30m# features/adapters/api/api_client_integration.feature:64[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN"[0m
    [33mWhen[0m [33mI make 100 rapid API calls to GetShip[0m
    [33mThen[0m [33mall 100 requests should fail immediately[0m
    [33mAnd[0m [33mthe rate limiter should not be invoked[0m
    [33mAnd[0m [33mno HTTP requests should be made[0m

  [1;37mScenario:[0m Circuit breaker state transitions don't affect rate limiting [1;30m# features/adapters/api/api_client_integration.feature:71[0m
    [33mGiven[0m [33mthe mock API always responds with status 503[0m
    [33mWhen[0m [33mI make 5 API calls to open the circuit[0m
    [36mThen[0m [36mthe circuit breaker state should be "OPEN"[0m                      [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI wait 61 seconds for circuit timeout[0m
    [33mAnd[0m [33mI make 2 rapid API calls[0m
    [33mThen[0m [33mthe calls should be rate limited[0m
    [33mAnd[0m [33mthe circuit breaker should attempt half-open state[0m

  [1;37mScenario:[0m Circuit breaker, retries, and rate limiting work harmoniously [1;30m# features/adapters/api/api_client_integration.feature:81[0m
    [33mGiven[0m [33mthe mock API is configured with intermittent failures:[0m
      | [36mrequest[0m | [36mattempt_1[0m | [36mattempt_2[0m | [36mattempt_3[0m |
      | [36m1[0m       | [36m503[0m       | [36m200[0m       | [36m[0m          |
      | [36m2[0m       | [36m200[0m       | [36m[0m          | [36m[0m          |
      | [36m3[0m       | [36m503[0m       | [36m503[0m       | [36m200[0m       |
      | [36m4[0m       | [36m200[0m       | [36m[0m          | [36m[0m          |
      | [36m5[0m       | [36m503[0m       | [36m200[0m       | [36m[0m          |
    [33mWhen[0m [33mI make 5 concurrent API calls to GetShip[0m
    [33mThen[0m [33mall 5 requests should eventually succeed[0m
    [33mAnd[0m [33mthe circuit breaker should remain "CLOSED"[0m
    [33mAnd[0m [33mrate limiting should be applied throughout[0m
    [33mAnd[0m [33mretry backoff should be applied for failed attempts[0m

  [1;37mScenario:[0m Non-retryable error does not count toward circuit breaker threshold [1;30m# features/adapters/api/api_client_integration.feature:96[0m
    [33mGiven[0m [33mthe mock API responds with status 404[0m
    [33mWhen[0m [33mI make 10 consecutive API calls to GetShip[0m
    [33mThen[0m [33mall 10 requests should fail immediately[0m
    [33mAnd[0m [33mno retry attempts should occur[0m
    [36mAnd[0m [36mthe circuit breaker state should be "CLOSED"[0m                            [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                           [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Context cancellation bypasses all resilience patterns    [1;30m# features/adapters/api/api_client_integration.feature:104[0m
    [33mGiven[0m [33mthe mock API has 5 second delay[0m
    [33mWhen[0m [33mI call GetShip with a context that times out after 1 second[0m
    [33mThen[0m [33mthe request should fail with context timeout[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m
    [33mAnd[0m [33mno retries should occur[0m

  [1;37mScenario:[0m Circuit recovery after timeout allows new requests [1;30m# features/adapters/api/api_client_integration.feature:111[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" from previous failures[0m
    [33mWhen[0m [33mI wait 61 seconds for circuit timeout[0m
    [33mAnd[0m [33mthe mock API is now responding with 200[0m
    [36mAnd[0m [36mI call GetShip with symbol "SHIP-1"[0m                    [1;30m# api_adapter_steps.go:245 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                            [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker state should be "CLOSED"[0m           [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m          [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Handling SpaceTraders API maintenance window     [1;30m# features/adapters/api/api_client_integration.feature:121[0m
    [33mGiven[0m [33mthe mock API responds with 503 for 2 minutes[0m
    [33mWhen[0m [33mI continuously attempt API calls during this period[0m
    [33mThen[0m [33mthe circuit breaker should open quickly[0m
    [33mAnd[0m [33msubsequent calls should fail fast[0m
    [33mWhen[0m [33mthe API recovers after 2 minutes[0m
    [33mAnd[0m [33mthe circuit timeout expires[0m
    [33mThen[0m [33mrequests should succeed again[0m
    [33mAnd[0m [33mthe circuit should close[0m

  [1;37mScenario:[0m Handling temporary network issues               [1;30m# features/adapters/api/api_client_integration.feature:131[0m
    [33mGiven[0m [33mthe mock API has intermittent connection failures[0m
    [33mWhen[0m [33mI make 20 API calls over 10 seconds[0m
    [33mThen[0m [33mmost requests should succeed after retries[0m
    [33mAnd[0m [33mthe circuit breaker should not open[0m
    [33mAnd[0m [33mrate limiting should prevent overwhelming the API[0m

  [1;37mScenario:[0m Handling rate limit errors with backoff                [1;30m# features/adapters/api/api_client_integration.feature:138[0m
    [33mGiven[0m [33mthe mock API responds with 429 and Retry-After 5 seconds[0m
    [36mWhen[0m [36mI call GetShip with symbol "SHIP-1"[0m                       [1;30m# api_adapter_steps.go:245 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should wait 5 seconds[0m
    [33mAnd[0m [33mretry the request[0m
    [33mAnd[0m [33meventually succeed[0m
    [33mAnd[0m [33mthe circuit breaker should remain "CLOSED"[0m

  [1;37mScenario:[0m Fast path for successful requests                    [1;30m# features/adapters/api/api_client_integration.feature:147[0m
    [33mGiven[0m [33mthe mock API responds immediately with 200[0m
    [33mWhen[0m [33mI make 100 sequential API calls[0m
    [33mThen[0m [33mall requests should succeed[0m
    [33mAnd[0m [33maverage latency should be under 10ms (excluding network)[0m
    [33mAnd[0m [33mthe circuit breaker should add minimal overhead[0m
    [33mAnd[0m [33mthe rate limiter should throttle appropriately[0m

  [1;37mScenario:[0m Metrics and observability                      [1;30m# features/adapters/api/api_client_integration.feature:155[0m
    [33mGiven[0m [33mI have made various API calls with mixed results[0m
    [33mWhen[0m [33mI query the API client metrics[0m
    [33mThen[0m [33mI should see:[0m
      | [36mmetric[0m                   | [36mvalue[0m |
      | [36mtotal_requests[0m           | [36m>0[0m    |
      | [36msuccessful_requests[0m      | [36m>0[0m    |
      | [36mfailed_requests[0m          | [36m>=0[0m   |
      | [36mcircuit_breaker_state[0m    | [36m-[0m     |
      | [36mcircuit_breaker_failures[0m | [36m-[0m     |
      | [36mretry_attempts[0m           | [36m>=0[0m   |
      | [36mrate_limited_wait_time[0m   | [36m>=0[0m   |

[1;37mFeature:[0m Circuit Breaker Pattern
  As a SpaceTraders API client
  I want circuit breaker protection
  So that I don't overwhelm a failing API and allow time for recovery

  [1;37mBackground:[0m
    [31mGiven[0m [31ma circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# api_adapter_steps.go:224 -> *apiAdapterContext[0m
    [1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [1;37mScenario:[0m Circuit starts in closed state                             [1;30m# features/adapters/api/circuit_breaker.feature:10[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                  [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                  [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit opens after max consecutive failures               [1;30m# features/adapters/api/circuit_breaker.feature:14[0m
    [36mGiven[0m [36mthe circuit breaker is in "CLOSED" state[0m                     [1;30m# api_adapter_steps.go:225 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI execute 5 failing operations through the circuit breaker[0m    [1;30m# api_adapter_steps.go:226 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe circuit breaker state should be "OPEN"[0m                    [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 5[0m                  [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit remains open within timeout period                        [1;30m# features/adapters/api/circuit_breaker.feature:20[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" with last failure 30 seconds ago[0m
    [33mWhen[0m [33mI attempt to execute an operation through the circuit breaker[0m
    [33mThen[0m [33mthe operation should fail immediately with "circuit breaker is open"[0m
    [33mAnd[0m [33mthe circuit breaker state should still be "OPEN"[0m

  [1;37mScenario:[0m Circuit transitions to half-open after timeout expires       [1;30m# features/adapters/api/circuit_breaker.feature:26[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" with last failure 61 seconds ago[0m
    [33mWhen[0m [33mI execute a successful operation through the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                    [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                    [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Failure in half-open state reopens circuit                   [1;30m# features/adapters/api/circuit_breaker.feature:32[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" with last failure 61 seconds ago[0m
    [33mWhen[0m [33mI execute a failing operation through the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "OPEN"[0m                      [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 1[0m                    [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Success in half-open state closes circuit                    [1;30m# features/adapters/api/circuit_breaker.feature:38[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" with last failure 61 seconds ago[0m
    [33mWhen[0m [33mI execute a successful operation through the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                    [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                    [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit does not open with non-consecutive failures         [1;30m# features/adapters/api/circuit_breaker.feature:45[0m
    [36mGiven[0m [36mthe circuit breaker is in "CLOSED" state[0m                      [1;30m# api_adapter_steps.go:225 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI execute 3 failing operations through the circuit breaker[0m     [1;30m# api_adapter_steps.go:226 -> *apiAdapterContext[0m
    [33mAnd[0m [33mI execute 1 successful operation through the circuit breaker[0m
    [33mAnd[0m [33mI execute 3 more failing operations through the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                   [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 3[0m                   [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Manual reset closes circuit and clears failures            [1;30m# features/adapters/api/circuit_breaker.feature:53[0m
    [33mGiven[0m [33mthe circuit breaker is "OPEN" with 5 failures[0m
    [33mWhen[0m [33mI manually reset the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                  [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 0[0m                  [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit breaker tracks state transitions correctly         [1;30m# features/adapters/api/circuit_breaker.feature:59[0m
    [36mGiven[0m [36mthe circuit breaker is in "CLOSED" state[0m                     [1;30m# api_adapter_steps.go:225 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI execute 5 failing operations through the circuit breaker[0m    [1;30m# api_adapter_steps.go:226 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe circuit breaker state should be "OPEN"[0m                    [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI wait 61 seconds[0m
    [33mAnd[0m [33mI execute 1 successful operation through the circuit breaker[0m
    [36mThen[0m [36mthe circuit breaker state should be "CLOSED"[0m                  [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Circuit breaker prevents cascading failures                  [1;30m# features/adapters/api/circuit_breaker.feature:67[0m
    [36mGiven[0m [36mthe circuit breaker is in "CLOSED" state[0m                       [1;30m# api_adapter_steps.go:225 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI execute 5 failing operations through the circuit breaker[0m      [1;30m# api_adapter_steps.go:226 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe circuit breaker state should be "OPEN"[0m                      [1;30m# api_adapter_steps.go:227 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI attempt to execute 100 operations through the circuit breaker[0m
    [33mThen[0m [33mall 100 operations should fail immediately[0m
    [36mAnd[0m [36mthe circuit breaker failure count should be 5[0m                    [1;30m# api_adapter_steps.go:228 -> *apiAdapterContext[0m

[1;37mFeature:[0m Rate Limiting
  As a SpaceTraders API client
  I want automatic rate limiting
  So that I respect the API's 2 requests/second limit and avoid 429 errors

  [1;37mBackground:[0m
    [31mGiven[0m [31ma rate limiter with limit 2 requests per second and burst 2[0m [1;30m# api_adapter_steps.go:238 -> *apiAdapterContext[0m
    [1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [1;37mScenario:[0m Allow burst of requests within limit                      [1;30m# features/adapters/api/rate_limiting.feature:10[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make 2 API requests simultaneously[0m                         [1;30m# api_adapter_steps.go:240 -> *apiAdapterContext[0m
    [36mThen[0m [36mboth requests should proceed immediately[0m                     [1;30m# api_adapter_steps.go:241 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthe rate limiter should have 0 tokens available[0m

  [1;37mScenario:[0m Throttle third request in same second                     [1;30m# features/adapters/api/rate_limiting.feature:16[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make 2 API requests at time 0ms[0m
    [33mAnd[0m [33mI make 1 API request at time 100ms[0m
    [33mThen[0m [33mthe first 2 requests should proceed immediately[0m
    [33mAnd[0m [33mthe third request should be delayed[0m

  [1;37mScenario:[0m Rate limiter refills after 1 second                       [1;30m# features/adapters/api/rate_limiting.feature:23[0m
    [33mGiven[0m [33mI made 2 requests 1 second ago[0m
    [33mAnd[0m [33mthe rate limiter has refilled[0m
    [33mWhen[0m [33mI make 2 new API requests[0m
    [36mThen[0m [36mboth requests should proceed immediately[0m                     [1;30m# api_adapter_steps.go:241 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Multiple concurrent requests respect rate limit           [1;30m# features/adapters/api/rate_limiting.feature:30[0m
    [33mWhen[0m [33mI make 5 concurrent API requests[0m
    [33mThen[0m [33mrequests 1-2 should proceed immediately[0m
    [33mAnd[0m [33mrequests 3-5 should be queued and throttled[0m
    [33mAnd[0m [33mall 5 requests should eventually complete[0m

  [1;37mScenario:[0m Rate limiter is thread-safe under concurrent load         [1;30m# features/adapters/api/rate_limiting.feature:36[0m
    [33mWhen[0m [33mI make 100 concurrent API requests from multiple goroutines[0m
    [33mThen[0m [33mall requests should eventually complete[0m
    [33mAnd[0m [33mthe rate should never exceed 2 requests per second[0m

  [1;37mScenario:[0m Burst allows immediate requests up to burst size          [1;30m# features/adapters/api/rate_limiting.feature:42[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make 2 requests at exactly the same time[0m
    [33mThen[0m [33mboth requests should proceed without delay[0m
    [33mAnd[0m [33mthe rate limiter tokens should be 0[0m

  [1;37mScenario:[0m Tokens refill at specified rate                           [1;30m# features/adapters/api/rate_limiting.feature:48[0m
    [33mGiven[0m [33mthe rate limiter is empty[0m
    [33mWhen[0m [33mI wait 1 second[0m
    [33mThen[0m [33mthe rate limiter should have 2 tokens available[0m

  [1;37mScenario:[0m Tokens do not exceed burst capacity                       [1;30m# features/adapters/api/rate_limiting.feature:53[0m
    [33mGiven[0m [33mthe rate limiter is empty[0m
    [33mWhen[0m [33mI wait 10 seconds[0m
    [33mThen[0m [33mthe rate limiter should have 2 tokens available[0m
    [33mAnd[0m [33mtokens should not exceed the burst size[0m

  [1;37mScenario:[0m Single request does not get throttled                     [1;30m# features/adapters/api/rate_limiting.feature:60[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make 1 API request[0m
    [33mThen[0m [33mthe request should proceed immediately[0m

  [1;37mScenario:[0m Requests spread over time do not trigger throttling       [1;30m# features/adapters/api/rate_limiting.feature:65[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make a request at time 0s[0m
    [33mAnd[0m [33mI make a request at time 1s[0m
    [33mAnd[0m [33mI make a request at time 2s[0m
    [33mThen[0m [33mall 3 requests should proceed immediately[0m

  [1;37mScenario:[0m Rate limiter allows sustained rate of 2 req/sec           [1;30m# features/adapters/api/rate_limiting.feature:72[0m
    [33mWhen[0m [33mI make requests at times [0s, 0s, 1s, 1s, 2s, 2s, 3s, 3s][0m
    [33mThen[0m [33mall 8 requests should complete[0m
    [33mAnd[0m [33mtotal execution time should be approximately 3 seconds[0m

  [1;37mScenario:[0m Waiting request is cancelled when context is cancelled    [1;30m# features/adapters/api/rate_limiting.feature:78[0m
    [33mGiven[0m [33mthe rate limiter is empty[0m
    [33mWhen[0m [33mI make a request with a cancellable context[0m
    [33mAnd[0m [33mI cancel the context while waiting for rate limiter[0m
    [33mThen[0m [33mthe request should fail with context cancelled error[0m
    [33mAnd[0m [33mno API call should be made[0m

  [1;37mScenario:[0m Rate limiter prevents bursting beyond API limits          [1;30m# features/adapters/api/rate_limiting.feature:86[0m
    [33mGiven[0m [33man API client with rate limiting enabled[0m
    [33mWhen[0m [33mI make 10 rapid requests to get ship data[0m
    [33mThen[0m [33mthe requests should be spread over at least 4 seconds[0m
    [33mAnd[0m [33mno 429 rate limit errors should occur[0m

  [1;37mScenario:[0m Rate limiter works with retry logic                       [1;30m# features/adapters/api/rate_limiting.feature:92[0m
    [33mGiven[0m [33man API client with rate limiting and retry enabled[0m
    [33mAnd[0m [33mthe API returns 503 for first 2 attempts[0m
    [33mWhen[0m [33mI make a request to get ship "SHIP-1"[0m
    [33mThen[0m [33mthe request should succeed after retries[0m
    [33mAnd[0m [33mall retry attempts should also respect rate limiting[0m

  [1;37mScenario:[0m Rate limiter has minimal overhead for allowed requests    [1;30m# features/adapters/api/rate_limiting.feature:100[0m
    [36mGiven[0m [36mthe rate limiter has full capacity[0m                          [1;30m# api_adapter_steps.go:239 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make 2 requests with timing measurement[0m
    [33mThen[0m [33meach request should have less than 1ms rate limiter overhead[0m

  [1;37mScenario:[0m Rate limiter accurately delays throttled requests         [1;30m# features/adapters/api/rate_limiting.feature:105[0m
    [33mGiven[0m [33mthe rate limiter is empty[0m
    [33mWhen[0m [33mI make a request and measure wait time[0m
    [33mThen[0m [33mthe wait time should be approximately 500ms[0m
    [33mAnd[0m [33mthe request should then proceed[0m

  [1;37mScenario:[0m Rate limiter validates positive rate                      [1;30m# features/adapters/api/rate_limiting.feature:112[0m
    [33mWhen[0m [33mI create a rate limiter with rate 0[0m
    [33mThen[0m [33mcreation should fail with "rate must be positive"[0m

  [1;37mScenario:[0m Rate limiter validates positive burst                     [1;30m# features/adapters/api/rate_limiting.feature:116[0m
    [33mWhen[0m [33mI create a rate limiter with burst 0[0m
    [33mThen[0m [33mcreation should fail with "burst must be positive"[0m

[1;37mFeature:[0m Exponential Backoff Retry Logic
  As a SpaceTraders API client
  I want automatic retries with exponential backoff
  So that transient failures don't cause permanent errors

  [1;37mBackground:[0m
    [31mGiven[0m [31man API client with max retries 3 and initial backoff 1 second[0m [1;30m# api_adapter_steps.go:231 -> *apiAdapterContext[0m
    [1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [1;37mScenario:[0m Request succeeds on first attempt                           [1;30m# features/adapters/api/retry_logic.feature:10[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 200[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Request succeeds on second attempt after transient failure  [1;30m# features/adapters/api/retry_logic.feature:16[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m503[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 2 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthere should be 1 retry attempt[0m

  [1;37mScenario:[0m Request succeeds on third attempt with exponential backoff  [1;30m# features/adapters/api/retry_logic.feature:26[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m503[0m    |
      | [36m2[0m       | [36m503[0m    |
      | [36m3[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 3 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthere should be 2 retry attempts[0m

  [1;37mScenario:[0m Retry on 429 Too Many Requests                              [1;30m# features/adapters/api/retry_logic.feature:38[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m429[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 2 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Retry on 500 Internal Server Error                          [1;30m# features/adapters/api/retry_logic.feature:47[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m500[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Retry on 502 Bad Gateway                                    [1;30m# features/adapters/api/retry_logic.feature:55[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m502[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Retry on 503 Service Unavailable                            [1;30m# features/adapters/api/retry_logic.feature:63[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m503[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Retry on 504 Gateway Timeout                                [1;30m# features/adapters/api/retry_logic.feature:71[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m504[0m    |
      | [36m2[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on 400 Bad Request                             [1;30m# features/adapters/api/retry_logic.feature:80[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 400[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make an API request to get ship "INVALID"[0m                    [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "status 400"[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on 401 Unauthorized                            [1;30m# features/adapters/api/retry_logic.feature:86[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 401[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "status 401"[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on 403 Forbidden                               [1;30m# features/adapters/api/retry_logic.feature:92[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 403[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "status 403"[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on 404 Not Found                               [1;30m# features/adapters/api/retry_logic.feature:98[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 404[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [36mWhen[0m [36mI make an API request to get ship "NONEXISTENT"[0m                [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "status 404"[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on 409 Conflict                                [1;30m# features/adapters/api/retry_logic.feature:104[0m
    [36mGiven[0m [36mthe mock API is configured to respond with status 409[0m         [1;30m# api_adapter_steps.go:232 -> *apiAdapterContext[0m
    [33mWhen[0m [33mI make an API request to navigate ship "SHIP-1"[0m
    [33mThen[0m [33mthe request should fail with error containing "status 409"[0m
    [36mAnd[0m [36mexactly 1 HTTP request should have been made[0m                    [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Fail after max retries exceeded                             [1;30m# features/adapters/api/retry_logic.feature:111[0m
    [33mGiven[0m [33mthe mock API is configured to always respond with status 503[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "max retries"[0m
    [36mAnd[0m [36mexactly 4 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Exponential backoff delays increase correctly                       [1;30m# features/adapters/api/retry_logic.feature:117[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m |
      | [36m1[0m       | [36m503[0m    |
      | [36m2[0m       | [36m503[0m    |
      | [36m3[0m       | [36m503[0m    |
      | [36m4[0m       | [36m200[0m    |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                             [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                             [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthe retry delays should follow exponential backoff pattern [1s, 2s, 4s][0m

  [1;37mScenario:[0m Retry on connection refused                                 [1;30m# features/adapters/api/retry_logic.feature:129[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mbehavior[0m           |
      | [36m1[0m       | [36mconnection_refused[0m |
      | [36m2[0m       | [36m200[0m                |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 2 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Retry on timeout                                            [1;30m# features/adapters/api/retry_logic.feature:138[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mbehavior[0m |
      | [36m1[0m       | [36mtimeout[0m  |
      | [36m2[0m       | [36m200[0m      |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [36mAnd[0m [36mexactly 2 HTTP requests should have been made[0m                   [1;30m# api_adapter_steps.go:235 -> *apiAdapterContext[0m

  [1;37mScenario:[0m Do not retry on context cancelled                           [1;30m# features/adapters/api/retry_logic.feature:147[0m
    [33mGiven[0m [33mthe mock API is configured to always respond with status 503[0m
    [33mAnd[0m [33mthe request context will be cancelled after 1 attempt[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [33mThen[0m [33mthe request should fail with error containing "context"[0m
    [33mAnd[0m [33mat most 1 HTTP request should have been made[0m

  [1;37mScenario:[0m Respect Retry-After header on 429 response                  [1;30m# features/adapters/api/retry_logic.feature:155[0m
    [33mGiven[0m [33mthe mock API is configured to:[0m
      | [36mattempt[0m | [36mstatus[0m | [36mretry_after[0m |
      | [36m1[0m       | [36m429[0m    | [36m5[0m           |
      | [36m2[0m       | [36m200[0m    | [36m[0m            |
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                     [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                     [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthe retry delay should be 5 seconds[0m

  [1;37mScenario:[0m Use exponential backoff when Retry-After is not provided                [1;30m# features/adapters/api/retry_logic.feature:164[0m
    [33mGiven[0m [33mthe mock API is configured to respond with status 429 without Retry-After[0m
    [33mAnd[0m [33mthen respond with status 200[0m
    [36mWhen[0m [36mI make an API request to get ship "SHIP-1"[0m                                 [1;30m# api_adapter_steps.go:233 -> *apiAdapterContext[0m
    [36mThen[0m [36mthe request should succeed[0m                                                 [1;30m# api_adapter_steps.go:234 -> *apiAdapterContext[0m
    [33mAnd[0m [33mthe retry delay should be 1 second[0m

[1;37mFeature:[0m Market Repository Persistence
  As a persistence layer
  I need to store and retrieve market data from the database
  So that the application can cache market information efficiently

  [1;37mBackground:[0m
    [32mGiven[0m [32ma clean test database[0m                           [1;30m# market_repository_steps.go:38 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma market repository instance[0m                      [1;30m# market_repository_steps.go:39 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Upsert market data for the first time         [1;30m# features/adapters/persistence/market_repository.feature:10[0m
    [32mGiven[0m [32ma player with ID 1[0m                              [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-TEST-A1"[0m                           [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data with 3 trade goods:[0m                   [1;30m# market_repository_steps.go:44 -> *MarketRepositoryContext[0m
      | [36mSymbol[0m     | [36mSupply[0m   | [36mActivity[0m | [36mPurchasePrice[0m | [36mSellPrice[0m | [36mTradeVolume[0m |
      | [36mIRON_ORE[0m   | [36mMODERATE[0m | [36mSTRONG[0m   | [36m100[0m           | [36m150[0m       | [36m500[0m         |
      | [36mCOPPER_ORE[0m | [36mHIGH[0m     | [36mGROWING[0m  | [36m80[0m            | [36m120[0m       | [36m300[0m         |
      | [36mALUMINUM[0m   | [36mLIMITED[0m  | [36mWEAK[0m     | [36m200[0m           | [36m250[0m       | [36m100[0m         |
    [32mWhen[0m [32mI upsert the market data[0m                         [1;30m# market_repository_steps.go:52 -> *MarketRepositoryContext[0m
    [32mThen[0m [32mthe market data should be persisted successfully[0m [1;30m# market_repository_steps.go:59 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe database should contain 1 market record[0m       [1;30m# market_repository_steps.go:60 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe database should contain 3 trade goods records[0m [1;30m# market_repository_steps.go:61 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Upsert market data updates existing record      [1;30m# features/adapters/persistence/market_repository.feature:23[0m
    [32mGiven[0m [32ma player with ID 1[0m                                [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-TEST-A1"[0m                             [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mexisting market data with 2 trade goods:[0m            [1;30m# market_repository_steps.go:46 -> *MarketRepositoryContext[0m
      | [36mSymbol[0m     | [36mSupply[0m   | [36mActivity[0m | [36mPurchasePrice[0m | [36mSellPrice[0m | [36mTradeVolume[0m |
      | [36mIRON_ORE[0m   | [36mMODERATE[0m | [36mSTRONG[0m   | [36m100[0m           | [36m150[0m       | [36m500[0m         |
      | [36mCOPPER_ORE[0m | [36mHIGH[0m     | [36mGROWING[0m  | [36m80[0m            | [36m120[0m       | [36m300[0m         |
    [32mAnd[0m [32mthe market data is already persisted[0m                [1;30m# market_repository_steps.go:47 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI upsert new market data with 3 trade goods:[0m       [1;30m# market_repository_steps.go:53 -> *MarketRepositoryContext[0m
      | [36mSymbol[0m   | [36mSupply[0m  | [36mActivity[0m | [36mPurchasePrice[0m | [36mSellPrice[0m | [36mTradeVolume[0m |
      | [36mIRON_ORE[0m | [36mHIGH[0m    | [36mSTRONG[0m   | [36m110[0m           | [36m160[0m       | [36m600[0m         |
      | [36mGOLD[0m     | [36mSCARCE[0m  | [36mWEAK[0m     | [36m500[0m           | [36m700[0m       | [36m50[0m          |
      | [36mSILVER[0m   | [36mLIMITED[0m | [36mGROWING[0m  | [36m300[0m           | [36m400[0m       | [36m150[0m         |
    [32mThen[0m [32mthe market data should be persisted successfully[0m   [1;30m# market_repository_steps.go:59 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe database should contain 1 market record[0m         [1;30m# market_repository_steps.go:60 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe database should contain 3 trade goods records[0m   [1;30m# market_repository_steps.go:61 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe trade goods should be updated to the new values[0m [1;30m# market_repository_steps.go:62 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Get market data by waypoint                                          [1;30m# features/adapters/persistence/market_repository.feature:41[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                     [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-TEST-A1"[0m                                                  [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mexisting market data with 2 trade goods:[0m                                 [1;30m# market_repository_steps.go:46 -> *MarketRepositoryContext[0m
      | [36mSymbol[0m     | [36mSupply[0m   | [36mActivity[0m | [36mPurchasePrice[0m | [36mSellPrice[0m | [36mTradeVolume[0m |
      | [36mIRON_ORE[0m   | [36mMODERATE[0m | [36mSTRONG[0m   | [36m100[0m           | [36m150[0m       | [36m500[0m         |
      | [36mCOPPER_ORE[0m | [36mHIGH[0m     | [36mGROWING[0m  | [36m80[0m            | [36m120[0m       | [36m300[0m         |
    [32mAnd[0m [32mthe market data is already persisted[0m                                     [1;30m# market_repository_steps.go:47 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI get market data for player 1 and waypoint "X1-TEST-A1"[0m                [1;30m# market_repository_steps.go:54 -> *MarketRepositoryContext[0m
    [32mThen[0m [32mthe market should be retrieved successfully[0m                             [1;30m# market_repository_steps.go:63 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe market should have waypoint "X1-TEST-A1"[0m                             [1;30m# market_repository_steps.go:64 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe retrieved market should have 2 trade goods[0m                           [1;30m# market_repository_steps.go:65 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe market should contain trade good "IRON_ORE" with purchase price 100[0m  [1;30m# market_repository_steps.go:66 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe market should contain trade good "COPPER_ORE" with purchase price 80[0m [1;30m# market_repository_steps.go:66 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Get non-existent market data returns nil                  [1;30m# features/adapters/persistence/market_repository.feature:56[0m
    [32mGiven[0m [32ma player with ID 1[0m                                          [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-NONEXISTENT"[0m                                   [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI get market data for player 1 and waypoint "X1-NONEXISTENT"[0m [1;30m# market_repository_steps.go:54 -> *MarketRepositoryContext[0m
    [32mThen[0m [32mthe market should be nil[0m                                     [1;30m# market_repository_steps.go:67 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthere should be no error[0m                                      [1;30m# market_repository_steps.go:68 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m List markets in system with fresh data                               [1;30m# features/adapters/persistence/market_repository.feature:63[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                     [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe following markets in system "X1-TEST":[0m                               [1;30m# market_repository_steps.go:48 -> *MarketRepositoryContext[0m
      | [36mWaypoint[0m   | [36mTradeGoodsCount[0m | [36mAgeMinutes[0m |
      | [36mX1-TEST-A1[0m | [36m2[0m               | [36m5[0m          |
      | [36mX1-TEST-B2[0m | [36m3[0m               | [36m10[0m         |
      | [36mX1-TEST-C3[0m | [36m1[0m               | [36m15[0m         |
    [32mWhen[0m [32mI list markets for player 1 in system "X1-TEST" with max age 20 minutes[0m [1;30m# market_repository_steps.go:55 -> *MarketRepositoryContext[0m
    [32mThen[0m [32m3 markets should be returned[0m                                            [1;30m# market_repository_steps.go:69 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should include "X1-TEST-A1"[0m                                  [1;30m# market_repository_steps.go:70 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should include "X1-TEST-B2"[0m                                  [1;30m# market_repository_steps.go:70 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should include "X1-TEST-C3"[0m                                  [1;30m# market_repository_steps.go:70 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m List markets in system filters stale data                            [1;30m# features/adapters/persistence/market_repository.feature:76[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                     [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe following markets in system "X1-TEST":[0m                               [1;30m# market_repository_steps.go:48 -> *MarketRepositoryContext[0m
      | [36mWaypoint[0m   | [36mTradeGoodsCount[0m | [36mAgeMinutes[0m |
      | [36mX1-TEST-A1[0m | [36m2[0m               | [36m5[0m          |
      | [36mX1-TEST-B2[0m | [36m3[0m               | [36m25[0m         |
      | [36mX1-TEST-C3[0m | [36m1[0m               | [36m40[0m         |
    [32mWhen[0m [32mI list markets for player 1 in system "X1-TEST" with max age 20 minutes[0m [1;30m# market_repository_steps.go:55 -> *MarketRepositoryContext[0m
    [32mThen[0m [32m1 markets should be returned[0m                                            [1;30m# market_repository_steps.go:69 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should include "X1-TEST-A1"[0m                                  [1;30m# market_repository_steps.go:70 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should not include "X1-TEST-B2"[0m                              [1;30m# market_repository_steps.go:71 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mthe markets should not include "X1-TEST-C3"[0m                              [1;30m# market_repository_steps.go:71 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m List markets in empty system returns empty list                       [1;30m# features/adapters/persistence/market_repository.feature:89[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                      [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI list markets for player 1 in system "X1-EMPTY" with max age 20 minutes[0m [1;30m# market_repository_steps.go:55 -> *MarketRepositoryContext[0m
    [32mThen[0m [32m0 markets should be returned[0m                                             [1;30m# market_repository_steps.go:69 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Upsert with empty trade goods list            [1;30m# features/adapters/persistence/market_repository.feature:94[0m
    [32mGiven[0m [32ma player with ID 1[0m                              [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-TEST-A1"[0m                           [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data with 0 trade goods[0m                    [1;30m# market_repository_steps.go:45 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI upsert the market data[0m                         [1;30m# market_repository_steps.go:52 -> *MarketRepositoryContext[0m
    [32mThen[0m [32mthe market data should be persisted successfully[0m [1;30m# market_repository_steps.go:59 -> *MarketRepositoryContext[0m
    [31mAnd[0m [31mthe database should contain 1 market record[0m       [1;30m# market_repository_steps.go:60 -> *MarketRepositoryContext[0m
    [1;31mexpected 1 market records, got 0[0m
    [36mAnd[0m [36mthe database should contain 0 trade goods records[0m [1;30m# market_repository_steps.go:61 -> *MarketRepositoryContext[0m

  [1;37mScenario:[0m Different players can have separate market data for same waypoint [1;30m# features/adapters/persistence/market_repository.feature:103[0m
    [32mGiven[0m [32ma player with ID 1[0m                                                  [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma player with ID 2[0m                                                    [1;30m# market_repository_steps.go:42 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32ma waypoint "X1-TEST-A1"[0m                                               [1;30m# market_repository_steps.go:43 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data for player 1 with 2 trade goods[0m                           [1;30m# market_repository_steps.go:49 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mmarket data for player 2 with 3 trade goods[0m                           [1;30m# market_repository_steps.go:49 -> *MarketRepositoryContext[0m
    [32mWhen[0m [32mI upsert market data for both players[0m                                [1;30m# market_repository_steps.go:56 -> *MarketRepositoryContext[0m
    [32mThen[0m [32mplayer 1 should have 2 trade goods for waypoint "X1-TEST-A1"[0m         [1;30m# market_repository_steps.go:72 -> *MarketRepositoryContext[0m
    [32mAnd[0m [32mplayer 2 should have 3 trade goods for waypoint "X1-TEST-A1"[0m          [1;30m# market_repository_steps.go:72 -> *MarketRepositoryContext[0m

[1;37mFeature:[0m Waypoint Caching
  As the waypoint repository
  I want to cache waypoint data with TTL and filtering capabilities
  So that I can minimize API calls and support efficient waypoint discovery

  [1;37mBackground:[0m
    [32mGiven[0m [32mthe database is initialized[0m                          [1;30m# waypoint_cache_steps.go:47 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Save single waypoint to database                   [1;30m# features/infrastructure/waypoint_cache.feature:9[0m
    [32mWhen[0m [32mI save waypoint "X1-GZ7-A1" for system "X1-GZ7" with:[0m [1;30m# waypoint_cache_steps.go:54 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
    [32mThen[0m [32mthe waypoint should be saved in the database[0m          [1;30m# waypoint_cache_steps.go:64 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" should exist in the database[0m      [1;30m# waypoint_cache_steps.go:65 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Save multiple waypoints for a system (batch insert)  [1;30m# features/infrastructure/waypoint_cache.feature:16[0m
    [32mWhen[0m [32mI save waypoints for system "X1-GZ7" with:[0m              [1;30m# waypoint_cache_steps.go:55 -> *WaypointCacheContext[0m
      | [36msymbol[0m     | [36mtype[0m    | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m | [36morbitals[0m   |
      | [36mX1-GZ7-A1[0m  | [36mPLANET[0m  | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     | [36mX1-GZ7-A1Z[0m |
      | [36mX1-GZ7-A1Z[0m | [36mORBITAL[0m | [36m10.0[0m | [36m5.0[0m | [36m[0m                | [36mfalse[0m    | [36m[0m           |
      | [36mX1-GZ7-B2[0m  | [36mMOON[0m    | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m     | [36mfalse[0m    | [36m[0m           |
    [32mThen[0m [32mall waypoints should be saved in the database[0m           [1;30m# waypoint_cache_steps.go:66 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe database should have 3 waypoints for system "X1-GZ7"[0m [1;30m# waypoint_cache_steps.go:67 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Retrieve cached waypoint by symbol                              [1;30m# features/infrastructure/waypoint_cache.feature:25[0m
    [32mGiven[0m [32mwaypoint "X1-GZ7-A1" exists in database for system "X1-GZ7" with:[0m [1;30m# waypoint_cache_steps.go:50 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
    [32mWhen[0m [32mI query waypoint "X1-GZ7-A1" from system "X1-GZ7"[0m                  [1;30m# waypoint_cache_steps.go:56 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive the waypoint[0m                                      [1;30m# waypoint_cache_steps.go:68 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint should have type "PLANET"[0m                              [1;30m# waypoint_cache_steps.go:69 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint should have coordinates (10.0, 5.0)[0m                    [1;30m# waypoint_cache_steps.go:70 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint should have traits "SHIPYARD,MARKET"[0m                   [1;30m# waypoint_cache_steps.go:71 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint should have fuel available[0m                             [1;30m# waypoint_cache_steps.go:72 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m List all waypoints in a system                 [1;30m# features/infrastructure/waypoint_cache.feature:36[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m     | [36mtype[0m    | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m  | [36mPLANET[0m  | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
      | [36mX1-GZ7-A1Z[0m | [36mORBITAL[0m | [36m10.0[0m | [36m5.0[0m | [36m[0m                | [36mfalse[0m    |
      | [36mX1-GZ7-B2[0m  | [36mMOON[0m    | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m     | [36mfalse[0m    |
    [32mWhen[0m [32mI list waypoints for system "X1-GZ7"[0m              [1;30m# waypoint_cache_steps.go:57 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 3 waypoints[0m                      [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1"[0m       [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1Z"[0m      [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-B2"[0m       [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Filter waypoints by trait (SHIPYARD)                    [1;30m# features/infrastructure/waypoint_cache.feature:48[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m          [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m     | [36mtype[0m    | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m  | [36mPLANET[0m  | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
      | [36mX1-GZ7-A1Z[0m | [36mORBITAL[0m | [36m10.0[0m | [36m5.0[0m | [36m[0m                | [36mfalse[0m    |
      | [36mX1-GZ7-B2[0m  | [36mMOON[0m    | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m     | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" by trait "SHIPYARD"[0m [1;30m# waypoint_cache_steps.go:58 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 1 waypoint[0m                                [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1"[0m                [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Filter waypoints by trait (MARKETPLACE)                    [1;30m# features/infrastructure/waypoint_cache.feature:58[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m             [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m    | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m               | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKETPLACE[0m | [36mtrue[0m     |
      | [36mX1-GZ7-B2[0m | [36mMOON[0m   | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m          | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" by trait "MARKETPLACE"[0m [1;30m# waypoint_cache_steps.go:58 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 2 waypoints[0m                                  [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1"[0m                   [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-B2"[0m                   [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Filter waypoints by type (PLANET)                    [1;30m# features/infrastructure/waypoint_cache.feature:68[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m       [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m     | [36mtype[0m    | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m  | [36mPLANET[0m  | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
      | [36mX1-GZ7-A1Z[0m | [36mORBITAL[0m | [36m10.0[0m | [36m5.0[0m | [36m[0m                | [36mfalse[0m    |
      | [36mX1-GZ7-B2[0m  | [36mMOON[0m    | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m     | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" by type "PLANET"[0m [1;30m# waypoint_cache_steps.go:59 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 1 waypoint[0m                             [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1"[0m             [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Filter waypoints by has_fuel flag                       [1;30m# features/infrastructure/waypoint_cache.feature:78[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m          [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m     | [36mtype[0m    | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m  | [36mPLANET[0m  | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
      | [36mX1-GZ7-A1Z[0m | [36mORBITAL[0m | [36m10.0[0m | [36m5.0[0m | [36m[0m                | [36mfalse[0m    |
      | [36mX1-GZ7-B2[0m  | [36mMOON[0m    | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m     | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" with fuel available[0m [1;30m# waypoint_cache_steps.go:60 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 1 waypoint[0m                                [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mthe waypoint list should contain "X1-GZ7-A1"[0m                [1;30m# waypoint_cache_steps.go:74 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Return empty list when no waypoints match trait filter  [1;30m# features/infrastructure/waypoint_cache.feature:88[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m          [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m    | [36mtype[0m | [36mx[0m    | [36my[0m   | [36mtraits[0m      | [36mhas_fuel[0m |
      | [36mX1-GZ7-B2[0m | [36mMOON[0m | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" by trait "SHIPYARD"[0m [1;30m# waypoint_cache_steps.go:58 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 0 waypoints[0m                               [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Return empty list when no waypoints match type filter [1;30m# features/infrastructure/waypoint_cache.feature:95[0m
    [32mGiven[0m [32mwaypoints exist in database for system "X1-GZ7":[0m        [1;30m# waypoint_cache_steps.go:51 -> *WaypointCacheContext[0m
      | [36msymbol[0m    | [36mtype[0m | [36mx[0m    | [36my[0m   | [36mtraits[0m      | [36mhas_fuel[0m |
      | [36mX1-GZ7-B2[0m | [36mMOON[0m | [36m-5.0[0m | [36m8.0[0m | [36mMARKETPLACE[0m | [36mfalse[0m    |
    [32mWhen[0m [32mI filter waypoints for system "X1-GZ7" by type "PLANET"[0m  [1;30m# waypoint_cache_steps.go:59 -> *WaypointCacheContext[0m
    [32mThen[0m [32mI should receive 0 waypoints[0m                             [1;30m# waypoint_cache_steps.go:73 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Upsert waypoint (update existing with new data)                 [1;30m# features/infrastructure/waypoint_cache.feature:102[0m
    [32mGiven[0m [32mwaypoint "X1-GZ7-A1" exists in database for system "X1-GZ7" with:[0m [1;30m# waypoint_cache_steps.go:50 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m   | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD[0m | [36mfalse[0m    |
    [32mWhen[0m [32mI save waypoint "X1-GZ7-A1" for system "X1-GZ7" with:[0m              [1;30m# waypoint_cache_steps.go:54 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m          | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD,MARKET[0m | [36mtrue[0m     |
    [32mThen[0m [32mthe waypoint should be saved in the database[0m                       [1;30m# waypoint_cache_steps.go:64 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" should have traits "SHIPYARD,MARKET"[0m           [1;30m# waypoint_cache_steps.go:75 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" should have fuel available[0m                     [1;30m# waypoint_cache_steps.go:76 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Preserve waypoint orbitals when saving                         [1;30m# features/infrastructure/waypoint_cache.feature:113[0m
    [32mWhen[0m [32mI save waypoint "X1-GZ7-A1" for system "X1-GZ7" with orbitals:[0m    [1;30m# waypoint_cache_steps.go:61 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m   | [36mhas_fuel[0m | [36morbitals[0m              |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD[0m | [36mtrue[0m     | [36mX1-GZ7-A1Z,X1-GZ7-A1Y[0m |
    [32mThen[0m [32mwaypoint "X1-GZ7-A1" should have orbitals "X1-GZ7-A1Z,X1-GZ7-A1Y"[0m [1;30m# waypoint_cache_steps.go:77 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Preserve waypoint coordinates accurately (no rounding errors) [1;30m# features/infrastructure/waypoint_cache.feature:119[0m
    [32mWhen[0m [32mI save waypoint "X1-GZ7-A1" for system "X1-GZ7" with:[0m            [1;30m# waypoint_cache_steps.go:54 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m       | [36my[0m        | [36mtraits[0m | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m123.456[0m | [36m-789.012[0m | [36mMARKET[0m | [36mfalse[0m    |
    [32mThen[0m [32mwaypoint "X1-GZ7-A1" should have coordinates (123.456, -789.012)[0m [1;30m# waypoint_cache_steps.go:78 -> *WaypointCacheContext[0m

  [1;37mScenario:[0m Deduplication by symbol (same symbol overwrites)                [1;30m# features/infrastructure/waypoint_cache.feature:125[0m
    [32mGiven[0m [32mwaypoint "X1-GZ7-A1" exists in database for system "X1-GZ7" with:[0m [1;30m# waypoint_cache_steps.go:50 -> *WaypointCacheContext[0m
      | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m | [36mhas_fuel[0m |
      | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mMARKET[0m | [36mfalse[0m    |
    [32mWhen[0m [32mI save waypoints for system "X1-GZ7" with:[0m                         [1;30m# waypoint_cache_steps.go:55 -> *WaypointCacheContext[0m
      | [36msymbol[0m    | [36mtype[0m   | [36mx[0m    | [36my[0m   | [36mtraits[0m   | [36mhas_fuel[0m |
      | [36mX1-GZ7-A1[0m | [36mPLANET[0m | [36m10.0[0m | [36m5.0[0m | [36mSHIPYARD[0m | [36mtrue[0m     |
      | [36mX1-GZ7-B2[0m | [36mMOON[0m   | [36m-5.0[0m | [36m8.0[0m | [36mMARKET[0m   | [36mfalse[0m    |
    [32mThen[0m [32mthe database should have 2 waypoints for system "X1-GZ7"[0m           [1;30m# waypoint_cache_steps.go:67 -> *WaypointCacheContext[0m
    [32mAnd[0m [32mwaypoint "X1-GZ7-A1" should have traits "SHIPYARD"[0m                  [1;30m# waypoint_cache_steps.go:75 -> *WaypointCacheContext[0m

[1;37mFeature:[0m Daemon Container Lifecycle
  As a daemon system
  I need containers to properly transition status during daemon operations
  So that container state accurately reflects execution lifecycle in real daemon scenarios

  [1;37mScenario:[0m Container transitions to RUNNING on successful start [1;30m# features/daemon/container_lifecycle.feature:10[0m
    [32mGiven[0m [32ma new daemon container is created with type "NAVIGATE"[0m [1;30m# container_lifecycle_steps.go:949 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon starts the container[0m                         [1;30m# container_lifecycle_steps.go:969 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "RUNNING"[0m                [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container started_at timestamp should be set[0m         [1;30m# container_lifecycle_steps.go:1000 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be nil[0m         [1;30m# container_lifecycle_steps.go:1001 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container transitions to COMPLETED on successful completion [1;30m# features/daemon/container_lifecycle.feature:17[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m                     [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container operation completes successfully[0m                 [1;30m# container_lifecycle_steps.go:970 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "COMPLETED"[0m                     [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be set[0m                [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should be marked as finished[0m                      [1;30m# container_lifecycle_steps.go:1003 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container transitions to FAILED on error                     [1;30m# features/daemon/container_lifecycle.feature:24[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m                      [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container operation encounters an error "Navigation failed"[0m [1;30m# container_lifecycle_steps.go:971 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "FAILED"[0m                         [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be set[0m                 [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container last_error should be "Navigation failed"[0m           [1;30m# container_lifecycle_steps.go:1005 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should be marked as finished[0m                       [1;30m# container_lifecycle_steps.go:1003 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container stays in STOPPING during graceful shutdown [1;30m# features/daemon/container_lifecycle.feature:32[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m              [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon signals the container to stop[0m                [1;30m# container_lifecycle_steps.go:972 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "STOPPING"[0m               [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be nil[0m         [1;30m# container_lifecycle_steps.go:1001 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should not be marked as finished[0m           [1;30m# container_lifecycle_steps.go:1004 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container finalizes to STOPPED after graceful shutdown [1;30m# features/daemon/container_lifecycle.feature:39[0m
    [32mGiven[0m [32ma daemon container is in "STOPPING" status[0m               [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon finalizes the container shutdown[0m               [1;30m# container_lifecycle_steps.go:973 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "STOPPED"[0m                  [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be set[0m           [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should be marked as finished[0m                 [1;30m# container_lifecycle_steps.go:1003 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Quick-running containers properly transition status [1;30m# features/daemon/container_lifecycle.feature:50[0m
    [32mGiven[0m [32ma daemon container that runs for less than 1 second[0m   [1;30m# container_lifecycle_steps.go:951 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container completes its operation[0m                  [1;30m# container_lifecycle_steps.go:974 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe status should be "COMPLETED" not "RUNNING"[0m         [1;30m# container_lifecycle_steps.go:1006 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should be marked as finished[0m              [1;30m# container_lifecycle_steps.go:1003 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container status reflects completion even with stop timestamp set [1;30m# features/daemon/container_lifecycle.feature:56[0m
    [32mGiven[0m [32ma container with status "RUNNING"[0m                                   [1;30m# container_lifecycle_steps.go:952 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container completes successfully[0m                                  [1;30m# container_lifecycle_steps.go:975 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI query the container status[0m                                         [1;30m# container_lifecycle_steps.go:976 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe status must be "COMPLETED" not "RUNNING"[0m                         [1;30m# container_lifecycle_steps.go:1007 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe stopped_at timestamp should be set[0m                                [1;30m# container_lifecycle_steps.go:1008 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m List containers shows correct status after completion        [1;30m# features/daemon/container_lifecycle.feature:67[0m
    [32mGiven[0m [32ma new daemon container is created with type "DOCK"[0m             [1;30m# container_lifecycle_steps.go:949 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container operation completes successfully[0m                  [1;30m# container_lifecycle_steps.go:970 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mI list all daemon containers[0m                                     [1;30m# container_lifecycle_steps.go:977 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container should appear with status "COMPLETED"[0m             [1;30m# container_lifecycle_steps.go:1009 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should be included in the finished containers list[0m [1;30m# container_lifecycle_steps.go:1010 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Completed containers can be queried by status   [1;30m# features/daemon/container_lifecycle.feature:74[0m
    [32mGiven[0m [32ma daemon container is in "COMPLETED" status[0m       [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI query containers by status "COMPLETED"[0m           [1;30m# container_lifecycle_steps.go:978 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container should appear in the results[0m         [1;30m# container_lifecycle_steps.go:1011 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should have finished flag set to true[0m [1;30m# container_lifecycle_steps.go:1012 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Running containers excluded from finished containers list [1;30m# features/daemon/container_lifecycle.feature:80[0m
    [32mGiven[0m [32m3 daemon containers exist:[0m                                  [1;30m# container_lifecycle_steps.go:963 -> *containerLifecycleContext[0m
      | [36mcontainer-1[0m | [36mRUNNING[0m   |
      | [36mcontainer-2[0m | [36mCOMPLETED[0m |
      | [36mcontainer-3[0m | [36mFAILED[0m    |
    [32mWhen[0m [32mI list only finished containers[0m                              [1;30m# container_lifecycle_steps.go:979 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe results should contain 2 containers[0m                      [1;30m# container_lifecycle_steps.go:1013 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe results should include "container-2" and "container-3"[0m    [1;30m# container_lifecycle_steps.go:1014 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe results should not include "container-1"[0m                  [1;30m# container_lifecycle_steps.go:1015 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container tracks start and stop timestamps         [1;30m# features/daemon/container_lifecycle.feature:94[0m
    [32mGiven[0m [32ma new daemon container is created with type "REFUEL"[0m [1;30m# container_lifecycle_steps.go:949 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon starts the container[0m                       [1;30m# container_lifecycle_steps.go:969 -> *containerLifecycleContext[0m
    [32mAnd[0m [32m2 seconds pass[0m                                         [1;30m# container_lifecycle_steps.go:980 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container operation completes successfully[0m         [1;30m# container_lifecycle_steps.go:970 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container started_at timestamp should be set[0m      [1;30m# container_lifecycle_steps.go:1000 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be set[0m       [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe runtime duration should be approximately 2 seconds[0m [1;30m# container_lifecycle_steps.go:1016 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container started_at persists through state transitions [1;30m# features/daemon/container_lifecycle.feature:103[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m                 [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container transitions to "COMPLETED"[0m                   [1;30m# container_lifecycle_steps.go:981 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container started_at timestamp should remain unchanged[0m [1;30m# container_lifecycle_steps.go:1017 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container stopped_at timestamp should be set[0m            [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container stopped_at is set for all terminal states      [1;30m# features/daemon/container_lifecycle.feature:109[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m                  [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container transitions to "FAILED"[0m                       [1;30m# container_lifecycle_steps.go:981 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container stopped_at timestamp should be set[0m            [1;30m# container_lifecycle_steps.go:1002 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe stopped_at should be greater than or equal to started_at[0m [1;30m# container_lifecycle_steps.go:1018 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container increments iteration count on loop                  [1;30m# features/daemon/container_lifecycle.feature:119[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status with max_iterations 5[0m [1;30m# container_lifecycle_steps.go:964 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container completes one iteration[0m                            [1;30m# container_lifecycle_steps.go:982 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container current_iteration should increment to 1[0m            [1;30m# container_lifecycle_steps.go:1019 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should continue running[0m                             [1;30m# container_lifecycle_steps.go:1020 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container respects max_iterations limit                        [1;30m# features/daemon/container_lifecycle.feature:125[0m
    [32mGiven[0m [32ma daemon container with max_iterations 3 and current_iteration 2[0m [1;30m# container_lifecycle_steps.go:965 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container completes one iteration[0m                             [1;30m# container_lifecycle_steps.go:982 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container current_iteration should be 3[0m                       [1;30m# container_lifecycle_steps.go:1023 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should not continue running[0m                          [1;30m# container_lifecycle_steps.go:1021 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container with -1 iterations runs indefinitely                    [1;30m# features/daemon/container_lifecycle.feature:131[0m
    [32mGiven[0m [32ma daemon container with max_iterations -1 and current_iteration 100[0m [1;30m# container_lifecycle_steps.go:965 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI check if the container should continue[0m                             [1;30m# container_lifecycle_steps.go:983 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container should continue running[0m                                [1;30m# container_lifecycle_steps.go:1020 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe current_iteration should be 100[0m                                   [1;30m# container_lifecycle_steps.go:1022 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container exits after max_iterations reached [1;30m# features/daemon/container_lifecycle.feature:137[0m
    [32mGiven[0m [32ma daemon container with max_iterations 5[0m       [1;30m# container_lifecycle_steps.go:966 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe container completes 5 iterations[0m            [1;30m# container_lifecycle_steps.go:996 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container should not continue running[0m       [1;30m# container_lifecycle_steps.go:1021 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container current_iteration should be 5[0m      [1;30m# container_lifecycle_steps.go:1023 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container restart increments restart_count               [1;30m# features/daemon/container_lifecycle.feature:147[0m
    [32mGiven[0m [32ma daemon container in "FAILED" status with restart_count 0[0m [1;30m# container_lifecycle_steps.go:953 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon restarts the container[0m                           [1;30m# container_lifecycle_steps.go:984 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "PENDING"[0m                    [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container restart_count should be 1[0m                      [1;30m# container_lifecycle_steps.go:1024 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container last_error should be nil[0m                       [1;30m# container_lifecycle_steps.go:1025 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container respects max_restarts policy (3)               [1;30m# features/daemon/container_lifecycle.feature:154[0m
    [32mGiven[0m [32ma daemon container in "FAILED" status with restart_count 3[0m [1;30m# container_lifecycle_steps.go:953 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI check if the container can restart[0m                        [1;30m# container_lifecycle_steps.go:985 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe restart eligibility should be false[0m                     [1;30m# container_lifecycle_steps.go:1026 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeContainerLifecycleScenario.func3[0m
    [32mAnd[0m [32mthe container should remain in "FAILED" status[0m               [1;30m# container_lifecycle_steps.go:1029 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container cannot restart after exceeding max_restarts    [1;30m# features/daemon/container_lifecycle.feature:160[0m
    [32mGiven[0m [32ma daemon container in "FAILED" status with restart_count 3[0m [1;30m# container_lifecycle_steps.go:953 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI attempt to restart the container[0m                          [1;30m# container_lifecycle_steps.go:986 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe restart operation should fail[0m                           [1;30m# container_lifecycle_steps.go:1031 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe error should mention "cannot be restarted"[0m               [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should remain in "FAILED" status[0m               [1;30m# container_lifecycle_steps.go:1029 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container maintains player_id through restarts        [1;30m# features/daemon/container_lifecycle.feature:167[0m
    [32mGiven[0m [32ma daemon container with player_id 42 in "FAILED" status[0m [1;30m# container_lifecycle_steps.go:954 -> github.com/andrescamacho/spacetraders-go/test/bdd/steps.InitializeContainerLifecycleScenario.func2[0m
    [32mWhen[0m [32mthe daemon restarts the container[0m                        [1;30m# container_lifecycle_steps.go:984 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container should have player_id 42[0m                   [1;30m# container_lifecycle_steps.go:1033 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container status should be "PENDING"[0m                  [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container maintains ship assignment through restarts              [1;30m# features/daemon/container_lifecycle.feature:173[0m
    [32mGiven[0m [32ma daemon container with metadata "ship_symbol" = "SHIP-1"[0m           [1;30m# container_lifecycle_steps.go:960 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container is in "FAILED" status[0m                                   [1;30m# container_lifecycle_steps.go:961 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon restarts the container[0m                                    [1;30m# container_lifecycle_steps.go:984 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container metadata should still contain "ship_symbol" = "SHIP-1"[0m [1;30m# container_lifecycle_steps.go:1034 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container status should be "PENDING"[0m                              [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container tracks multiple restart attempts               [1;30m# features/daemon/container_lifecycle.feature:180[0m
    [32mGiven[0m [32ma daemon container in "FAILED" status with restart_count 0[0m [1;30m# container_lifecycle_steps.go:953 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon restarts the container 2 times[0m                   [1;30m# container_lifecycle_steps.go:987 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container restart_count should be 2[0m                     [1;30m# container_lifecycle_steps.go:1024 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should still be eligible for restart[0m           [1;30m# container_lifecycle_steps.go:1035 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Multiple containers can run simultaneously           [1;30m# features/daemon/container_lifecycle.feature:190[0m
    [32mGiven[0m [32m5 daemon containers are created[0m                        [1;30m# container_lifecycle_steps.go:962 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mthe daemon starts all containers[0m                        [1;30m# container_lifecycle_steps.go:988 -> *containerLifecycleContext[0m
    [32mThen[0m [32mall containers should have status "RUNNING"[0m             [1;30m# container_lifecycle_steps.go:1036 -> *containerLifecycleContext[0m
    [32mAnd[0m [32meach container should have a unique started_at timestamp[0m [1;30m# container_lifecycle_steps.go:1037 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container IDs are unique and sequential [1;30m# features/daemon/container_lifecycle.feature:196[0m
    [32mGiven[0m [32m10 daemon containers are created[0m          [1;30m# container_lifecycle_steps.go:962 -> *containerLifecycleContext[0m
    [32mThen[0m [32meach container should have a unique ID[0m     [1;30m# container_lifecycle_steps.go:1038 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container IDs should be sequential[0m      [1;30m# container_lifecycle_steps.go:1039 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Daemon tracks containers independently  [1;30m# features/daemon/container_lifecycle.feature:201[0m
    [32mGiven[0m [32m3 daemon containers exist:[0m                [1;30m# container_lifecycle_steps.go:963 -> *containerLifecycleContext[0m
      | [36mcontainer-1[0m | [36mRUNNING[0m   |
      | [36mcontainer-2[0m | [36mCOMPLETED[0m |
      | [36mcontainer-3[0m | [36mSTOPPED[0m   |
    [32mWhen[0m [32mI query container "container-1"[0m            [1;30m# container_lifecycle_steps.go:989 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "RUNNING"[0m   [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI query container "container-2"[0m            [1;30m# container_lifecycle_steps.go:989 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "COMPLETED"[0m [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI query container "container-3"[0m            [1;30m# container_lifecycle_steps.go:989 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe container status should be "STOPPED"[0m   [1;30m# container_lifecycle_steps.go:999 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Completed containers can be removed without stopping [1;30m# features/daemon/container_lifecycle.feature:217[0m
    [32mGiven[0m [32ma daemon container is in "COMPLETED" status[0m            [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI remove the container[0m                                  [1;30m# container_lifecycle_steps.go:990 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe removal should succeed[0m                              [1;30m# container_lifecycle_steps.go:1040 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should not appear in the list[0m              [1;30m# container_lifecycle_steps.go:1041 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Failed containers can be removed without stopping [1;30m# features/daemon/container_lifecycle.feature:223[0m
    [32mGiven[0m [32ma daemon container is in "FAILED" status[0m            [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI remove the container[0m                               [1;30m# container_lifecycle_steps.go:990 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe removal should succeed[0m                           [1;30m# container_lifecycle_steps.go:1040 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should not appear in the list[0m           [1;30m# container_lifecycle_steps.go:1041 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Stopped containers can be removed without stopping [1;30m# features/daemon/container_lifecycle.feature:229[0m
    [32mGiven[0m [32ma daemon container is in "STOPPED" status[0m            [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI remove the container[0m                                [1;30m# container_lifecycle_steps.go:990 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe removal should succeed[0m                            [1;30m# container_lifecycle_steps.go:1040 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should not appear in the list[0m            [1;30m# container_lifecycle_steps.go:1041 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Running containers must be stopped before removal [1;30m# features/daemon/container_lifecycle.feature:235[0m
    [32mGiven[0m [32ma daemon container is in "RUNNING" status[0m           [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI attempt to remove the container without stopping[0m   [1;30m# container_lifecycle_steps.go:991 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe removal should fail[0m                              [1;30m# container_lifecycle_steps.go:1042 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe error should mention "must be stopped first"[0m      [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container should still appear in the list[0m         [1;30m# container_lifecycle_steps.go:1043 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container cannot transition from COMPLETED to RUNNING            [1;30m# features/daemon/container_lifecycle.feature:246[0m
    [32mGiven[0m [32ma daemon container is in "COMPLETED" status[0m                        [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI attempt to start the container[0m                                    [1;30m# container_lifecycle_steps.go:992 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe operation should fail[0m                                           [1;30m# container_lifecycle_steps.go:1044 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe error should mention "cannot start container in COMPLETED state"[0m [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe container status should remain "COMPLETED"[0m                       [1;30m# container_lifecycle_steps.go:1030 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container cannot transition from FAILED to RUNNING without restart [1;30m# features/daemon/container_lifecycle.feature:253[0m
    [32mGiven[0m [32ma daemon container is in "FAILED" status[0m                             [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI attempt to start the container[0m                                      [1;30m# container_lifecycle_steps.go:992 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe operation should fail[0m                                             [1;30m# container_lifecycle_steps.go:1044 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe error should mention "cannot start container in FAILED state"[0m      [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container cannot be completed if not running                      [1;30m# features/daemon/container_lifecycle.feature:259[0m
    [32mGiven[0m [32ma daemon container is in "PENDING" status[0m                           [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mI attempt to complete the container[0m                                  [1;30m# container_lifecycle_steps.go:993 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe operation should fail[0m                                            [1;30m# container_lifecycle_steps.go:1044 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe error should mention "cannot complete container in PENDING state"[0m [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m

  [1;37mScenario:[0m Container stopped_at timestamp is immutable once set [1;30m# features/daemon/container_lifecycle.feature:265[0m
    [32mGiven[0m [32ma daemon container is in "COMPLETED" status[0m            [1;30m# container_lifecycle_steps.go:950 -> *containerLifecycleContext[0m
    [32mAnd[0m [32mthe stopped_at timestamp is recorded[0m                     [1;30m# container_lifecycle_steps.go:994 -> *containerLifecycleContext[0m
    [32mWhen[0m [32mtime advances by 5 seconds[0m                              [1;30m# container_lifecycle_steps.go:995 -> *containerLifecycleContext[0m
    [32mThen[0m [32mthe stopped_at timestamp should remain unchanged[0m        [1;30m# container_lifecycle_steps.go:1045 -> *containerLifecycleContext[0m

[1;37mFeature:[0m Container Logging & Persistence
  As a daemon system
  I need containers to log messages to the database with deduplication
  So that I can query container logs by ID, level, and time range with pagination

  [1;37mScenario:[0m Container logs INFO messages to database                              [1;30m# features/daemon/container_logging.feature:10[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m                      [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "test-container-1" for player 1[0m                       [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log an INFO message "Operation started successfully" for the container[0m [1;30m# container_logging_steps.go:404 -> *containerLoggingContext[0m
    [32mThen[0m [32mthe log should be persisted to the database[0m                              [1;30m# container_logging_steps.go:426 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log level should be "INFO"[0m                                            [1;30m# container_logging_steps.go:427 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log message should be "Operation started successfully"[0m                [1;30m# container_logging_steps.go:428 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs ERROR messages to database                                    [1;30m# features/daemon/container_logging.feature:18[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m                             [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "test-container-2" for player 1[0m                              [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log an ERROR message "Navigation failed: insufficient fuel" for the container[0m [1;30m# container_logging_steps.go:405 -> *containerLoggingContext[0m
    [32mThen[0m [32mthe log should be persisted to the database[0m                                     [1;30m# container_logging_steps.go:426 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log level should be "ERROR"[0m                                                  [1;30m# container_logging_steps.go:427 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log message should be "Navigation failed: insufficient fuel"[0m                 [1;30m# container_logging_steps.go:428 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs include timestamp and container_id               [1;30m# features/daemon/container_logging.feature:26[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m                [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "test-container-3" for player 1[0m                 [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log an INFO message "Processing waypoint data" for the container[0m [1;30m# container_logging_steps.go:404 -> *containerLoggingContext[0m
    [32mThen[0m [32mthe log should be persisted to the database[0m                        [1;30m# container_logging_steps.go:426 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log should have a container_id of "test-container-3"[0m            [1;30m# container_logging_steps.go:429 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log should have a player_id of 1[0m                                [1;30m# container_logging_steps.go:430 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log should have a timestamp within the last 5 seconds[0m           [1;30m# container_logging_steps.go:431 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs are queryable by container_id        [1;30m# features/daemon/container_logging.feature:39[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m    [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "query-test-1" for player 1[0m         [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "query-test-2" for player 1[0m         [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log 3 INFO messages for container "query-test-1"[0m     [1;30m# container_logging_steps.go:406 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI log 2 ERROR messages for container "query-test-2"[0m     [1;30m# container_logging_steps.go:407 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI query logs for container "query-test-1" with limit 10[0m [1;30m# container_logging_steps.go:418 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 3 log entries[0m                 [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mAnd[0m [32mall log entries should have container_id "query-test-1"[0m [1;30m# container_logging_steps.go:433 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs are queryable by log level            [1;30m# features/daemon/container_logging.feature:49[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m     [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "level-test-1" for player 1[0m          [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log 2 INFO messages for the container[0m                 [1;30m# container_logging_steps.go:408 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI log 3 ERROR messages for the container[0m                 [1;30m# container_logging_steps.go:409 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI log 1 WARNING message for the container[0m                [1;30m# container_logging_steps.go:410 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI query logs for the container filtered by level "ERROR"[0m [1;30m# container_logging_steps.go:419 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 3 log entries[0m                  [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mAnd[0m [32mall log entries should have level "ERROR"[0m                [1;30m# container_logging_steps.go:434 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs deduplicate within 60 seconds                                     [1;30m# features/daemon/container_logging.feature:63[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m                                 [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "dedup-test-1" for player 1[0m                                      [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log an INFO message "Duplicate message test" for the container[0m                    [1;30m# container_logging_steps.go:404 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI log the same INFO message "Duplicate message test" 2 seconds later[0m                 [1;30m# container_logging_steps.go:414 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI log the same INFO message "Duplicate message test" 30 seconds after the first log[0m  [1;30m# container_logging_steps.go:415 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 1 log entry when querying[0m                                  [1;30m# container_logging_steps.go:420 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log message should be "Duplicate message test"[0m                                   [1;30m# container_logging_steps.go:428 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log the same INFO message "Duplicate message test" 65 seconds after the first log[0m [1;30m# container_logging_steps.go:415 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 2 log entries when querying[0m                                [1;30m# container_logging_steps.go:421 -> *containerLoggingContext[0m
    [32mAnd[0m [32mboth entries should have the message "Duplicate message test"[0m                        [1;30m# container_logging_steps.go:435 -> *containerLoggingContext[0m

  [1;37mScenario:[0m Container logs support pagination with limit and offset [1;30m# features/daemon/container_logging.feature:75[0m
    [32mGiven[0m [32ma container log repository with in-memory database[0m        [1;30m# container_logging_steps.go:400 -> *containerLoggingContext[0m
    [32mAnd[0m [32ma container with ID "pagination-test-1" for player 1[0m        [1;30m# container_logging_steps.go:401 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI log 15 unique INFO messages for the container[0m            [1;30m# container_logging_steps.go:411 -> *containerLoggingContext[0m
    [32mAnd[0m [32mI query logs with limit 5 and no offset[0m                     [1;30m# container_logging_steps.go:422 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 5 log entries[0m                     [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI query logs with limit 5 and offset 5[0m                     [1;30m# container_logging_steps.go:423 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 5 log entries[0m                     [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe log entries should be different from the first page[0m     [1;30m# container_logging_steps.go:436 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI query logs with limit 5 and offset 10[0m                    [1;30m# container_logging_steps.go:423 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 5 log entries[0m                     [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mWhen[0m [32mI query logs with limit 10 and offset 10[0m                   [1;30m# container_logging_steps.go:423 -> *containerLoggingContext[0m
    [32mThen[0m [32mI should receive exactly 5 log entries[0m                     [1;30m# container_logging_steps.go:432 -> *containerLoggingContext[0m
    [32mAnd[0m [32mthe total count of all logs should be 15[0m                    [1;30m# container_logging_steps.go:437 -> *containerLoggingContext[0m

[1;37mFeature:[0m Daemon Server Lifecycle
  As a SpaceTraders bot operator
  I need a daemon server to manage background operations
  So that CLI commands can execute asynchronously with proper lifecycle management

  [1;37mScenario:[0m Daemon server starts and listens on Unix socket          [1;30m# features/daemon/daemon_server.feature:10[0m
    [32mGiven[0m [32mthe daemon server is not running[0m                           [1;30m# daemon_server_steps.go:111 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock
    [32mWhen[0m [32mI start the daemon server on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:128 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon server should be running[0m                         [1;30m# daemon_server_steps.go:142 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe Unix socket should exist at "/tmp/test-daemon.sock"[0m      [1;30m# daemon_server_steps.go:143 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe socket permissions should be 0600[0m                        [1;30m# daemon_server_steps.go:144 -> *daemonServerContext[0m

  [1;37mScenario:[0m Daemon server removes existing socket on startup         [1;30m# features/daemon/daemon_server.feature:17[0m
    [32mGiven[0m [32ma stale Unix socket exists at "/tmp/test-daemon.sock"[0m      [1;30m# daemon_server_steps.go:112 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock
    [32mWhen[0m [32mI start the daemon server on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:128 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon server should start successfully[0m                 [1;30m# daemon_server_steps.go:145 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe Unix socket should exist at "/tmp/test-daemon.sock"[0m      [1;30m# daemon_server_steps.go:143 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe socket should be active[0m                                  [1;30m# daemon_server_steps.go:146 -> *daemonServerContext[0m

  [1;37mScenario:[0m Daemon server fails to start if socket path is invalid                              [1;30m# features/daemon/daemon_server.feature:24[0m
    [32mGiven[0m [32mthe daemon server is not running[0m                                                      [1;30m# daemon_server_steps.go:111 -> *daemonServerContext[0m
    [32mWhen[0m [32mI attempt to start the daemon server on invalid socket "/nonexistent/path/daemon.sock"[0m [1;30m# daemon_server_steps.go:129 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon startup should fail[0m                                                         [1;30m# daemon_server_steps.go:147 -> *daemonServerContext[0m
    [31mAnd[0m [31mthe error should mention "failed to create unix socket listener"[0m                        [1;30m# container_lifecycle_steps.go:1032 -> *containerLifecycleContext[0m
    [1;31mexpected error mentioning 'failed to create unix socket listener' but got no error[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server accepts gRPC client connections                [1;30m# features/daemon/daemon_server.feature:34[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mWhen[0m [32ma gRPC client connects to the Unix socket[0m                       [1;30m# daemon_server_steps.go:130 -> *daemonServerContext[0m
    [32mThen[0m [32mthe connection should be accepted[0m                               [1;30m# daemon_server_steps.go:149 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe client should receive a valid gRPC server response[0m           [1;30m# daemon_server_steps.go:150 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server handles HealthCheck request                    [1;30m# features/daemon/daemon_server.feature:40[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                       [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
    [32mWhen[0m [32mthe client sends a HealthCheck request[0m                          [1;30m# daemon_server_steps.go:131 -> *daemonServerContext[0m
    [32mThen[0m [32mthe response should have status "ok"[0m                            [1;30m# daemon_server_steps.go:151 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe response should include version "0.1.0"[0m                      [1;30m# daemon_server_steps.go:152 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe response should include active_containers count[0m              [1;30m# daemon_server_steps.go:153 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server handles NavigateShip request                                    [1;30m# features/daemon/daemon_server.feature:52[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m                  [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                                        [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
    [32mAnd[0m [32ma ship "TEST-SHIP-1" exists for player 1[0m                                          [1;30m# daemon_server_steps.go:115 -> *daemonServerContext[0m
[2025-11-15T16:03:06Z] [navigate-TEST-SHIP-1-1763222586862937630] INFO: Container started
[2025-11-15T16:03:06Z] [navigate-TEST-SHIP-1-1763222586862937630] INFO: Executing iteration
[2025-11-15T16:03:06Z] [navigate-TEST-SHIP-1-1763222586862937630] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:06Z] [navigate-TEST-SHIP-1-1763222586862937630] INFO: Iteration 1 completed
[2025-11-15T16:03:06Z] [navigate-TEST-SHIP-1-1763222586862937630] INFO: Container completed successfully
    [32mWhen[0m [32mthe client sends a NavigateShip request for ship "TEST-SHIP-1" to "X1-TEST-DEST"[0m [1;30m# daemon_server_steps.go:132 -> *daemonServerContext[0m
    [32mThen[0m [32mthe response should include a container_id[0m                                       [1;30m# daemon_server_steps.go:154 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe response should have status "PENDING"[0m                                         [1;30m# daemon_server_steps.go:151 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container should be registered in the daemon[0m                                  [1;30m# daemon_server_steps.go:155 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server creates container for navigation operation                      [1;30m# features/daemon/daemon_server.feature:61[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m                  [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                                        [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587029032215] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587029032215] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587029032215] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587029032215] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587029032215] INFO: Container completed successfully
    [32mWhen[0m [32mthe client sends a NavigateShip request for ship "TEST-SHIP-1" to "X1-TEST-DEST"[0m [1;30m# daemon_server_steps.go:132 -> *daemonServerContext[0m
    [32mThen[0m [32ma container should be created with type "NAVIGATE"[0m                               [1;30m# daemon_server_steps.go:156 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container metadata should include ship_symbol "TEST-SHIP-1"[0m                   [1;30m# daemon_server_steps.go:157 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container metadata should include destination "X1-TEST-DEST"[0m                  [1;30m# daemon_server_steps.go:158 -> *daemonServerContext[0m
    [31mAnd[0m [31mthe container should have player_id 1[0m                                             [1;30m# container_lifecycle_steps.go:1033 -> *containerLifecycleContext[0m
    [1;31mruntime error: invalid memory address or nil pointer dereference
runtime.gopanic
	/usr/local/go1.24.7/src/runtime/panic.go:792
runtime.panicmem
	/usr/local/go1.24.7/src/runtime/panic.go:262
runtime.sigpanic
	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
github.com/andrescamacho/spacetraders-go/internal/domain/container.(*Container).PlayerID
	/home/user/spacetraders/gobot/internal/domain/container/container.go:119
github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*containerLifecycleContext).theContainerShouldHavePlayerID
	/home/user/spacetraders/gobot/test/bdd/steps/container_lifecycle_steps.go:812
reflect.Value.call
	/usr/local/go1.24.7/src/reflect/value.go:584
reflect.Value.Call
	/usr/local/go1.24.7/src/reflect/value.go:368
github.com/cucumber/godog/internal/models.(*StepDefinition).Run
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
github.com/cucumber/godog.(*suite).runStep
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
github.com/cucumber/godog.(*suite).runSteps
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
github.com/cucumber/godog.(*suite).runPickle.func1
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
testing.tRunner
	/usr/local/go1.24.7/src/testing/testing.go:1792
runtime.goexit
	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server returns container ID immediately                                [1;30m# features/daemon/daemon_server.feature:70[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m                  [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                                        [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587197020473] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587197020473] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587197020473] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587197020473] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587197020473] INFO: Container completed successfully
    [32mWhen[0m [32mthe client sends a NavigateShip request for ship "TEST-SHIP-1" to "X1-TEST-DEST"[0m [1;30m# daemon_server_steps.go:132 -> *daemonServerContext[0m
    [32mThen[0m [32mthe response should return within 100 milliseconds[0m                               [1;30m# daemon_server_steps.go:160 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe response should include a container_id[0m                                        [1;30m# daemon_server_steps.go:154 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container should not be in COMPLETED status yet[0m                               [1;30m# daemon_server_steps.go:161 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server continues operation in background                               [1;30m# features/daemon/daemon_server.feature:82[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m                  [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                                        [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587355282308] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587355282308] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587355282308] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587355282308] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587355282308] INFO: Container completed successfully
    [32mWhen[0m [32mthe client sends a NavigateShip request for ship "TEST-SHIP-1" to "X1-TEST-DEST"[0m [1;30m# daemon_server_steps.go:132 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe client disconnects after receiving the container_id[0m                           [1;30m# daemon_server_steps.go:133 -> *daemonServerContext[0m
    [32mThen[0m [32mthe container should continue executing in the background[0m                        [1;30m# daemon_server_steps.go:162 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container status should eventually transition to "RUNNING"[0m                    [1;30m# daemon_server_steps.go:163 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server tracks multiple concurrent operations          [1;30m# features/daemon/daemon_server.feature:90[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma gRPC client is connected[0m                                       [1;30m# daemon_server_steps.go:114 -> *daemonServerContext[0m
    [32mAnd[0m [32mships exist for player 1:[0m                                        [1;30m# daemon_server_steps.go:116 -> *daemonServerContext[0m
      | [36mTEST-SHIP-1[0m |
      | [36mTEST-SHIP-2[0m |
      | [36mTEST-SHIP-3[0m |
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587531339521] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587531339521] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587531339521] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587531339521] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-1-1763222587531339521] INFO: Container completed successfully
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-2-1763222587531652879] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-2-1763222587531652879] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-2-1763222587531652879] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-2-1763222587531652879] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-2-1763222587531652879] INFO: Container completed successfully
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-3-1763222587532053306] INFO: Container started
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-3-1763222587532053306] INFO: Executing iteration
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-3-1763222587532053306] INFO: Command executed, result type: <nil>
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-3-1763222587532053306] INFO: Iteration 1 completed
[2025-11-15T16:03:07Z] [navigate-TEST-SHIP-3-1763222587532053306] INFO: Container completed successfully
    [32mWhen[0m [32mthe client sends NavigateShip requests for all 3 ships[0m          [1;30m# daemon_server_steps.go:134 -> *daemonServerContext[0m
    [32mThen[0m [32m3 containers should be created[0m                                  [1;30m# daemon_server_steps.go:164 -> *daemonServerContext[0m
    [31mAnd[0m [31mall containers should be registered in the daemon[0m                [1;30m# daemon_server_steps.go:165 -> *daemonServerContext[0m
    [1;31mexpected 0 containers, got 3[0m
    [36mAnd[0m [36meach container should have a unique container_id[0m                 [1;30m# daemon_server_steps.go:166 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server initiates graceful shutdown on SIGTERM         [1;30m# features/daemon/daemon_server.feature:106[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32m2 containers are running in the background[0m                       [1;30m# daemon_server_steps.go:117 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should initiate graceful shutdown[0m                    [1;30m# daemon_server_steps.go:167 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should stop accepting new connections[0m                 [1;30m# daemon_server_steps.go:168 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should wait for running containers to finish[0m          [1;30m# daemon_server_steps.go:169 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server waits for containers during shutdown (within timeout) [1;30m# features/daemon/daemon_server.feature:114[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m        [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma container is running that will complete in 5 seconds[0m                  [1;30m# daemon_server_steps.go:118 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                                    [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should wait for the container to complete[0m                   [1;30m# daemon_server_steps.go:170 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container should finish successfully[0m                                [1;30m# daemon_server_steps.go:171 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should shut down gracefully[0m                                  [1;30m# daemon_server_steps.go:172 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server enforces 30-second shutdown timeout                   [1;30m# features/daemon/daemon_server.feature:122[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m        [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma container is running that will take 60 seconds to complete[0m            [1;30m# daemon_server_steps.go:119 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                                    [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should wait up to 30 seconds[0m                                [1;30m# daemon_server_steps.go:173 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should force shutdown after 30 seconds[0m                       [1;30m# daemon_server_steps.go:174 -> *daemonServerContext[0m
    [32mAnd[0m [32ma warning should be logged about containers not stopping within timeout[0m [1;30m# daemon_server_steps.go:175 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server stops all containers on forceful shutdown      [1;30m# features/daemon/daemon_server.feature:130[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32m5 containers are running in the background[0m                       [1;30m# daemon_server_steps.go:117 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe 30-second timeout expires[0m                                    [1;30m# daemon_server_steps.go:138 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should stop all running containers[0m                   [1;30m# daemon_server_steps.go:176 -> *daemonServerContext[0m
    [32mAnd[0m [32mall containers should transition to STOPPED status[0m               [1;30m# daemon_server_steps.go:177 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server closes database connections on shutdown        [1;30m# features/daemon/daemon_server.feature:142[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe database has 10 active connections from the daemon[0m           [1;30m# daemon_server_steps.go:121 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon completes shutdown[0m                                    [1;30m# daemon_server_steps.go:139 -> *daemonServerContext[0m
    [32mThen[0m [32mall database connections should be closed[0m                       [1;30m# daemon_server_steps.go:178 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe connection pool should be released[0m                           [1;30m# daemon_server_steps.go:179 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server releases all ship assignments on shutdown      [1;30m# features/daemon/daemon_server.feature:150[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32m3 ships are assigned to running containers[0m                       [1;30m# daemon_server_steps.go:122 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon completes shutdown[0m                                    [1;30m# daemon_server_steps.go:139 -> *daemonServerContext[0m
    [32mThen[0m [32mall ship assignments should be released[0m                         [1;30m# daemon_server_steps.go:180 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe ship assignment release_reason should be "daemon_shutdown"[0m   [1;30m# daemon_server_steps.go:181 -> *daemonServerContext[0m
    [32mAnd[0m [32mno ships should remain locked after shutdown[0m                     [1;30m# daemon_server_steps.go:182 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server removes Unix socket on shutdown                [1;30m# features/daemon/daemon_server.feature:159[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon completes shutdown[0m                                    [1;30m# daemon_server_steps.go:139 -> *daemonServerContext[0m
    [32mThen[0m [32mthe Unix socket at "/tmp/test-daemon.sock" should be removed[0m    [1;30m# daemon_server_steps.go:183 -> *daemonServerContext[0m
    [31mAnd[0m [31mthe socket file should not exist[0m                                 [1;30m# daemon_server_steps.go:184 -> *daemonServerContext[0m
    [1;31msocket file still exists at /tmp/test-daemon.sock[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server prevents memory leaks during shutdown          [1;30m# features/daemon/daemon_server.feature:166[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32m100 containers have been executed and completed[0m                  [1;30m# daemon_server_steps.go:123 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon completes shutdown[0m                                    [1;30m# daemon_server_steps.go:139 -> *daemonServerContext[0m
    [32mThen[0m [32mall goroutines spawned by containers should terminate[0m           [1;30m# daemon_server_steps.go:185 -> *daemonServerContext[0m
    [32mAnd[0m [32mno goroutine leaks should be present[0m                             [1;30m# daemon_server_steps.go:186 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon process should exit cleanly[0m                           [1;30m# daemon_server_steps.go:187 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server handles SIGINT signal (Ctrl+C)                 [1;30m# features/daemon/daemon_server.feature:179[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGINT signal to the daemon[0m                              [1;30m# daemon_server_steps.go:136 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should initiate graceful shutdown[0m                    [1;30m# daemon_server_steps.go:167 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should shut down within 30 seconds[0m                    [1;30m# daemon_server_steps.go:188 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server handles repeated shutdown signals gracefully   [1;30m# features/daemon/daemon_server.feature:185[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32ma container is running in the background[0m                         [1;30m# daemon_server_steps.go:124 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                             [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mAnd[0m [32mI send another SIGTERM signal 1 second later[0m                     [1;30m# daemon_server_steps.go:137 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should continue graceful shutdown[0m                    [1;30m# daemon_server_steps.go:189 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should not panic or exit immediately[0m                  [1;30m# daemon_server_steps.go:190 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe container should still be allowed to finish[0m                  [1;30m# daemon_server_steps.go:191 -> *daemonServerContext[0m
Daemon server listening on unix socket: /tmp/test-daemon.sock

  [1;37mScenario:[0m Daemon server completes shutdown even with failing containers [1;30m# features/daemon/daemon_server.feature:194[0m
    [32mGiven[0m [32mthe daemon server is running on socket "/tmp/test-daemon.sock"[0m  [1;30m# daemon_server_steps.go:113 -> *daemonServerContext[0m
    [32mAnd[0m [32m2 containers are running that will fail with errors[0m               [1;30m# daemon_server_steps.go:125 -> *daemonServerContext[0m
    [32mWhen[0m [32mI send SIGTERM signal to the daemon[0m                              [1;30m# daemon_server_steps.go:135 -> *daemonServerContext[0m
    [32mThen[0m [32mthe daemon should wait for containers to fail[0m                    [1;30m# daemon_server_steps.go:192 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe daemon should complete shutdown successfully[0m                  [1;30m# daemon_server_steps.go:193 -> *daemonServerContext[0m
    [32mAnd[0m [32mthe failed containers should be marked as FAILED[0m                  [1;30m# daemon_server_steps.go:194 -> *daemonServerContext[0m

[1;37mFeature:[0m Health Monitor - Container and Ship Health Monitoring
  As an autonomous bot operator
  I need the health monitor to detect and recover from stuck operations
  So that containers and ships don't remain in invalid states indefinitely

  [1;37mBackground:[0m
    [32mGiven[0m [32mthe clock is mocked[0m                                                                                [1;30m# health_monitor_steps.go:27 -> *HealthMonitorContext[0m
    [32mAnd[0m [32ma health monitor exists with check interval 60 seconds and recovery timeout 300 seconds[0m              [1;30m# health_monitor_steps.go:28 -> *HealthMonitorContext[0m

  [1;37mScenario:[0m Health monitor detects stale assignment after container removed                                  [1;30m# features/daemon/health_monitor.feature:14[0m
    [33mGiven[0m [33ma ship "SHIP-1" with player ID 1 is assigned to container "container-123" for operation "navigate"[0m
    [33mAnd[0m [33mthe container "container-123" no longer exists[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe stale assignment for ship "SHIP-1" should be detected[0m
    [33mAnd[0m [33mthe ship assignment should be auto-released with reason "stale_cleanup"[0m
    [33mAnd[0m [33m1 stale assignment should be cleaned up[0m

  [1;37mScenario:[0m Health monitor ignores valid assignments                                                         [1;30m# features/daemon/health_monitor.feature:22[0m
    [33mGiven[0m [33ma ship "SHIP-1" with player ID 1 is assigned to container "container-123" for operation "navigate"[0m
    [33mAnd[0m [33mthe container "container-123" exists and is running[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe ship assignment for "SHIP-1" should remain active[0m
    [33mAnd[0m [33m0 stale assignments should be cleaned up[0m

  [1;37mScenario:[0m Health monitor cleans up multiple stale assignments                                              [1;30m# features/daemon/health_monitor.feature:29[0m
    [33mGiven[0m [33ma ship "SHIP-1" with player ID 1 is assigned to container "container-123" for operation "navigate"[0m
    [33mAnd[0m [33ma ship "SHIP-2" with player ID 1 is assigned to container "container-456" for operation "scout"[0m
    [33mAnd[0m [33ma ship "SHIP-3" with player ID 1 is assigned to container "container-789" for operation "dock"[0m
    [33mAnd[0m [33mno containers exist[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33m3 stale assignments should be cleaned up[0m
    [33mAnd[0m [33mall ship assignments should be released with reason "stale_cleanup"[0m

  [1;37mScenario:[0m Health monitor detects stuck IN_TRANSIT ship                                        [1;30m# features/daemon/health_monitor.feature:42[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma container "container-123" exists for ship "SHIP-1" with status "RUNNING"[0m
    [33mAnd[0m [33mthe recovery timeout is 300 seconds[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe stuck ship "SHIP-1" should be detected[0m
    [33mAnd[0m [33ma warning should be logged about stuck ship "SHIP-1"[0m
    [33mAnd[0m [33mthe stuck ship count should be 1[0m

  [1;37mScenario:[0m Health monitor distinguishes between stuck and slow operations                      [1;30m# features/daemon/health_monitor.feature:51[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 200 seconds ago[0m
    [33mAnd[0m [33mthe recovery timeout is 300 seconds[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe stuck ship "SHIP-1" should not be detected[0m
    [33mAnd[0m [33mthe stuck ship count should be 0[0m

  [1;37mScenario:[0m Health monitor detects missing arrival for completed route                          [1;30m# features/daemon/health_monitor.feature:58[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma route for ship "SHIP-1" exists with status "COMPLETED"[0m
    [33mAnd[0m [33mthe ship has not arrived at its destination[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe stuck ship "SHIP-1" should be detected[0m
    [33mAnd[0m [33ma critical warning should be logged about route-ship state mismatch[0m

  [1;37mScenario:[0m Health monitor triggers recovery for stuck ship                                     [1;30m# features/daemon/health_monitor.feature:70[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma container "container-123" exists for ship "SHIP-1" with status "RUNNING"[0m
    [33mAnd[0m [33mthe health monitor detects ship "SHIP-1" as stuck[0m
    [33mWhen[0m [33mthe health monitor attempts recovery for ship "SHIP-1"[0m
    [33mThen[0m [33ma recovery action should be initiated for ship "SHIP-1"[0m
    [33mAnd[0m [33mthe recovery attempt should be logged[0m
    [33mAnd[0m [33mthe recovery attempt count for ship "SHIP-1" should be 1[0m

  [1;37mScenario:[0m Health monitor recovery succeeds and resumes operation                              [1;30m# features/daemon/health_monitor.feature:79[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma container "container-123" exists for ship "SHIP-1" with status "RUNNING"[0m
    [33mAnd[0m [33mthe ship is stuck due to missing arrival[0m
    [33mWhen[0m [33mthe health monitor attempts recovery for ship "SHIP-1"[0m
    [33mAnd[0m [33mthe recovery action forces arrival at destination[0m
    [33mThen[0m [33mthe ship navigation status should transition to "IN_ORBIT"[0m
    [33mAnd[0m [33mthe container "container-123" should remain running[0m
    [33mAnd[0m [33mthe recovery should be marked as successful[0m

  [1;37mScenario:[0m Health monitor recovery fails and marks container as failed                         [1;30m# features/daemon/health_monitor.feature:89[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma container "container-123" exists for ship "SHIP-1" with status "RUNNING"[0m
    [33mAnd[0m [33mthe recovery action will fail with error "API timeout"[0m
    [33mWhen[0m [33mthe health monitor attempts recovery for ship "SHIP-1"[0m
    [36mThen[0m [36mthe recovery should be marked as failed[0m                                                [1;30m# health_monitor_steps.go:32 -> *HealthMonitorContext[0m
    [33mAnd[0m [33mthe container "container-123" should transition to "FAILED"[0m
    [33mAnd[0m [33man error should be logged with reason "API timeout"[0m

  [1;37mScenario:[0m Health monitor tracks recovery attempts per ship                                    [1;30m# features/daemon/health_monitor.feature:102[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mWhen[0m [33mthe health monitor attempts recovery for ship "SHIP-1" 3 times[0m
    [33mThen[0m [33mthe recovery attempt count for ship "SHIP-1" should be 3[0m
    [33mAnd[0m [33mall recovery attempts should be persisted[0m

  [1;37mScenario:[0m Health monitor abandons ship after max recovery attempts                            [1;30m# features/daemon/health_monitor.feature:108[0m
    [33mGiven[0m [33ma ship "SHIP-1" with navigation status "IN_TRANSIT" since 600 seconds ago[0m
    [33mAnd[0m [33ma container "container-123" exists for ship "SHIP-1" with status "RUNNING"[0m
    [33mAnd[0m [33mthe max recovery attempts is 5[0m
    [36mAnd[0m [36mthe ship has already failed recovery 5 times[0m                                            [1;30m# health_monitor_steps.go:33 -> *HealthMonitorContext[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe ship "SHIP-1" should be marked as abandoned[0m
    [33mAnd[0m [33mthe container "container-123" should transition to "FAILED"[0m
    [33mAnd[0m [33ma critical error should be logged about abandoning ship "SHIP-1"[0m

  [1;37mScenario:[0m Health monitor clears healthy ship from watch list                                  [1;30m# features/daemon/health_monitor.feature:118[0m
    [33mGiven[0m [33ma ship "SHIP-1" was previously stuck and is on the watch list[0m
    [33mAnd[0m [33mthe ship "SHIP-1" navigation status is now "IN_ORBIT"[0m
    [33mAnd[0m [33mthe ship has been healthy for 120 seconds[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33mthe ship "SHIP-1" should be removed from watch list[0m
    [33mAnd[0m [33mthe recovery attempt count for ship "SHIP-1" should be reset to 0[0m

  [1;37mScenario:[0m Health monitor respects cooldown between checks                                     [1;30m# features/daemon/health_monitor.feature:130[0m
    [33mGiven[0m [33mthe health monitor check interval is 60 seconds[0m
    [33mAnd[0m [33mthe health monitor last ran 30 seconds ago[0m
    [33mWhen[0m [33mthe health monitor is triggered to run[0m
    [36mThen[0m [36mthe health check should be skipped due to cooldown[0m                                     [1;30m# health_monitor_steps.go:34 -> *HealthMonitorContext[0m
    [33mAnd[0m [33mno monitoring actions should be performed[0m

  [1;37mScenario:[0m Health monitor runs after cooldown period elapses                                   [1;30m# features/daemon/health_monitor.feature:137[0m
    [33mGiven[0m [33mthe health monitor check interval is 60 seconds[0m
    [33mAnd[0m [33mthe health monitor last ran 65 seconds ago[0m
    [33mWhen[0m [33mthe health monitor is triggered to run[0m
    [33mThen[0m [33mthe health check should execute[0m
    [33mAnd[0m [33mthe last check timestamp should be updated[0m

  [1;37mScenario:[0m Health monitor detects infinite loop in navigation                                  [1;30m# features/daemon/health_monitor.feature:148[0m
    [33mGiven[0m [33ma ship "SHIP-1" is assigned to container "container-123"[0m
    [33mAnd[0m [33mthe container "container-123" has completed 50 iterations in 120 seconds[0m
    [33mAnd[0m [33mthe container max iterations is -1[0m
    [33mAnd[0m [33mthe average iteration duration is 2.4 seconds[0m
    [33mWhen[0m [33mthe health monitor runs a check[0m
    [33mThen[0m [33ma suspicious rapid iteration pattern should be detected for container "container-123"[0m
    [33mAnd[0m [33ma warning should be logged about potential infinite loop[0m

  [1;37mScenario:[0m Health monitor reports metrics on recovery success rate                             [1;30m# features/daemon/health_monitor.feature:157[0m
    [33mGiven[0m [33mthe health monitor has attempted 20 recoveries[0m
    [33mAnd[0m [33m15 recoveries were successful[0m
    [36mAnd[0m [36m5 recoveries failed[0m                                                                     [1;30m# health_monitor_steps.go:31 -> *HealthMonitorContext[0m
    [33mWhen[0m [33mthe health monitor reports metrics[0m
    [33mThen[0m [33mthe success rate should be 75 percent[0m
    [33mAnd[0m [33mthe total recovery attempts should be 20[0m
    [36mAnd[0m [36mthe failed recovery count should be 5[0m                                                   [1;30m# health_monitor_steps.go:35 -> *HealthMonitorContext[0m

[1;37mFeature:[0m Daemon Player Resolution
  As a daemon service
  I need to resolve player identifiers from requests
  So that operations can be executed for the correct player

  [1;37mBackground:[0m
    [32mGiven[0m [32mthe daemon player resolution service is initialized[0m [1;30m# daemon_player_resolution_steps.go:187 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mplayer 1 exists with agent symbol "AGENT-1"[0m           [1;30m# daemon_player_resolution_steps.go:188 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mplayer 2 exists with agent symbol "AGENT-2"[0m           [1;30m# daemon_player_resolution_steps.go:188 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolve player using player_id only               [1;30m# features/daemon/player_resolution.feature:15[0m
    [32mWhen[0m [32mI resolve player with player_id 1[0m                    [1;30m# daemon_player_resolution_steps.go:191 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                        [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe resolved player_id should be 1[0m                    [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolve player using non-zero player_id           [1;30m# features/daemon/player_resolution.feature:20[0m
    [32mWhen[0m [32mI resolve player with player_id 2[0m                    [1;30m# daemon_player_resolution_steps.go:191 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                        [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe resolved player_id should be 2[0m                    [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolve player using agent_symbol only            [1;30m# features/daemon/player_resolution.feature:29[0m
    [32mWhen[0m [32mI resolve player with agent_symbol "AGENT-1"[0m         [1;30m# daemon_player_resolution_steps.go:192 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                        [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe resolved player_id should be 1[0m                    [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolve player using different agent_symbol       [1;30m# features/daemon/player_resolution.feature:34[0m
    [32mWhen[0m [32mI resolve player with agent_symbol "AGENT-2"[0m         [1;30m# daemon_player_resolution_steps.go:192 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                        [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe resolved player_id should be 2[0m                    [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m player_id takes precedence over agent_symbol              [1;30m# features/daemon/player_resolution.feature:43[0m
    [32mWhen[0m [32mI resolve player with player_id 1 and agent_symbol "AGENT-2"[0m [1;30m# daemon_player_resolution_steps.go:193 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                                [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe resolved player_id should be 1[0m                            [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m agent_symbol is used when player_id is zero               [1;30m# features/daemon/player_resolution.feature:48[0m
    [32mWhen[0m [32mI resolve player with player_id 0 and agent_symbol "AGENT-1"[0m [1;30m# daemon_player_resolution_steps.go:193 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should succeed[0m                                [1;30m# daemon_player_resolution_steps.go:204 -> *daemonPlayerResolutionContext[0m
    [31mAnd[0m [31mthe resolved player_id should be 1[0m                            [1;30m# daemon_player_resolution_steps.go:206 -> *daemonPlayerResolutionContext[0m
    [1;31mexpected resolved player_id to be 1, got 0[0m

  [1;37mScenario:[0m Resolution fails when neither player_id nor agent_symbol provided        [1;30m# features/daemon/player_resolution.feature:57[0m
    [32mWhen[0m [32mI resolve player with player_id 0 and no agent_symbol[0m                       [1;30m# daemon_player_resolution_steps.go:194 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should fail[0m                                                  [1;30m# daemon_player_resolution_steps.go:205 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe error should contain "either player_id or agent_symbol must be provided"[0m [1;30m# daemon_player_resolution_steps.go:207 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolution fails when agent_symbol is empty string                       [1;30m# features/daemon/player_resolution.feature:62[0m
    [32mWhen[0m [32mI resolve player with player_id 0 and agent_symbol ""[0m                       [1;30m# daemon_player_resolution_steps.go:193 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should fail[0m                                                  [1;30m# daemon_player_resolution_steps.go:205 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe error should contain "either player_id or agent_symbol must be provided"[0m [1;30m# daemon_player_resolution_steps.go:207 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m Resolution fails when agent_symbol not found          [1;30m# features/daemon/player_resolution.feature:67[0m
    [32mWhen[0m [32mI resolve player with agent_symbol "UNKNOWN-AGENT"[0m       [1;30m# daemon_player_resolution_steps.go:192 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe resolution should fail[0m                               [1;30m# daemon_player_resolution_steps.go:205 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe error should contain "failed to resolve agent symbol"[0m [1;30m# daemon_player_resolution_steps.go:207 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m NavigateShip resolves player using player_id      [1;30m# features/daemon/player_resolution.feature:76[0m
    [32mWhen[0m [32mI send a NavigateShip request with player_id 1[0m       [1;30m# daemon_player_resolution_steps.go:197 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe player should be resolved to player_id 1[0m         [1;30m# daemon_player_resolution_steps.go:208 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe operation should use the correct player context[0m   [1;30m# daemon_player_resolution_steps.go:209 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m NavigateShip resolves player using agent_symbol        [1;30m# features/daemon/player_resolution.feature:81[0m
    [32mWhen[0m [32mI send a NavigateShip request with agent_symbol "AGENT-2"[0m [1;30m# daemon_player_resolution_steps.go:198 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe player should be resolved to player_id 2[0m              [1;30m# daemon_player_resolution_steps.go:208 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe operation should use the correct player context[0m        [1;30m# daemon_player_resolution_steps.go:209 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m DockShip resolves player correctly                [1;30m# features/daemon/player_resolution.feature:86[0m
    [32mWhen[0m [32mI send a DockShip request with player_id 1[0m           [1;30m# daemon_player_resolution_steps.go:199 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe player should be resolved to player_id 1[0m         [1;30m# daemon_player_resolution_steps.go:208 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe operation should use the correct player context[0m   [1;30m# daemon_player_resolution_steps.go:209 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m OrbitShip resolves player correctly                  [1;30m# features/daemon/player_resolution.feature:91[0m
    [32mWhen[0m [32mI send an OrbitShip request with agent_symbol "AGENT-1"[0m [1;30m# daemon_player_resolution_steps.go:200 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe player should be resolved to player_id 1[0m            [1;30m# daemon_player_resolution_steps.go:208 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe operation should use the correct player context[0m      [1;30m# daemon_player_resolution_steps.go:209 -> *daemonPlayerResolutionContext[0m

  [1;37mScenario:[0m RefuelShip resolves player correctly              [1;30m# features/daemon/player_resolution.feature:96[0m
    [32mWhen[0m [32mI send a RefuelShip request with player_id 2[0m         [1;30m# daemon_player_resolution_steps.go:201 -> *daemonPlayerResolutionContext[0m
    [32mThen[0m [32mthe player should be resolved to player_id 2[0m         [1;30m# daemon_player_resolution_steps.go:208 -> *daemonPlayerResolutionContext[0m
    [32mAnd[0m [32mthe operation should use the correct player context[0m   [1;30m# daemon_player_resolution_steps.go:209 -> *daemonPlayerResolutionContext[0m

[1;37mFeature:[0m Ship Assignment and Locking
  As a daemon orchestrator
  I want to track and enforce ship assignments to containers
  So that ships cannot be used by multiple operations concurrently

  [1;37mBackground:[0m
    [32mGiven[0m [32ma player exists with id 1[0m                                                           [1;30m# ship_assignment_steps.go:693 -> *shipAssignmentContext[0m
    [32mAnd[0m [32ma ship "TEST-SHIP-1" exists for player 1[0m                                              [1;30m# daemon_server_steps.go:115 -> *daemonServerContext[0m

  [1;37mScenario:[0m Ship can be assigned to container                                                 [1;30m# features/daemon/ship_assignment.feature:14[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m              [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI assign ship "TEST-SHIP-1" to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:703 -> *shipAssignmentContext[0m
    [31mThen[0m [31mship "TEST-SHIP-1" should be assigned to container "nav-container-1"[0m                 [1;30m# ship_assignment_steps.go:740 -> *shipAssignmentContext[0m
    [1;31mship TEST-SHIP-1 is not assigned to any container[0m
    [36mAnd[0m [36mthe ship assignment status should be "active"[0m                                         [1;30m# ship_assignment_steps.go:742 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mthe ship assignment operation should be "navigate"[0m                                    [1;30m# ship_assignment_steps.go:744 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mthe ship assignment player_id should be 1[0m                                             [1;30m# ship_assignment_steps.go:746 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mthe ship assignment should have an assigned_at timestamp[0m                              [1;30m# ship_assignment_steps.go:748 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship cannot be assigned to multiple containers                                            [1;30m# features/daemon/ship_assignment.feature:23[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                      [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32ma container "dock-container-2" exists with type "DOCK" for player 1[0m                           [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m       [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI attempt to assign ship "TEST-SHIP-1" to container "dock-container-2" with operation "dock"[0m [1;30m# ship_assignment_steps.go:707 -> *shipAssignmentContext[0m
    [31mThen[0m [31mthe assignment should fail with error "ship is already assigned to another container"[0m        [1;30m# ship_assignment_steps.go:750 -> *shipAssignmentContext[0m
    [1;31mexpected error containing 'ship is already assigned to another container' but got 'ship TEST-SHIP-1 does not exist'[0m
    [36mAnd[0m [36mship "TEST-SHIP-1" should still be assigned to container "nav-container-1"[0m                    [1;30m# ship_assignment_steps.go:752 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment persists in database                                              [1;30m# features/daemon/ship_assignment.feature:31[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m              [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI assign ship "TEST-SHIP-1" to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:703 -> *shipAssignmentContext[0m
    [31mThen[0m [31mthe ship assignment should be persisted in the database[0m                              [1;30m# ship_assignment_steps.go:766 -> *shipAssignmentContext[0m
    [1;31mno assignment to persist[0m
    [36mAnd[0m [36mquerying the database should return the assignment for ship "TEST-SHIP-1"[0m             [1;30m# ship_assignment_steps.go:768 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment is released when container stops                                    [1;30m# features/daemon/ship_assignment.feature:41[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mthe container "nav-container-1" transitions to "STOPPED" status[0m                        [1;30m# ship_assignment_steps.go:699 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mI release the ship assignment for "TEST-SHIP-1" with reason "container_stopped"[0m         [1;30m# ship_assignment_steps.go:709 -> *shipAssignmentContext[0m
    [32mThen[0m [32mship "TEST-SHIP-1" should no longer be assigned to any container[0m                       [1;30m# ship_assignment_steps.go:754 -> *shipAssignmentContext[0m
    [31mAnd[0m [31mthe ship assignment should have a released_at timestamp[0m                                 [1;30m# ship_assignment_steps.go:756 -> *shipAssignmentContext[0m
    [1;31mno assignment to check released_at timestamp[0m
    [36mAnd[0m [36mthe ship assignment release_reason should be "container_stopped"[0m                        [1;30m# daemon_server_steps.go:181 -> *daemonServerContext[0m

  [1;37mScenario:[0m Ship assignment is released when container fails                                    [1;30m# features/daemon/ship_assignment.feature:50[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mthe container "nav-container-1" transitions to "FAILED" status[0m                         [1;30m# ship_assignment_steps.go:699 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mI release the ship assignment for "TEST-SHIP-1" with reason "container_failed"[0m          [1;30m# ship_assignment_steps.go:709 -> *shipAssignmentContext[0m
    [32mThen[0m [32mship "TEST-SHIP-1" should no longer be assigned to any container[0m                       [1;30m# ship_assignment_steps.go:754 -> *shipAssignmentContext[0m
    [31mAnd[0m [31mthe ship assignment should have a released_at timestamp[0m                                 [1;30m# ship_assignment_steps.go:756 -> *shipAssignmentContext[0m
    [1;31mno assignment to check released_at timestamp[0m
    [36mAnd[0m [36mthe ship assignment release_reason should be "container_failed"[0m                         [1;30m# daemon_server_steps.go:181 -> *daemonServerContext[0m

  [1;37mScenario:[0m Ship assignment is released when daemon stops gracefully                            [1;30m# features/daemon/ship_assignment.feature:59[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mthe daemon receives shutdown signal[0m                                                    [1;30m# ship_assignment_steps.go:724 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mI release all ship assignments with reason "daemon_shutdown"[0m                            [1;30m# ship_assignment_steps.go:711 -> *shipAssignmentContext[0m
    [32mThen[0m [32mship "TEST-SHIP-1" should no longer be assigned to any container[0m                       [1;30m# ship_assignment_steps.go:754 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mthe ship assignment release_reason should be "daemon_shutdown"[0m                          [1;30m# daemon_server_steps.go:181 -> *daemonServerContext[0m

  [1;37mScenario:[0m Orphaned ship assignments are cleaned on daemon startup                                   [1;30m# features/daemon/ship_assignment.feature:71[0m
    [31mGiven[0m [31mship "TEST-SHIP-1" has an orphaned assignment to non-existent container "old-container-999"[0m [1;30m# ship_assignment_steps.go:715 -> *shipAssignmentContext[0m
    [1;31mship TEST-SHIP-1 does not exist[0m
    [36mAnd[0m [36mthe assignment was created 2 hours ago[0m                                                        [1;30m# ship_assignment_steps.go:717 -> *shipAssignmentContext[0m
    [36mWhen[0m [36mthe daemon starts up[0m                                                                         [1;30m# ship_assignment_steps.go:723 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mI clean orphaned ship assignments[0m                                                             [1;30m# ship_assignment_steps.go:725 -> *shipAssignmentContext[0m
    [36mThen[0m [36mship "TEST-SHIP-1" should no longer be assigned to any container[0m                             [1;30m# ship_assignment_steps.go:754 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mthe orphaned assignment cleanup count should be 1[0m                                             [1;30m# ship_assignment_steps.go:760 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment includes player_id validation                                                 [1;30m# features/daemon/ship_assignment.feature:83[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                          [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32ma ship "OTHER-SHIP-1" exists for player 2[0m                                                         [1;30m# daemon_server_steps.go:115 -> *daemonServerContext[0m
    [32mWhen[0m [32mI attempt to assign ship "OTHER-SHIP-1" to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:707 -> *shipAssignmentContext[0m
    [31mThen[0m [31mthe assignment should fail with error "ship player_id mismatch"[0m                                  [1;30m# ship_assignment_steps.go:750 -> *shipAssignmentContext[0m
    [1;31mexpected error containing 'ship player_id mismatch' but got 'ship OTHER-SHIP-1 does not exist'[0m
    [36mAnd[0m [36mship "OTHER-SHIP-1" should not be assigned to any container[0m                                       [1;30m# ship_assignment_steps.go:762 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment prevents concurrent navigation commands                             [1;30m# features/daemon/ship_assignment.feature:94[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI attempt to execute a navigation command for ship "TEST-SHIP-1"[0m                       [1;30m# ship_assignment_steps.go:731 -> *shipAssignmentContext[0m
    [31mThen[0m [31mthe navigation command should be rejected with error "ship is locked by container"[0m     [1;30m# ship_assignment_steps.go:772 -> *shipAssignmentContext[0m
    [1;31mexpected command error containing 'ship is locked by container' but got no error[0m
    [36mAnd[0m [36mthe error should include container_id "nav-container-1"[0m                                 [1;30m# ship_assignment_steps.go:774 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment allows read-only queries during lock                                [1;30m# features/daemon/ship_assignment.feature:101[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI query ship details for "TEST-SHIP-1"[0m                                                 [1;30m# ship_assignment_steps.go:733 -> *shipAssignmentContext[0m
    [32mThen[0m [32mthe query should succeed[0m                                                               [1;30m# ship_assignment_steps.go:776 -> *shipAssignmentContext[0m
    [31mAnd[0m [31mthe ship details should include assignment status "locked"[0m                              [1;30m# ship_assignment_steps.go:777 -> *shipAssignmentContext[0m
    [1;31mexpected assignment_status 'locked' but got 'unlocked'[0m
    [36mAnd[0m [36mthe ship details should include container_id "nav-container-1"[0m                          [1;30m# ship_assignment_steps.go:779 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment lock timeout after 30 minutes                                       [1;30m# features/daemon/ship_assignment.feature:113[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mthe assignment was created 31 minutes ago[0m                                               [1;30m# ship_assignment_steps.go:719 -> *shipAssignmentContext[0m
    [31mWhen[0m [31mI check if the ship assignment is stale[0m                                                [1;30m# ship_assignment_steps.go:726 -> *shipAssignmentContext[0m
    [1;31mno assignment found[0m
    [36mThen[0m [36mthe assignment should be marked as stale[0m                                               [1;30m# ship_assignment_steps.go:783 -> *shipAssignmentContext[0m
    [36mAnd[0m [36mI should be able to forcefully release the stale assignment[0m                             [1;30m# ship_assignment_steps.go:727 -> *shipAssignmentContext[0m

  [1;37mScenario:[0m Ship assignment reacquire fails if still locked                                     [1;30m# features/daemon/ship_assignment.feature:121[0m
    [32mGiven[0m [32ma container "nav-container-1" exists with type "NAVIGATE" for player 1[0m                [1;30m# ship_assignment_steps.go:697 -> *shipAssignmentContext[0m
    [32mAnd[0m [32mship "TEST-SHIP-1" is assigned to container "nav-container-1" with operation "navigate"[0m [1;30m# ship_assignment_steps.go:705 -> *shipAssignmentContext[0m
    [32mWhen[0m [32mI attempt to reassign ship "TEST-SHIP-1" from "nav-container-1" to "nav-container-2"[0m   [1;30m# ship_assignment_steps.go:736 -> *shipAssignmentContext[0m
    [31mThen[0m [31mthe reassignment should fail with error "ship is still locked"[0m                         [1;30m# ship_assignment_steps.go:785 -> *shipAssignmentContext[0m
    [1;31mexpected error containing 'ship is still locked' but got 'ship not assigned'[0m
    [36mAnd[0m [36mship "TEST-SHIP-1" should still be assigned to container "nav-container-1"[0m              [1;30m# ship_assignment_steps.go:752 -> *shipAssignmentContext[0m

--- [31mFailed steps:[0m

  [31mScenario: Deliver to contract before accepting raises error[0m [1;30m# features/domain/contract/contract_entity.feature:144[0m
    [31mThen I should get a contract error "contract not accepted"[0m [1;30m# features/domain/contract/contract_entity.feature:147[0m
      [31mError: [0m[1;31mexpected error 'contract not accepted', got nil[0m

  [31mScenario: Cannot start transit to same location[0m [1;30m# features/domain/navigation/ship_entity.feature:514[0m
    [31mThen the operation should fail with error "cannot transit to same location"[0m [1;30m# features/domain/navigation/ship_entity.feature:517[0m
      [31mError: [0m[1;31mexpected error containing 'cannot transit to same location' but got no error[0m

  [31mScenario: Build graph from API when cache is empty[0m [1;30m# features/application/navigate_ship_handler.feature:24[0m
    [31mAnd navigation should succeed[0m [1;30m# features/application/navigate_ship_handler.feature:35[0m
      [31mError: [0m[1;31mexpected success but got error: Waypoint X1-NEW-B1 not found in cache for system X1-NEW. Destination waypoint is missing from waypoint cache. Please sync waypoints from API.[0m

  [31mScenario: Reject navigation with empty waypoint cache[0m [1;30m# features/application/navigate_ship_handler.feature:54[0m
    [31mThen the command should fail with error "waypoint cache is empty"[0m [1;30m# features/application/navigate_ship_handler.feature:60[0m
      [31mError: [0m[1;31mexpected error containing 'waypoint cache is empty' but command succeeded[0m

  [31mScenario: Reject navigation when ship location missing from cache[0m [1;30m# features/application/navigate_ship_handler.feature:64[0m
    [31mThen the command should fail with error "Ship location is missing from waypoint cache"[0m [1;30m# features/application/navigate_ship_handler.feature:71[0m
      [31mError: [0m[1;31mexpected error containing 'Ship location is missing from waypoint cache' but command succeeded[0m

  [31mScenario: Reject navigation when destination missing from cache[0m [1;30m# features/application/navigate_ship_handler.feature:74[0m
    [31mThen the command should fail with error "Destination waypoint is missing from waypoint cache"[0m [1;30m# features/application/navigate_ship_handler.feature:81[0m
      [31mError: [0m[1;31mexpected error containing 'Destination waypoint is missing from waypoint cache' but command succeeded[0m

  [31mScenario: Route not found - provide detailed statistics[0m [1;30m# features/application/navigate_ship_handler.feature:84[0m
    [31mThen the error should include "No route found"[0m [1;30m# features/application/navigate_ship_handler.feature:91[0m
      [31mError: [0m[1;31mexpected error to mention 'No route found' but got 'failed to get ship: failed to convert ship data: failed to get location waypoint: waypoint not found: X1-GZ7-A1'[0m

  [31mScenario: Ship already at destination - return success immediately[0m [1;30m# features/application/navigate_ship_handler.feature:102[0m
    [31mAnd the route should have 0 segments[0m [1;30m# features/application/navigate_ship_handler.feature:110[0m
      [31mError: [0m[1;31mruntime error: invalid memory address or nil pointer dereference
runtime.gopanic
	/usr/local/go1.24.7/src/runtime/panic.go:792
runtime.panicmem
	/usr/local/go1.24.7/src/runtime/panic.go:262
runtime.sigpanic
	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
github.com/andrescamacho/spacetraders-go/internal/domain/navigation.(*Route).Segments
	/home/user/spacetraders/gobot/internal/domain/navigation/route.go:148
github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*routeContext).theRouteShouldHaveSegments
	/home/user/spacetraders/gobot/test/bdd/steps/route_steps.go:195
reflect.Value.call
	/usr/local/go1.24.7/src/reflect/value.go:584
reflect.Value.Call
	/usr/local/go1.24.7/src/reflect/value.go:368
github.com/cucumber/godog/internal/models.(*StepDefinition).Run
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
github.com/cucumber/godog.(*suite).runStep
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
github.com/cucumber/godog.(*suite).runSteps
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
github.com/cucumber/godog.(*suite).runPickle.func1
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
testing.tRunner
	/usr/local/go1.24.7/src/testing/testing.go:1792
runtime.goexit
	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700[0m

  [31mScenario: Successfully navigate ship from orbit[0m [1;30m# features/application/navigate_to_waypoint.feature:9[0m
    [31mAnd the response should include arrival time[0m [1;30m# features/application/navigate_to_waypoint.feature:15[0m
      [31mError: [0m[1;31mexpected arrival time in response[0m

  [31mScenario: Navigate ship that is docked (auto-orbits first)[0m [1;30m# features/application/navigate_to_waypoint.feature:18[0m
    [31mThen the navigation should succeed with status "navigating"[0m [1;30m# features/application/navigate_to_waypoint.feature:22[0m
      [31mError: [0m[1;31mexpected success but got error: failed to navigate: failed to navigate ship: failed to start transit: ship must be in orbit to start transit, currently: DOCKED[0m

  [31mScenario: Handle ship already in transit - wait for arrival first[0m [1;30m# features/application/route_executor.feature:87[0m
    [31mAnd the route execution should succeed[0m [1;30m# features/application/route_executor.feature:94[0m
      [31mError: [0m[1;31mexpected route execution to succeed but got error: failed to fetch ship data from API: failed to find player: player not found: 1[0m

  [31mScenario: Circuit breaker wraps entire retry sequence[0m [1;30m# features/adapters/api/api_client_integration.feature:15[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Circuit opens after multiple failed retry sequences[0m [1;30m# features/adapters/api/api_client_integration.feature:23[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Open circuit prevents retry attempts[0m [1;30m# features/adapters/api/api_client_integration.feature:30[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Successful requests reset circuit breaker failure count[0m [1;30m# features/adapters/api/api_client_integration.feature:37[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Rate limiting applies to retry attempts[0m [1;30m# features/adapters/api/api_client_integration.feature:45[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Multiple concurrent requests with retries respect rate limit[0m [1;30m# features/adapters/api/api_client_integration.feature:56[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Open circuit prevents rate limiter from being used[0m [1;30m# features/adapters/api/api_client_integration.feature:64[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Circuit breaker state transitions don't affect rate limiting[0m [1;30m# features/adapters/api/api_client_integration.feature:71[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Circuit breaker, retries, and rate limiting work harmoniously[0m [1;30m# features/adapters/api/api_client_integration.feature:81[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Non-retryable error does not count toward circuit breaker threshold[0m [1;30m# features/adapters/api/api_client_integration.feature:96[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Context cancellation bypasses all resilience patterns[0m [1;30m# features/adapters/api/api_client_integration.feature:104[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Circuit recovery after timeout allows new requests[0m [1;30m# features/adapters/api/api_client_integration.feature:111[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Handling SpaceTraders API maintenance window[0m [1;30m# features/adapters/api/api_client_integration.feature:121[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Handling temporary network issues[0m [1;30m# features/adapters/api/api_client_integration.feature:131[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Handling rate limit errors with backoff[0m [1;30m# features/adapters/api/api_client_integration.feature:138[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Fast path for successful requests[0m [1;30m# features/adapters/api/api_client_integration.feature:147[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Metrics and observability[0m [1;30m# features/adapters/api/api_client_integration.feature:155[0m
    [31mGiven an API client with the following configuration:[0m [1;30m# features/adapters/api/api_client_integration.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: API integration step definitions need to be implemented[0m

  [31mScenario: Circuit starts in closed state[0m [1;30m# features/adapters/api/circuit_breaker.feature:10[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit opens after max consecutive failures[0m [1;30m# features/adapters/api/circuit_breaker.feature:14[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit remains open within timeout period[0m [1;30m# features/adapters/api/circuit_breaker.feature:20[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit transitions to half-open after timeout expires[0m [1;30m# features/adapters/api/circuit_breaker.feature:26[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Failure in half-open state reopens circuit[0m [1;30m# features/adapters/api/circuit_breaker.feature:32[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Success in half-open state closes circuit[0m [1;30m# features/adapters/api/circuit_breaker.feature:38[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit does not open with non-consecutive failures[0m [1;30m# features/adapters/api/circuit_breaker.feature:45[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Manual reset closes circuit and clears failures[0m [1;30m# features/adapters/api/circuit_breaker.feature:53[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit breaker tracks state transitions correctly[0m [1;30m# features/adapters/api/circuit_breaker.feature:59[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Circuit breaker prevents cascading failures[0m [1;30m# features/adapters/api/circuit_breaker.feature:67[0m
    [31mGiven a circuit breaker with max failures 5 and timeout 60 seconds[0m [1;30m# features/adapters/api/circuit_breaker.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Circuit breaker step definitions need to be implemented[0m

  [31mScenario: Allow burst of requests within limit[0m [1;30m# features/adapters/api/rate_limiting.feature:10[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Throttle third request in same second[0m [1;30m# features/adapters/api/rate_limiting.feature:16[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter refills after 1 second[0m [1;30m# features/adapters/api/rate_limiting.feature:23[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Multiple concurrent requests respect rate limit[0m [1;30m# features/adapters/api/rate_limiting.feature:30[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter is thread-safe under concurrent load[0m [1;30m# features/adapters/api/rate_limiting.feature:36[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Burst allows immediate requests up to burst size[0m [1;30m# features/adapters/api/rate_limiting.feature:42[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Tokens refill at specified rate[0m [1;30m# features/adapters/api/rate_limiting.feature:48[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Tokens do not exceed burst capacity[0m [1;30m# features/adapters/api/rate_limiting.feature:53[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Single request does not get throttled[0m [1;30m# features/adapters/api/rate_limiting.feature:60[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Requests spread over time do not trigger throttling[0m [1;30m# features/adapters/api/rate_limiting.feature:65[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter allows sustained rate of 2 req/sec[0m [1;30m# features/adapters/api/rate_limiting.feature:72[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Waiting request is cancelled when context is cancelled[0m [1;30m# features/adapters/api/rate_limiting.feature:78[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter prevents bursting beyond API limits[0m [1;30m# features/adapters/api/rate_limiting.feature:86[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter works with retry logic[0m [1;30m# features/adapters/api/rate_limiting.feature:92[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter has minimal overhead for allowed requests[0m [1;30m# features/adapters/api/rate_limiting.feature:100[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter accurately delays throttled requests[0m [1;30m# features/adapters/api/rate_limiting.feature:105[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter validates positive rate[0m [1;30m# features/adapters/api/rate_limiting.feature:112[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Rate limiter validates positive burst[0m [1;30m# features/adapters/api/rate_limiting.feature:116[0m
    [31mGiven a rate limiter with limit 2 requests per second and burst 2[0m [1;30m# features/adapters/api/rate_limiting.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Rate limiting step definitions need to be implemented[0m

  [31mScenario: Request succeeds on first attempt[0m [1;30m# features/adapters/api/retry_logic.feature:10[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Request succeeds on second attempt after transient failure[0m [1;30m# features/adapters/api/retry_logic.feature:16[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Request succeeds on third attempt with exponential backoff[0m [1;30m# features/adapters/api/retry_logic.feature:26[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on 429 Too Many Requests[0m [1;30m# features/adapters/api/retry_logic.feature:38[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on 500 Internal Server Error[0m [1;30m# features/adapters/api/retry_logic.feature:47[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on 502 Bad Gateway[0m [1;30m# features/adapters/api/retry_logic.feature:55[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on 503 Service Unavailable[0m [1;30m# features/adapters/api/retry_logic.feature:63[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on 504 Gateway Timeout[0m [1;30m# features/adapters/api/retry_logic.feature:71[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on 400 Bad Request[0m [1;30m# features/adapters/api/retry_logic.feature:80[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on 401 Unauthorized[0m [1;30m# features/adapters/api/retry_logic.feature:86[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on 403 Forbidden[0m [1;30m# features/adapters/api/retry_logic.feature:92[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on 404 Not Found[0m [1;30m# features/adapters/api/retry_logic.feature:98[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on 409 Conflict[0m [1;30m# features/adapters/api/retry_logic.feature:104[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Fail after max retries exceeded[0m [1;30m# features/adapters/api/retry_logic.feature:111[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Exponential backoff delays increase correctly[0m [1;30m# features/adapters/api/retry_logic.feature:117[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on connection refused[0m [1;30m# features/adapters/api/retry_logic.feature:129[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Retry on timeout[0m [1;30m# features/adapters/api/retry_logic.feature:138[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Do not retry on context cancelled[0m [1;30m# features/adapters/api/retry_logic.feature:147[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Respect Retry-After header on 429 response[0m [1;30m# features/adapters/api/retry_logic.feature:155[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Use exponential backoff when Retry-After is not provided[0m [1;30m# features/adapters/api/retry_logic.feature:164[0m
    [31mGiven an API client with max retries 3 and initial backoff 1 second[0m [1;30m# features/adapters/api/retry_logic.feature:7[0m
      [31mError: [0m[1;31mNOT IMPLEMENTED: Retry logic step definitions need to be implemented[0m

  [31mScenario: Upsert with empty trade goods list[0m [1;30m# features/adapters/persistence/market_repository.feature:94[0m
    [31mAnd the database should contain 1 market record[0m [1;30m# features/adapters/persistence/market_repository.feature:100[0m
      [31mError: [0m[1;31mexpected 1 market records, got 0[0m

  [31mScenario: Daemon server fails to start if socket path is invalid[0m [1;30m# features/daemon/daemon_server.feature:24[0m
    [31mAnd the error should mention "failed to create unix socket listener"[0m [1;30m# features/daemon/daemon_server.feature:28[0m
      [31mError: [0m[1;31mexpected error mentioning 'failed to create unix socket listener' but got no error[0m

  [31mScenario: Daemon server creates container for navigation operation[0m [1;30m# features/daemon/daemon_server.feature:61[0m
    [31mAnd the container should have player_id 1[0m [1;30m# features/daemon/daemon_server.feature:68[0m
      [31mError: [0m[1;31mruntime error: invalid memory address or nil pointer dereference
runtime.gopanic
	/usr/local/go1.24.7/src/runtime/panic.go:792
runtime.panicmem
	/usr/local/go1.24.7/src/runtime/panic.go:262
runtime.sigpanic
	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
github.com/andrescamacho/spacetraders-go/internal/domain/container.(*Container).PlayerID
	/home/user/spacetraders/gobot/internal/domain/container/container.go:119
github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*containerLifecycleContext).theContainerShouldHavePlayerID
	/home/user/spacetraders/gobot/test/bdd/steps/container_lifecycle_steps.go:812
reflect.Value.call
	/usr/local/go1.24.7/src/reflect/value.go:584
reflect.Value.Call
	/usr/local/go1.24.7/src/reflect/value.go:368
github.com/cucumber/godog/internal/models.(*StepDefinition).Run
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
github.com/cucumber/godog.(*suite).runStep
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
github.com/cucumber/godog.(*suite).runSteps
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
github.com/cucumber/godog.(*suite).runPickle.func1
	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
testing.tRunner
	/usr/local/go1.24.7/src/testing/testing.go:1792
runtime.goexit
	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700[0m

  [31mScenario: Daemon server tracks multiple concurrent operations[0m [1;30m# features/daemon/daemon_server.feature:90[0m
    [31mAnd all containers should be registered in the daemon[0m [1;30m# features/daemon/daemon_server.feature:99[0m
      [31mError: [0m[1;31mexpected 0 containers, got 3[0m

  [31mScenario: Daemon server removes Unix socket on shutdown[0m [1;30m# features/daemon/daemon_server.feature:159[0m
    [31mAnd the socket file should not exist[0m [1;30m# features/daemon/daemon_server.feature:164[0m
      [31mError: [0m[1;31msocket file still exists at /tmp/test-daemon.sock[0m

  [31mScenario: agent_symbol is used when player_id is zero[0m [1;30m# features/daemon/player_resolution.feature:48[0m
    [31mAnd the resolved player_id should be 1[0m [1;30m# features/daemon/player_resolution.feature:51[0m
      [31mError: [0m[1;31mexpected resolved player_id to be 1, got 0[0m

  [31mScenario: Ship can be assigned to container[0m [1;30m# features/daemon/ship_assignment.feature:14[0m
    [31mThen ship "TEST-SHIP-1" should be assigned to container "nav-container-1"[0m [1;30m# features/daemon/ship_assignment.feature:17[0m
      [31mError: [0m[1;31mship TEST-SHIP-1 is not assigned to any container[0m

  [31mScenario: Ship cannot be assigned to multiple containers[0m [1;30m# features/daemon/ship_assignment.feature:23[0m
    [31mThen the assignment should fail with error "ship is already assigned to another container"[0m [1;30m# features/daemon/ship_assignment.feature:28[0m
      [31mError: [0m[1;31mexpected error containing 'ship is already assigned to another container' but got 'ship TEST-SHIP-1 does not exist'[0m

  [31mScenario: Ship assignment persists in database[0m [1;30m# features/daemon/ship_assignment.feature:31[0m
    [31mThen the ship assignment should be persisted in the database[0m [1;30m# features/daemon/ship_assignment.feature:34[0m
      [31mError: [0m[1;31mno assignment to persist[0m

  [31mScenario: Ship assignment is released when container stops[0m [1;30m# features/daemon/ship_assignment.feature:41[0m
    [31mAnd the ship assignment should have a released_at timestamp[0m [1;30m# features/daemon/ship_assignment.feature:47[0m
      [31mError: [0m[1;31mno assignment to check released_at timestamp[0m

  [31mScenario: Ship assignment is released when container fails[0m [1;30m# features/daemon/ship_assignment.feature:50[0m
    [31mAnd the ship assignment should have a released_at timestamp[0m [1;30m# features/daemon/ship_assignment.feature:56[0m
      [31mError: [0m[1;31mno assignment to check released_at timestamp[0m

  [31mScenario: Orphaned ship assignments are cleaned on daemon startup[0m [1;30m# features/daemon/ship_assignment.feature:71[0m
    [31mGiven ship "TEST-SHIP-1" has an orphaned assignment to non-existent container "old-container-999"[0m [1;30m# features/daemon/ship_assignment.feature:72[0m
      [31mError: [0m[1;31mship TEST-SHIP-1 does not exist[0m

  [31mScenario: Ship assignment includes player_id validation[0m [1;30m# features/daemon/ship_assignment.feature:83[0m
    [31mThen the assignment should fail with error "ship player_id mismatch"[0m [1;30m# features/daemon/ship_assignment.feature:87[0m
      [31mError: [0m[1;31mexpected error containing 'ship player_id mismatch' but got 'ship OTHER-SHIP-1 does not exist'[0m

  [31mScenario: Ship assignment prevents concurrent navigation commands[0m [1;30m# features/daemon/ship_assignment.feature:94[0m
    [31mThen the navigation command should be rejected with error "ship is locked by container"[0m [1;30m# features/daemon/ship_assignment.feature:98[0m
      [31mError: [0m[1;31mexpected command error containing 'ship is locked by container' but got no error[0m

  [31mScenario: Ship assignment allows read-only queries during lock[0m [1;30m# features/daemon/ship_assignment.feature:101[0m
    [31mAnd the ship details should include assignment status "locked"[0m [1;30m# features/daemon/ship_assignment.feature:106[0m
      [31mError: [0m[1;31mexpected assignment_status 'locked' but got 'unlocked'[0m

  [31mScenario: Ship assignment lock timeout after 30 minutes[0m [1;30m# features/daemon/ship_assignment.feature:113[0m
    [31mWhen I check if the ship assignment is stale[0m [1;30m# features/daemon/ship_assignment.feature:117[0m
      [31mError: [0m[1;31mno assignment found[0m

  [31mScenario: Ship assignment reacquire fails if still locked[0m [1;30m# features/daemon/ship_assignment.feature:121[0m
    [31mThen the reassignment should fail with error "ship is still locked"[0m [1;30m# features/daemon/ship_assignment.feature:125[0m
      [31mError: [0m[1;31mexpected error containing 'ship is still locked' but got 'ship not assigned'[0m


648 scenarios ([32m450 passed[0m, [31m93 failed[0m, [33m167 undefined[0m)
3519 steps ([32m2615 passed[0m, [31m93 failed[0m, [33m584 undefined[0m, [36m227 skipped[0m)
39.535342421s

[33mYou can implement step definitions for undefined steps with these snippets:[0m
[33m
func aContainerExistsForShipWithStatus(arg1, arg2, arg3 string) error {
	return godog.ErrPending
}

func aContractRepository() error {
	return godog.ErrPending
}

func aContractWithDeadline(arg1 string) error {
	return godog.ErrPending
}

func aContractWithNoDeadline() error {
	return godog.ErrPending
}

func aCriticalErrorShouldBeLoggedAboutAbandoningShip(arg1 string) error {
	return godog.ErrPending
}

func aCriticalWarningShouldBeLoggedAboutRouteshipStateMismatch() error {
	return godog.ErrPending
}

func aFullyFulfilledContract() error {
	return godog.ErrPending
}

func aMediatorIsConfiguredWithScoutingHandlers() error {
	return godog.ErrPending
}

func aMediatorIsInitialized() error {
	return godog.ErrPending
}

func aMockAPIClient() error {
	return godog.ErrPending
}

func aPIReturnsSegmentTravelTimeOfSeconds(arg1 int) error {
	return godog.ErrPending
}

func aPIReturnsTravelTimeInThePast() error {
	return godog.ErrPending
}

func aPlayerRepository() error {
	return godog.ErrPending
}

func aRecoveryActionShouldBeInitiatedForShip(arg1 string) error {
	return godog.ErrPending
}

func aRouteForShipExistsWithStatus(arg1, arg2 string) error {
	return godog.ErrPending
}

func aRouteSegmentRequiringUnitsOfFuelInCRUISEMode(arg1 int) error {
	return godog.ErrPending
}

func aRouteSegmentRequiringUnitsOfFuelInDRIFTMode(arg1 int) error {
	return godog.ErrPending
}

func aShipAtWithUnitsOfFuelAndCapacity(arg1 string, arg2, arg3 int) error {
	return godog.ErrPending
}

func aShipIsAssignedToContainer(arg1, arg2 string) error {
	return godog.ErrPending
}

func aShipWasPreviouslyStuckAndIsOnTheWatchList(arg1 string) error {
	return godog.ErrPending
}

func aShipWithNavigationStatusSinceSecondsAgo(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func aShipWithPlayerIDIsAssignedToContainerForOperation(arg1 string, arg2 int, arg3, arg4 string) error {
	return godog.ErrPending
}

func aSuspiciousRapidIterationPatternShouldBeDetectedForContainer(arg1 string) error {
	return godog.ErrPending
}

func aValidAcceptedContractWithMultipleDeliveries(arg1 *godog.Table) error {
	return godog.ErrPending
}

func aValidUnacceptedContractWithAllDeliveriesComplete() error {
	return godog.ErrPending
}

func aWarningShouldBeLoggedAboutPotentialInfiniteLoop() error {
	return godog.ErrPending
}

func aWarningShouldBeLoggedAboutStuckShip(arg1 string) error {
	return godog.ErrPending
}

func aWaypointWithOrbitals(arg1, arg2 string) error {
	return godog.ErrPending
}

func allOperationsShouldFailImmediately(arg1 int) error {
	return godog.ErrPending
}

func allRecoveryAttemptsShouldBePersisted() error {
	return godog.ErrPending
}

func allRequestsShouldComplete(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldEventuallyComplete() error {
	return godog.ErrPending
}

func allRequestsShouldEventuallyComplete(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldEventuallySucceed(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldFail(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldFailImmediately(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldProceedImmediately(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldSucceed() error {
	return godog.ErrPending
}

func allRequestsShouldSucceed(arg1 int) error {
	return godog.ErrPending
}

func allRequestsShouldSucceedAfterRetry(arg1 int) error {
	return godog.ErrPending
}

func allRetryAttemptsShouldAlsoRespectRateLimiting() error {
	return godog.ErrPending
}

func allRetryAttemptsShouldRespectRateLimiting() error {
	return godog.ErrPending
}

func allShipAssignmentsShouldBeReleasedWithReason(arg1 string) error {
	return godog.ErrPending
}

func anAPIClientWithRateLimitingAndRetryEnabled() error {
	return godog.ErrPending
}

func anAPIClientWithRateLimitingEnabled() error {
	return godog.ErrPending
}

func anErrorShouldBeLoggedWithReason(arg1 string) error {
	return godog.ErrPending
}

func atMostHTTPRequestShouldHaveBeenMade(arg1 int) error {
	return godog.ErrPending
}

func averageLatencyShouldBeUnderMsExcludingNetwork(arg1 int) error {
	return godog.ErrPending
}

func bothDistancesShouldBeEqual() error {
	return godog.ErrPending
}

func bothRequestsShouldProceedWithoutDelay() error {
	return godog.ErrPending
}

func containerShouldBeMarkedAsReused(arg1 int) error {
	return godog.ErrPending
}

func contractCreationShouldFailWithError(arg1 string) error {
	return godog.ErrPending
}

func creationShouldFailWith(arg1 string) error {
	return godog.ErrPending
}

func currentLocationHasFuelAvailable() error {
	return godog.ErrPending
}

func currentTimeIs(arg1 string) error {
	return godog.ErrPending
}

func deliveryShouldBeComplete(arg1 string) error {
	return godog.ErrPending
}

func deliveryShouldHaveOfUnitsFulfilled(arg1 string, arg2, arg3 int) error {
	return godog.ErrPending
}

func dockAPIIsCalled() error {
	return godog.ErrPending
}

func dockAPIReturnsError(arg1 string) error {
	return godog.ErrPending
}

func eachRequestShouldHaveLessThanMsRateLimiterOverhead(arg1 int) error {
	return godog.ErrPending
}

func eventuallySucceed() error {
	return godog.ErrPending
}

func exactlyHTTPAttemptsShouldHaveBeenMade(arg1 int) error {
	return godog.ErrPending
}

func finalStatusShouldBeIN_ORBITAt(arg1 string) error {
	return godog.ErrPending
}

func flightModeShouldBeSetToBeforeNavigateAPICall(arg1 string) error {
	return godog.ErrPending
}

func fuelShouldBeAt(arg1 int) error {
	return godog.ErrPending
}

func handlerShouldAddSecondBuffer(arg1 int) error {
	return godog.ErrPending
}

func handlerShouldCalculateWaitTimeAsSeconds(arg1 int) error {
	return godog.ErrPending
}

func iAddUnitsOfFuel(arg1 int) error {
	return godog.ErrPending
}

func iAttemptToAddUnitsOfFuel(arg1 int) error {
	return godog.ErrPending
}

func iAttemptToCreateAContractWithEmptyContract_id() error {
	return godog.ErrPending
}

func iAttemptToCreateAContractWithEmptyFaction_symbol() error {
	return godog.ErrPending
}

func iAttemptToCreateAContractWithPlayer_id(arg1 int) error {
	return godog.ErrPending
}

func iAttemptToCreateAContractWithPlayer_id(arg1 int) error {
	return godog.ErrPending
}

func iAttemptToCreateCargoWithCapacityUnitsAndInventory(arg1, arg2 int) error {
	return godog.ErrPending
}

func iAttemptToCreateTheContractWithNoDeliveries() error {
	return godog.ErrPending
}

func iAttemptToExecuteAnOperationThroughTheCircuitBreaker() error {
	return godog.ErrPending
}

func iAttemptToExecuteOperationsThroughTheCircuitBreaker(arg1 int) error {
	return godog.ErrPending
}

func iCallGetShipWithAContextThatTimesOutAfterSecond(arg1 int) error {
	return godog.ErrPending
}

func iCanFulfillTheContractSuccessfully() error {
	return godog.ErrPending
}

func iCancelTheContextWhileWaitingForRateLimiter() error {
	return godog.ErrPending
}

func iCheckIfContractIsExpired() error {
	return godog.ErrPending
}

func iCheckIfFuelCanTravelRequiringWithSafetyMargin(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func iCheckIfFuelIsFull() error {
	return godog.ErrPending
}

func iCheckIfIsOrbitalOf(arg1, arg2 string) error {
	return godog.ErrPending
}

func iCheckIfShipShouldPreventDriftModeWithThreshold(arg1, arg2 int) error {
	return godog.ErrPending
}

func iCheckIfShipShouldRefuelOpportunisticallyAtWithThreshold(arg1 string, arg2, arg3 int) error {
	return godog.ErrPending
}

func iContinuouslyAttemptAPICallsDuringThisPeriod() error {
	return godog.ErrPending
}

func iCreateARateLimiterWithBurst(arg1 int) error {
	return godog.ErrPending
}

func iCreateARateLimiterWithRate(arg1 int) error {
	return godog.ErrPending
}

func iDeliverUnitOf(arg1 int, arg2 string) error {
	return godog.ErrPending
}

func iExecuteAFailingOperationThroughTheCircuitBreaker() error {
	return godog.ErrPending
}

func iExecuteASuccessfulOperationThroughTheCircuitBreaker() error {
	return godog.ErrPending
}

func iExecuteMoreFailingOperationsThroughTheCircuitBreaker(arg1 int) error {
	return godog.ErrPending
}

func iExecuteSuccessfulOperationThroughTheCircuitBreaker(arg1 int) error {
	return godog.ErrPending
}

func iExecuteTheAssignScoutingFleetCommandWith(arg1 *godog.Table) error {
	return godog.ErrPending
}

func iGetTheNameOfBURNMode() error {
	return godog.ErrPending
}

func iGetTheNameOfCRUISEMode() error {
	return godog.ErrPending
}

func iGetTheNameOfDRIFTMode() error {
	return godog.ErrPending
}

func iGetTheNameOfSTEALTHMode() error {
	return godog.ErrPending
}

func iHaveMadeVariousAPICallsWithMixedResults() error {
	return godog.ErrPending
}

func iMadeRequestsSecondAgo(arg1, arg2 int) error {
	return godog.ErrPending
}

func iMakeAPICallsOverSeconds(arg1, arg2 int) error {
	return godog.ErrPending
}

func iMakeAPICallsToOpenTheCircuit(arg1 int) error {
	return godog.ErrPending
}

func iMakeAPIRequest(arg1 int) error {
	return godog.ErrPending
}

func iMakeAPIRequestAtTimeMs(arg1, arg2 int) error {
	return godog.ErrPending
}

func iMakeAPIRequestsAtTimeMs(arg1, arg2 int) error {
	return godog.ErrPending
}

func iMakeARequestAndMeasureWaitTime() error {
	return godog.ErrPending
}

func iMakeARequestAtTimeS(arg1 int) error {
	return godog.ErrPending
}

func iMakeARequestToGetShip(arg1 string) error {
	return godog.ErrPending
}

func iMakeARequestWithACancellableContext() error {
	return godog.ErrPending
}

func iMakeAnAPIRequestToNavigateShip(arg1 string) error {
	return godog.ErrPending
}

func iMakeConcurrentAPICallsToGetShip(arg1 int) error {
	return godog.ErrPending
}

func iMakeConcurrentAPIRequests(arg1 int) error {
	return godog.ErrPending
}

func iMakeConcurrentAPIRequestsFromMultipleGoroutines(arg1 int) error {
	return godog.ErrPending
}

func iMakeConsecutiveAPICallsToGetShip(arg1 int) error {
	return godog.ErrPending
}

func iMakeNewAPIRequests(arg1 int) error {
	return godog.ErrPending
}

func iMakeRapidAPICalls(arg1 int) error {
	return godog.ErrPending
}

func iMakeRapidAPICallsToGetShip(arg1 int) error {
	return godog.ErrPending
}

func iMakeRapidRequestsToGetShipData(arg1 int) error {
	return godog.ErrPending
}

func iMakeRequestsAtExactlyTheSameTime(arg1 int) error {
	return godog.ErrPending
}

func iMakeRequestsAtTimesSSSSSSSS(arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8 int) error {
	return godog.ErrPending
}

func iMakeRequestsWithTimingMeasurement(arg1 int) error {
	return godog.ErrPending
}

func iMakeSequentialAPICalls(arg1 int) error {
	return godog.ErrPending
}

func iManuallyResetTheCircuitBreaker() error {
	return godog.ErrPending
}

func iQueryTheAPIClientMetrics() error {
	return godog.ErrPending
}

func iShouldSee(arg1 *godog.Table) error {
	return godog.ErrPending
}

func iTryToDeliverUnitsOf(arg1 int, arg2 string) error {
	return godog.ErrPending
}

func iWaitSecond(arg1 int) error {
	return godog.ErrPending
}

func iWaitSeconds(arg1 int) error {
	return godog.ErrPending
}

func iWaitSecondsForCircuitTimeout(arg1 int) error {
	return godog.ErrPending
}

func logShouldMention(arg1 string) error {
	return godog.ErrPending
}

func mostRequestsShouldSucceedAfterRetries() error {
	return godog.ErrPending
}

func navigateAPIIsCalled() error {
	return godog.ErrPending
}

func navigateAPIReturnsError(arg1 string) error {
	return godog.ErrPending
}

func navigationAPICompletes() error {
	return godog.ErrPending
}

func navigationAPIIsCalled() error {
	return godog.ErrPending
}

func navigationBeginsForTheSegment() error {
	return godog.ErrPending
}

func navigationExecutes() error {
	return godog.ErrPending
}

func navigationToConsumesFuel(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func noAPICallShouldBeMade() error {
	return godog.ErrPending
}

func noAPICallsShouldBeMade() error {
	return godog.ErrPending
}

func noContainersExist() error {
	return godog.ErrPending
}

func noFuelConsumptionShouldOccur() error {
	return godog.ErrPending
}

func noHTTPRequestsShouldBeMade() error {
	return godog.ErrPending
}

func noMonitoringActionsShouldBePerformed() error {
	return godog.ErrPending
}

func noRateLimitErrorsShouldOccur(arg1 int) error {
	return godog.ErrPending
}

func noRefuelAtCBecauseNoFuelStation(arg1 int) error {
	return godog.ErrPending
}

func noRefuelChecksShouldExecute() error {
	return godog.ErrPending
}

func noRetriesShouldOccur() error {
	return godog.ErrPending
}

func noRetryAttemptsShouldOccur() error {
	return godog.ErrPending
}

func noShipsShouldBeAssignedToScouting() error {
	return godog.ErrPending
}

func noSleepShouldOccur() error {
	return godog.ErrPending
}

func onlyThePlannedRefuelShouldExecute() error {
	return godog.ErrPending
}

func opportunisticRefuelShouldNOTTrigger() error {
	return godog.ErrPending
}

func opportunisticRefuelShouldTrigger() error {
	return godog.ErrPending
}

func opportunisticRefuelShouldTriggerAtB(arg1 int) error {
	return godog.ErrPending
}

func orbitAPIIsCalled() error {
	return godog.ErrPending
}

func plannedRefuelShouldExecuteAtD(arg1 int) error {
	return godog.ErrPending
}

func predepartureRefuelShouldNOTTrigger() error {
	return godog.ErrPending
}

func predepartureRefuelShouldTrigger() error {
	return godog.ErrPending
}

func rateLimitingShouldBeAppliedThroughout() error {
	return godog.ErrPending
}

func rateLimitingShouldPreventOverwhelmingTheAPI() error {
	return godog.ErrPending
}

func recoveriesWereSuccessful(arg1 int) error {
	return godog.ErrPending
}

func refuelAPIIsCalled() error {
	return godog.ErrPending
}

func refuelAPIShouldBeCalled() error {
	return godog.ErrPending
}

func refuelSequenceExecutes() error {
	return godog.ErrPending
}

func requestsShouldBeQueuedAndThrottled(arg1, arg2 int) error {
	return godog.ErrPending
}

func requestsShouldProceedImmediately(arg1, arg2 int) error {
	return godog.ErrPending
}

func requestsShouldSucceedAgain() error {
	return godog.ErrPending
}

func retryBackoffShouldBeAppliedForFailedAttempts() error {
	return godog.ErrPending
}

func retryTheRequest() error {
	return godog.ErrPending
}

func routeExecutionBegins() error {
	return godog.ErrPending
}

func routeFailRouteMethodShouldBeCalledWithErrorMessage() error {
	return godog.ErrPending
}

func routeHasRefuel_before_departureSetToTrue() error {
	return godog.ErrPending
}

func routeHasSegmentFromAToB(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func routeRequiresRefuelAt(arg1 string) error {
	return godog.ErrPending
}

func routeShouldHaveSegments(arg1 int) error {
	return godog.ErrPending
}

func routeStatusShouldBeCOMPLETED() error {
	return godog.ErrPending
}

func routingEnginePlansBURNModeForSegment(arg1 int) error {
	return godog.ErrPending
}

func routingEnginePlansCRUISEModeForNextSegment() error {
	return godog.ErrPending
}

func routingEnginePlansCRUISEModeForSegment(arg1 int) error {
	return godog.ErrPending
}

func routingEnginePlansDRIFTModeForNextSegment() error {
	return godog.ErrPending
}

func routingEnginePlansRouteWithSegments(arg1 *godog.Table) error {
	return godog.ErrPending
}

func routingEngineReturnsRouteWithRefuel_before_departureTrue() error {
	return godog.ErrPending
}

func segmentExecutes(arg1 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteFromAToB(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteFromBToC(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteFromCToD(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteToB(arg1, arg2 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteToC(arg1, arg2 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteToD(arg1, arg2 int) error {
	return godog.ErrPending
}

func segmentShouldExecuteToE(arg1, arg2 int) error {
	return godog.ErrPending
}

func shipAlreadyHasARunningScouttourContainer(arg1 string) error {
	return godog.ErrPending
}

func shipArriveMethodShouldBeCalledIfStatusIsIN_TRANSIT() error {
	return godog.ErrPending
}

func shipArrivesAtFuelStationWithFuel(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func shipArrivesAtFuelStationWithFuel(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipArrivesAtWithFuel(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipAttemptsToRefuelAt(arg1, arg2 string) error {
	return godog.ErrPending
}

func shipContainerShouldBeReused(arg1 string) error {
	return godog.ErrPending
}

func shipExecutesARouteWithDockRefuelOrbitNavigate(arg1 string) error {
	return godog.ErrPending
}

func shipHasFuelCapacity(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func shipIsAtFuelStationWithFuel(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipIsAtFuelStationWithLowFuel(arg1, arg2 string) error {
	return godog.ErrPending
}

func shipIsAtWithFuel(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipIsDOCKEDAt(arg1, arg2 string) error {
	return godog.ErrPending
}

func shipIsIN_ORBITAtWithLowFuel(arg1, arg2 string) error {
	return godog.ErrPending
}

func shipIsIN_TRANSITToArrivingInSeconds(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipNavigatesFromTo(arg1, arg2, arg3 string) error {
	return godog.ErrPending
}

func shipNavigatesToDestination(arg1 string) error {
	return godog.ErrPending
}

func shipNavigatesWithSegmentTravelTimeSeconds(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func shipShouldArriveAtD(arg1 int) error {
	return godog.ErrPending
}

func shipShouldArriveAtWithFuel(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func shipShouldBeAssignedToScoutMarkets(arg1 string) error {
	return godog.ErrPending
}

func shipShouldBeIN_ORBITAfterArrival() error {
	return godog.ErrPending
}

func shipShouldBeIN_ORBITBeforeNavigation() error {
	return godog.ErrPending
}

func shipShouldBeIN_TRANSITAfterNavigateAPICall() error {
	return godog.ErrPending
}

func shipShouldDockAt(arg1 string) error {
	return godog.ErrPending
}

func shipShouldGetANewScouttourContainer(arg1 string) error {
	return godog.ErrPending
}

func shipShouldHaveFuelAfterRefuelAtC(arg1, arg2 int) error {
	return godog.ErrPending
}

func shipShouldHaveFuelAtB(arg1, arg2 int) error {
	return godog.ErrPending
}

func shipShouldHaveFuelBeforeDeparture(arg1 int) error {
	return godog.ErrPending
}

func shipShouldHaveFuelRemainingAtB(arg1, arg2 int) error {
	return godog.ErrPending
}

func shipShouldNotBeAssigned(arg1 string) error {
	return godog.ErrPending
}

func shipShouldOrbitAfterRefuel() error {
	return godog.ErrPending
}

func shipShouldRefuelAtCBecauseOfPlannedRefuel(arg1 int) error {
	return godog.ErrPending
}

func shipShouldRefuelBeforeDeparting() error {
	return godog.ErrPending
}

func shipShouldRefuelBeforeStartingJourney() error {
	return godog.ErrPending
}

func shipShouldRefuelTo(arg1, arg2 int) error {
	return godog.ErrPending
}

func shipShouldRefuelToFullCapacity() error {
	return godog.ErrPending
}

func shipShouldRemainInOrbit() error {
	return godog.ErrPending
}

func shipShouldTransitionBackToIN_ORBIT() error {
	return godog.ErrPending
}

func shipShouldTransitionToDOCKED() error {
	return godog.ErrPending
}

func shipStartsAtWithFuel(arg1, arg2 string, arg3 int) error {
	return godog.ErrPending
}

func shipStartsNavigationTo(arg1, arg2 string) error {
	return godog.ErrPending
}

func shipStateShouldBeRefetchedAfterSleep() error {
	return godog.ErrPending
}

func shipStateShouldBeRefetchedImmediately() error {
	return godog.ErrPending
}

func shipStateShouldBeResyncedAfterArrival() error {
	return godog.ErrPending
}

func shipStateShouldStillBeRefetched() error {
	return godog.ErrPending
}

func shipStateShouldStillBeResynced() error {
	return godog.ErrPending
}

func staleAssignmentShouldBeCleanedUp(arg1 int) error {
	return godog.ErrPending
}

func staleAssignmentsShouldBeCleanedUp(arg1 int) error {
	return godog.ErrPending
}

func subsequentCallsShouldFailFast() error {
	return godog.ErrPending
}

func theAPIRecoversAfterMinutes(arg1 int) error {
	return godog.ErrPending
}

func theAPIReturnsForFirstAttempts(arg1, arg2 int) error {
	return godog.ErrPending
}

func theAverageIterationDurationIsSeconds(arg1, arg2 int) error {
	return godog.ErrPending
}

func theCallsShouldBeRateLimited() error {
	return godog.ErrPending
}

func theCircuitBreakerIs(arg1 string) error {
	return godog.ErrPending
}

func theCircuitBreakerIsFromPreviousFailures(arg1 string) error {
	return godog.ErrPending
}

func theCircuitBreakerIsWithFailures(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func theCircuitBreakerIsWithLastFailureSecondsAgo(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func theCircuitBreakerShouldAddMinimalOverhead() error {
	return godog.ErrPending
}

func theCircuitBreakerShouldAttemptHalfopenState() error {
	return godog.ErrPending
}

func theCircuitBreakerShouldNotOpen() error {
	return godog.ErrPending
}

func theCircuitBreakerShouldOpenQuickly() error {
	return godog.ErrPending
}

func theCircuitBreakerShouldRemain(arg1 string) error {
	return godog.ErrPending
}

func theCircuitBreakerStateShouldStillBe(arg1 string) error {
	return godog.ErrPending
}

func theCircuitShouldClose() error {
	return godog.ErrPending
}

func theCircuitTimeoutExpires() error {
	return godog.ErrPending
}

func theCommandShouldAssignShipToScouting(arg1 int) error {
	return godog.ErrPending
}

func theCommandShouldAssignShipsToScouting(arg1 int) error {
	return godog.ErrPending
}

func theContainerExistsAndIsRunning(arg1 string) error {
	return godog.ErrPending
}

func theContainerHasCompletedIterationsInSeconds(arg1 string, arg2, arg3 int) error {
	return godog.ErrPending
}

func theContainerMaxIterationsIs(arg1 int) error {
	return godog.ErrPending
}

func theContainerNoLongerExists(arg1 string) error {
	return godog.ErrPending
}

func theContainerShouldRemainRunning(arg1 string) error {
	return godog.ErrPending
}

func theContainerShouldTransitionTo(arg1, arg2 string) error {
	return godog.ErrPending
}

func theContractAcceptancePaymentShouldBeCredits(arg1 int) error {
	return godog.ErrPending
}

func theContractFactionShouldBe(arg1 string) error {
	return godog.ErrPending
}

func theContractFulfillmentPaymentShouldBeCredits(arg1 int) error {
	return godog.ErrPending
}

func theContractShouldBeExpired() error {
	return godog.ErrPending
}

func theContractShouldBeFulfillable() error {
	return godog.ErrPending
}

func theContractShouldHaveDeliveries(arg1 int) error {
	return godog.ErrPending
}

func theContractShouldNotBeExpired() error {
	return godog.ErrPending
}

func theContractTypeShouldBe(arg1 string) error {
	return godog.ErrPending
}

func theErrorOccurs() error {
	return godog.ErrPending
}

func theErrorOccursDuringExecution() error {
	return godog.ErrPending
}

func theErrorShouldBeReturnedToHandler() error {
	return godog.ErrPending
}

func theErrorShouldPropagateToCaller() error {
	return godog.ErrPending
}

func theFirstRequestsShouldProceedImmediately(arg1 int) error {
	return godog.ErrPending
}

func theFollowingShipsOwnedByPlayer(arg1 int, arg2 *godog.Table) error {
	return godog.ErrPending
}

func theFollowingShipsOwnedByPlayerInSystem(arg1 int, arg2 string, arg3 *godog.Table) error {
	return godog.ErrPending
}

func theFollowingWaypointsWithMarketplacesInSystem(arg1 string, arg2 *godog.Table) error {
	return godog.ErrPending
}

func theFuelShouldBeFull() error {
	return godog.ErrPending
}

func theHandlerShouldCalculateSecondsWaitTime(arg1 int) error {
	return godog.ErrPending
}

func theHandlerShouldDetectIN_TRANSITState() error {
	return godog.ErrPending
}

func theHandlerShouldSleepForSeconds(arg1 int) error {
	return godog.ErrPending
}

func theHandlerShouldWaitForArrival() error {
	return godog.ErrPending
}

func theHealthCheckShouldExecute() error {
	return godog.ErrPending
}

func theHealthMonitorAttemptsRecoveryForShip(arg1 string) error {
	return godog.ErrPending
}

func theHealthMonitorAttemptsRecoveryForShipTimes(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func theHealthMonitorCheckIntervalIsSeconds(arg1 int) error {
	return godog.ErrPending
}

func theHealthMonitorDetectsShipAsStuck(arg1 string) error {
	return godog.ErrPending
}

func theHealthMonitorHasAttemptedRecoveries(arg1 int) error {
	return godog.ErrPending
}

func theHealthMonitorIsTriggeredToRun() error {
	return godog.ErrPending
}

func theHealthMonitorLastRanSecondsAgo(arg1 int) error {
	return godog.ErrPending
}

func theHealthMonitorReportsMetrics() error {
	return godog.ErrPending
}

func theHealthMonitorRunsACheck() error {
	return godog.ErrPending
}

func theLastCheckTimestampShouldBeUpdated() error {
	return godog.ErrPending
}

func theMarketsAssignedShouldExclude(arg1 string) error {
	return godog.ErrPending
}

func theMarketsAssignedShouldInclude(arg1 string) error {
	return godog.ErrPending
}

func theMaxRecoveryAttemptsIs(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIAlwaysRespondsWithStatus(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIHasIntermittentConnectionFailures() error {
	return godog.ErrPending
}

func theMockAPIHasSecondDelay(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIIsConfiguredTo(arg1 *godog.Table) error {
	return godog.ErrPending
}

func theMockAPIIsConfiguredToAlwaysRespondWithStatus(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIIsConfiguredToRespondWithStatusWithoutRetryAfter(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIIsConfiguredWithIntermittentFailures(arg1 *godog.Table) error {
	return godog.ErrPending
}

func theMockAPIIsNowRespondingWith(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsImmediatelyWith(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsWithAndRetryAfterSeconds(arg1, arg2 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsWithForMinutes(arg1, arg2 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsWithStatus(arg1 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsWithStatusForAttemptsThen(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func theMockAPIRespondsWithStatusForFirstAttemptThen(arg1, arg2 int) error {
	return godog.ErrPending
}

func theModeNameShouldBe(arg1 string) error {
	return godog.ErrPending
}

func theNavigationSegmentCompletes() error {
	return godog.ErrPending
}

func theNewFuelShouldHaveCapacity(arg1 int) error {
	return godog.ErrPending
}

func theOperationShouldFailImmediatelyWith(arg1 string) error {
	return godog.ErrPending
}

func theOriginalFuelShouldStillHaveCurrent(arg1 int) error {
	return godog.ErrPending
}

func theRateLimiterHasRefilled() error {
	return godog.ErrPending
}

func theRateLimiterIsEmpty() error {
	return godog.ErrPending
}

func theRateLimiterShouldHaveTokensAvailable(arg1 int) error {
	return godog.ErrPending
}

func theRateLimiterShouldNotBeInvoked() error {
	return godog.ErrPending
}

func theRateLimiterShouldThrottleAppropriately() error {
	return godog.ErrPending
}

func theRateLimiterTokensShouldBe(arg1 int) error {
	return godog.ErrPending
}

func theRateShouldNeverExceedRequestsPerSecond(arg1 int) error {
	return godog.ErrPending
}

func theRecoveryActionForcesArrivalAtDestination() error {
	return godog.ErrPending
}

func theRecoveryActionWillFailWithError(arg1 string) error {
	return godog.ErrPending
}

func theRecoveryAttemptCountForShipShouldBe(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func theRecoveryAttemptCountForShipShouldBeResetTo(arg1 string, arg2 int) error {
	return godog.ErrPending
}

func theRecoveryAttemptShouldBeLogged() error {
	return godog.ErrPending
}

func theRecoveryShouldBeMarkedAsSuccessful() error {
	return godog.ErrPending
}

func theRecoveryTimeoutIsSeconds(arg1 int) error {
	return godog.ErrPending
}

func theRequestContextWillBeCancelledAfterAttempt(arg1 int) error {
	return godog.ErrPending
}

func theRequestShouldFailImmediatelyWith(arg1 string) error {
	return godog.ErrPending
}

func theRequestShouldFailWithContextCancelledError() error {
	return godog.ErrPending
}

func theRequestShouldFailWithContextTimeout() error {
	return godog.ErrPending
}

func theRequestShouldFailWithErrorContaining(arg1 string) error {
	return godog.ErrPending
}

func theRequestShouldProceedImmediately() error {
	return godog.ErrPending
}

func theRequestShouldSucceedAfterRetries() error {
	return godog.ErrPending
}

func theRequestShouldThenProceed() error {
	return godog.ErrPending
}

func theRequestShouldWaitSeconds(arg1 int) error {
	return godog.ErrPending
}

func theRequestsShouldBeSpreadOverAtLeastSeconds(arg1 int) error {
	return godog.ErrPending
}

func theRequestsShouldBeThrottledToReqsec(arg1 int) error {
	return godog.ErrPending
}

func theRetryDelayShouldBeSecond(arg1 int) error {
	return godog.ErrPending
}

func theRetryDelayShouldBeSeconds(arg1 int) error {
	return godog.ErrPending
}

func theRetryDelaysShouldFollowExponentialBackoffPatternSSS(arg1, arg2, arg3 int) error {
	return godog.ErrPending
}

func theRoutingEnginePlansDirectRouteWithoutPlannedRefuel() error {
	return godog.ErrPending
}

func theSegmentHasRequires_refuelSetToTrue() error {
	return godog.ErrPending
}

func theShipAssignmentForShouldRemainActive(arg1 string) error {
	return godog.ErrPending
}

func theShipAssignmentShouldBeAutoreleasedWithReason(arg1 string) error {
	return godog.ErrPending
}

func theShipHasBeenHealthyForSeconds(arg1 int) error {
	return godog.ErrPending
}

func theShipHasNotArrivedAtItsDestination() error {
	return godog.ErrPending
}

func theShipIsStuckDueToMissingArrival() error {
	return godog.ErrPending
}

func theShipNavigationStatusIsNow(arg1, arg2 string) error {
	return godog.ErrPending
}

func theShipNavigationStatusShouldTransitionTo(arg1 string) error {
	return godog.ErrPending
}

func theShipShouldBeMarkedAsAbandoned(arg1 string) error {
	return godog.ErrPending
}

func theShipShouldBeRemovedFromWatchList(arg1 string) error {
	return godog.ErrPending
}

func theStaleAssignmentForShipShouldBeDetected(arg1 string) error {
	return godog.ErrPending
}

func theStuckShipCountShouldBe(arg1 int) error {
	return godog.ErrPending
}

func theStuckShipShouldBeDetected(arg1 string) error {
	return godog.ErrPending
}

func theStuckShipShouldNotBeDetected(arg1 string) error {
	return godog.ErrPending
}

func theSuccessRateShouldBePercent(arg1 int) error {
	return godog.ErrPending
}

func theThirdRequestShouldBeDelayed() error {
	return godog.ErrPending
}

func theTotalRecoveryAttemptsShouldBe(arg1 int) error {
	return godog.ErrPending
}

func theTotalTimeShouldAccountForBothBackoffAndRateLimiting() error {
	return godog.ErrPending
}

func theWaitTimeShouldBeApproximatelyMs(arg1 int) error {
	return godog.ErrPending
}

func theWaypointShouldHaveXCoordinate(arg1, arg2 int) error {
	return godog.ErrPending
}

func theWaypointShouldHaveYCoordinate(arg1, arg2 int) error {
	return godog.ErrPending
}

func thenFirstSegmentShouldExecute() error {
	return godog.ErrPending
}

func thenNavigationToShouldBegin(arg1 string) error {
	return godog.ErrPending
}

func thenRespondWithStatus(arg1 int) error {
	return godog.ErrPending
}

func thenSegmentToBShouldExecute(arg1 int) error {
	return godog.ErrPending
}

func thereShouldBeRetryAttempt(arg1 int) error {
	return godog.ErrPending
}

func thereShouldBeRetryAttempts(arg1 int) error {
	return godog.ErrPending
}

func tokensShouldNotExceedTheBurstSize() error {
	return godog.ErrPending
}

func totalExecutionTimeShouldBeApproximatelySeconds(arg1 int) error {
	return godog.ErrPending
}

func totalHTTPAttemptsShouldHaveBeenMade(arg1 int) error {
	return godog.ErrPending
}

func totalSleepTimeShouldBeSeconds(arg1 int) error {
	return godog.ErrPending
}

func waitTimeShouldBeSeconds(arg1 int) error {
	return godog.ErrPending
}

func waypointHasNoFuelAvailable(arg1 string) error {
	return godog.ErrPending
}

func waypointHasTraitAndFuelAvailable(arg1, arg2 string) error {
	return godog.ErrPending
}

func InitializeScenario(ctx *godog.ScenarioContext) {
	ctx.Step(`^a container "([^"]*)" exists for ship "([^"]*)" with status "([^"]*)"$`, aContainerExistsForShipWithStatus)
	ctx.Step(`^a contract repository$`, aContractRepository)
	ctx.Step(`^a contract with deadline "([^"]*)"$`, aContractWithDeadline)
	ctx.Step(`^a contract with no deadline$`, aContractWithNoDeadline)
	ctx.Step(`^a critical error should be logged about abandoning ship "([^"]*)"$`, aCriticalErrorShouldBeLoggedAboutAbandoningShip)
	ctx.Step(`^a critical warning should be logged about route-ship state mismatch$`, aCriticalWarningShouldBeLoggedAboutRouteshipStateMismatch)
	ctx.Step(`^a fully fulfilled contract$`, aFullyFulfilledContract)
	ctx.Step(`^a mediator is configured with scouting handlers$`, aMediatorIsConfiguredWithScoutingHandlers)
	ctx.Step(`^a mediator is initialized$`, aMediatorIsInitialized)
	ctx.Step(`^a mock API client$`, aMockAPIClient)
	ctx.Step(`^API returns segment travel time of (\d+) seconds$`, aPIReturnsSegmentTravelTimeOfSeconds)
	ctx.Step(`^API returns travel time in the past$`, aPIReturnsTravelTimeInThePast)
	ctx.Step(`^a player repository$`, aPlayerRepository)
	ctx.Step(`^a recovery action should be initiated for ship "([^"]*)"$`, aRecoveryActionShouldBeInitiatedForShip)
	ctx.Step(`^a route for ship "([^"]*)" exists with status "([^"]*)"$`, aRouteForShipExistsWithStatus)
	ctx.Step(`^a route segment requiring (\d+) units of fuel in CRUISE mode$`, aRouteSegmentRequiringUnitsOfFuelInCRUISEMode)
	ctx.Step(`^a route segment requiring (\d+) units of fuel in DRIFT mode$`, aRouteSegmentRequiringUnitsOfFuelInDRIFTMode)
	ctx.Step(`^a ship at "([^"]*)" with (\d+) units of fuel and capacity (\d+)$`, aShipAtWithUnitsOfFuelAndCapacity)
	ctx.Step(`^a ship "([^"]*)" is assigned to container "([^"]*)"$`, aShipIsAssignedToContainer)
	ctx.Step(`^a ship "([^"]*)" was previously stuck and is on the watch list$`, aShipWasPreviouslyStuckAndIsOnTheWatchList)
	ctx.Step(`^a ship "([^"]*)" with navigation status "([^"]*)" since (\d+) seconds ago$`, aShipWithNavigationStatusSinceSecondsAgo)
	ctx.Step(`^a ship "([^"]*)" with player ID (\d+) is assigned to container "([^"]*)" for operation "([^"]*)"$`, aShipWithPlayerIDIsAssignedToContainerForOperation)
	ctx.Step(`^a suspicious rapid iteration pattern should be detected for container "([^"]*)"$`, aSuspiciousRapidIterationPatternShouldBeDetectedForContainer)
	ctx.Step(`^a valid accepted contract with multiple deliveries:$`, aValidAcceptedContractWithMultipleDeliveries)
	ctx.Step(`^a valid unaccepted contract with all deliveries complete$`, aValidUnacceptedContractWithAllDeliveriesComplete)
	ctx.Step(`^a warning should be logged about potential infinite loop$`, aWarningShouldBeLoggedAboutPotentialInfiniteLoop)
	ctx.Step(`^a warning should be logged about stuck ship "([^"]*)"$`, aWarningShouldBeLoggedAboutStuckShip)
	ctx.Step(`^a waypoint "([^"]*)" with orbitals \["([^"]*)"\]$`, aWaypointWithOrbitals)
	ctx.Step(`^all (\d+) operations should fail immediately$`, allOperationsShouldFailImmediately)
	ctx.Step(`^all recovery attempts should be persisted$`, allRecoveryAttemptsShouldBePersisted)
	ctx.Step(`^all (\d+) requests should complete$`, allRequestsShouldComplete)
	ctx.Step(`^all requests should eventually complete$`, allRequestsShouldEventuallyComplete)
	ctx.Step(`^all (\d+) requests should eventually complete$`, allRequestsShouldEventuallyComplete)
	ctx.Step(`^all (\d+) requests should eventually succeed$`, allRequestsShouldEventuallySucceed)
	ctx.Step(`^all (\d+) requests should fail$`, allRequestsShouldFail)
	ctx.Step(`^all (\d+) requests should fail immediately$`, allRequestsShouldFailImmediately)
	ctx.Step(`^all (\d+) requests should proceed immediately$`, allRequestsShouldProceedImmediately)
	ctx.Step(`^all requests should succeed$`, allRequestsShouldSucceed)
	ctx.Step(`^all (\d+) requests should succeed$`, allRequestsShouldSucceed)
	ctx.Step(`^all requests should succeed after (\d+) retry$`, allRequestsShouldSucceedAfterRetry)
	ctx.Step(`^all retry attempts should also respect rate limiting$`, allRetryAttemptsShouldAlsoRespectRateLimiting)
	ctx.Step(`^all retry attempts should respect rate limiting$`, allRetryAttemptsShouldRespectRateLimiting)
	ctx.Step(`^all ship assignments should be released with reason "([^"]*)"$`, allShipAssignmentsShouldBeReleasedWithReason)
	ctx.Step(`^an API client with rate limiting and retry enabled$`, anAPIClientWithRateLimitingAndRetryEnabled)
	ctx.Step(`^an API client with rate limiting enabled$`, anAPIClientWithRateLimitingEnabled)
	ctx.Step(`^an error should be logged with reason "([^"]*)"$`, anErrorShouldBeLoggedWithReason)
	ctx.Step(`^at most (\d+) HTTP request should have been made$`, atMostHTTPRequestShouldHaveBeenMade)
	ctx.Step(`^average latency should be under (\d+)ms \(excluding network\)$`, averageLatencyShouldBeUnderMsExcludingNetwork)
	ctx.Step(`^both distances should be equal$`, bothDistancesShouldBeEqual)
	ctx.Step(`^both requests should proceed without delay$`, bothRequestsShouldProceedWithoutDelay)
	ctx.Step(`^(\d+) container should be marked as reused$`, containerShouldBeMarkedAsReused)
	ctx.Step(`^contract creation should fail with error "([^"]*)"$`, contractCreationShouldFailWithError)
	ctx.Step(`^creation should fail with "([^"]*)"$`, creationShouldFailWith)
	ctx.Step(`^current location has fuel available$`, currentLocationHasFuelAvailable)
	ctx.Step(`^current time is "([^"]*)"$`, currentTimeIs)
	ctx.Step(`^"([^"]*)" delivery should be complete$`, deliveryShouldBeComplete)
	ctx.Step(`^"([^"]*)" delivery should have (\d+) of (\d+) units fulfilled$`, deliveryShouldHaveOfUnitsFulfilled)
	ctx.Step(`^dock API is called$`, dockAPIIsCalled)
	ctx.Step(`^dock API returns error "([^"]*)"$`, dockAPIReturnsError)
	ctx.Step(`^each request should have less than (\d+)ms rate limiter overhead$`, eachRequestShouldHaveLessThanMsRateLimiterOverhead)
	ctx.Step(`^eventually succeed$`, eventuallySucceed)
	ctx.Step(`^exactly (\d+) HTTP attempts should have been made$`, exactlyHTTPAttemptsShouldHaveBeenMade)
	ctx.Step(`^final status should be IN_ORBIT at "([^"]*)"$`, finalStatusShouldBeIN_ORBITAt)
	ctx.Step(`^flight mode should be set to "([^"]*)" before navigate API call$`, flightModeShouldBeSetToBeforeNavigateAPICall)
	ctx.Step(`^fuel should be at (\d+)%$`, fuelShouldBeAt)
	ctx.Step(`^handler should add (\d+) second buffer$`, handlerShouldAddSecondBuffer)
	ctx.Step(`^handler should calculate wait time as (\d+) seconds$`, handlerShouldCalculateWaitTimeAsSeconds)
	ctx.Step(`^I add (\d+) units of fuel$`, iAddUnitsOfFuel)
	ctx.Step(`^I attempt to add -(\d+) units of fuel$`, iAttemptToAddUnitsOfFuel)
	ctx.Step(`^I attempt to create a contract with empty contract_id$`, iAttemptToCreateAContractWithEmptyContract_id)
	ctx.Step(`^I attempt to create a contract with empty faction_symbol$`, iAttemptToCreateAContractWithEmptyFaction_symbol)
	ctx.Step(`^I attempt to create a contract with player_id (\d+)$`, iAttemptToCreateAContractWithPlayer_id)
	ctx.Step(`^I attempt to create a contract with player_id -(\d+)$`, iAttemptToCreateAContractWithPlayer_id)
	ctx.Step(`^I attempt to create cargo with capacity (\d+), units (\d+), and inventory$`, iAttemptToCreateCargoWithCapacityUnitsAndInventory)
	ctx.Step(`^I attempt to create the contract with no deliveries$`, iAttemptToCreateTheContractWithNoDeliveries)
	ctx.Step(`^I attempt to execute an operation through the circuit breaker$`, iAttemptToExecuteAnOperationThroughTheCircuitBreaker)
	ctx.Step(`^I attempt to execute (\d+) operations through the circuit breaker$`, iAttemptToExecuteOperationsThroughTheCircuitBreaker)
	ctx.Step(`^I call GetShip with a context that times out after (\d+) second$`, iCallGetShipWithAContextThatTimesOutAfterSecond)
	ctx.Step(`^I can fulfill the contract successfully$`, iCanFulfillTheContractSuccessfully)
	ctx.Step(`^I cancel the context while waiting for rate limiter$`, iCancelTheContextWhileWaitingForRateLimiter)
	ctx.Step(`^I check if contract is expired$`, iCheckIfContractIsExpired)
	ctx.Step(`^I check if fuel can travel requiring (\d+) with safety margin (\d+)\.(\d+)$`, iCheckIfFuelCanTravelRequiringWithSafetyMargin)
	ctx.Step(`^I check if fuel is full$`, iCheckIfFuelIsFull)
	ctx.Step(`^I check if "([^"]*)" is orbital of "([^"]*)"$`, iCheckIfIsOrbitalOf)
	ctx.Step(`^I check if ship should prevent drift mode with threshold (\d+)\.(\d+)$`, iCheckIfShipShouldPreventDriftModeWithThreshold)
	ctx.Step(`^I check if ship should refuel opportunistically at "([^"]*)" with threshold (\d+)\.(\d+)$`, iCheckIfShipShouldRefuelOpportunisticallyAtWithThreshold)
	ctx.Step(`^I continuously attempt API calls during this period$`, iContinuouslyAttemptAPICallsDuringThisPeriod)
	ctx.Step(`^I create a rate limiter with burst (\d+)$`, iCreateARateLimiterWithBurst)
	ctx.Step(`^I create a rate limiter with rate (\d+)$`, iCreateARateLimiterWithRate)
	ctx.Step(`^I deliver (\d+) unit of "([^"]*)"$`, iDeliverUnitOf)
	ctx.Step(`^I execute a failing operation through the circuit breaker$`, iExecuteAFailingOperationThroughTheCircuitBreaker)
	ctx.Step(`^I execute a successful operation through the circuit breaker$`, iExecuteASuccessfulOperationThroughTheCircuitBreaker)
	ctx.Step(`^I execute (\d+) more failing operations through the circuit breaker$`, iExecuteMoreFailingOperationsThroughTheCircuitBreaker)
	ctx.Step(`^I execute (\d+) successful operation through the circuit breaker$`, iExecuteSuccessfulOperationThroughTheCircuitBreaker)
	ctx.Step(`^I execute the assign scouting fleet command with:$`, iExecuteTheAssignScoutingFleetCommandWith)
	ctx.Step(`^I get the name of BURN mode$`, iGetTheNameOfBURNMode)
	ctx.Step(`^I get the name of CRUISE mode$`, iGetTheNameOfCRUISEMode)
	ctx.Step(`^I get the name of DRIFT mode$`, iGetTheNameOfDRIFTMode)
	ctx.Step(`^I get the name of STEALTH mode$`, iGetTheNameOfSTEALTHMode)
	ctx.Step(`^I have made various API calls with mixed results$`, iHaveMadeVariousAPICallsWithMixedResults)
	ctx.Step(`^I made (\d+) requests (\d+) second ago$`, iMadeRequestsSecondAgo)
	ctx.Step(`^I make (\d+) API calls over (\d+) seconds$`, iMakeAPICallsOverSeconds)
	ctx.Step(`^I make (\d+) API calls to open the circuit$`, iMakeAPICallsToOpenTheCircuit)
	ctx.Step(`^I make (\d+) API request$`, iMakeAPIRequest)
	ctx.Step(`^I make (\d+) API request at time (\d+)ms$`, iMakeAPIRequestAtTimeMs)
	ctx.Step(`^I make (\d+) API requests at time (\d+)ms$`, iMakeAPIRequestsAtTimeMs)
	ctx.Step(`^I make a request and measure wait time$`, iMakeARequestAndMeasureWaitTime)
	ctx.Step(`^I make a request at time (\d+)s$`, iMakeARequestAtTimeS)
	ctx.Step(`^I make a request to get ship "([^"]*)"$`, iMakeARequestToGetShip)
	ctx.Step(`^I make a request with a cancellable context$`, iMakeARequestWithACancellableContext)
	ctx.Step(`^I make an API request to navigate ship "([^"]*)"$`, iMakeAnAPIRequestToNavigateShip)
	ctx.Step(`^I make (\d+) concurrent API calls to GetShip$`, iMakeConcurrentAPICallsToGetShip)
	ctx.Step(`^I make (\d+) concurrent API requests$`, iMakeConcurrentAPIRequests)
	ctx.Step(`^I make (\d+) concurrent API requests from multiple goroutines$`, iMakeConcurrentAPIRequestsFromMultipleGoroutines)
	ctx.Step(`^I make (\d+) consecutive API calls to GetShip$`, iMakeConsecutiveAPICallsToGetShip)
	ctx.Step(`^I make (\d+) new API requests$`, iMakeNewAPIRequests)
	ctx.Step(`^I make (\d+) rapid API calls$`, iMakeRapidAPICalls)
	ctx.Step(`^I make (\d+) rapid API calls to GetShip$`, iMakeRapidAPICallsToGetShip)
	ctx.Step(`^I make (\d+) rapid requests to get ship data$`, iMakeRapidRequestsToGetShipData)
	ctx.Step(`^I make (\d+) requests at exactly the same time$`, iMakeRequestsAtExactlyTheSameTime)
	ctx.Step(`^I make requests at times \[(\d+)s, (\d+)s, (\d+)s, (\d+)s, (\d+)s, (\d+)s, (\d+)s, (\d+)s\]$`, iMakeRequestsAtTimesSSSSSSSS)
	ctx.Step(`^I make (\d+) requests with timing measurement$`, iMakeRequestsWithTimingMeasurement)
	ctx.Step(`^I make (\d+) sequential API calls$`, iMakeSequentialAPICalls)
	ctx.Step(`^I manually reset the circuit breaker$`, iManuallyResetTheCircuitBreaker)
	ctx.Step(`^I query the API client metrics$`, iQueryTheAPIClientMetrics)
	ctx.Step(`^I should see:$`, iShouldSee)
	ctx.Step(`^I try to deliver -(\d+) units of "([^"]*)"$`, iTryToDeliverUnitsOf)
	ctx.Step(`^I wait (\d+) second$`, iWaitSecond)
	ctx.Step(`^I wait (\d+) seconds$`, iWaitSeconds)
	ctx.Step(`^I wait (\d+) seconds for circuit timeout$`, iWaitSecondsForCircuitTimeout)
	ctx.Step(`^log should mention "([^"]*)"$`, logShouldMention)
	ctx.Step(`^most requests should succeed after retries$`, mostRequestsShouldSucceedAfterRetries)
	ctx.Step(`^navigate API is called$`, navigateAPIIsCalled)
	ctx.Step(`^navigate API returns error "([^"]*)"$`, navigateAPIReturnsError)
	ctx.Step(`^navigation API completes$`, navigationAPICompletes)
	ctx.Step(`^navigation API is called$`, navigationAPIIsCalled)
	ctx.Step(`^navigation begins for the segment$`, navigationBeginsForTheSegment)
	ctx.Step(`^navigation executes$`, navigationExecutes)
	ctx.Step(`^navigation to "([^"]*)" consumes (\d+) fuel$`, navigationToConsumesFuel)
	ctx.Step(`^no API call should be made$`, noAPICallShouldBeMade)
	ctx.Step(`^no API calls should be made$`, noAPICallsShouldBeMade)
	ctx.Step(`^no containers exist$`, noContainersExist)
	ctx.Step(`^no fuel consumption should occur$`, noFuelConsumptionShouldOccur)
	ctx.Step(`^no HTTP requests should be made$`, noHTTPRequestsShouldBeMade)
	ctx.Step(`^no monitoring actions should be performed$`, noMonitoringActionsShouldBePerformed)
	ctx.Step(`^no (\d+) rate limit errors should occur$`, noRateLimitErrorsShouldOccur)
	ctx.Step(`^no refuel at C(\d+) because no fuel station$`, noRefuelAtCBecauseNoFuelStation)
	ctx.Step(`^no refuel checks should execute$`, noRefuelChecksShouldExecute)
	ctx.Step(`^no retries should occur$`, noRetriesShouldOccur)
	ctx.Step(`^no retry attempts should occur$`, noRetryAttemptsShouldOccur)
	ctx.Step(`^no ships should be assigned to scouting$`, noShipsShouldBeAssignedToScouting)
	ctx.Step(`^no sleep should occur$`, noSleepShouldOccur)
	ctx.Step(`^only the planned refuel should execute$`, onlyThePlannedRefuelShouldExecute)
	ctx.Step(`^opportunistic refuel should NOT trigger$`, opportunisticRefuelShouldNOTTrigger)
	ctx.Step(`^opportunistic refuel should trigger$`, opportunisticRefuelShouldTrigger)
	ctx.Step(`^opportunistic refuel should trigger at B(\d+)$`, opportunisticRefuelShouldTriggerAtB)
	ctx.Step(`^orbit API is called$`, orbitAPIIsCalled)
	ctx.Step(`^planned refuel should execute at D(\d+)$`, plannedRefuelShouldExecuteAtD)
	ctx.Step(`^pre-departure refuel should NOT trigger$`, predepartureRefuelShouldNOTTrigger)
	ctx.Step(`^pre-departure refuel should trigger$`, predepartureRefuelShouldTrigger)
	ctx.Step(`^rate limiting should be applied throughout$`, rateLimitingShouldBeAppliedThroughout)
	ctx.Step(`^rate limiting should prevent overwhelming the API$`, rateLimitingShouldPreventOverwhelmingTheAPI)
	ctx.Step(`^(\d+) recoveries were successful$`, recoveriesWereSuccessful)
	ctx.Step(`^refuel API is called$`, refuelAPIIsCalled)
	ctx.Step(`^refuel API should be called$`, refuelAPIShouldBeCalled)
	ctx.Step(`^refuel sequence executes$`, refuelSequenceExecutes)
	ctx.Step(`^requests (\d+)-(\d+) should be queued and throttled$`, requestsShouldBeQueuedAndThrottled)
	ctx.Step(`^requests (\d+)-(\d+) should proceed immediately$`, requestsShouldProceedImmediately)
	ctx.Step(`^requests should succeed again$`, requestsShouldSucceedAgain)
	ctx.Step(`^retry backoff should be applied for failed attempts$`, retryBackoffShouldBeAppliedForFailedAttempts)
	ctx.Step(`^retry the request$`, retryTheRequest)
	ctx.Step(`^route execution begins$`, routeExecutionBegins)
	ctx.Step(`^route FailRoute method should be called with error message$`, routeFailRouteMethodShouldBeCalledWithErrorMessage)
	ctx.Step(`^route has refuel_before_departure set to true$`, routeHasRefuel_before_departureSetToTrue)
	ctx.Step(`^route has (\d+) segment from A(\d+) to B(\d+)$`, routeHasSegmentFromAToB)
	ctx.Step(`^route requires refuel at "([^"]*)"$`, routeRequiresRefuelAt)
	ctx.Step(`^route should have (\d+) segments$`, routeShouldHaveSegments)
	ctx.Step(`^route status should be COMPLETED$`, routeStatusShouldBeCOMPLETED)
	ctx.Step(`^routing engine plans BURN mode for segment (\d+)$`, routingEnginePlansBURNModeForSegment)
	ctx.Step(`^routing engine plans CRUISE mode for next segment$`, routingEnginePlansCRUISEModeForNextSegment)
	ctx.Step(`^routing engine plans CRUISE mode for segment (\d+)$`, routingEnginePlansCRUISEModeForSegment)
	ctx.Step(`^routing engine plans DRIFT mode for next segment$`, routingEnginePlansDRIFTModeForNextSegment)
	ctx.Step(`^routing engine plans route with segments:$`, routingEnginePlansRouteWithSegments)
	ctx.Step(`^routing engine returns route with refuel_before_departure true$`, routingEngineReturnsRouteWithRefuel_before_departureTrue)
	ctx.Step(`^segment (\d+) executes$`, segmentExecutes)
	ctx.Step(`^segment (\d+) should execute from A(\d+) to B(\d+)$`, segmentShouldExecuteFromAToB)
	ctx.Step(`^segment (\d+) should execute from B(\d+) to C(\d+)$`, segmentShouldExecuteFromBToC)
	ctx.Step(`^segment (\d+) should execute from C(\d+) to D(\d+)$`, segmentShouldExecuteFromCToD)
	ctx.Step(`^segment (\d+) should execute to B(\d+)$`, segmentShouldExecuteToB)
	ctx.Step(`^segment (\d+) should execute to C(\d+)$`, segmentShouldExecuteToC)
	ctx.Step(`^segment (\d+) should execute to D(\d+)$`, segmentShouldExecuteToD)
	ctx.Step(`^segment (\d+) should execute to E(\d+)$`, segmentShouldExecuteToE)
	ctx.Step(`^ship "([^"]*)" already has a running scout-tour container$`, shipAlreadyHasARunningScouttourContainer)
	ctx.Step(`^ship Arrive method should be called if status is IN_TRANSIT$`, shipArriveMethodShouldBeCalledIfStatusIsIN_TRANSIT)
	ctx.Step(`^ship arrives at fuel station "([^"]*)" with (\d+) fuel$`, shipArrivesAtFuelStationWithFuel)
	ctx.Step(`^ship "([^"]*)" arrives at fuel station "([^"]*)" with (\d+)% fuel$`, shipArrivesAtFuelStationWithFuel)
	ctx.Step(`^ship "([^"]*)" arrives at "([^"]*)" with (\d+)% fuel$`, shipArrivesAtWithFuel)
	ctx.Step(`^ship "([^"]*)" attempts to refuel at "([^"]*)"$`, shipAttemptsToRefuelAt)
	ctx.Step(`^ship "([^"]*)" container should be reused$`, shipContainerShouldBeReused)
	ctx.Step(`^ship "([^"]*)" executes a route with dock refuel orbit navigate$`, shipExecutesARouteWithDockRefuelOrbitNavigate)
	ctx.Step(`^ship "([^"]*)" has (\d+) fuel capacity$`, shipHasFuelCapacity)
	ctx.Step(`^ship "([^"]*)" is at fuel station "([^"]*)" with (\d+)% fuel$`, shipIsAtFuelStationWithFuel)
	ctx.Step(`^ship "([^"]*)" is at fuel station "([^"]*)" with low fuel$`, shipIsAtFuelStationWithLowFuel)
	ctx.Step(`^ship "([^"]*)" is at "([^"]*)" with (\d+)% fuel$`, shipIsAtWithFuel)
	ctx.Step(`^ship "([^"]*)" is DOCKED at "([^"]*)"$`, shipIsDOCKEDAt)
	ctx.Step(`^ship "([^"]*)" is IN_ORBIT at "([^"]*)" with low fuel$`, shipIsIN_ORBITAtWithLowFuel)
	ctx.Step(`^ship "([^"]*)" is IN_TRANSIT to "([^"]*)" arriving in (\d+) seconds$`, shipIsIN_TRANSITToArrivingInSeconds)
	ctx.Step(`^ship "([^"]*)" navigates from "([^"]*)" to "([^"]*)"$`, shipNavigatesFromTo)
	ctx.Step(`^ship "([^"]*)" navigates to destination$`, shipNavigatesToDestination)
	ctx.Step(`^ship "([^"]*)" navigates with segment travel time (\d+) seconds$`, shipNavigatesWithSegmentTravelTimeSeconds)
	ctx.Step(`^ship should arrive at D(\d+)$`, shipShouldArriveAtD)
	ctx.Step(`^ship should arrive at "([^"]*)" with (\d+)% fuel$`, shipShouldArriveAtWithFuel)
	ctx.Step(`^ship "([^"]*)" should be assigned to scout markets$`, shipShouldBeAssignedToScoutMarkets)
	ctx.Step(`^ship should be IN_ORBIT after arrival$`, shipShouldBeIN_ORBITAfterArrival)
	ctx.Step(`^ship should be IN_ORBIT before navigation$`, shipShouldBeIN_ORBITBeforeNavigation)
	ctx.Step(`^ship should be IN_TRANSIT after navigate API call$`, shipShouldBeIN_TRANSITAfterNavigateAPICall)
	ctx.Step(`^ship should dock at "([^"]*)"$`, shipShouldDockAt)
	ctx.Step(`^ship "([^"]*)" should get a new scout-tour container$`, shipShouldGetANewScouttourContainer)
	ctx.Step(`^ship should have (\d+) fuel after refuel at C(\d+)$`, shipShouldHaveFuelAfterRefuelAtC)
	ctx.Step(`^ship should have (\d+)% fuel at B(\d+)$`, shipShouldHaveFuelAtB)
	ctx.Step(`^ship should have (\d+)% fuel before departure$`, shipShouldHaveFuelBeforeDeparture)
	ctx.Step(`^ship should have (\d+) fuel remaining at B(\d+)$`, shipShouldHaveFuelRemainingAtB)
	ctx.Step(`^ship "([^"]*)" should not be assigned$`, shipShouldNotBeAssigned)
	ctx.Step(`^ship should orbit after refuel$`, shipShouldOrbitAfterRefuel)
	ctx.Step(`^ship should refuel at C(\d+) because of planned refuel$`, shipShouldRefuelAtCBecauseOfPlannedRefuel)
	ctx.Step(`^ship should refuel before departing$`, shipShouldRefuelBeforeDeparting)
	ctx.Step(`^ship should refuel before starting journey$`, shipShouldRefuelBeforeStartingJourney)
	ctx.Step(`^ship should refuel to (\d+)\/(\d+)$`, shipShouldRefuelTo)
	ctx.Step(`^ship should refuel to full capacity$`, shipShouldRefuelToFullCapacity)
	ctx.Step(`^ship should remain in orbit$`, shipShouldRemainInOrbit)
	ctx.Step(`^ship should transition back to IN_ORBIT$`, shipShouldTransitionBackToIN_ORBIT)
	ctx.Step(`^ship should transition to DOCKED$`, shipShouldTransitionToDOCKED)
	ctx.Step(`^ship "([^"]*)" starts at "([^"]*)" with (\d+) fuel$`, shipStartsAtWithFuel)
	ctx.Step(`^ship "([^"]*)" starts navigation to "([^"]*)"$`, shipStartsNavigationTo)
	ctx.Step(`^ship state should be re-fetched after sleep$`, shipStateShouldBeRefetchedAfterSleep)
	ctx.Step(`^ship state should be re-fetched immediately$`, shipStateShouldBeRefetchedImmediately)
	ctx.Step(`^ship state should be re-synced after arrival$`, shipStateShouldBeResyncedAfterArrival)
	ctx.Step(`^ship state should still be re-fetched$`, shipStateShouldStillBeRefetched)
	ctx.Step(`^ship state should still be re-synced$`, shipStateShouldStillBeResynced)
	ctx.Step(`^(\d+) stale assignment should be cleaned up$`, staleAssignmentShouldBeCleanedUp)
	ctx.Step(`^(\d+) stale assignments should be cleaned up$`, staleAssignmentsShouldBeCleanedUp)
	ctx.Step(`^subsequent calls should fail fast$`, subsequentCallsShouldFailFast)
	ctx.Step(`^the API recovers after (\d+) minutes$`, theAPIRecoversAfterMinutes)
	ctx.Step(`^the API returns (\d+) for first (\d+) attempts$`, theAPIReturnsForFirstAttempts)
	ctx.Step(`^the average iteration duration is (\d+)\.(\d+) seconds$`, theAverageIterationDurationIsSeconds)
	ctx.Step(`^the calls should be rate limited$`, theCallsShouldBeRateLimited)
	ctx.Step(`^the circuit breaker is "([^"]*)"$`, theCircuitBreakerIs)
	ctx.Step(`^the circuit breaker is "([^"]*)" from previous failures$`, theCircuitBreakerIsFromPreviousFailures)
	ctx.Step(`^the circuit breaker is "([^"]*)" with (\d+) failures$`, theCircuitBreakerIsWithFailures)
	ctx.Step(`^the circuit breaker is "([^"]*)" with last failure (\d+) seconds ago$`, theCircuitBreakerIsWithLastFailureSecondsAgo)
	ctx.Step(`^the circuit breaker should add minimal overhead$`, theCircuitBreakerShouldAddMinimalOverhead)
	ctx.Step(`^the circuit breaker should attempt half-open state$`, theCircuitBreakerShouldAttemptHalfopenState)
	ctx.Step(`^the circuit breaker should not open$`, theCircuitBreakerShouldNotOpen)
	ctx.Step(`^the circuit breaker should open quickly$`, theCircuitBreakerShouldOpenQuickly)
	ctx.Step(`^the circuit breaker should remain "([^"]*)"$`, theCircuitBreakerShouldRemain)
	ctx.Step(`^the circuit breaker state should still be "([^"]*)"$`, theCircuitBreakerStateShouldStillBe)
	ctx.Step(`^the circuit should close$`, theCircuitShouldClose)
	ctx.Step(`^the circuit timeout expires$`, theCircuitTimeoutExpires)
	ctx.Step(`^the command should assign (\d+) ship to scouting$`, theCommandShouldAssignShipToScouting)
	ctx.Step(`^the command should assign (\d+) ships to scouting$`, theCommandShouldAssignShipsToScouting)
	ctx.Step(`^the container "([^"]*)" exists and is running$`, theContainerExistsAndIsRunning)
	ctx.Step(`^the container "([^"]*)" has completed (\d+) iterations in (\d+) seconds$`, theContainerHasCompletedIterationsInSeconds)
	ctx.Step(`^the container max iterations is -(\d+)$`, theContainerMaxIterationsIs)
	ctx.Step(`^the container "([^"]*)" no longer exists$`, theContainerNoLongerExists)
	ctx.Step(`^the container "([^"]*)" should remain running$`, theContainerShouldRemainRunning)
	ctx.Step(`^the container "([^"]*)" should transition to "([^"]*)"$`, theContainerShouldTransitionTo)
	ctx.Step(`^the contract acceptance payment should be (\d+) credits$`, theContractAcceptancePaymentShouldBeCredits)
	ctx.Step(`^the contract faction should be "([^"]*)"$`, theContractFactionShouldBe)
	ctx.Step(`^the contract fulfillment payment should be (\d+) credits$`, theContractFulfillmentPaymentShouldBeCredits)
	ctx.Step(`^the contract should be expired$`, theContractShouldBeExpired)
	ctx.Step(`^the contract should be fulfillable$`, theContractShouldBeFulfillable)
	ctx.Step(`^the contract should have (\d+) deliveries$`, theContractShouldHaveDeliveries)
	ctx.Step(`^the contract should not be expired$`, theContractShouldNotBeExpired)
	ctx.Step(`^the contract type should be "([^"]*)"$`, theContractTypeShouldBe)
	ctx.Step(`^the error occurs$`, theErrorOccurs)
	ctx.Step(`^the error occurs during execution$`, theErrorOccursDuringExecution)
	ctx.Step(`^the error should be returned to handler$`, theErrorShouldBeReturnedToHandler)
	ctx.Step(`^the error should propagate to caller$`, theErrorShouldPropagateToCaller)
	ctx.Step(`^the first (\d+) requests should proceed immediately$`, theFirstRequestsShouldProceedImmediately)
	ctx.Step(`^the following ships owned by player (\d+):$`, theFollowingShipsOwnedByPlayer)
	ctx.Step(`^the following ships owned by player (\d+) in system "([^"]*)":$`, theFollowingShipsOwnedByPlayerInSystem)
	ctx.Step(`^the following waypoints with marketplaces in system "([^"]*)":$`, theFollowingWaypointsWithMarketplacesInSystem)
	ctx.Step(`^the fuel should be full$`, theFuelShouldBeFull)
	ctx.Step(`^the handler should calculate (\d+) seconds wait time$`, theHandlerShouldCalculateSecondsWaitTime)
	ctx.Step(`^the handler should detect IN_TRANSIT state$`, theHandlerShouldDetectIN_TRANSITState)
	ctx.Step(`^the handler should sleep for (\d+) seconds$`, theHandlerShouldSleepForSeconds)
	ctx.Step(`^the handler should wait for arrival$`, theHandlerShouldWaitForArrival)
	ctx.Step(`^the health check should execute$`, theHealthCheckShouldExecute)
	ctx.Step(`^the health monitor attempts recovery for ship "([^"]*)"$`, theHealthMonitorAttemptsRecoveryForShip)
	ctx.Step(`^the health monitor attempts recovery for ship "([^"]*)" (\d+) times$`, theHealthMonitorAttemptsRecoveryForShipTimes)
	ctx.Step(`^the health monitor check interval is (\d+) seconds$`, theHealthMonitorCheckIntervalIsSeconds)
	ctx.Step(`^the health monitor detects ship "([^"]*)" as stuck$`, theHealthMonitorDetectsShipAsStuck)
	ctx.Step(`^the health monitor has attempted (\d+) recoveries$`, theHealthMonitorHasAttemptedRecoveries)
	ctx.Step(`^the health monitor is triggered to run$`, theHealthMonitorIsTriggeredToRun)
	ctx.Step(`^the health monitor last ran (\d+) seconds ago$`, theHealthMonitorLastRanSecondsAgo)
	ctx.Step(`^the health monitor reports metrics$`, theHealthMonitorReportsMetrics)
	ctx.Step(`^the health monitor runs a check$`, theHealthMonitorRunsACheck)
	ctx.Step(`^the last check timestamp should be updated$`, theLastCheckTimestampShouldBeUpdated)
	ctx.Step(`^the markets assigned should exclude "([^"]*)"$`, theMarketsAssignedShouldExclude)
	ctx.Step(`^the markets assigned should include "([^"]*)"$`, theMarketsAssignedShouldInclude)
	ctx.Step(`^the max recovery attempts is (\d+)$`, theMaxRecoveryAttemptsIs)
	ctx.Step(`^the mock API always responds with status (\d+)$`, theMockAPIAlwaysRespondsWithStatus)
	ctx.Step(`^the mock API has intermittent connection failures$`, theMockAPIHasIntermittentConnectionFailures)
	ctx.Step(`^the mock API has (\d+) second delay$`, theMockAPIHasSecondDelay)
	ctx.Step(`^the mock API is configured to:$`, theMockAPIIsConfiguredTo)
	ctx.Step(`^the mock API is configured to always respond with status (\d+)$`, theMockAPIIsConfiguredToAlwaysRespondWithStatus)
	ctx.Step(`^the mock API is configured to respond with status (\d+) without Retry-After$`, theMockAPIIsConfiguredToRespondWithStatusWithoutRetryAfter)
	ctx.Step(`^the mock API is configured with intermittent failures:$`, theMockAPIIsConfiguredWithIntermittentFailures)
	ctx.Step(`^the mock API is now responding with (\d+)$`, theMockAPIIsNowRespondingWith)
	ctx.Step(`^the mock API responds immediately with (\d+)$`, theMockAPIRespondsImmediatelyWith)
	ctx.Step(`^the mock API responds with (\d+) and Retry-After (\d+) seconds$`, theMockAPIRespondsWithAndRetryAfterSeconds)
	ctx.Step(`^the mock API responds with (\d+) for (\d+) minutes$`, theMockAPIRespondsWithForMinutes)
	ctx.Step(`^the mock API responds with status (\d+)$`, theMockAPIRespondsWithStatus)
	ctx.Step(`^the mock API responds with status (\d+) for (\d+) attempts then (\d+)$`, theMockAPIRespondsWithStatusForAttemptsThen)
	ctx.Step(`^the mock API responds with status (\d+) for first attempt then (\d+)$`, theMockAPIRespondsWithStatusForFirstAttemptThen)
	ctx.Step(`^the mode name should be "([^"]*)"$`, theModeNameShouldBe)
	ctx.Step(`^the navigation segment completes$`, theNavigationSegmentCompletes)
	ctx.Step(`^the new fuel should have capacity (\d+)$`, theNewFuelShouldHaveCapacity)
	ctx.Step(`^the operation should fail immediately with "([^"]*)"$`, theOperationShouldFailImmediatelyWith)
	ctx.Step(`^the original fuel should still have current (\d+)$`, theOriginalFuelShouldStillHaveCurrent)
	ctx.Step(`^the rate limiter has refilled$`, theRateLimiterHasRefilled)
	ctx.Step(`^the rate limiter is empty$`, theRateLimiterIsEmpty)
	ctx.Step(`^the rate limiter should have (\d+) tokens available$`, theRateLimiterShouldHaveTokensAvailable)
	ctx.Step(`^the rate limiter should not be invoked$`, theRateLimiterShouldNotBeInvoked)
	ctx.Step(`^the rate limiter should throttle appropriately$`, theRateLimiterShouldThrottleAppropriately)
	ctx.Step(`^the rate limiter tokens should be (\d+)$`, theRateLimiterTokensShouldBe)
	ctx.Step(`^the rate should never exceed (\d+) requests per second$`, theRateShouldNeverExceedRequestsPerSecond)
	ctx.Step(`^the recovery action forces arrival at destination$`, theRecoveryActionForcesArrivalAtDestination)
	ctx.Step(`^the recovery action will fail with error "([^"]*)"$`, theRecoveryActionWillFailWithError)
	ctx.Step(`^the recovery attempt count for ship "([^"]*)" should be (\d+)$`, theRecoveryAttemptCountForShipShouldBe)
	ctx.Step(`^the recovery attempt count for ship "([^"]*)" should be reset to (\d+)$`, theRecoveryAttemptCountForShipShouldBeResetTo)
	ctx.Step(`^the recovery attempt should be logged$`, theRecoveryAttemptShouldBeLogged)
	ctx.Step(`^the recovery should be marked as successful$`, theRecoveryShouldBeMarkedAsSuccessful)
	ctx.Step(`^the recovery timeout is (\d+) seconds$`, theRecoveryTimeoutIsSeconds)
	ctx.Step(`^the request context will be cancelled after (\d+) attempt$`, theRequestContextWillBeCancelledAfterAttempt)
	ctx.Step(`^the request should fail immediately with "([^"]*)"$`, theRequestShouldFailImmediatelyWith)
	ctx.Step(`^the request should fail with context cancelled error$`, theRequestShouldFailWithContextCancelledError)
	ctx.Step(`^the request should fail with context timeout$`, theRequestShouldFailWithContextTimeout)
	ctx.Step(`^the request should fail with error containing "([^"]*)"$`, theRequestShouldFailWithErrorContaining)
	ctx.Step(`^the request should proceed immediately$`, theRequestShouldProceedImmediately)
	ctx.Step(`^the request should succeed after retries$`, theRequestShouldSucceedAfterRetries)
	ctx.Step(`^the request should then proceed$`, theRequestShouldThenProceed)
	ctx.Step(`^the request should wait (\d+) seconds$`, theRequestShouldWaitSeconds)
	ctx.Step(`^the requests should be spread over at least (\d+) seconds$`, theRequestsShouldBeSpreadOverAtLeastSeconds)
	ctx.Step(`^the requests should be throttled to (\d+) req\/sec$`, theRequestsShouldBeThrottledToReqsec)
	ctx.Step(`^the retry delay should be (\d+) second$`, theRetryDelayShouldBeSecond)
	ctx.Step(`^the retry delay should be (\d+) seconds$`, theRetryDelayShouldBeSeconds)
	ctx.Step(`^the retry delays should follow exponential backoff pattern \[(\d+)s, (\d+)s, (\d+)s\]$`, theRetryDelaysShouldFollowExponentialBackoffPatternSSS)
	ctx.Step(`^the routing engine plans direct route without planned refuel$`, theRoutingEnginePlansDirectRouteWithoutPlannedRefuel)
	ctx.Step(`^the segment has requires_refuel set to true$`, theSegmentHasRequires_refuelSetToTrue)
	ctx.Step(`^the ship assignment for "([^"]*)" should remain active$`, theShipAssignmentForShouldRemainActive)
	ctx.Step(`^the ship assignment should be auto-released with reason "([^"]*)"$`, theShipAssignmentShouldBeAutoreleasedWithReason)
	ctx.Step(`^the ship has been healthy for (\d+) seconds$`, theShipHasBeenHealthyForSeconds)
	ctx.Step(`^the ship has not arrived at its destination$`, theShipHasNotArrivedAtItsDestination)
	ctx.Step(`^the ship is stuck due to missing arrival$`, theShipIsStuckDueToMissingArrival)
	ctx.Step(`^the ship "([^"]*)" navigation status is now "([^"]*)"$`, theShipNavigationStatusIsNow)
	ctx.Step(`^the ship navigation status should transition to "([^"]*)"$`, theShipNavigationStatusShouldTransitionTo)
	ctx.Step(`^the ship "([^"]*)" should be marked as abandoned$`, theShipShouldBeMarkedAsAbandoned)
	ctx.Step(`^the ship "([^"]*)" should be removed from watch list$`, theShipShouldBeRemovedFromWatchList)
	ctx.Step(`^the stale assignment for ship "([^"]*)" should be detected$`, theStaleAssignmentForShipShouldBeDetected)
	ctx.Step(`^the stuck ship count should be (\d+)$`, theStuckShipCountShouldBe)
	ctx.Step(`^the stuck ship "([^"]*)" should be detected$`, theStuckShipShouldBeDetected)
	ctx.Step(`^the stuck ship "([^"]*)" should not be detected$`, theStuckShipShouldNotBeDetected)
	ctx.Step(`^the success rate should be (\d+) percent$`, theSuccessRateShouldBePercent)
	ctx.Step(`^the third request should be delayed$`, theThirdRequestShouldBeDelayed)
	ctx.Step(`^the total recovery attempts should be (\d+)$`, theTotalRecoveryAttemptsShouldBe)
	ctx.Step(`^the total time should account for both backoff and rate limiting$`, theTotalTimeShouldAccountForBothBackoffAndRateLimiting)
	ctx.Step(`^the wait time should be approximately (\d+)ms$`, theWaitTimeShouldBeApproximatelyMs)
	ctx.Step(`^the waypoint should have x coordinate (\d+)\.(\d+)$`, theWaypointShouldHaveXCoordinate)
	ctx.Step(`^the waypoint should have y coordinate (\d+)\.(\d+)$`, theWaypointShouldHaveYCoordinate)
	ctx.Step(`^then first segment should execute$`, thenFirstSegmentShouldExecute)
	ctx.Step(`^then navigation to "([^"]*)" should begin$`, thenNavigationToShouldBegin)
	ctx.Step(`^then respond with status (\d+)$`, thenRespondWithStatus)
	ctx.Step(`^then segment to B(\d+) should execute$`, thenSegmentToBShouldExecute)
	ctx.Step(`^there should be (\d+) retry attempt$`, thereShouldBeRetryAttempt)
	ctx.Step(`^there should be (\d+) retry attempts$`, thereShouldBeRetryAttempts)
	ctx.Step(`^tokens should not exceed the burst size$`, tokensShouldNotExceedTheBurstSize)
	ctx.Step(`^total execution time should be approximately (\d+) seconds$`, totalExecutionTimeShouldBeApproximatelySeconds)
	ctx.Step(`^(\d+) total HTTP attempts should have been made$`, totalHTTPAttemptsShouldHaveBeenMade)
	ctx.Step(`^total sleep time should be (\d+) seconds$`, totalSleepTimeShouldBeSeconds)
	ctx.Step(`^wait time should be (\d+) seconds$`, waitTimeShouldBeSeconds)
	ctx.Step(`^waypoint "([^"]*)" has no fuel available$`, waypointHasNoFuelAvailable)
	ctx.Step(`^waypoint "([^"]*)" has trait "([^"]*)" and fuel available$`, waypointHasTraitAndFuelAvailable)
}
[0m
--- FAIL: TestFeatures (39.60s)
    --- FAIL: TestFeatures/Deliver_to_contract_before_accepting_raises_error (0.04s)
        suite.go:640: expected error 'contract not accepted', got nil
    --- FAIL: TestFeatures/Cannot_start_transit_to_same_location (0.03s)
        suite.go:640: expected error containing 'cannot transit to same location' but got no error
    --- FAIL: TestFeatures/Build_graph_from_API_when_cache_is_empty (0.04s)
        suite.go:640: expected success but got error: Waypoint X1-NEW-B1 not found in cache for system X1-NEW. Destination waypoint is missing from waypoint cache. Please sync waypoints from API.
    --- FAIL: TestFeatures/Reject_navigation_with_empty_waypoint_cache (0.04s)
        suite.go:640: expected error containing 'waypoint cache is empty' but command succeeded
    --- FAIL: TestFeatures/Reject_navigation_when_ship_location_missing_from_cache (0.02s)
        suite.go:640: expected error containing 'Ship location is missing from waypoint cache' but command succeeded
    --- FAIL: TestFeatures/Reject_navigation_when_destination_missing_from_cache (0.02s)
        suite.go:640: expected error containing 'Destination waypoint is missing from waypoint cache' but command succeeded
    --- FAIL: TestFeatures/Route_not_found_-_provide_detailed_statistics (0.04s)
        suite.go:640: expected error to mention 'No route found' but got 'failed to get ship: failed to convert ship data: failed to get location waypoint: waypoint not found: X1-GZ7-A1'
    --- FAIL: TestFeatures/Ship_already_at_destination_-_return_success_immediately (0.05s)
        suite.go:640: runtime error: invalid memory address or nil pointer dereference
            runtime.gopanic
            	/usr/local/go1.24.7/src/runtime/panic.go:792
            runtime.panicmem
            	/usr/local/go1.24.7/src/runtime/panic.go:262
            runtime.sigpanic
            	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
            github.com/andrescamacho/spacetraders-go/internal/domain/navigation.(*Route).Segments
            	/home/user/spacetraders/gobot/internal/domain/navigation/route.go:148
            github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*routeContext).theRouteShouldHaveSegments
            	/home/user/spacetraders/gobot/test/bdd/steps/route_steps.go:195
            reflect.Value.call
            	/usr/local/go1.24.7/src/reflect/value.go:584
            reflect.Value.Call
            	/usr/local/go1.24.7/src/reflect/value.go:368
            github.com/cucumber/godog/internal/models.(*StepDefinition).Run
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
            github.com/cucumber/godog.(*suite).runStep
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
            github.com/cucumber/godog.(*suite).runSteps
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
            github.com/cucumber/godog.(*suite).runPickle.func1
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
            testing.tRunner
            	/usr/local/go1.24.7/src/testing/testing.go:1792
            runtime.goexit
            	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700
    --- FAIL: TestFeatures/Successfully_navigate_ship_from_orbit (0.04s)
        suite.go:640: expected arrival time in response
    --- FAIL: TestFeatures/Navigate_ship_that_is_docked_(auto-orbits_first) (0.04s)
        suite.go:640: expected success but got error: failed to navigate: failed to navigate ship: failed to start transit: ship must be in orbit to start transit, currently: DOCKED
    --- FAIL: TestFeatures/Handle_ship_already_in_transit_-_wait_for_arrival_first (0.04s)
        suite.go:640: expected route execution to succeed but got error: failed to fetch ship data from API: failed to find player: player not found: 1
    --- FAIL: TestFeatures/Circuit_breaker_wraps_entire_retry_sequence (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_opens_after_multiple_failed_retry_sequences (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Open_circuit_prevents_retry_attempts (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Successful_requests_reset_circuit_breaker_failure_count (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiting_applies_to_retry_attempts (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Multiple_concurrent_requests_with_retries_respect_rate_limit (0.05s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Open_circuit_prevents_rate_limiter_from_being_used (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_breaker_state_transitions_don't_affect_rate_limiting (0.05s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_breaker,_retries,_and_rate_limiting_work_harmoniously (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Non-retryable_error_does_not_count_toward_circuit_breaker_threshold (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Context_cancellation_bypasses_all_resilience_patterns (0.05s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_recovery_after_timeout_allows_new_requests (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Handling_SpaceTraders_API_maintenance_window (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Handling_temporary_network_issues (0.05s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Handling_rate_limit_errors_with_backoff (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Fast_path_for_successful_requests (0.05s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Metrics_and_observability (0.04s)
        suite.go:640: NOT IMPLEMENTED: API integration step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_starts_in_closed_state (0.03s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_opens_after_max_consecutive_failures (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_remains_open_within_timeout_period (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_transitions_to_half-open_after_timeout_expires (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Failure_in_half-open_state_reopens_circuit (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Success_in_half-open_state_closes_circuit (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_does_not_open_with_non-consecutive_failures (0.03s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Manual_reset_closes_circuit_and_clears_failures (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_breaker_tracks_state_transitions_correctly (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Circuit_breaker_prevents_cascading_failures (0.04s)
        suite.go:640: NOT IMPLEMENTED: Circuit breaker step definitions need to be implemented
    --- FAIL: TestFeatures/Allow_burst_of_requests_within_limit (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Throttle_third_request_in_same_second (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_refills_after_1_second (0.05s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Multiple_concurrent_requests_respect_rate_limit (0.05s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_is_thread-safe_under_concurrent_load (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Burst_allows_immediate_requests_up_to_burst_size (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Tokens_refill_at_specified_rate (0.05s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Tokens_do_not_exceed_burst_capacity (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Single_request_does_not_get_throttled (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Requests_spread_over_time_do_not_trigger_throttling (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_allows_sustained_rate_of_2_req/sec (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Waiting_request_is_cancelled_when_context_is_cancelled (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_prevents_bursting_beyond_API_limits (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_works_with_retry_logic (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_has_minimal_overhead_for_allowed_requests (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_accurately_delays_throttled_requests (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_validates_positive_rate (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Rate_limiter_validates_positive_burst (0.04s)
        suite.go:640: NOT IMPLEMENTED: Rate limiting step definitions need to be implemented
    --- FAIL: TestFeatures/Request_succeeds_on_first_attempt (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Request_succeeds_on_second_attempt_after_transient_failure (0.03s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Request_succeeds_on_third_attempt_with_exponential_backoff (0.03s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_429_Too_Many_Requests (0.02s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_500_Internal_Server_Error (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_502_Bad_Gateway (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_503_Service_Unavailable (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_504_Gateway_Timeout (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_400_Bad_Request (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_401_Unauthorized (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_403_Forbidden (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_404_Not_Found (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_409_Conflict (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Fail_after_max_retries_exceeded (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Exponential_backoff_delays_increase_correctly (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_connection_refused (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Retry_on_timeout (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Do_not_retry_on_context_cancelled (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Respect_Retry-After_header_on_429_response (0.04s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Use_exponential_backoff_when_Retry-After_is_not_provided (0.05s)
        suite.go:640: NOT IMPLEMENTED: Retry logic step definitions need to be implemented
    --- FAIL: TestFeatures/Upsert_with_empty_trade_goods_list (0.05s)
        suite.go:640: expected 1 market records, got 0
    --- FAIL: TestFeatures/Daemon_server_fails_to_start_if_socket_path_is_invalid (0.04s)
        suite.go:640: expected error mentioning 'failed to create unix socket listener' but got no error
    --- FAIL: TestFeatures/Daemon_server_creates_container_for_navigation_operation (0.15s)
        suite.go:640: runtime error: invalid memory address or nil pointer dereference
            runtime.gopanic
            	/usr/local/go1.24.7/src/runtime/panic.go:792
            runtime.panicmem
            	/usr/local/go1.24.7/src/runtime/panic.go:262
            runtime.sigpanic
            	/usr/local/go1.24.7/src/runtime/signal_unix.go:925
            github.com/andrescamacho/spacetraders-go/internal/domain/container.(*Container).PlayerID
            	/home/user/spacetraders/gobot/internal/domain/container/container.go:119
            github.com/andrescamacho/spacetraders-go/test/bdd/steps.(*containerLifecycleContext).theContainerShouldHavePlayerID
            	/home/user/spacetraders/gobot/test/bdd/steps/container_lifecycle_steps.go:812
            reflect.Value.call
            	/usr/local/go1.24.7/src/reflect/value.go:584
            reflect.Value.Call
            	/usr/local/go1.24.7/src/reflect/value.go:368
            github.com/cucumber/godog/internal/models.(*StepDefinition).Run
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/internal/models/stepdef.go:241
            github.com/cucumber/godog.(*suite).runStep
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:291
            github.com/cucumber/godog.(*suite).runSteps
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:582
            github.com/cucumber/godog.(*suite).runPickle.func1
            	/root/go/pkg/mod/github.com/cucumber/godog@v0.15.1/suite.go:638
            testing.tRunner
            	/usr/local/go1.24.7/src/testing/testing.go:1792
            runtime.goexit
            	/usr/local/go1.24.7/src/runtime/asm_amd64.s:1700
    --- FAIL: TestFeatures/Daemon_server_tracks_multiple_concurrent_operations (0.15s)
        suite.go:640: expected 0 containers, got 3
    --- FAIL: TestFeatures/Daemon_server_removes_Unix_socket_on_shutdown (0.14s)
        suite.go:640: socket file still exists at /tmp/test-daemon.sock
    --- FAIL: TestFeatures/agent_symbol_is_used_when_player_id_is_zero (0.04s)
        suite.go:640: expected resolved player_id to be 1, got 0
    --- FAIL: TestFeatures/Ship_can_be_assigned_to_container (0.05s)
        suite.go:640: ship TEST-SHIP-1 is not assigned to any container
    --- FAIL: TestFeatures/Ship_cannot_be_assigned_to_multiple_containers (0.05s)
        suite.go:640: expected error containing 'ship is already assigned to another container' but got 'ship TEST-SHIP-1 does not exist'
    --- FAIL: TestFeatures/Ship_assignment_persists_in_database (0.05s)
        suite.go:640: no assignment to persist
    --- FAIL: TestFeatures/Ship_assignment_is_released_when_container_stops (0.04s)
        suite.go:640: no assignment to check released_at timestamp
    --- FAIL: TestFeatures/Ship_assignment_is_released_when_container_fails (0.04s)
        suite.go:640: no assignment to check released_at timestamp
    --- FAIL: TestFeatures/Orphaned_ship_assignments_are_cleaned_on_daemon_startup (0.04s)
        suite.go:640: ship TEST-SHIP-1 does not exist
    --- FAIL: TestFeatures/Ship_assignment_includes_player_id_validation (0.04s)
        suite.go:640: expected error containing 'ship player_id mismatch' but got 'ship OTHER-SHIP-1 does not exist'
    --- FAIL: TestFeatures/Ship_assignment_prevents_concurrent_navigation_commands (0.04s)
        suite.go:640: expected command error containing 'ship is locked by container' but got no error
    --- FAIL: TestFeatures/Ship_assignment_allows_read-only_queries_during_lock (0.04s)
        suite.go:640: expected assignment_status 'locked' but got 'unlocked'
    --- FAIL: TestFeatures/Ship_assignment_lock_timeout_after_30_minutes (0.04s)
        suite.go:640: no assignment found
    --- FAIL: TestFeatures/Ship_assignment_reacquire_fails_if_still_locked (0.04s)
        suite.go:640: expected error containing 'ship is still locked' but got 'ship not assigned'
    bdd_test.go:22: non-zero status returned, failed to run feature tests
FAIL
coverage: 61.5% of statements in ./...
FAIL	github.com/andrescamacho/spacetraders-go/test/bdd	39.836s
	github.com/andrescamacho/spacetraders-go/test/bdd/steps		coverage: 0.0% of statements
FAIL
